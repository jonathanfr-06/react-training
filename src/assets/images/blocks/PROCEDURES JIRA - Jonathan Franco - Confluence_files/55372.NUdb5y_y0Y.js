(self._cf=self._cf||[]).push([[55372],{959088:(e,t,a)=>{"use strict";a.d(t,{Z:()=>m});var l=a(615919),s=a(840506),o=a(747472),n=a(898789),i=a(85278),c=a(16728),r=a(353356),u=a(304712);const d=({description:e,title:t})=>{const{formatMessage:a}=(0,o.Z)();return s.createElement(n.Z,{icon:s.createElement(i.default,{primaryColor:`var(--ds-icon-success, ${c.eE})`,label:"Success"}),id:"feedbackSent",description:e||a(r.s.feedbackSuccessFlagDescription),title:t||a(r.s.feedbackSuccessFlagTitle)})};d.displayName="FeedbackFlag";const p=e=>s.createElement(u.Z,{locale:e.locale},s.createElement(d,(0,l.Z)({},e)));p.displayName="FeedbackFlagWithIntl";const m=p},304712:(e,t,a)=>{"use strict";a.d(t,{Z:()=>o});var l=a(840506),s=a(659898);const o=({children:e,locale:t})=>{const[o,n]=(0,l.useState)();return(0,l.useEffect)((()=>{(async()=>{if(t){const e=await(async e=>{e=e.replace("-","_");try{return(await a(365674)(`./${e}`)).default}catch(t){}try{const t=e.split(/[-_]/)[0];return(await a(365674)(`./${t}`)).default}catch(t){}})(t);n(e)}})()}),[t]),l.createElement(s.Z,{locale:t||"en",defaultLocale:"en",messages:o},e)};o.displayName="IntlProviderWithResolvedMessages"},955372:(e,t,a)=>{"use strict";a.r(t),a.d(t,{FeedbackButton:()=>N,FeedbackFlag:()=>x.Z,FeedbackForm:()=>V,default:()=>G});var l=a(615919),s=a(840506),o=a(747472),n=a(555687),i=a(65472),c=a(857087),r=a(353356),u=a(199009),d=a(922213),p=a(24359);const m=e=>["/gateway/api"].includes(e);var b=a(872342),f=a(142807),h=a(384746),g=a(645159),y=a(79198),k=a(762144),v=a(805643),F=a(884185),L=a(811836),E=a(815526),C=a(416595),I=a(272169),Z=a(364633),D=a(195482),w=a(539474),S=a(16728),T=a(304712);const B=["id"],M=["locale"],O=({showTypeField:e=!0,showDefaultTextFields:t=!0,customContent:a,onClose:i,onSubmit:c,feedbackTitle:u,feedbackTitleDetails:d,feedbackGroupLabels:p,summaryPlaceholder:m,canBeContactedLabel:T,enrolInResearchLabel:M,submitButtonLabel:O,cancelButtonLabel:A,anonymousFeedback:V,hasDescriptionDefaultValue:P,selectLabel:x,customTextAreaLabel:R})=>{const[_,N]=(0,s.useState)(!1),[G,q]=(0,s.useState)(""),[U,$]=(0,s.useState)(!1),[j,W]=(0,s.useState)("empty"),[z,J]=(0,s.useState)(!1),{formatMessage:Q}=(0,o.Z)(),H=()=>"empty"!==j,Y=H()||!e,K=G||P,X=e&&!H()||!K,ee=e=>(null==e?void 0:e.empty.selectOptionLabel)||Q(r.s.selectionOptionDefaultPlaceholder),te=(0,s.useRef)();return s.createElement(F.Z,{shouldCloseOnOverlayClick:!1,shouldCloseOnEscapePress:!1,autoFocus:te,onClose:i,testId:"feedbackCollectorModalDialog"},s.createElement(g.ZP,{onSubmit:async()=>{J(!0),await c({canBeContacted:_,description:G,enrollInResearchGroup:U,type:j}),J(!1)}},(({formProps:o})=>{return s.createElement("form",(0,l.Z)({},o),s.createElement(L.default,null,s.createElement(E.default,null,u||s.createElement(f.Z,(0,l.Z)({},r.s.feedbackTitle))),s.createElement(n.Z,{style:{lineHeight:"normal"},spacing:"none",onClick:i,appearance:"subtle"},s.createElement(v.default,{label:"Close Modal",primaryColor:`var(--ds-text-subtle, ${S.Mx})`}))),s.createElement(C.default,null,s.createElement("p",{style:{color:`var(--ds-text-subtle, ${S.hH})`,marginBottom:"var(--ds-space-300, 24px)"}},Q(r.s.requiredFieldsSummary),s.createElement(y.Z,null)),d,a,e?s.createElement(k.Z,{name:"topic",label:x||Q(r.s.selectionOptionDefaultLabel),isRequired:!0},(e=>{let{fieldProps:{id:t}}=e,a=(0,b.Z)(e.fieldProps,B);return s.createElement(D.Z,(0,l.Z)((0,l.Z)({},a),{},{onChange:e=>{!e||e instanceof Array||W(e.value)},menuPortalTarget:document.body,styles:{menuPortal:e=>(0,l.Z)((0,l.Z)({},e),{},{zIndex:9999})},options:(o=p,[{label:(null==o?void 0:o.question.selectOptionLabel)||Q(r.s.selectionOptionQuestionLabel),value:"question"},{label:(null==o?void 0:o.comment.selectOptionLabel)||Q(r.s.selectionOptionCommentLabel),value:"comment"},{label:(null==o?void 0:o.bug.selectOptionLabel)||Q(r.s.selectionOptionBugLabel),value:"bug"},{label:(null==o?void 0:o.suggestion.selectOptionLabel)||Q(r.s.selectionOptionSuggestionLabel),value:"suggestion"}]),ref:te,placeholder:ee(p),inputId:t}));var o})):null,t&&Y&&s.createElement(s.Fragment,null,s.createElement(k.Z,{label:e?(c=p,{bug:(null==c?void 0:c.bug.fieldLabel)||Q(r.s.formBugLabel),comment:(null==c?void 0:c.comment.fieldLabel)||Q(r.s.formCommentLabel),suggestion:(null==c?void 0:c.suggestion.fieldLabel)||Q(r.s.formSuggestionLabel),question:(null==c?void 0:c.question.fieldLabel)||Q(r.s.formQuestionLabel),empty:(null==c?void 0:c.empty.fieldLabel)||Q(r.s.formEmptyLabel)})[j]:R||Q(r.s.defaultCustomTextAreaLabel),isRequired:!0,name:"description"},(({fieldProps:e})=>s.createElement(w.Z,(0,l.Z)((0,l.Z)({},e),{},{name:"foo",minimumRows:6,placeholder:m||void 0,onChange:e=>q(e.target.value),value:G})))),!V&&s.createElement(s.Fragment,null,s.createElement(k.Z,{name:"can-be-contacted"},(({fieldProps:e})=>s.createElement(h.Z,(0,l.Z)((0,l.Z)({},e),{},{label:T||s.createElement(f.Z,(0,l.Z)((0,l.Z)({},r.s.canBeContactedLabel),{},{values:{a:e=>s.createElement("a",{href:"https://www.atlassian.com/legal/privacy-policy",target:"_blank"},e)}})),onChange:e=>N(e.target.checked)})))),s.createElement(k.Z,{name:"enroll-in-research-group"},(({fieldProps:e})=>s.createElement(h.Z,(0,l.Z)((0,l.Z)({},e),{},{label:M||Q(r.s.enrolInResearchLabel),onChange:e=>$(e.target.checked)})))))||s.createElement(s.Fragment,null,s.createElement(k.Z,{name:"anonymousFeedback"},(()=>s.createElement(Z.Z,{title:Q(r.s.feedbackIsAnonymousTitle),appearance:"information"},s.createElement("p",null,Q(r.s.feedbackIsAnonymous)))))))),s.createElement(I.default,null,s.createElement(n.Z,{appearance:"subtle",onClick:i},A||s.createElement(f.Z,(0,l.Z)({},r.s.cancelButtonLabel))),s.createElement(n.Z,{appearance:"primary",type:"submit",isDisabled:z||X,testId:"feedbackCollectorSubmitBtn"},O||s.createElement(f.Z,(0,l.Z)({},r.s.submitButtonLabel)))));var c})))};O.displayName="FeedbackForm";const A=e=>{let{locale:t}=e,a=(0,b.Z)(e,M);return s.createElement(T.Z,{locale:t},s.createElement(O,(0,l.Z)({},a)))};A.displayName="FeedbackFormWithIntl";const V=A;class P extends s.Component{constructor(...e){super(...e),(0,u.Z)(this,"state",{anonymousFeedback:!0}),(0,u.Z)(this,"postFeedback",(async e=>{const t=this.props.entrypointId;let a=this.getFeedbackUrl();if(t){const t=await this.mapFormToJSD(e),s={feedback:(0,l.Z)({entrypointId:this.props.entrypointId,entrypointUiVersion:this.getPackageVersion()},t)};m(a)?a+="/feedback-collector-api":this.props.customFeedbackUrl||(a="https://feedback-collector-api.services.atlassian.com");const o=d.Buffer.from(JSON.stringify(s)).toString("base64");fetch(`${a}/v2/feedback`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:o}),credentials:"include"})}this.props.onClose(),setTimeout((()=>this.props.onSubmit(e)),this.props.timeoutOnSubmit)}))}async componentDidMount(){const e=!(await this.shouldShowOptInCheckboxesNew());this.setState({anonymousFeedback:e})}getGatewayUrl(){const{customGatewayUrl:e,url:t}=this.props;return e||(t||P.defaultProps.url)}getFeedbackUrl(){const{customFeedbackUrl:e,url:t}=this.props;return e||(t||P.defaultProps.url)}getPackageVersion(){return"0.0.0-use.local"}async getEntitlementInformation(){var e,t,a,s,o;const n=this.getGatewayUrl();let i,c,r,u,d;if(window.location.host.includes("bitbucket.org")){var p;i="Bitbucket",u="bitbucket",r=JSON.parse(JSON.stringify(null===(p=document.querySelector('meta[id="bb-bootstrap"]'))||void 0===p?void 0:p.getAttribute("data-current-user")));c=r.hasPremium?"PREMIUM":"STANDARD"}else if(["trellis.coffee","trello.com"].includes(window.location.host))i="Trello",u="trello";else{document.querySelector('meta[id="confluence-context-path"]')?(i="Confluence",u="pricingplan.confluence.ondemand"):(i="Jira",u="jira-software.ondemand");try{r=await fetch(`${n}/customer-context/entitlements/${window.location.host}`,(0,l.Z)({method:"GET",headers:{"Content-Type":"application/json"}},m(n)?{credentials:"include"}:{}))}catch(g){r=void 0}}const b=[],f=(null===(e=r)||void 0===e?void 0:e.cloudSiteId)||"";var h;null!==(t=r)&&void 0!==t&&t.children&&(d=null===(h=r)||void 0===h?void 0:h.children.find((e=>e.key===u)));return b.push({id:"product",value:i?null===(a=i)||void 0===a?void 0:a.toLowerCase():""},{id:"hostingType",value:null!==(s=d)&&void 0!==s&&s.product?d.product.hostingType:"CLOUD"},{id:"entitlementEdition",value:null!==(o=c)&&void 0!==o?o:""},{id:"cloudId",value:f}),b}getTypeFieldValue(e){switch(e){case"bug":return this.props.typeBugDefaultValue;case"comment":return this.props.typeCommentDefaultValue;case"suggestion":return this.props.typeSuggestionDefaultValue;case"question":return this.props.typeQuestionDefaultValue;default:return this.props.typeEmptyDefaultValue}}async getAtlassianID(){const{atlassianAccountId:e,shouldGetEntitlementDetails:t}=this.props;try{if(e||!t)return e;const a=this.getGatewayUrl(),s=await fetch(`${a}/me`,(0,l.Z)({method:"GET",headers:{"Content-Type":"application/json"}},m(a)?{credentials:"include"}:{}));return(await s.json()).account_id}catch(a){return}}shouldShowOptInCheckboxes(){if(this.props.anonymousFeedback)return!this.props.anonymousFeedback;if(this.props.atlassianAccountId)return!0;let e;return this.getAtlassianID().then((t=>{e=void 0!==t})).catch((()=>{e=!1})),e}shouldShowOptInCheckboxesNew(){return new Promise((e=>{this.props.anonymousFeedback&&e(!this.props.anonymousFeedback),this.props.atlassianAccountId&&e(!0),this.getAtlassianID().then((t=>{e(void 0!==t)})).catch((()=>{e(!1)}))}))}getDescription(e){return e.description||this.props.descriptionDefaultValue}getSummary(e){return((e,t=100)=>function(e,t){return e&&t?e.length<=t?e:e.substring(0,t)+"...":e}(e.replace(/\n/g," "),t))(e.description,this.props.summaryTruncateLength)||this.props.summaryDefaultValue}getCustomerName(){var e;return null!==(e=this.props.name)&&void 0!==e?e:this.props.customerNameDefaultValue}addEmailToContext(){const e=this.props.additionalFields.find((e=>"customfield_10047"===e.id));e?e.value=`${e.value}\n        email: ${this.props.email}`:this.props.additionalFields.push({id:"customfield_10047",value:`email: ${this.props.email}`})}async mapFormToJSD(e){let t=null;this.props.shouldGetEntitlementDetails&&(t=await this.getEntitlementInformation()),this.props.email&&this.addEmailToContext();const a=await this.getAtlassianID();return{fields:[...null!==t&&t||[],this.props.showTypeField?{id:this.props.typeFieldId,value:this.getTypeFieldValue(e.type)}:void 0,{id:this.props.summaryFieldId,value:this.getSummary(e)},{id:this.props.descriptionFieldId,value:this.getDescription(e)},{id:"aaidOrHash",value:e.canBeContacted?a:void 0},{id:this.props.customerNameFieldId,value:this.getCustomerName()},e.canBeContacted?{id:this.props.canBeContactedFieldId,value:this.props.canBeContactedAgreeValue}:{id:this.props.canBeContactedFieldId,value:this.props.canBeContactedDeclineValue},e.enrollInResearchGroup?{id:this.props.enrollInResearchFieldId,value:this.props.enrollInResearchAgreeValue}:{id:this.props.enrollInResearchFieldId,value:this.props.enrollInResearchDeclineValue},...this.props.additionalFields].filter(Boolean)}}render(){const e=!this.shouldShowOptInCheckboxes();return s.createElement(V,{customContent:this.props.customContent,feedbackTitle:this.props.feedbackTitle,feedbackTitleDetails:this.props.feedbackTitleDetails,showTypeField:this.props.showTypeField,showDefaultTextFields:this.props.showDefaultTextFields,hasDescriptionDefaultValue:!!this.props.descriptionDefaultValue,canBeContactedLabel:this.props.canBeContactedLabel,enrolInResearchLabel:this.props.enrolInResearchLabel,summaryPlaceholder:this.props.summaryPlaceholder,submitButtonLabel:this.props.submitButtonLabel,cancelButtonLabel:this.props.cancelButtonLabel,feedbackGroupLabels:this.props.feedbackGroupLabels,onSubmit:this.postFeedback,onClose:this.props.onClose,locale:this.props.locale,anonymousFeedback:(0,p.e)("platform.proforma-form-builder-feedback_hupaz")?this.state.anonymousFeedback:e,selectLabel:this.props.selectLabel,customTextAreaLabel:this.props.customTextAreaLabel})}}P.displayName="FeedbackCollector",(0,u.Z)(P,"defaultProps",{url:"/gateway/api",shouldGetEntitlementDetails:!0,canBeContactedFieldId:"customfield_10043",canBeContactedAgreeValue:[{id:"10109"}],canBeContactedDeclineValue:[{id:"10111"}],additionalFields:[],customerNameFieldId:"customfield_10045",customerNameDefaultValue:"unknown",descriptionFieldId:"description",descriptionDefaultValue:"",enrollInResearchFieldId:"customfield_10044",enrollInResearchAgreeValue:[{id:"10110"}],enrollInResearchDeclineValue:[{id:"10112"}],summaryFieldId:"summary",summaryDefaultValue:"",summaryTruncateLength:100,timeoutOnSubmit:700,typeFieldId:"customfield_10042",typeBugDefaultValue:{id:"10105"},typeCommentDefaultValue:{id:"10106"},typeSuggestionDefaultValue:{id:"10107"},typeQuestionDefaultValue:{id:"10108"},typeEmptyDefaultValue:{id:"empty"},showTypeField:!0,showDefaultTextFields:!0,anonymousFeedback:!1,onClose:()=>{},onSubmit:()=>{}});var x=a(959088);const R=e=>{const[t,a]=(0,s.useState)(!1),[l,u]=(0,s.useState)(!1),{formatMessage:d}=(0,o.Z)(),{entrypointId:p,atlassianAccountId:m,shouldGetEntitlementDetails:b}=e;return s.createElement(s.Fragment,null,s.createElement(n.Z,{onClick:()=>a(!0),iconBefore:s.createElement(c.default,{label:d(r.s.feedbackIconLabel),size:"small"})},d(r.s.giveFeedback)),t&&s.createElement(P,{onClose:()=>a(!1),onSubmit:()=>u(!0),atlassianAccountId:m,entrypointId:p,shouldGetEntitlementDetails:b}),s.createElement(i.ZP,{onDismissed:()=>u(!1)},l&&s.createElement(x.Z,null)))},_=e=>{const{locale:t}=(0,o.Z)();return s.createElement(T.Z,{locale:t},s.createElement(R,(0,l.Z)({},e)))};_.displayName="FeedbackButtonWithIntl";const N=_,G=P},353356:(e,t,a)=>{"use strict";a.d(t,{s:()=>l});const l=(0,a(93972).defineMessages)({feedbackTitle:{id:"feedback-collector.feedback-title",defaultMessage:"Share your thoughts"},enrolInResearchLabel:{id:"feedback-collector.enrol-in-research.label",defaultMessage:"I'd like to participate in product research"},canBeContactedLabel:{id:"feedback-collector.can-be-contacted.label",defaultMessage:"Yes, Atlassian teams can contact me to learn about my experiences to improve Atlassian products and services. I acknowledge the <a>Atlassian Privacy Policy</a>."},summaryPlaceholder:{id:"feedback-collector.summary-placeholder",defaultMessage:"Let us know what's on your mind"},formCommentLabel:{id:"feedback-collector.form.comment.label",defaultMessage:"Let us know what's on your mind"},submitButtonLabel:{id:"feedback-collector.submit-button.label",defaultMessage:"Send feedback"},cancelButtonLabel:{id:"feedback-collector.cancel-button.label",defaultMessage:"Cancel"},giveFeedback:{id:"proforma-form-builder.give-feedback",defaultMessage:"Give feedback"},formBugLabel:{id:"feedback-collector.form.bug.label",defaultMessage:"Describe the bug or issue"},formSuggestionLabel:{id:"feedback-collector.form.suggestion.label",defaultMessage:"Let us know what you'd like to improve"},formQuestionLabel:{id:"feedback-collector.form.question.label",defaultMessage:"What would you like to know?"},formEmptyLabel:{id:"feedback-collector.form.empty.label",defaultMessage:"Select an option"},selectionOptionQuestionLabel:{id:"feedback-collector.option.question.label",defaultMessage:"Ask a question"},selectionOptionCommentLabel:{id:"feedback-collector.option.comment.label",defaultMessage:"Leave a comment"},selectionOptionBugLabel:{id:"feedback-collector.option.bug.label",defaultMessage:"Report a bug"},selectionOptionSuggestionLabel:{id:"feedback-collector.option.suggestion.label",defaultMessage:"Suggest an improvement"},selectionOptionDefaultLabel:{id:"feedback-collector.option.default.label",defaultMessage:"Select feedback"},selectionOptionDefaultPlaceholder:{id:"feedback-collector.option.default.placeholder",defaultMessage:"Choose one"},feedbackIconLabel:{id:"proforma-form-builder.feedback-icon-label",defaultMessage:"Feedback"},feedbackSuccessFlagDescription:{id:"feedback-collector.success-flag.description",defaultMessage:"Your valuable feedback helps us continually improve our products."},feedbackSuccessFlagTitle:{id:"feedback-collector.success-flag.title",defaultMessage:"Thanks!"},feedbackIsAnonymousTitle:{id:"feedback-collector.anonymous.title",defaultMessage:"Anonymous feedback"},feedbackIsAnonymous:{id:"feedback-collector.anonymous",defaultMessage:"This feedback is being submitted anonymously. Atlassian will not be able to contact you directly regarding this feedback"},requiredFieldsSummary:{id:"feedback-collector.required.fields.summary",defaultMessage:"Required fields are marked with an asterisk"},defaultCustomTextAreaLabel:{id:"feedback-collector.default.custom.textarea.label",defaultMessage:"What's on your mind?"}})},365674:(e,t,a)=>{var l={"./":[802487,7143],"./cs":[166337,23146],"./cs.ts":[166337,23146],"./da":[504866,81263],"./da.ts":[504866,81263],"./de":[433446,74489],"./de.ts":[433446,74489],"./en":[422136,77136],"./en.ts":[422136,77136],"./en_GB":[46344,10506],"./en_GB.ts":[46344,10506],"./en_ZZ":[702037,77441],"./en_ZZ.ts":[702037,77441],"./es":[571336,37875],"./es.ts":[571336,37875],"./fi":[698061,14656],"./fi.ts":[698061,14656],"./fr":[329831,80515],"./fr.ts":[329831,80515],"./hu":[955798,58401],"./hu.ts":[955798,58401],"./index":[802487,7143],"./index.ts":[802487,7143],"./it":[790810,88280],"./it.ts":[790810,88280],"./ja":[324524,51404],"./ja.ts":[324524,51404],"./ko":[795555,13997],"./ko.ts":[795555,13997],"./nb":[487306,52250],"./nb.ts":[487306,52250],"./nl":[197582,63230],"./nl.ts":[197582,63230],"./pl":[577194,99025],"./pl.ts":[577194,99025],"./pt_BR":[519421,80978],"./pt_BR.ts":[519421,80978],"./ru":[324248,1641],"./ru.ts":[324248,1641],"./sv":[834849,73028],"./sv.ts":[834849,73028],"./th":[730859,57645],"./th.ts":[730859,57645],"./tr":[469188,72772],"./tr.ts":[469188,72772],"./uk":[357072,15239],"./uk.ts":[357072,15239],"./vi":[171421,61738],"./vi.ts":[171421,61738],"./zh":[74468,60767],"./zh.ts":[74468,60767],"./zh_TW":[850846,41847],"./zh_TW.ts":[850846,41847]};function s(e){if(!a.o(l,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=l[e],s=t[0];return a.e(t[1]).then((()=>a(s)))}s.keys=()=>Object.keys(l),s.id=365674,e.exports=s}}]);
//# sourceMappingURL=55372.NUdb5y_y0Y.js.map