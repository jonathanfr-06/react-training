"use strict";(self._cf=self._cf||[]).push([[84266,78363],{336712:(e,t,s)=>{s.r(t),s.d(t,{ExternalUserLozenge:()=>d,ExternalUserLozengeProps:()=>l});var n=s(615919),i=s(840506),r=s(93972),o=s(142807),a=s(480963),c=s(332072);const u=(0,r.defineMessages)({externalUserLozengeText:{id:"external-collab-ui.user-guest-lozenge",defaultMessage:"Guest"},guestUserTooltip:{id:"external-collab-ui.user-guest-lozenge.tooltip",defaultMessage:"Guests can only access certain spaces and have limited access to user info."}}),l={text:i.createElement(c.Z,{content:i.createElement(o.Z,(0,n.Z)({},u.guestUserTooltip))},i.createElement(o.Z,(0,n.Z)({},u.externalUserLozengeText))),appearance:"default",isBold:!1},d=()=>{const{text:e,appearance:t,isBold:s}=l;return i.createElement(a.Z,{appearance:t,isBold:s},e)};d.displayName="ExternalUserLozenge"},649567:(e,t,s)=>{s.d(t,{$:()=>n});const n=s(779076).ZP`fragment ExternalCollaboratorEntitlementFragment on Query{entitlements{externalCollaborator{isEntitled}}}`},189445:(e,t,s)=>{s.d(t,{D:()=>n});const n=e=>null==e?void 0:e.entitlements.externalCollaborator.isEntitled},635441:(e,t,s)=>{s.d(t,{Z:()=>i});var n=s(651410);function i(e,t,s,i,r,o){return(0,n.vv)(e,t,s,i,r,o)}},863750:(e,t,s)=>{s.d(t,{R:()=>E});var n=s(615919),i=s(199009),r=s(454812),o=s(636755),a=s(579141),c=s(301771),u=s(419539),l=s(336712),d=s(697674),h=s(734875);const m=(0,d.FO)({key:h.F6}),p="initialState",f="searchUser",g="succeeded",y="failed";class E extends r.ZP{constructor(e,t,s,n){super(t),(0,i.Z)(this,"userTeamEndpoint",void 0),(0,i.Z)(this,"teamMentionConfig",void 0),(0,i.Z)(this,"includeExternalCollaborators",void 0),this.teamMentionConfig=s,this.userTeamEndpoint=e,this.includeExternalCollaborators=n}async remoteInitialState(e){try{const t=await this.doSearch("",e);return this._notifyAnalyticsListeners(o.oX,p,g),t}catch(t){throw this._notifyAnalyticsListeners(o.oX,p,y),t}}async remoteSearch(e,t){try{const s=await this.doSearch(e,t);return this._notifyAnalyticsListeners(o.oX,f,g),s}catch(s){throw this._notifyAnalyticsListeners(o.oX,f,y),s}}async doSearch(e,t){m.start();const s=await this.post(await this.cloudId(),await this.orgId(),e,t);if(!s.ok){const e=await s.json();throw m.stop({customData:{isExCoEnabled:this.includeExternalCollaborators,success:!1}}),new Error(JSON.stringify(e))}const n=(await s.json()).recommendedUsers.map((e=>this.isUser(e)?this.convertToUserMention(e):(this.isTeam(e),this.convertToTeamMention(e))));return m.stop({customData:{isExCoEnabled:this.includeExternalCollaborators,success:!0}}),{query:e,mentions:n}}async cloudId(){const{cloudId:e}=await(0,u.g)();return e}async orgId(){const{orgId:e}=await(0,u.g)();return e}async post(e,t,s,i){return await(0,c.y)(this.userTeamEndpoint,{method:"POST",headers:{"content-type":"application/json"},credentials:"include",body:JSON.stringify({context:(0,n.Z)((0,n.Z)({contextType:"Mentions",principalId:"context",productKey:i&&i.product||"confluence",siteId:e,containerId:i&&i.containerId,objectId:i&&i.objectId,childObjectId:i&&i.childObjectId,mentionsSessionId:i&&i.sessionId},t?{organizationId:t}:{}),this.includeExternalCollaborators?{productAttributes:{isEntitledConfluenceExternalCollaborator:!0}}:{}),searchQuery:(0,n.Z)({queryString:s},this.includeExternalCollaborators?{productAccessPermissionIds:["write","external-collaborator-write"]}:{}),maxNumberOfResults:20,includeTeams:!0})})}isUser(e){return"USER"===e.entityType}convertToUserMention(e){var t;return(0,n.Z)({id:e.id,name:e.name||e.nickname||"",mentionName:e.nickname||"",avatarUrl:e.avatarUrl,accessLevel:e.accessLevel,userType:e.userType},null!=e&&null!==(t=e.attributes)&&void 0!==t&&t.isConfluenceExternalCollaborator?{lozenge:l.ExternalUserLozengeProps}:{})}isTeam(e){return"TEAM"===e.entityType}convertToTeamMention(e){const{teamLinkResolver:t}=this.teamMentionConfig;let s="";const n=`${window.location.origin}/people/team/${e.id}`;return"function"==typeof t&&(s=t(e.id)),{id:e.id,name:e.displayName,mentionName:e.displayName,avatarUrl:e.smallAvatarImageUrl,accessLevel:a.kI[a.kI.CONTAINER],userType:a.FW[a.FW.TEAM],context:{members:e.members,includesYou:e.includesYou,memberCount:e.memberCount,teamLink:s||n}}}}},688889:(e,t,s)=>{s.d(t,{Z:()=>l});var n=s(784569),i=s(649233),r=s(804929),o=s(9019),a=s(779076),c=s(649567);const u=a.ZP`query MentionsProviderQuery{...ExternalCollaboratorEntitlementFragment}${c.$}`,l=async()=>(0,n.WQ)().query({query:u}).then((({data:e})=>e)).catch((e=>{(0,r.UJ)().submitError(e,{attribution:o.x.MISSION_CONTROL}),(0,i.Xb)(e)}))},651410:(e,t,s)=>{s.d(t,{OC:()=>f,vv:()=>g});var n=s(971701),i=s(150539),r=s(419539),o=s(566887),a=s(189445),c=s(579141),u=s(301771);class l{getLookupLimit(){return 90}async lookupMentionNames(e){const t=e.reduce(((e,t,s)=>`${e}${s>0?"&":""}accountId=${encodeURIComponent(t)}`),"");return(0,u.y)(`/wiki/rest/api/user/bulk?${t}`,{credentials:"same-origin"}).then((e=>e.json())).then((e=>e&&e.results&&e.results.length?e.results.map((e=>({id:e.accountId,name:e.displayName,status:c.dP.OK}))):[]))}}var d=s(863750),h=s(688889);const m="/gateway/api/mentions",p="/gateway/api/teams/mentions";async function f(e,t,s,i,c,u){const{featureFlags:f}=await(0,r.g)(),g={url:`${m}/${e}`,productId:"micros-group/confluence",containerId:t||void 0,shouldHighlightMention:e=>e.id===s,debounceTime:150};if(f[o.sH]){g.inviteExperimentCohort=f[o.sH];const e=(f[o.sH]==o.wG.VARIATION_HOME||f[o.sH]==o.wG.VARIATION_SOURCE)&&!!c;e&&(g.productName="Confluence",g.shouldEnableInvite=e,g.onInviteItemClick=c,g.userRole=u)}const y={url:p,productId:"micros-group/confluence",shouldHighlightMention:e=>e.id===s};return g.mentionNameResolver=new n.j(new l,i),async function(e,t){let s=!1;const n=await(0,h.Z)();return s=!0===(0,a.D)(n),new d.R("/gateway/api/v1/recommendations",e,t,s)}(g,y)}async function g(e,t,s,n,r,o){if(!e)throw new Error("MentionResource cannot be configured without a cloud id");const a=(null==s?void 0:s.spaceId)||void 0;return{mentionResource:await f(e,a,t,n,r,o),presenceResource:new i.ZP({url:"/gateway/api/directory/graphql",cloudId:e,productId:"confluence"}),mentionServiceUrl:`${m}/${e}`,contextIdentifier:{containerId:a||"",objectId:(null==s?void 0:s.contentId)||"",childObjectId:(null==s?void 0:s.commentId)||""}}}},862545:(e,t,s)=>{s.d(t,{Z:()=>c});var n=s(615919),i=s(872342),r=s(840506),o=s(32807);const a=["analyticsContext"],c=e=>t=>{const s=(0,r.forwardRef)(((s,c)=>{let{analyticsContext:u}=s,l=(0,i.Z)(s,a);const d=(0,r.useMemo)((()=>(0,n.Z)((0,n.Z)({},e),u)),[u]);return r.createElement(o.Z,{data:d},r.createElement(t,(0,n.Z)((0,n.Z)({},l),{},{ref:c})))}));return s.displayName=`WithAnalyticsContext(${t.displayName||t.name})`,s}},480963:(e,t,s)=>{s.d(t,{Z:()=>u});var n=s(840506),i=s(789085),r=s(723177),o=s(429762);const a=(0,r.tu)({display:"inline-flex",borderRadius:"border.radius",blockSize:"min-content",position:"static",overflow:"hidden"}),c=(0,n.memo)((({children:e,testId:t,isBold:s=!1,appearance:r="default",maxWidth:c=200,style:u})=>{const h=s?"bold":"subtle",m=r in l[h]?r:"default",p="string"==typeof c?c:`${c}px`,f="string"==typeof c&&/%$/.test(c);return n.createElement(o.Z,{as:"span",backgroundColor:l[h][m],style:{backgroundColor:null==u?void 0:u.backgroundColor,maxWidth:f?c:"100%"},paddingInline:"space.050",xcss:a,testId:t},n.createElement(i.Z,{fontSize:"size.050",fontWeight:"bold",lineHeight:"lineHeight.100",textTransform:"uppercase",color:d[h][m],shouldTruncate:!0,UNSAFE_style:{color:null==u?void 0:u.color,maxWidth:f?"100%":`calc(${p} - var(--ds-space-100, 8px))`},testId:t&&`${t}--text`},e))}));c.displayName="Lozenge";const u=c,l={bold:{default:"color.background.neutral.bold",inprogress:"color.background.information.bold",moved:"color.background.warning.bold",new:"color.background.discovery.bold",removed:"color.background.danger.bold",success:"color.background.success.bold"},subtle:{default:"color.background.neutral",inprogress:"color.background.information",moved:"color.background.warning",new:"color.background.discovery",removed:"color.background.danger",success:"color.background.success"}},d={bold:{default:"inverse",inprogress:"inverse",moved:"warning.inverse",new:"inverse",removed:"inverse",success:"inverse"},subtle:{default:"subtle",inprogress:"information",moved:"warning",new:"discovery",removed:"danger",success:"success"}}},621130:(e,t,s)=>{s.d(t,{Z:()=>o});var n=s(840506),i=s(781775),r=s(362868);const o=()=>{const[e,t]=(0,n.useState)((0,i.Z)());return(0,n.useEffect)((()=>{const e=new r.Z((e=>t(e)));return e.observe(),()=>e.disconnect()}),[]),e}},327115:(e,t,s)=>{s.d(t,{p:()=>n});const n="fabric-elements"},971701:(e,t,s)=>{s.d(t,{j:()=>o});var n=s(199009),i=s(579141),r=s(636755);class o{constructor(e,t={}){(0,n.Z)(this,"client",void 0),(0,n.Z)(this,"nameCache",new Map),(0,n.Z)(this,"nameQueue",new Map),(0,n.Z)(this,"nameStartTime",new Map),(0,n.Z)(this,"processingQueue",new Map),(0,n.Z)(this,"debounce",0),(0,n.Z)(this,"fireHydrationEvent",void 0),(0,n.Z)(this,"processQueue",(()=>{clearTimeout(this.debounce),this.debounce=0;const{queue:e,extraQueue:t}=this.splitQueueAtLimit();this.nameQueue=t,this.processingQueue=new Map([...this.processingQueue,...e]),this.client.lookupMentionNames(Array.from(e.keys())).then((t=>{t.forEach((t=>{const{id:s}=t;e.delete(s),this.resolveQueueItem(t)})),e.forEach(((e,t)=>{this.resolveQueueItem({id:t,status:i.dP.UNKNOWN})}))})).catch((()=>{e.forEach(((e,t)=>{this.resolveQueueItem({id:t,status:i.dP.SERVICE_ERROR})}))})),this.nameQueue.size>0&&this.scheduleProcessQueue()})),this.client=e,this.fireHydrationEvent=(0,r.Ng)(t)}lookupName(e){const t=this.nameCache.get(e);return t?(this.fireAnalytics(!0,t),t):new Promise((t=>{const s=this.processingQueue.get(e);s&&this.processingQueue.set(e,[...s,t]);const n=this.nameQueue.get(e)||[];this.nameQueue.set(e,[...n,t]),0!==n.length||s||this.nameStartTime.set(e,Date.now()),this.scheduleProcessQueue(),this.isQueueAtLimit()&&this.processQueue()}))}cacheName(e,t){this.nameCache.set(e,{id:e,name:t,status:i.dP.OK})}scheduleProcessQueue(){this.debounce||(this.debounce=window.setTimeout(this.processQueue,o.waitForBatch))}isQueueAtLimit(){return this.nameQueue.size>=this.client.getLookupLimit()}splitQueueAtLimit(){const e=Array.from(this.nameQueue.entries()),t=this.client.getLookupLimit();return{queue:new Map(e.slice(0,t)),extraQueue:new Map(e.slice(t))}}resolveQueueItem(e){const{id:t}=e,s=this.processingQueue.get(t);s&&(this.processingQueue.delete(t),this.nameCache.set(t,e),s.forEach((t=>{try{t(e)}catch(s){}})),this.fireAnalytics(!1,e))}fireAnalytics(e,t){const{id:s}=t,n=t.status===i.dP.OK?"completed":"failed",r=this.nameStartTime.get(s),o=r?Date.now()-r:0;this.nameStartTime.delete(s),this.fireHydrationEvent(n,s,e,o)}}(0,n.Z)(o,"waitForBatch",100)},454812:(e,t,s)=>{s.d(t,{Hb:()=>m,ZP:()=>f,a3:()=>h,bj:()=>p});var n=s(615919),i=s(199009),r=s(599635),o=s(579141),a=s(635144),c=s(636755),u=s(394367),l=s.n(u);const d=()=>({params:{},headers:{}});class h{constructor(){(0,i.Z)(this,"changeListeners",void 0),(0,i.Z)(this,"errListeners",void 0),(0,i.Z)(this,"infoListeners",void 0),(0,i.Z)(this,"allResultsListeners",void 0),(0,i.Z)(this,"analyticsListeners",void 0),this.changeListeners=new Map,this.allResultsListeners=new Map,this.errListeners=new Map,this.infoListeners=new Map,this.analyticsListeners=new Map}subscribe(e,t,s,n,i,r){t&&this.changeListeners.set(e,t),s&&this.errListeners.set(e,s),n&&this.infoListeners.set(e,n),i&&this.allResultsListeners.set(e,i),r&&this.analyticsListeners.set(e,r)}unsubscribe(e){this.changeListeners.delete(e),this.errListeners.delete(e),this.infoListeners.delete(e),this.allResultsListeners.delete(e),this.analyticsListeners.delete(e)}}class m extends h{shouldHighlightMention(e){return!1}filter(e){throw new Error(`not yet implemented.\nParams: query=${e}`)}recordMentionSelection(e){}isFiltering(e){return!1}_notifyListeners(e,t){(0,a.ZP)("ak-mention-resource._notifyListeners",e&&e.mentions&&e.mentions.length,this.changeListeners),this.changeListeners.forEach(((s,n)=>{try{s(e.mentions.slice(0,20),e.query,t)}catch(i){(0,a.ZP)(`error from listener '${n}', ignoring`,i)}}))}_notifyAllResultsListeners(e){(0,a.ZP)("ak-mention-resource._notifyAllResultsListeners",e&&e.mentions&&e.mentions.length,this.changeListeners),this.allResultsListeners.forEach(((t,s)=>{try{t(e.mentions.slice(0,20),e.query)}catch(n){(0,a.ZP)(`error from listener '${s}', ignoring`,n)}}))}_notifyErrorListeners(e,t){this.errListeners.forEach(((s,n)=>{try{s(e,t)}catch(i){(0,a.ZP)(`error from listener '${n}', ignoring`,i)}}))}_notifyInfoListeners(e){this.infoListeners.forEach(((t,s)=>{try{t(e)}catch(n){(0,a.ZP)(`error from listener '${s}', ignoring`,n)}}))}_notifyAnalyticsListeners(e,t,s,n){this.analyticsListeners.forEach(((i,r)=>{try{i(e,t,s,n)}catch(o){(0,a.ZP)(`error from listener '${r}', ignoring`,o)}}))}}const p=e=>!!(e&&e.supportsMentionNameResolving&&e.supportsMentionNameResolving()),f=class extends m{constructor(e){super(),(0,i.Z)(this,"config",void 0),(0,i.Z)(this,"lastReturnedSearch",void 0),(0,i.Z)(this,"activeSearches",void 0),(0,i.Z)(this,"productName",void 0),(0,i.Z)(this,"shouldEnableInvite",void 0),(0,i.Z)(this,"inviteExperimentCohort",void 0),(0,i.Z)(this,"userRole",void 0),(0,i.Z)(this,"onInviteItemClick",void 0),this.verifyMentionConfig(e),this.config=e,this.lastReturnedSearch=0,this.activeSearches=new Set,this.productName=e.productName,this.shouldEnableInvite=!!e.shouldEnableInvite,this.inviteExperimentCohort=e.inviteExperimentCohort,this.onInviteItemClick=e.onInviteItemClick,this.userRole=e.userRole||"basic",this.config.debounceTime&&(this.filter=l()(this.filter,this.config.debounceTime))}shouldHighlightMention(e){return!!this.config.shouldHighlightMention&&this.config.shouldHighlightMention(e)}notify(e,t,s){if(e>this.lastReturnedSearch)this.lastReturnedSearch=e,this._notifyListeners(t,{duration:Date.now()-e});else{const t=new Date(e).toISOString().substr(17,6);(0,a.ZP)("Stale search result, skipping",t,s)}this._notifyAllResultsListeners(t)}notifyError(e,t){this._notifyErrorListeners(e,t),t&&this.activeSearches.delete(t)}async filter(e,t){try{const s=Date.now();let n;if(e){this.activeSearches.add(e);const s=this.search(e,t);n=await s.mentions}else n=await this.initialState(t);this.notify(s,n,e)}catch(s){this.notifyError(s,e)}}recordMentionSelection(e,t){return this.recordSelection(e,t).then((()=>{}),(e=>(0,a.ZP)(`error recording mention selection: ${e}`,e)))}isFiltering(e){return this.activeSearches.has(e)}resolveMentionName(e){return this.config.mentionNameResolver?this.config.mentionNameResolver.lookupName(e):{id:e,name:"",status:o.dP.UNKNOWN}}cacheMentionName(e,t){this.config.mentionNameResolver&&this.config.mentionNameResolver.cacheName(e,t)}supportsMentionNameResolving(){return!!this.config.mentionNameResolver}updateActiveSearches(e){this.activeSearches.add(e)}verifyMentionConfig(e){if(!e.url)throw new Error("config.url is a required parameter");e.securityProvider||(e.securityProvider=d)}initialState(e){return this.remoteInitialState(e)}clearContext(e={}){return Object.keys(e).filter((t=>e[t])).reduce(((t,s)=>(0,n.Z)({[s]:e[s]},t)),{})}getQueryParams(e){const t={};return this.config.containerId&&(t.containerId=this.config.containerId),this.config.productId&&(t.productIdentifier=this.config.productId),(0,n.Z)((0,n.Z)({},t),this.clearContext(e))}async remoteInitialState(e){const t={path:"bootstrap",queryParams:this.getQueryParams(e)};try{const e=await r.P6.requestService(this.config,t);return this._notifyAnalyticsListeners(c.oX,c.O3.INITIAL_STATE,c.eX.SUCCEEDED),this.transformServiceResponse(e,"")}catch(s){throw this._notifyAnalyticsListeners(c.oX,c.O3.INITIAL_STATE,c.eX.FAILED),s}}search(e,t){return{mentions:this.remoteSearch(e,t)}}async remoteSearch(e,t){const s={path:"search",queryParams:(0,n.Z)({query:e,limit:100},this.getQueryParams(t))};try{const t=await r.P6.requestService(this.config,s);return this._notifyAnalyticsListeners(c.oX,c.O3.SEARCH,c.eX.SUCCEEDED),this.transformServiceResponse(t,e)}catch(i){throw this._notifyAnalyticsListeners(c.oX,c.O3.SEARCH,c.eX.FAILED),i}}transformServiceResponse(e,t){const s=e.mentions.map((e=>{let s;return((0,o.Lp)(e)||(0,o.kK)(e))&&(s=e.userType),(0,n.Z)((0,n.Z)({},e),{},{lozenge:s,query:t})}));return(0,n.Z)((0,n.Z)({},e),{},{mentions:s,query:e.query||t})}async recordSelection(e,t){const s={path:"record",queryParams:(0,n.Z)({selectedUserId:e.id},this.getQueryParams(t)),requestInit:{method:"POST"}},i=(0,o.kK)(e)?c.O3.SELECT_TEAM:c.O3.SELECT;try{const e=await r.P6.requestService(this.config,s);return this._notifyAnalyticsListeners(c.oX,i,c.eX.SUCCEEDED),e}catch(a){throw this._notifyAnalyticsListeners(c.oX,i,c.eX.FAILED),a}}}},150539:(e,t,s)=>{s.d(t,{ZP:()=>d});var n=s(199009),i=s(635144),r=s(454812);class o{constructor(e,t){(0,n.Z)(this,"presence",void 0),(0,n.Z)(this,"expiry",void 0),this.presence=e,this.expiry=Date.now()+t}expired(){return Date.now()>this.expiry}}class a extends r.a3{refreshPresence(e){throw new Error(`not yet implemented.\nParams: userIds=${e}`)}notifyListeners(e){this.changeListeners.forEach(((t,s)=>{try{t(e)}catch(n){(0,i.ZP)(`error from listener '${s}', ignoring`,n)}}))}}class c extends a{constructor(e){if(super(),(0,n.Z)(this,"config",void 0),(0,n.Z)(this,"presenceCache",void 0),(0,n.Z)(this,"presenceParser",void 0),!e.url)throw new Error("config.url is a required parameter");if(!e.cloudId)throw new Error("config.cloudId is a required parameter");this.config=e,this.config.url=c.cleanUrl(e.url),this.presenceCache=e.cache||new u(e.cacheExpiry),this.presenceParser=e.parser||new l}refreshPresence(e){const t=this.presenceCache.getBulk(e);this.notifyListeners(t);const s=this.presenceCache.getMissingUserIds(e);s.length&&this.retrievePresence(s)}retrievePresence(e){this.queryDirectoryForPresences(e).then((e=>this.presenceParser.parse(e))).then((e=>{this.notifyListeners(e),this.presenceCache.update(e)}))}queryDirectoryForPresences(e){const t={query:"query getPresenceForMentions($organizationId: String!, $userIds: [String!], $productId: String) {\n                PresenceBulk(organizationId: $organizationId, product: $productId, userIds: $userIds) {\n                  userId\n                  state\n                  stateMetadata\n                }\n              }",variables:{organizationId:this.config.cloudId,userIds:e}};this.config.productId&&(t.variables.productId=this.config.productId);const s={method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(t)};return fetch(this.config.url,s).then((e=>e.json()))}static cleanUrl(e){return"/"!==e.substr(-1)&&(e+="/"),e}}class u{constructor(e,t){(0,n.Z)(this,"cache",void 0),(0,n.Z)(this,"size",void 0),(0,n.Z)(this,"expiryInMillis",void 0),(0,n.Z)(this,"flushTrigger",void 0),this.expiryInMillis=e||u.defaultTimeout,this.flushTrigger=t||u.defaultFlushTrigger,this.cache={},this.size=0}_delete(e){delete this.cache[e],this.size--}_deleteIfExpired(e){this.contains(e)&&this.cache[e].expired()&&this._delete(e)}_removeExpired(){Object.keys(this.cache).forEach((e=>{this._deleteIfExpired(e)}))}contains(e){return this.cache.hasOwnProperty(e)}get(e){return this._deleteIfExpired(e),this.contains(e)?this.cache[e].presence:{}}getBulk(e){const t={};for(const s of e)this.contains(s)&&(t[s]=this.get(s));return t}getMissingUserIds(e){return e.filter((e=>!this.contains(e)))}update(e){this.size>=this.flushTrigger&&this._removeExpired(),Object.keys(e).forEach((t=>{this.cache[t]=new o(e[t],this.expiryInMillis),this.size++}))}}(0,n.Z)(u,"defaultTimeout",2e4),(0,n.Z)(u,"defaultFlushTrigger",50);class l{mapState(e){return"unavailable"===e?"offline":"available"===e?"online":e}parse(e){const t={};if(e.hasOwnProperty("data")&&e.data.hasOwnProperty("PresenceBulk")){const s=e.data.PresenceBulk;for(const e of s)if(e.userId&&e.state){const s=l.extractState(e)||e.state;t[e.userId]={status:this.mapState(s)}}else e.hasOwnProperty("userId")&&e.hasOwnProperty("state")||console.error("Unexpected response from presence service contains keys: "+Object.keys(e))}return t}static extractState(e){return l.isFocusState(e)?l.FOCUS_STATE:e.state}static isFocusState(e){if(e.stateMetadata)try{const t=JSON.parse(e.stateMetadata);return t&&!!t.focus}catch(t){console.error(`Failed to parse presence's stateMetadata for user with id ${e.userId}: ${e.stateMetadata}`),console.error(t)}return!1}}(0,n.Z)(l,"FOCUS_STATE","focus");const d=c},579141:(e,t,s)=>{s.d(t,{FW:()=>r,Lp:()=>u,X:()=>a,dP:()=>o,kI:()=>i,kK:()=>l,ks:()=>d,kz:()=>c,tI:()=>h,ue:()=>n});let n=function(e){return e[e.SELF=0]="SELF",e[e.RESTRICTED=1]="RESTRICTED",e[e.DEFAULT=2]="DEFAULT",e}({}),i=function(e){return e[e.NONE=0]="NONE",e[e.SITE=1]="SITE",e[e.APPLICATION=2]="APPLICATION",e[e.CONTAINER=3]="CONTAINER",e}({}),r=function(e){return e[e.DEFAULT=0]="DEFAULT",e[e.SPECIAL=1]="SPECIAL",e[e.APP=2]="APP",e[e.TEAM=3]="TEAM",e[e.SYSTEM=4]="SYSTEM",e}({}),o=function(e){return e[e.UNKNOWN=0]="UNKNOWN",e[e.SERVICE_ERROR=1]="SERVICE_ERROR",e[e.OK=2]="OK",e}({});function a(e){return!!e&&e===i[i.NONE]}function c(e){return!!e.userType&&e.userType===r[r.SPECIAL]}function u(e){return e.userType&&e.userType===r[r.APP]}function l(e){return e.userType&&e.userType===r[r.TEAM]}function d(e){return e&&("@all"===e||"@here"===e)}const h=e=>!(!e||!e.then)},636755:(e,t,s)=>{s.d(t,{AW:()=>p,KE:()=>f,Ng:()=>E,O3:()=>d,XK:()=>g,eX:()=>m,oX:()=>u,tv:()=>l,zW:()=>y});var n=s(615919),i=s(1705),r=s(327115),o=s(579141);const a="platform-pkg",c="0.0.0-use.local",u="sli",l="smart";let d=function(e){return e.SEARCH="searchUser",e.SEARCH_TEAM="searchTeam",e.INITIAL_STATE="initialState",e.SELECT="select",e.SELECT_TEAM="selectTeam",e}({}),h=function(e){return e.TYPEAHEAD="mentionTypeahead",e.MENTION="mention",e}({}),m=function(e){return e.VIEWED="viewed",e.CLICKED="clicked",e.CLOSED="closed",e.SUCCEEDED="succeeded",e.FAILED="failed",e}({});const p=e=>(t,s,n=[],o)=>{if(e.createAnalyticsEvent){const u={action:t,actionSubject:h.TYPEAHEAD,attributes:{packageName:a,packageVersion:c,componentName:h.MENTION,duration:Math.round(s),userIds:n,queryLength:o?o.length:0},eventType:i.Ru};e.createAnalyticsEvent(u).fire(r.p)}},f=e=>(t,s,n,u,l)=>{const d={action:s,actionSubject:t,eventType:i._d,attributes:{packageName:a,packageVersion:c,componentName:h.MENTION,accessLevel:l,isSpecial:(0,o.ks)(n),userId:u}},m=e(d);return m.fire(r.p),m},g=e=>(t,s)=>{if(e.createAnalyticsEvent){const n=y(t,s);e.createAnalyticsEvent(n).fire(r.p)}},y=(e,t,s)=>({action:t,actionSubject:e,eventType:i.Ru,attributes:(0,n.Z)({packageName:a,packageVersion:c,componentName:h.MENTION},s)}),E=e=>(t,s,n,o)=>{if(e.createAnalyticsEvent){const u={action:t,actionSubject:h.MENTION,actionSubjectId:"hydration",attributes:{packageName:a,packageVersion:c,componentName:h.MENTION,userId:s,fromCache:n,duration:Math.round(o)},eventType:i.Ru};e.createAnalyticsEvent(u).fire(r.p)}}},635144:(e,t,s)=>{s.d(t,{ZP:()=>i});let n=!1;function i(e,...t){n&&console.log(e,...t)}}}]);
//# sourceMappingURL=84266._EQWbXvVo0.js.map