WRMCB=function(e){var c=console;if(c&&c.log&&c.error){c.log('Error running batched script.');c.error(e);}}
;
try {
/* module-key = 'com.atlassian.plugins.atlassian-connect-plugin:ap-core-v5', location = 'v5/js/core/connect-host.js' */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).connectHost=t()}(this,(function(){"use strict";function e(){e=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e};return e.apply(this,arguments)}function t(e,n){t=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){e.__proto__=t;return e};return t(e,n)}function n(e,n){e.prototype=Object.create(n.prototype);e.prototype.constructor=e;t(e,n)}function i(){}i.prototype=Object.create(null);function o(){o.init.call(this)}o.EventEmitter=o;o.usingDomains=!1;o.prototype.domain=void 0;o.prototype._events=void 0;o.prototype._maxListeners=void 0;o.defaultMaxListeners=10;o.init=function(){this.domain=null;o.usingDomains&&undefined.active;if(!this._events||this._events===Object.getPrototypeOf(this)._events){this._events=new i;this._eventsCount=0}this._maxListeners=this._maxListeners||void 0};o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');this._maxListeners=e;return this};function r(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}o.prototype.getMaxListeners=function(){return r(this)};function a(e,t,n){if(t)e.call(n);else for(var i=e.length,o=g(e,i),r=0;r<i;++r)o[r].call(n)}function s(e,t,n,i){if(t)e.call(n,i);else for(var o=e.length,r=g(e,o),a=0;a<o;++a)r[a].call(n,i)}function c(e,t,n,i,o){if(t)e.call(n,i,o);else for(var r=e.length,a=g(e,r),s=0;s<r;++s)a[s].call(n,i,o)}function d(e,t,n,i,o,r){if(t)e.call(n,i,o,r);else for(var a=e.length,s=g(e,a),c=0;c<a;++c)s[c].call(n,i,o,r)}function l(e,t,n,i){if(t)e.apply(n,i);else for(var o=e.length,r=g(e,o),a=0;a<o;++a)r[a].apply(n,i)}o.prototype.emit=function(e){var t,n,i,o,r,u,f,p="error"===e;if(u=this._events)p=p&&null==u.error;else if(!p)return!1;f=this.domain;if(p){t=arguments[1];if(!f){if(t instanceof Error)throw t;var g=new Error('Uncaught, unspecified "error" event. ('+t+")");g.context=t;throw g}t||(t=new Error('Uncaught, unspecified "error" event'));t.domainEmitter=this;t.domain=f;t.domainThrown=!1;f.emit("error",t);return!1}if(!(n=u[e]))return!1;var h="function"==typeof n;switch(i=arguments.length){case 1:a(n,h,this);break;case 2:s(n,h,this,arguments[1]);break;case 3:c(n,h,this,arguments[1],arguments[2]);break;case 4:d(n,h,this,arguments[1],arguments[2],arguments[3]);break;default:o=new Array(i-1);for(r=1;r<i;r++)o[r-1]=arguments[r];l(n,h,this,o)}return!0};function u(e,t,n,o){var a,s,c,d;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if(s=e._events){if(s.newListener){e.emit("newListener",t,n.listener?n.listener:n);s=e._events}c=s[t]}else{s=e._events=new i;e._eventsCount=0}if(c){"function"==typeof c?c=s[t]=o?[n,c]:[c,n]:o?c.unshift(n):c.push(n);if(!c.warned&&(a=r(e))&&a>0&&c.length>a){c.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+c.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning";l.emitter=e;l.type=t;l.count=c.length;d=l,"function"==typeof console.warn?console.warn(d):console.log(d)}}else{c=s[t]=n;++e._eventsCount}return e}o.prototype.addListener=function(e,t){return u(this,e,t,!1)};o.prototype.on=o.prototype.addListener;o.prototype.prependListener=function(e,t){return u(this,e,t,!0)};function f(e,t,n){var i=!1;function o(){e.removeListener(t,o);if(!i){i=!0;n.apply(e,arguments)}}o.listener=n;return o}o.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');this.on(e,f(this,e,t));return this};o.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');this.prependListener(e,f(this,e,t));return this};o.prototype.removeListener=function(e,t){var n,o,r,a,s;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(o=this._events))return this;if(!(n=o[e]))return this;if(n===t||n.listener&&n.listener===t)if(0==--this._eventsCount)this._events=new i;else{delete o[e];o.removeListener&&this.emit("removeListener",e,n.listener||t)}else if("function"!=typeof n){r=-1;for(a=n.length;a-- >0;)if(n[a]===t||n[a].listener&&n[a].listener===t){s=n[a].listener;r=a;break}if(r<0)return this;if(1===n.length){n[0]=void 0;if(0==--this._eventsCount){this._events=new i;return this}delete o[e]}else!function(e,t){for(var n=t,i=n+1,o=e.length;i<o;n+=1,i+=1)e[n]=e[i];e.pop()}(n,r);o.removeListener&&this.emit("removeListener",e,s||t)}return this};o.prototype.removeAllListeners=function(e){var t,n;if(!(n=this._events))return this;if(!n.removeListener){if(0===arguments.length){this._events=new i;this._eventsCount=0}else n[e]&&(0==--this._eventsCount?this._events=new i:delete n[e]);return this}if(0===arguments.length){for(var o,r=Object.keys(n),a=0;a<r.length;++a)"removeListener"!==(o=r[a])&&this.removeAllListeners(o);this.removeAllListeners("removeListener");this._events=new i;this._eventsCount=0;return this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this};o.prototype.listeners=function(e){var t,n,i=this._events;n=i&&(t=i[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(t):[];return n};o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)};o.prototype.listenerCount=p;function p(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}o.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};function g(e,t){for(var n=new Array(t);t--;)n[t]=e[t];return n}var h=function(e){n(t,e);function t(){var t;(t=e.call(this)||this).setMaxListeners(20);return t}var i=t.prototype;i.dispatch=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];this.emit.apply(this,["before:"+e].concat(n));this.emit.apply(this,arguments);this.emit.apply(this,["after:"+e].concat(n))};i.registerOnce=function(e,t){if("string"!=typeof e)throw"ACJS: event name must be string";this.once(e,t)};i.register=function(e,t){if("string"!=typeof e)throw"ACJS: event name must be string";this.on(e,t)};i.unregister=function(e,t){if("string"!=typeof e)throw"ACJS: event name must be string";this.removeListener(e,t)};return t}(o),m=new h,y=function(e,t){m.dispatch("iframe-bridge-timeout",{$el:e,extension:t})},v=function(e,t){m.dispatch("iframe-bridge-cancelled",{$el:e,extension:t})},_=window.AJS&&window.AJS.$||function(){console.error("[ACJS] jQuery was not loaded before Connect. If in product frontend, make sure to load via a wrapper, eg withConnectHost()")},x="ap-status-indicator",b='<div class="ap-loading"><div class="small-spinner"></div>Loading app...</div>',w='<div class="ap-load-timeout"><div class="small-spinner"></div>App is not responding. Wait or <a href="#" class="ap-btn-cancel">cancel</a>?</div>',k="App failed to load.",E=new(function(){function e(){this._stateRegistry={}}var t=e.prototype;t._loadingContainer=function(e){return e.find(".ap-status-indicator")};t.render=function(){var e=document.createElement("div");e.classList.add(x);e.innerHTML=b;var t=_(e);this._startSpinner(t);return t};t._startSpinner=function(e){setTimeout((function(){var t=e.find(".small-spinner");t.length&&t.spin&&t.spin({lines:12,length:3,width:2,radius:3,trail:60,speed:1.5,zIndex:1})}),10)};t.hide=function(e,t){this._clearTimeout(t);this._loadingContainer(e)[0].style.display="none"};t.cancelled=function(e,t){var n=k;this._loadingContainer(e).empty().text(n)};t._setupTimeout=function(e,t){this._stateRegistry[t.id]=setTimeout((function(){y(e,t)}),12e3)};t._clearTimeout=function(e){if(this._stateRegistry[e]){clearTimeout(this._stateRegistry[e]);delete this._stateRegistry[e]}};t.timeout=function(e,t){var n=_(w),i=this._loadingContainer(e);i.empty().append(n);this._startSpinner(i);_("a.ap-btn-cancel",i).click((function(){v(e,t)}));this._clearTimeout(t);return i};return e}());m.register("iframe-create",(function(e){e.extension.options.noDom||E._setupTimeout(e.$el.parents(".ap-iframe-container"),e.extension)}));m.register("iframe-bridge-established",(function(e){e.extension.options.noDom||E.hide(e.$el.parents(".ap-iframe-container"),e.extension.id)}));m.register("iframe-bridge-timeout",(function(e){e.extension.options.noDom||E.timeout(e.$el,e.extension.id)}));m.register("iframe-bridge-cancelled",(function(e){e.extension.options.noDom||E.cancelled(e.$el,e.extension.id)}));m.register("iframe-destroyed",(function(e){E._clearTimeout(e.extension.extension_id)}));function A(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})));return!0}catch(e){return!1}}function C(e,n,i){C=A()?Reflect.construct.bind():function(e,n,i){var o=[null];o.push.apply(o,n);var r=new(Function.bind.apply(e,o));i&&t(r,i.prototype);return r};return C.apply(null,arguments)}var O="[Simple-XDM] ",I=Function.prototype.bind,S={locationOrigin:function(){return window.location.origin?window.location.origin:window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")},randomString:function(){return Math.floor(1e9*Math.random()).toString(16)},isString:function(e){return"string"==typeof e||e instanceof String},argumentsToArray:function(e){return Array.prototype.slice.call(e)},argumentNames:function(e){return e.toString().replace(/((\/\/.*$)|(\/\*[^]*?\*\/))/gm,"").replace(/[^(]+\(([^)]*)[^]+/,"$1").match(/([^\s,]+)/g)||[]},hasCallback:function(e){var t=e.length;return t>0&&"function"==typeof e[t-1]},error:function(e){if(window.console&&window.console.error){var t=[];if("string"==typeof e){t.push(O+e);t=t.concat(Array.prototype.slice.call(arguments,1))}else{t.push(O);t=t.concat(Array.prototype.slice.call(arguments))}window.console.error.apply(null,t)}},warn:function(e){window.console&&console.warn(O+e)},log:function(e){window.console&&window.console.log(O+e)},_bind:function(e,t){return I&&t.bind===I?t.bind(e):function(){return t.apply(e,arguments)}},throttle:function(e,t,n){var i=0;return function(){var o=Date.now();if(o-i>t){i=o;e.apply(n,arguments)}}},each:function(e,t){var n,i;if(e)if(null!=(n=e.length)&&"function"!=typeof e){i=0;for(;i<n&&!1!==t.call(e[i],i,e[i]);)i+=1}else for(i in e)if(e.hasOwnProperty(i)&&!1===t.call(e[i],i,e[i]))break},extend:function(e){var t=arguments,n=[].slice.call(t,1,t.length);n.forEach((function(t){"object"==typeof t&&Object.getOwnPropertyNames(t).forEach((function(n){e[n]=t[n]}))}));return e},sanitizeStructuredClone:function(e){var t=[Boolean,String,Date,RegExp,Blob,File,FileList,ArrayBuffer],n=[Error,Node],i=S.warn,o=[];return function e(r){if("function"==typeof r){i("A function was detected and removed from the message.");return null}if(n.some((function(e){if(r instanceof e){i(e.name+" object was detected and removed from the message.");return!0}return!1})))return{};if(r&&"object"==typeof r&&t.every((function(e){return!(r instanceof e)}))){var a;if(Array.isArray(r))a=r.map((function(t){return e(t)}));else{if(o.indexOf(r)>-1){i("A circular reference was detected and removed from the message.");return null}o.push(r);a={};for(var s in r)if(r.hasOwnProperty(s)){var c=e(r[s]);null!==c&&(a[s]=c)}o.pop()}return a}return r}(e)},getOrigin:function(e,t){if("function"==typeof URL)try{return new URL(e,t).origin}catch(e){}var n=document.implementation.createHTMLDocument("");if(t){var i=n.createElement("base");i.href=t;n.head.appendChild(i)}var o=n.createElement("a");o.href=e;n.body.appendChild(o);var r=o.protocol+"//"+o.hostname;e.match(/\/\/[^/]+:[0-9]+\//)&&(r+=o.port?":"+o.port:"");return r}},P=function(e){n(i,e);var t=i.prototype;t._padUndefinedArguments=function(e,t){return e.length>=t?e:e.concat(new Array(t-e.length))};function i(t){var n;t=t||{};(n=e.call(this,t)||this)._registeredExtensions=t.extensions||{};n._registeredAPIModules={};n._registeredAPIModules._globals={};n._pendingCallbacks={};n._keycodeCallbacks={};n._clickHandler=null;n._pendingEvents={};n._messageHandlers={init:n._handleInit,req:n._handleRequest,resp:n._handleResponse,broadcast:n._handleBroadcast,event_query:n._handleEventQuery,key_triggered:n._handleKeyTriggered,addon_clicked:n._handleAddonClick,get_host_offset:n._getHostOffset,unload:n._handleUnload};return n}t._verifyAPI=function(e,t){var n=e.data.targets;if(n){var i=this.getApiSpec(),o=!1;!function e(t,n){Object.getOwnPropertyNames(n).forEach((function(i){"object"==typeof n[i]&&t[i]?e(t[i],n[i]):"parent"===n[i]&&t[i]&&(o=!0)}))}(i,n);e.source.postMessage({type:"api_tamper",tampered:o},t.extension.url)}};t._handleInit=function(e,t){e.source.postMessage({type:"init_received"},t.extension.url);this._registeredExtensions[t.extension_id].source=e.source;if(t.initCallback){t.initCallback(e.data.eid);delete t.initCallback}e.data.targets&&this._verifyAPI(e,t)};t._getHostOffset=function(e,t){var n=e.source,i=null,o=t||window;o===o.top&&"function"==typeof o.getHostOffsetFunctionOverride&&(i=o.getHostOffsetFunctionOverride(n));if("number"!=typeof i){i=0;for(;!this._hasSameOrigin(n);){i++;n=n.parent}}e.source.postMessage({hostFrameOffset:i},e.origin)};t._hasSameOrigin=function(e){if(e===e.top)return!0;try{var t="test_var_"+Math.random().toString(16).substr(2);e[t]=!0;return e[t]}catch(e){}return!1};t._handleResponse=function(e){var t=e.data,n=this._pendingCallbacks[t.mid];if(n){delete this._pendingCallbacks[t.mid];n.apply(window,t.args)}};t.registerRequestNotifier=function(e){this._registeredRequestNotifier=e};t._handleRequest=function(e,t){function n(){var n=S.sanitizeStructuredClone(S.argumentsToArray(arguments));e.source.postMessage({mid:e.data.mid,type:"resp",forPlugin:!0,args:n},t.extension.url)}var i=e.data,o=this._registeredAPIModules[i.mod],r=this.getRegisteredExtensions(t.extension)[0];if(o){var a=i.fn;if(i._cls){var s=o[i._cls],c=i.mod+"-"+i._cls+"-";n._id=i._id;if("constructor"===a){if(!s._construct){s.constructor.prototype._destroy=function(){delete this._context._proxies[c+this._id]};s._construct=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=C(s.constructor,t),o=t[t.length-1];i._id=o._id;i._context=o._context;i._context._proxies[c+i._id]=i;return i}}o=s;a="_construct"}else o=r._proxies[c+i._id]}var d=o[a];if(d){var l=i.args,u=d.length-1;"_construct"===a&&(u=o.constructor.length-1);n._context=r;(l=this._padUndefinedArguments(l,u)).push(n);var f=d.apply(o,l);d.returnsPromise&&("object"!=typeof f&&"function"!=typeof f||"function"!=typeof f.then?n("Defined module method did not return a promise."):f.then((function(e){n(void 0,e)})).catch((function(e){n(e=e instanceof Error?e.message:e)})));this._registeredRequestNotifier&&this._registeredRequestNotifier.call(null,{module:i.mod,fn:i.fn,type:i.type,addon_key:t.extension.addon_key,key:t.extension.key,extension_id:t.extension_id})}}};t._handleBroadcast=function(e,t){var n=e.data;this.dispatch(n.etyp,(function(e){return e.extension.addon_key===t.extension.addon_key&&e.extension_id!==t.extension_id}),n.evnt,null,null)};t._handleKeyTriggered=function(e,t){var n=e.data,i=this._keycodeKey(n.keycode,n.modifiers,t.extension_id),o=this._keycodeCallbacks[i];o&&o.forEach((function(e){e.call(null,{addon_key:t.extension.addon_key,key:t.extension.key,extension_id:t.extension_id,keycode:n.keycode,modifiers:n.modifiers})}),this)};t.defineAPIModule=function(e,t){t=t||"_globals";this._registeredAPIModules[t]=S.extend({},this._registeredAPIModules[t]||{},e);return this._registeredAPIModules};t.isAPIModuleDefined=function(e){return void 0!==this._registeredAPIModules[e]};t._pendingEventKey=function(e,t){var n=e.addon_key||"global";e.key&&(n=n+"@@"+e.key);return n=n+"@@"+t};t.queueEvent=function(e,t,n,i){if(this._findRegistrations(t).some((function(e){return void 0!==e.registered_events}),this))this.dispatch(e,t,n,i);else{this._cleanupInvalidEvents();var o=(new Date).getTime();this._pendingEvents[this._pendingEventKey(t,o)]={type:e,targetSpec:t,event:n,callback:i,time:o,uid:S.randomString()}}};t._cleanupInvalidEvents=function(){var e=this,t=(new Date).getTime();Object.keys(this._pendingEvents).forEach((function(n){var i=e._pendingEvents[n];t-i.time<=3e4||delete e._pendingEvents[n]}))};t._handleEventQuery=function(e,t){var n=this,i={},o=(new Date).getTime();Object.keys(this._pendingEvents).forEach((function(r){var a=n._pendingEvents[r],s=o-a.time<=3e4,c=!a.targetSpec||0!==n._findRegistrations(a.targetSpec).length;c&&a.targetSpec.key&&(c=a.targetSpec.addon_key===t.extension.addon_key&&a.targetSpec.key===t.extension.key);if(s&&c){i[r]=a;a.targetSpec=a.targetSpec||{};n.dispatch(a.type,a.targetSpec,a.event,a.callback,e.source)}else s||delete n._pendingEvents[r]}));this._registeredExtensions[t.extension_id].registered_events=e.data.args;return i};t._handleUnload=function(e,t){if(t){t.extension_id&&this._registeredExtensions[t.extension_id]&&delete this._registeredExtensions[t.extension_id].source;t.unloadCallback&&t.unloadCallback(e.data.eid)}};t.dispatch=function(e,t,n,i,o){function r(t,n){if(t.source&&t.source.postMessage){var o;if(i){o=S.randomString();this._pendingCallbacks[o]=i}t.source.postMessage({type:"evt",mid:o,etyp:e,evnt:n},t.extension.url)}}this._findRegistrations(t||{}).forEach((function(e){o&&!e.source&&(e.source=o);e.source&&S._bind(this,r)(e,n)}),this)};t._findRegistrations=function(e){var t=this;if(0===this._registeredExtensions.length){S.error("no registered extensions",this._registeredExtensions);return[]}var n=Object.getOwnPropertyNames(e),i=Object.getOwnPropertyNames(this._registeredExtensions).map((function(e){return t._registeredExtensions[e]}));return e instanceof Function?i.filter(e):i.filter((function(t){return n.every((function(n){return t.extension[n]===e[n]}))}))};t.registerExtension=function(e,t){t._proxies={};t.extension_id=e;this._registeredExtensions[e]=t};t._keycodeKey=function(e,t,n){var i=e;if(t){"string"==typeof t&&(t=[t]);t.sort();t.forEach((function(e){i+="$$"+e}),this)}return i+"__"+n};t.registerKeyListener=function(e,t,n,i){"string"==typeof n&&(n=[n]);var o=this._registeredExtensions[e],r=this._keycodeKey(t,n,e);if(!this._keycodeCallbacks[r]){this._keycodeCallbacks[r]=[];o.source.postMessage({type:"key_listen",keycode:t,modifiers:n,action:"add"},o.extension.url)}this._keycodeCallbacks[r].push(i)};t.unregisterKeyListener=function(e,t,n,i){var o=this._keycodeKey(t,n,e),r=this._keycodeCallbacks[o],a=this._registeredExtensions[e];if(r){if(i){var s=r.indexOf(i);this._keycodeCallbacks[o].splice(s,1)}else delete this._keycodeCallbacks[o];a.source&&a.source.postMessage&&a.source.postMessage({type:"key_listen",keycode:t,modifiers:n,action:"remove"},a.extension.url)}};t.registerClickHandler=function(e){if("function"!=typeof e)throw new Error("callback must be a function");if(null!==this._clickHandler)throw new Error("ClickHandler already registered");this._clickHandler=e};t._handleAddonClick=function(e,t){"function"==typeof this._clickHandler&&this._clickHandler({addon_key:t.extension.addon_key,key:t.extension.key,extension_id:t.extension_id})};t.unregisterClickHandler=function(){this._clickHandler=null};t.getApiSpec=function(e){var t=this;function n(e){return Object.getOwnPropertyNames(e).reduce((function(t,i){var o=e[i];switch(typeof o){case"function":t[i]={args:S.argumentNames(o),returnsPromise:o.returnsPromise||!1};break;case"object":o.hasOwnProperty("constructor")&&(t[i]=n(o))}return t}),{})}return Object.getOwnPropertyNames(this._registeredAPIModules).reduce((function(i,o){var r=t._registeredAPIModules[o];void 0!==r.addonKey&&r.addonKey!==e||(i[o]=n(r));return i}),{})};t._originEqual=function(e,t){function n(e){return"string"==typeof e&&e.length>0}var i=S.getOrigin(e);return!!(n(e)&&n(t)&&n(i))&&t===i};t._checkOrigin=function(e,t){var n=t&&!t.source&&["init"].indexOf(e.data.type)>-1,i=t&&e.source===t.source,o=t&&this._originEqual(t.extension.url,e.origin)&&(n||i);"get_host_offset"===e.data.type&&window===window.top&&(o=!0);"unload"!==e.data.type||!i&&void 0!==e.source||(o=!0);return o};t.getRegisteredExtensions=function(e){return e?this._findRegistrations(e):this._registeredExtensions};t.unregisterExtension=function(e){var t=this._findRegistrations(e);0!==t.length&&t.forEach((function(e){var t=this;Object.keys(this._pendingEvents).forEach((function(n){var i=t._pendingEvents[n].targetSpec||{};i.addon_key===e.extension.addon_key&&i.key===e.extension.key&&delete t._pendingEvents[n]}));delete this._registeredExtensions[e.extension_id]}),this)};t.setFeatureFlagGetter=function(e){this._getBooleanFeatureFlag=e};return i}(function(){function e(e){var t=e||{};this._registerListener(t.listenOn)}var t=e.prototype;t._registerListener=function(e){e&&e.addEventListener||(e=window);e.addEventListener("message",S._bind(this,this._receiveMessage),!1)};t._receiveMessage=function(e){var t,n=this._messageHandlers[e.data.type],i=e.data.eid;i&&this._registeredExtensions&&(t=this._registeredExtensions[i]);if(!n||!this._checkOrigin(e,t))return!1;n.call(this,e,t)};return e}()),T=function(){function e(){this._xdm=new P}var t=e.prototype;t.dispatch=function(e,t,n,i){this._xdm.queueEvent(e,t,n,i);return this.getExtensions(t)};t.broadcast=function(e,t,n){this._xdm.dispatch(e,t,n,null,null);return this.getExtensions(t)};t._createId=function(e){if(!e.addon_key||!e.key)throw Error("Extensions require addon_key and key");return e.addon_key+"__"+e.key+"__"+S.randomString()};t.create=function(e,t,n){var i=this.registerExtension(e,t,n),o=e.options||{},r={extension_id:i,api:this._xdm.getApiSpec(e.addon_key),origin:S.locationOrigin(),options:o};return{id:i,name:JSON.stringify(r),src:e.url}};t.registerRequestNotifier=function(e){this._xdm.registerRequestNotifier(e)};t.registerExtension=function(e,t,n){var i=this._createId(e);this._xdm.registerExtension(i,{extension:e,initCallback:t,unloadCallback:n});return i};t.registerKeyListener=function(e,t,n,i){this._xdm.registerKeyListener(e,t,n,i)};t.unregisterKeyListener=function(e,t,n,i){this._xdm.unregisterKeyListener(e,t,n,i)};t.registerClickHandler=function(e){this._xdm.registerClickHandler(e)};t.unregisterClickHandler=function(){this._xdm.unregisterClickHandler()};t.defineModule=function(e,t,n){this._xdm.defineAPIModule(t,e,n)};t.isModuleDefined=function(e){return this._xdm.isAPIModuleDefined(e)};t.defineGlobals=function(e){this._xdm.defineAPIModule(e)};t.getExtensions=function(e){return this._xdm.getRegisteredExtensions(e)};t.unregisterExtension=function(e){return this._xdm.unregisterExtension(e)};t.returnsPromise=function(e){e.returnsPromise=!0};t.setFeatureFlagGetter=function(e){this._xdm.setFeatureFlagGetter(e)};t.registerExistingExtension=function(e,t){return this._xdm.registerExtension(e,t)};return e}(),M=new T,D=["contextJwt","url"],j=function(e){var t;return"dialogs"!==(null==e||null==(t=e.extension)||null==(t=t.options)?void 0:t.moduleType)},F=function(e,t,n){M.dispatch(e,t,n);m.dispatch("event-dispatch",{type:e,targetSpec:t,event:n})},L=function(e,t,n){m.dispatch("event-public-dispatch",{type:e,event:t,sender:n});var i=n.options||{};i.contextJwt;i.url;var o=function(e,t){if(null==e)return{};var n,i,o={},r=Object.keys(e);for(i=0;i<r.length;i++){n=r[i];t.indexOf(n)>=0||(o[n]=e[n])}return o}(i,D);M.dispatch(e,{},{sender:{addonKey:n.addon_key,key:n.key,options:S.sanitizeStructuredClone(o)},event:t})};function N(e){if(!e)throw new Error("No selector to escape");return e.replace(/[!"#$%&'()*+,.\/:;<=>?@[\\\]^`{|}~]/g,"\\$&")}var B,$={escapeSelector:N,stringToDimension:function(e){var t=!1,n="px";if("string"==typeof e){t=e.indexOf("%")===e.length-1;e=parseInt(e,10);t&&(n="%")}if(!isNaN(e))return e+n},getIframeByExtensionId:function(e){return _("iframe#"+N(e))},first:function(e,t){return t?e.slice(0,t):e[0]},last:function(e){return e[e.length-1]},pick:function(e,t){return"object"!=typeof e?{}:Object.keys(e).filter((function(e){return t.indexOf(e)>=0})).reduce((function(t,n){var i;return Object.assign(t,((i={})[n]=e[n],i))}),{})},debounce:function(e,t){var n;return function(){var i=this,o=[].slice.call(arguments);function r(){n=null;e.apply(i,o)}n&&clearTimeout(n);n=setTimeout(r,t||50)}},isSupported:function(e,t,n,i){return e&&e[t]&&e[t].supports?e[t].supports(n):i},extend:Object.assign,guessProductFromModuleDefined:function(e){return e.isModuleDefined("jira")?"Jira":e.isModuleDefined("confluence")?"Confluence":""}},J={emit:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];var o=$.last(n);n=$.first(n,-1);F(e,{addon_key:o._context.extension.addon_key},n)},emitPublic:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];var o=$.last(n),r=o._context.extension;n=$.first(n,-1);L(e,n,r)},emitToDataProvider:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=$.last(t);i._context.extension;t=$.first(t,-1);F("dataProviderEvent",{addon_key:i._context.extension.addon_key},t)}},R=function(e,t){m.dispatch("dialog-extension-open",{extension:e,options:t})},z=function(){m.dispatch("dialog-close-active",{})},H=function(e,t){m.dispatch("dialog-button-add",{button:{text:e.text,identifier:e.identifier,data:{userButton:!0}},extension:t})},U={close:function(e){m.dispatch("dialog-close",{dialog:e.dialog,extension:e.extension,customData:e.customData})},closeActive:function(e){m.dispatch("dialog-close-active",e)},clickButton:function(e,t,n){m.dispatch("dialog-button-click",{identifier:e,$el:t,extension:n})},toggleButton:function(e){m.dispatch("dialog-button-toggle",e)},toggleButtonVisibility:function(e){m.dispatch("dialog-button-toggle-visibility",e)}},K=function(e){M.registerKeyListener(e.extension_id,e.key,e.modifiers,e.callback);m.dispatch("dom-event-register",e)},q=function(e){M.unregisterKeyListener(e.extension_id,e.key,e.modifiers,e.callback);m.dispatch("dom-event-unregister",e)},V=function(e){window.addEventListener("keydown",(function(t){t.keyCode===e.keyCode&&e.callback()}))},W=function(e){M.registerClickHandler((function(t){var n=document.getElementById(t.extension_id);n&&e(n)}))},G=function(){M.unregisterClickHandler()},X=new(function(){function e(){}e.prototype.randomIdentifier=function(){return Math.random().toString(16).substring(7)};return e}()),Q=[];if("IntersectionObserver"in window&&"IntersectionObserverEntry"in window){var Y=new IntersectionObserver((function(e){e.forEach((function(e){var t=e.intersectionRatio,n=e.target;if(t>0){Y.unobserve(n);!function(e){Q=Q.filter((function(t){var n=t.element,i=t.callback;if(n===e){i();return!1}return!0}))}(n)}}))}),{threshold:.25});B=Y.observe.bind(Y)}var Z=function(){function e(){this._addons={}}var t=e.prototype;t._shouldSampleEvent=function(e){return 100*Math.random()<=e};t._track=function(e,t){var n=window,i="connect.addon."+e;(t=t||{}).version=n._AP&&n._AP.version?n._AP.version:void 0;t.userAgent=n.navigator.userAgent;if(!n.AJS)return!1;if(n.AJS.Analytics)n.AJS.Analytics.triggerPrivacyPolicySafeEvent(i,t);else{if(!n.AJS.trigger)return!1;AJS.trigger("analyticsEvent",{name:i,data:t})}return!0};t._trackGasV3=function(e,t){try{window.require("ac/analytics").emitGasV3(e,t)}catch(e){window.Confluence||window.__karma__||console.info("Connect GasV3 catch",e)}};t._time=function(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()};t.trackLoadingStarted=function(e){if(this._addons&&e&&e.id){e.startLoading=this._time();this._addons[e.id]=e}else console.error("ACJS: cannot track loading analytics",this._addons,e)};t.trackLoadingEnded=function(e){var t=this;if(this._addons&&e&&this._addons[e.id]){var n,i=e.url,o=void 0!==i&&-1===i.indexOf("xdm_e="),r=this._time()-this._addons[e.id].startLoading,a=this.getIframeLoadApdex(r);try{n=Object.keys(JSON.parse(this._addons[e.id].$el[0].name).api).sort().toString()}catch(e){n="error"}var s={addonKey:e.addon_key,moduleKey:e.key,moduleType:e.options?e.options.moduleType:void 0,moduleLocation:e.options?e.options.moduleLocation:void 0,pearApp:e.options&&"true"===e.options.pearApp?"true":"false",iframeLoadMillis:r,iframeLoadApdex:a,iframeIsCacheable:o,value:r>2e4?"x":Math.ceil(r/100),api:n};"function"==typeof window.requestIdleCallback?window.requestIdleCallback((function(){return t._track("iframe.performance.load",s)}),{timeout:100}):this._track("iframe.performance.load",s)}else console.error("ACJS: cannot track loading end analytics",this._addons,e)};t.getIframeLoadApdex=function(e){return e<=300?1:e<=1200?.5:0};t.trackLoadingTimeout=function(e){var t=window.navigator.onLine;"boolean"!=typeof t&&(t="not-supported");this._track("iframe.performance.timeout",{addonKey:e.addon_key,moduleKey:e.key,moduleType:e.options?e.options.moduleType:void 0,moduleLocation:e.options?e.options.moduleLocation:void 0,pearApp:e.options&&"true"===e.options.pearApp?"true":"false",connectedStatus:t.toString()});this.trackLoadingEnded(e)};t.trackLoadingCancel=function(e){this._track("iframe.performance.cancel",{addonKey:e.addon_key,moduleKey:e.key,moduleType:e.options?e.options.moduleType:void 0,moduleLocation:e.options?e.options.moduleLocation:void 0,pearApp:e.options&&"true"===e.options.pearApp?"true":"false"})};t.trackUseOfDeprecatedMethod=function(e,t){this._track("jsapi.deprecated",{addonKey:t.addon_key,moduleKey:t.key,methodUsed:e})};t.trackMultipleDialogOpening=function(e,t){this._track("jsapi.dialog.multiple",{addonKey:t.addon_key,moduleKey:t.key,dialogType:e})};t.trackVisible=function(e){this._track("iframe.is_visible",{addonKey:e.addon_key,moduleKey:e.key,moduleType:e.options?e.options.moduleType:void 0,pearApp:e.options&&"true"===e.options.pearApp?"true":"false"})};t.trackIframePerformance=function(e,t){this._trackGasV3("operational",{source:t.addon_key,action:"iframeRendered",actionSubject:"connectAddon",actionSubjectId:t.addon_key,attributes:{key:t.key,pearApp:this._getPearApp(t),moduleType:this._getModuleType(t),iframeIsCacheable:this._isCacheable(t),moduleLocation:this._getModuleLocation(t),domainLookupTime:e.domainLookupTime,connectionTime:e.connectionTime,decodedBodySize:e.decodedBodySize,domContentLoadedTime:e.domContentLoadedTime,fetchTime:e.fetchTime}})};t.dispatch=function(e,t){this._track(e,t)};t.trackExternal=function(e,t){this._track(e,t)};t._resetAnalyticsDueToUnreliable=function(e){if(!e)throw new Error("Cannot reset analytics due to no extension id");if(this._addons[e]){clearTimeout(this._addons[e]);delete this._addons[e]}else console.info("Cannot clear analytics, cache does not contain extension id")};t._isCacheable=function(e){var t=e.url;return void 0!==t&&-1===t.indexOf("xdm_e=")};t._getModuleType=function(e){return e.options?e.options.moduleType:void 0};t._getModuleLocation=function(e){return e.options?e.options.moduleLocation:void 0};t._getPearApp=function(e){return e.options&&"true"===e.options.pearApp};t.trackGasV3Visible=function(e){this._trackGasV3("operational",{action:"iframeViewed",actionSubject:"connectAddon",actionSubjectId:e.addon_key,attributes:{moduleType:this._getModuleType(e),iframeIsCacheable:this._isCacheable(e),moduleKey:e.key,moduleLocation:this._getModuleLocation(e),pearApp:this._getPearApp(e)},source:e.addon_key})};t.trackGasV3InvokeMethod=function(e,t,n){this._shouldSampleEvent(1)&&this._trackGasV3("operational",{action:"invokeMethod",actionSubject:"connectAddon",actionSubjectId:e.addon_key,attributes:{module:t,method:n,moduleType:this._getModuleType(e),moduleKey:e.key,moduleLocation:this._getModuleLocation(e),pearApp:this._getPearApp(e)},source:e.addon_key})};t.trackGasV3ContentResolver=function(e,t){if(this._shouldSampleEvent(5)){var n=t.extension,i=t.attrs,o=e?"contentResolverSucceeded":"contentResolverFailed";this._trackGasV3("operational",{action:o,actionSubject:"connectAddon",actionSubjectId:n.addon_key,attributes:Object.assign({},i,{moduleType:this._getModuleType(n),moduleKey:n.key,moduleLocation:this._getModuleLocation(n),pearApp:this._getPearApp(n)}),source:n.addon_key})}};t.trackGasV3LoadingEnded=function(e){var t=this._time()-this._addons[e.id].startLoading;this._trackGasV3("operational",{action:"iframeLoaded",actionSubject:"connectAddon",actionSubjectId:e.addon_key,attributes:{moduleType:this._getModuleType(e),iframeIsCacheable:this._isCacheable(e),iframeLoadMillis:t,moduleKey:e.key,moduleLocation:this._getModuleLocation(e),pearApp:this._getPearApp(e)},source:e.addon_key})};t.trackGasV3LoadingTimeout=function(e){this._trackGasV3("operational",{action:"iframeTimeout",actionSubject:"connectAddon",actionSubjectId:e.addon_key,attributes:{moduleType:this._getModuleType(e),iframeIsCacheable:this._isCacheable(e),moduleKey:e.key,moduleLocation:this._getModuleLocation(e),pearApp:this._getPearApp(e)},source:e.addon_key})};return e}(),ee=new Z;_.fn&&m.register("iframe-create",(function(e){ee.trackLoadingStarted(e.extension)}));m.register("method-invoked",(function(e){ee.trackGasV3InvokeMethod(e.extension,e.module,e.fn)}));m.register("iframe-bridge-start",(function(e){ee.trackLoadingStarted(e.extension)}));m.register("iframe-bridge-established",(function(e){ee.trackLoadingEnded(e.extension);!function(e,t){if("function"==typeof t&&e instanceof Element){Q.push({element:e,callback:t});B(e)}}(document.getElementById(e.extension.id),(function(){m.dispatch("iframe-visible",e.extension);ee.trackVisible(e.extension);ee.trackGasV3Visible(e.extension)}))}));m.register("iframe-bridge-established",(function(e){ee.trackGasV3LoadingEnded(e.extension)}));m.register("iframe-bridge-timeout",(function(e){ee.trackLoadingTimeout(e.extension)}));m.register("iframe-bridge-cancelled",(function(e){ee.trackLoadingCancel(e.extension)}));m.register("analytics-deprecated-method-used",(function(e){ee.trackUseOfDeprecatedMethod(e.methodUsed,e.extension)}));m.register("analytics-iframe-performance",(function(e){ee.trackIframePerformance(e.metrics,e.extension)}));m.register("iframe-destroyed",(function(e){ee._resetAnalyticsDueToUnreliable(e.extension.extension_id)}));m.register("analytics-external-event-track",(function(e){ee.trackExternal(e.eventName,e.values)}));m.register("analytics-content-resolver-track",(function(e){var t=e.success,n=e.extra;ee.trackGasV3ContentResolver(t,n)}));m.register("iframe-bridge-timeout",(function(e){ee.trackGasV3LoadingTimeout(e.extension)}));var te=new(function(){function e(){}var t=e.prototype;t._maxDimension=function(e,t){var n=$.stringToDimension(e),i=parseInt(n,10),o=parseInt(t,10);return n.indexOf("%")>-1&&i>=100||i>o?"100%":n};t._closeOnEscape=function(e){return!1!==e.closeOnEscape};t._size=function(e){var t=e.size;"x-large"===e.size&&(t="xlarge");"maximum"!==e.size&&"100%"===e.width&&"100%"===e.height&&(t="fullscreen");return t};t._header=function(e){var t="";switch(typeof e){case"string":t=e;break;case"object":t=e.value}return t};t._hint=function(e){return"string"==typeof e?e:""};t._chrome=function(e){var t=!1;"boolean"==typeof e.chrome&&(t=e.chrome);"fullscreen"===e.size&&(t=!0);"maximum"===e.size&&(t=!1);return t};t._width=function(e){if(!e.size)return e.width?this._maxDimension(e.width,_(window).width()):"50%"};t._height=function(e){if(!e.size)return e.height?this._maxDimension(e.height,_(window).height()):"50%"};t._actions=function(e){var t=[];(e=e||{}).actions||(t=[{name:"submit",identifier:"submit",text:e.submitText||"Submit",type:"primary",disabled:!0},{name:"cancel",identifier:"cancel",text:e.cancelText||"Cancel",type:"link",immutable:!0}]);e.buttons&&(t=t.concat(this._buttons(e)));return t};t._id=function(e){"string"!=typeof e&&(e=Math.random().toString(36).substring(2,8));return e};t._buttons=function(e){var t=[];e.buttons&&Array.isArray(e.buttons)&&e.buttons.forEach((function(e){var n,i,o=!1;e.text&&"string"==typeof e.text&&(n=e.text);i=e.identifier&&"string"==typeof e.identifier?e.identifier:X.randomIdentifier();e.disabled&&!0===e.disabled&&(o=!0);t.push({text:n,identifier:i,type:"secondary",custom:!0,disabled:o})}));return t};t._onHide=function(e){return"function"==typeof e.onHide?e.onHide:function(){}};t.sanitizeOptions=function(e){e=e||{};var t={chrome:this._chrome(e),header:this._header(e.header),hint:this._hint(e.hint),width:this._width(e),height:this._height(e),$content:e.$content,extension:e.extension,actions:this._actions(e),id:this._id(e.id),size:e.size,closeOnEscape:this._closeOnEscape(e),onHide:this._onHide(e)};t.size=this._size(t);return t};t.moduleOptionsFromGlobal=function(e,t){return!!(window._AP&&window._AP.dialogModules&&window._AP.dialogModules[e]&&window._AP.dialogModules[e][t])&&$.extend({},{chrome:!0,hostFrameOffset:1},window._AP.dialogModules[e][t].options)};t.trackMultipleDialogOpening=function(e,t){var n,i=this._size(t);if(_(".ap-aui-dialog2:visible").length){n=_("#macro-browser-dialog").length||AJS.Confluence&&AJS.Confluence.Editor&&AJS.Confluence.Editor.currentEditMode?"fullscreen"===i?"connect-macro-multiple-fullscreen":"connect-macro-multiple":"connect-multiple";ee.trackMultipleDialogOpening(n,e)}};t.assertActiveDialogOrThrow=function(e,t){if(!e.isActiveDialog(t))throw new Error("Failed to find an active dialog for: "+t)};return e}()),ne={notifyIframeCreated:function(e,t){m.dispatch("iframe-create",{$el:e,extension:t})},notifyBridgeEstablished:function(e,t){m.dispatch("iframe-bridge-established",{$el:e,extension:t})},notifyIframeDestroyed:function(e){"string"==typeof e&&(e={id:e});M.getExtensions(e).forEach((function(e){m.dispatch("iframe-destroyed",{extension:e});M.unregisterExtension({id:e.extension_id})}),this)},notifyUnloaded:function(e,t){m.dispatch("iframe-unload",{$el:e,extension:t})}},ie={},oe=function(e){return encodeURIComponent(e).replace(/[!'()*]/g,(function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()}))},re="%[a-f0-9]{2}",ae=new RegExp("("+re+")|([^%]+?)","gi"),se=new RegExp("("+re+")+","gi");function ce(e,t){try{return[decodeURIComponent(e.join(""))]}catch(e){}if(1===e.length)return e;t=t||1;var n=e.slice(0,t),i=e.slice(t);return Array.prototype.concat.call([],ce(n),ce(i))}function de(e){try{return decodeURIComponent(e)}catch(i){for(var t=e.match(ae)||[],n=1;n<t.length;n++)t=(e=ce(t,n).join("")).match(ae)||[];return e}}var le=function(e){if("string"!=typeof e)throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{e=e.replace(/\+/g," ");return decodeURIComponent(e)}catch(t){return function(e){for(var t={"%FE%FF":"��","%FF%FE":"��"},n=se.exec(e);n;){try{t[n[0]]=decodeURIComponent(n[0])}catch(e){var i=de(n[0]);i!==n[0]&&(t[n[0]]=i)}n=se.exec(e)}t["%C2"]="�";for(var o=Object.keys(t),r=0;r<o.length;r++){var a=o[r];e=e.replace(new RegExp(a,"g"),t[a])}return e}(e)}},ue=function(e,t){if("string"!=typeof e||"string"!=typeof t)throw new TypeError("Expected the arguments to be of type `string`");if(""===t)return[e];var n=e.indexOf(t);return-1===n?[e]:[e.slice(0,n),e.slice(n+t.length)]},fe=function(e,t){for(var n={},i=Object.keys(e),o=Array.isArray(t),r=0;r<i.length;r++){var a=i[r],s=e[a];(o?-1!==t.indexOf(a):t(a,s,e))&&(n[a]=s)}return n};!function(e){const t=oe,n=le,i=ue,o=fe,r=Symbol("encodeFragmentIdentifier");function a(e){if("string"!=typeof e||1!==e.length)throw new TypeError("arrayFormatSeparator must be single character string")}function s(e,n){return n.encode?n.strict?t(e):encodeURIComponent(e):e}function c(e,t){return t.decode?n(e):e}function d(e){return Array.isArray(e)?e.sort():"object"==typeof e?d(Object.keys(e)).sort(((e,t)=>Number(e)-Number(t))).map((t=>e[t])):e}function l(e){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t));return e}function u(e){const t=(e=l(e)).indexOf("?");return-1===t?"":e.slice(t+1)}function f(e,t){t.parseNumbers&&!Number.isNaN(Number(e))&&"string"==typeof e&&""!==e.trim()?e=Number(e):!t.parseBooleans||null===e||"true"!==e.toLowerCase()&&"false"!==e.toLowerCase()||(e="true"===e.toLowerCase());return e}function p(e,t){a((t=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},t)).arrayFormatSeparator);const n=function(e){let t;switch(e.arrayFormat){case"index":return(e,n,i)=>{t=/\[(\d*)\]$/.exec(e);e=e.replace(/\[\d*\]$/,"");if(t){void 0===i[e]&&(i[e]={});i[e][t[1]]=n}else i[e]=n};case"bracket":return(e,n,i)=>{t=/(\[\])$/.exec(e);e=e.replace(/\[\]$/,"");t?void 0!==i[e]?i[e]=[].concat(i[e],n):i[e]=[n]:i[e]=n};case"colon-list-separator":return(e,n,i)=>{t=/(:list)$/.exec(e);e=e.replace(/:list$/,"");t?void 0!==i[e]?i[e]=[].concat(i[e],n):i[e]=[n]:i[e]=n};case"comma":case"separator":return(t,n,i)=>{const o="string"==typeof n&&n.includes(e.arrayFormatSeparator),r="string"==typeof n&&!o&&c(n,e).includes(e.arrayFormatSeparator);n=r?c(n,e):n;const a=o||r?n.split(e.arrayFormatSeparator).map((t=>c(t,e))):null===n?n:c(n,e);i[t]=a};case"bracket-separator":return(t,n,i)=>{const o=/(\[\])$/.test(t);t=t.replace(/\[\]$/,"");if(!o){i[t]=n?c(n,e):n;return}const r=null===n?[]:n.split(e.arrayFormatSeparator).map((t=>c(t,e)));void 0!==i[t]?i[t]=[].concat(i[t],r):i[t]=r};default:return(e,t,n)=>{void 0!==n[e]?n[e]=[].concat(n[e],t):n[e]=t}}}(t),o=Object.create(null);if("string"!=typeof e)return o;if(!(e=e.trim().replace(/^[?#&]/,"")))return o;for(const r of e.split("&")){if(""===r)continue;let[e,a]=i(t.decode?r.replace(/\+/g," "):r,"=");a=void 0===a?null:["comma","separator","bracket-separator"].includes(t.arrayFormat)?a:c(a,t);n(c(e,t),a,o)}for(const e of Object.keys(o)){const n=o[e];if("object"==typeof n&&null!==n)for(const e of Object.keys(n))n[e]=f(n[e],t);else o[e]=f(n,t)}return!1===t.sort?o:(!0===t.sort?Object.keys(o).sort():Object.keys(o).sort(t.sort)).reduce(((e,t)=>{const n=o[t];Boolean(n)&&"object"==typeof n&&!Array.isArray(n)?e[t]=d(n):e[t]=n;return e}),Object.create(null))}e.extract=u;e.parse=p;e.stringify=(e,t)=>{if(!e)return"";a((t=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},t)).arrayFormatSeparator);const n=n=>t.skipNull&&null==e[n]||t.skipEmptyString&&""===e[n],i=function(e){switch(e.arrayFormat){case"index":return t=>(n,i)=>{const o=n.length;return void 0===i||e.skipNull&&null===i||e.skipEmptyString&&""===i?n:null===i?[...n,[s(t,e),"[",o,"]"].join("")]:[...n,[s(t,e),"[",s(o,e),"]=",s(i,e)].join("")]};case"bracket":return t=>(n,i)=>void 0===i||e.skipNull&&null===i||e.skipEmptyString&&""===i?n:null===i?[...n,[s(t,e),"[]"].join("")]:[...n,[s(t,e),"[]=",s(i,e)].join("")];case"colon-list-separator":return t=>(n,i)=>void 0===i||e.skipNull&&null===i||e.skipEmptyString&&""===i?n:null===i?[...n,[s(t,e),":list="].join("")]:[...n,[s(t,e),":list=",s(i,e)].join("")];case"comma":case"separator":case"bracket-separator":{const t="bracket-separator"===e.arrayFormat?"[]=":"=";return n=>(i,o)=>{if(void 0===o||e.skipNull&&null===o||e.skipEmptyString&&""===o)return i;o=null===o?"":o;return 0===i.length?[[s(n,e),t,s(o,e)].join("")]:[[i,s(o,e)].join(e.arrayFormatSeparator)]}}default:return t=>(n,i)=>void 0===i||e.skipNull&&null===i||e.skipEmptyString&&""===i?n:null===i?[...n,s(t,e)]:[...n,[s(t,e),"=",s(i,e)].join("")]}}(t),o={};for(const t of Object.keys(e))n(t)||(o[t]=e[t]);const r=Object.keys(o);!1!==t.sort&&r.sort(t.sort);return r.map((n=>{const o=e[n];return void 0===o?"":null===o?s(n,t):Array.isArray(o)?0===o.length&&"bracket-separator"===t.arrayFormat?s(n,t)+"[]":o.reduce(i(n),[]).join("&"):s(n,t)+"="+s(o,t)})).filter((e=>e.length>0)).join("&")};e.parseUrl=(e,t)=>{t=Object.assign({decode:!0},t);const[n,o]=i(e,"#");return Object.assign({url:n.split("?")[0]||"",query:p(u(e),t)},t&&t.parseFragmentIdentifier&&o?{fragmentIdentifier:c(o,t)}:{})};e.stringifyUrl=(t,n)=>{n=Object.assign({encode:!0,strict:!0,[r]:!0},n);const i=l(t.url).split("?")[0]||"",o=e.extract(t.url),a=e.parse(o,{sort:!1}),c=Object.assign(a,t.query);let d=e.stringify(c,n);d&&(d=`?${d}`);let u=function(e){let t="";const n=e.indexOf("#");-1!==n&&(t=e.slice(n));return t}(t.url);t.fragmentIdentifier&&(u=`#${n[r]?s(t.fragmentIdentifier,n):t.fragmentIdentifier}`);return`${i}${d}${u}`};e.pick=(t,n,i)=>{i=Object.assign({parseFragmentIdentifier:!0,[r]:!1},i);const{url:a,query:s,fragmentIdentifier:c}=e.parseUrl(t,i);return e.stringifyUrl({url:a,query:o(s,n),fragmentIdentifier:c},i)};e.exclude=(t,n,i)=>{const o=Array.isArray(n)?e=>!n.includes(e):(e,t)=>!n(e,t);return e.pick(t,o,i)}}(ie);for(var pe=function(e){for(var t,n=function(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");-1===n&&(n=t);return[n,n===t?0:4-n%4]}(e),i=n[0],o=n[1],r=new me(function(e,t,n){return 3*(t+n)/4-n}(0,i,o)),a=0,s=o>0?i-4:i,c=0;c<s;c+=4){t=he[e.charCodeAt(c)]<<18|he[e.charCodeAt(c+1)]<<12|he[e.charCodeAt(c+2)]<<6|he[e.charCodeAt(c+3)];r[a++]=t>>16&255;r[a++]=t>>8&255;r[a++]=255&t}if(2===o){t=he[e.charCodeAt(c)]<<2|he[e.charCodeAt(c+1)]>>4;r[a++]=255&t}if(1===o){t=he[e.charCodeAt(c)]<<10|he[e.charCodeAt(c+1)]<<4|he[e.charCodeAt(c+2)]>>2;r[a++]=t>>8&255;r[a++]=255&t}return r},ge=[],he=[],me="undefined"!=typeof Uint8Array?Uint8Array:Array,ye="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ve=0,_e=ye.length;ve<_e;++ve){ge[ve]=ye[ve];he[ye.charCodeAt(ve)]=ve}he["-".charCodeAt(0)]=62;he["_".charCodeAt(0)]=63;function xe(e){var t=4-e.length%4;1===t?e+="=":2===t&&(e+="==");return(new TextDecoder).decode(pe(e))}var be=60;function we(e){if(null===e||""===e)throw"Invalid JWT: must be neither null nor empty-string.";var t=e.indexOf("."),n=e.indexOf(".",t+1);if(t<0||n<=t)throw'Invalid JWT: must contain 2 period (".") characters.';var i=e.substring(t+1,n);if(null===i||""===i)throw"Invalid JWT: encoded claims must be neither null nor empty-string.";var o=xe.call(window,i);return JSON.parse(o)}m.register("jwt-skew-set",(function(e){be=e.skew}));var ke={parseJwtIssuer:function(e){return we(e).iss},parseJwtClaims:we,isJwtExpired:function(e,t){void 0===t&&(t=be);var n=we(e),i=0,o=Math.floor(Date.now()/1e3);n&&n.exp&&(i=n.exp);return i-t<o}};function Ee(e){return ie.parse(ie.extract(e)).jwt}var Ae={hasJwt:function(e){return Ee(e)&&0!==Ee(e).length},isJwtExpired:function(e){var t=Ee(e);return ke.isJwtExpired(t)}},Ce=function(e){m.dispatch("content-resolver-register-by-extension",e)},Oe=function(e){if(!e.resolver)throw Error("ACJS: No content resolver supplied");var t=e.resolver.call(null,$.extend({classifier:"json"},e.extension));t.fail((function(t,n){m.dispatch("jwt-url-refreshed-failed",{extension:e.extension,$container:e.$container,errorText:n.text})}));t.done((function(t){var n={};if("object"==typeof t)n=t;else if("string"==typeof t)try{n=JSON.parse(t)}catch(e){console.error("ACJS: invalid response from content resolver")}e.extension.url=n.url;$.extend(e.extension.options,n.options);m.dispatch("jwt-url-refreshed",{extension:e.extension,$container:e.$container,url:e.extension.url})}));m.dispatch("jwt-url-refresh-request",{data:e})},Ie=function(e){"number"==typeof e?m.dispatch("jwt-skew-set",{skew:e}):console.error("ACJS: invalid JWT clock skew set")},Se=function(e){var t={};if(e&&"object"==typeof e){e.width&&(t.width=$.stringToDimension(e.width));e.height&&(t.height=$.stringToDimension(e.height));if("string"==typeof e.sandbox){var n=document.createElement("iframe");t.sandbox=e.sandbox.split(" ").filter((function(e){return $.isSupported(n,"sandbox",e,!0)})).join(" ")}}return t},Pe=new(function(){function e(){this.store={}}var t=e.prototype;t.set=function(e,t){if(t){var n={};n[e]=t}else n=e;$.extend(this.store,n)};t.get=function(e){return e?this.store[e]:$.extend({},this.store)};return e}());function Te(e){if(AJS&&AJS.DarkFeatures&&AJS.DarkFeatures.isEnabled&&AJS.DarkFeatures.isEnabled(e))return!0;var t,n,i=window.featureFlags||(t="fe-feature-flags",null===(n=document.querySelector("meta[name='ajs-"+t+"']"))?void 0:n.getAttribute("content")||void 0);if(!i)return!1;var o={};try{o="object"==typeof i?i:JSON.parse(i)}catch(e){return!1}return!(!o[e]||"boolean"!=typeof o[e].value)&&o[e].value}var Me={getBooleanFeatureFlag:Te,isSetBlockDisplayFlagEnabled:function(){return Te("com.atlassian.connect.acjs.onecloud-1878-set-block-display")},imperativeTriggerForDialogWebItems:function(){return Te("issue.view.use-imperative-trigger-for-acjs-dialog-webitems_ek6c4")}},De=!1,je="com.codebarrel.addons.automation";var Fe=!1;function Le(e){return{addon_key:e.addon_key,key:e.key,url:e.url,options:e.options}}var Ne={createSimpleXdmExtension:function(e){var t=Le(e),n=Pe.get();e.options=t.options=$.extend({},t.options);e.options.globalOptions=n;!function(e){e===je&&function(){if(!De){De=!0;var e={getPerformanceTiming:function(e){return new Promise((function(n,i){t(e)||i(new Error("This is a restricted API"));n(JSON.parse(JSON.stringify(window.performance.timing)))}))},getPerformanceNavigationTiming:function(e){return new Promise((function(n,i){t(e)||i(new Error("This is a restricted API"));window.PerformanceNavigationTiming||n(void 0);var o=window.performance.getEntriesByType("navigation");n(JSON.parse(JSON.stringify(o)))}))}};M.returnsPromise(e.getPerformanceTiming);M.returnsPromise(e.getPerformanceNavigationTiming);M.defineModule("_performance",e)}function t(e){return e._context.extension.addon_key===je}}();!function(){if(!Fe){Fe=!0;var e={getBooleanFeatureFlag:function(e){return new Promise((function(t,n){0===e.indexOf("com.atlassian.connect.acjs.iframe.")?t(Te(e)):n(new Error("Only allowlisted flags can be accessed from the iframe."))}))}};M.returnsPromise(e.getBooleanFeatureFlag);M.defineModule("_featureFlag",e)}}()}(e.addon_key);var i=M.create(t,(function(){e.options.noDOM||(e.$el=_(document.getElementById(e.id)));ne.notifyBridgeEstablished(e.$el,e)}),(function(){ne.notifyUnloaded(e.$el,e)}));t.id=i.id;e.id=i.id;$.extend(i,Se(e.options));return{iframeAttributes:i,extension:e}},extensionConfigSanitizer:Le},Be=new(function(){function e(){this._contentResolver=!1}var t=e.prototype;t.setContentResolver=function(e){this._contentResolver=e};t.resize=function(e,t,n){e=$.stringToDimension(e);t=$.stringToDimension(t);n.css({width:e,height:t});n.trigger("resized",{width:e,height:t})};t.simpleXdmExtension=function(e,t){!e.url||Ae.hasJwt(e.url)&&Ae.isJwtExpired(e.url)?this._contentResolver?Oe({extension:e,resolver:this._contentResolver,$container:t}):console.error("JWT is expired and no content resolver was specified"):this._appendExtension(t,this._simpleXdmCreate(e))};t._simpleXdmCreate=function(e){var t=Ne.createSimpleXdmExtension(e);e.id=t.iframeAttributes.id;e.$el=this.render(t.iframeAttributes);return e};t._appendExtension=function(e,t){var n=e.find("iframe");n.length>0&&n.destroy();t.options.hideIframeUntilLoad&&t.$el.css({visibility:"hidden"}).load((function(){t.$el.css({visibility:""})}));e.prepend(t.$el);ne.notifyIframeCreated(t.$el,t)};t._appendExtensionError=function(e,t){var n=_('<div class="connect-resolve-error"></div>'),i=_("<p />").text(t);n.append('<p class="error">Error: The content resolver threw the following error:</p>');n.append(i);e.prepend(n)};t.resolverResponse=function(e){var t=this._simpleXdmCreate(e.extension);this._appendExtension(e.$container,t)};t.resolverFailResponse=function(e){this._appendExtensionError(e.$container,e.errorText)};t.render=function(e){(e=e||{}).referrerpolicy="no-referrer";return _("<iframe />").attr(e).addClass("ap-iframe")};return e}());m.register("iframe-resize",(function(e){Be.resize(e.width,e.height,e.$el)}));m.register("content-resolver-register-by-extension",(function(e){Be.setContentResolver(e.callback)}));m.register("jwt-url-refreshed",(function(e){Be.resolverResponse(e)}));m.register("jwt-url-refreshed-failed",(function(e){Be.resolverFailResponse(e)}));m.register("after:iframe-bridge-established",(function(e){e.extension.options.noDom?e.extension.options.bridgeEstablished=!0:e.$el[0].bridgeEstablished=!0}));var $e=function(e){m.dispatch("button-clicked",{$el:e})},Je=function(e,t){m.dispatch("button-toggle",{$el:e,disabled:t})},Re=function(e,t){m.dispatch("button-toggle-visibility",{$el:e,hidden:t})},ze=["primary","link","secondary"],He=0,Ue=function(){function e(){this.AP_BUTTON_CLASS="ap-aui-button"}var t=e.prototype;t.setType=function(e,t){t&&ze.indexOf(t)>=0&&e.addClass("aui-button-"+t);return e};t.setDisabled=function(e,t){void 0===t||e.data("immutable")||e.attr("aria-disabled",t);return e};t.setHidden=function(e,t){void 0===t||e.data("immutable")||e.toggle(!t);return e};t._setId=function(e,t){if(!t){t="ap-button-"+He;He++}e.attr("id",t);return e};t._additionalClasses=function(e,t){if(t){"string"!=typeof t&&(t=t.join(" "));e.addClass(t)}return e};t.getName=function(e){return _(e).data("name")};t.getText=function(e){return _(e).text()};t.getIdentifier=function(e){return _(e).data("identifier")};t.isVisible=function(e){return _(e).is(":visible")};t.isEnabled=function(e){return!("true"===_(e).attr("aria-disabled"))};t.render=function(e){var t=_("<button />");e=e||{};t.addClass("aui-button "+this.AP_BUTTON_CLASS);t.text(e.text);t.data(e.data);t.data({name:e.name||e.identifier,identifier:e.identifier||X.randomIdentifier(),immutable:e.immutable||!1});this._additionalClasses(t,e.additionalClasses);this.setType(t,e.type);this.setDisabled(t,e.disabled||!1);this._setId(t,e.id);return t};return e}(),Ke=new Ue;_((function(){_("body").on("click","."+Ke.AP_BUTTON_CLASS,(function(e){var t=_(e.target).closest("."+Ke.AP_BUTTON_CLASS);"true"!==t.attr("aria-disabled")&&$e(t)}))}));m.register("button-toggle",(function(e){Ke.setDisabled(e.$el,e.disabled)}));m.register("button-toggle-visibility",(function(e){Ke.setHidden(e.$el,e.hidden)}));var qe=["ap-iframe-container"],Ve=new(function(){function e(){}var t=e.prototype;t.createExtension=function(e,t){var n=this._renderContainer();t&&!1===t.loadingIndicator||n.append(this._renderLoadingIndicator());Be.simpleXdmExtension(e,n);return n};t._renderContainer=function(e){var t=_("<div />").attr(e||{});t.addClass(qe.join(" "));return t};t._renderLoadingIndicator=function(){return E.render()};return e}());m.register("iframe-create",(function(e){var t="embedded-"+e.extension.id;e.extension.$el.parents(".ap-iframe-container").attr("id",t)}));function We(e){return Ve.createExtension(e)}var Ge=function(e,t){var n={};if(t){n.methods=t;n.name=e}else n.methods=e;m.dispatch("module-define-custom",n)},Xe=function(e,t){m.dispatch("analytics-deprecated-method-used",{methodUsed:e,extension:t})},Qe=function(e){m.dispatch("iframe-bridge-start",{extension:e})},Ye=function(e,t){m.dispatch("analytics-external-event-track",{eventName:e,values:t})},Ze=function(e,t){m.dispatch("analytics-content-resolver-track",{success:e,extra:t})},et=function(e,t){e&&Object.getOwnPropertyNames(e).length>0&&m.dispatch("analytics-iframe-performance",{metrics:e,extension:t})};function tt(e){var t=e.attr("class"),n=t?t.match(/ap-plugin-key-([^\s]*)/):null;return!!Array.isArray(n)&&n[1]}function nt(e){var t=e.attr("class"),n=t?t.match(/ap-module-key-([^\s]*)/):null;return!!Array.isArray(n)&&n[1]}function it(e){return tt(e)+"__"+nt(e)}function ot(e,t,n){var i=e+"Modules";if(window._AP&&window._AP[i]&&window._AP[i][t]&&window._AP[i][t][n])return $.extend({},window._AP[i][t][n].options)}function rt(e,t){var n=tt(t),i=function(e){var t=e.attr("class"),n=t?t.match(/ap-target-key-([^\s]*)/):null;return!!Array.isArray(n)&&n[1]}(t);return ot(e,n,i)}function at(e){var t=e.attr("href");Me.imperativeTriggerForDialogWebItems()&&(t=t||e.attr("data-href"));var n,i={};t||(t=e.find("a").attr("href"));if(t){var o=t.indexOf("#");if(o>=0){var r=t.substring(o+1);try{n=JSON.parse(decodeURI(r))}catch(e){console.error("ACJS: cannot decode webitem anchor")}n&&window._AP&&window._AP._convertConnectOptions?i=window._AP._convertConnectOptions(n):console.error("ACJS: cannot convert webitem url to connect iframe options")}else{var a=it(e),s=st(e)?"inlineDialog":"dialog",c=rt(s,e);!c&&window._AP&&window._AP[s+"Options"]&&(c=$.extend({},window._AP[s+"Options"][a])||{});if(!c){c={};console.warn("no webitem "+s+"Options for "+a)}c.productContext=c.productContext||{};var d=ie.parse(ie.extract(t));$.extend(c.productContext,d);i={addon_key:tt(e),key:nt(e),options:c}}}return i}function st(e){return e.hasClass("ap-inline-dialog")}var ct={sanitizeTriggers:function(e){var t;Array.isArray(e)?t=e.join(" "):"string"==typeof e&&(t=e.trim());return t},uniqueId:function(){return"webitem-"+Math.floor(1e9*Math.random()).toString(16)},getExtensionKey:tt,getKey:nt,getOptionsForWebItem:function(e){var t=it(e),n=st(e)?"inlineDialog":"dialog",i=rt(n,e);!i&&window._AP&&window._AP[n+"Options"]&&(i=$.extend({},window._AP[n+"Options"][t])||{});if(!i){i={};console.warn("no webitem "+n+"Options for "+t)}i.productContext=i.productContext||{};i.structuredContext=i.structuredContext||{};var o=at(e);if(o&&o.options){$.extend(i.productContext,o.options.productContext);$.extend(i.structuredContext,o.options.structuredContext);i.contextJwt=o.options.contextJwt}return i},getModuleOptionsByAddonAndModuleKey:ot,getConfigFromTarget:at},dt=new function(){var e=this;this._providers={};this.registerProvider=function(t,n){e._providers[t]=n};this.getProvider=function(t){return e._providers[t]}},lt=new(function(){function e(){this.moduleNamesToModules=new Map}e.prototype.registerModule=function(e,t){var n=e.getModuleRegistrationName();this.moduleNamesToModules.set(n,e)};e.prototype.getModuleByName=function(e){return this.moduleNamesToModules.get(e)};e.prototype.getProviderByModuleName=function(e){var t=this.moduleNamesToModules.get(e);return t&&t.isEnabled()?t.getProvider():void 0};return e}()),ut=function(e){var t;if(_t.getWebItemsBySelector(e.selector))return!1;t=_t.setWebItem(e);m.dispatch("webitem-added",{webitem:t})},ft=function(e,t,n){m.dispatch("webitem-invoked:"+e.name,{webitem:e,event:t,extension:n})},pt=function(e,t){var n=e?"inline-dialog":"dialog";m.dispatch("webitem-invoked:"+n,t)},gt=new WeakSet,ht=function(){function e(){this._webitems={};this._contentResolver=function(){}}var t=e.prototype;t.setContentResolver=function(e){this._contentResolver=e};t.requestContent=function(e){if(e.addon_key&&e.key)return this._contentResolver.call(null,$.extend({classifier:"json"},e))};t.getWebItemsBySelector=function(e){var t,n=this;Object.getOwnPropertyNames(this._webitems).some((function(i){var o=n._webitems[i];if(o.selector&&o.selector.trim()===e.trim()){t=o;return!0}return!1}));return t};t.setWebItem=function(e){return this._webitems[e.name]={name:e.name,selector:e.selector,triggers:e.triggers}};t._removeTriggers=function(e){var t=this,n=ct.sanitizeTriggers(e.triggers);_((function(){_("body").off(n,e.selector,t._webitems[e.name]._on)}));delete this._webitems[e.name]._on};t._addTriggers=function(e){var t=ct.sanitizeTriggers(e.triggers);e._on=function(t){if(!t.defaultPrevented||!Me.imperativeTriggerForDialogWebItems()){var n=_(t.target).closest(e.selector);if(!Me.imperativeTriggerForDialogWebItems()||void 0===n.attr("data-ap-ignore")){t.preventDefault();vt(n,t.type,t,e)}}};_((function(){if(Te("com.atlassian.connect.acjs.use-mutationobserver-for-connect-dialog-events")){var n=function(n){if(!gt.has(n)){gt.add(n);_(n).on(t,e._on)}};document.querySelectorAll(e.selector).forEach((function(e){n(e)}));new MutationObserver((function(t,i){t.forEach((function(t){"childList"===t.type&&t.addedNodes.forEach((function(t){t.nodeType===Node.ELEMENT_NODE&&(t.matches(e.selector)?n(t):t.querySelectorAll(e.selector).forEach((function(e){n(e)})))}))}))})).observe(document.body,{childList:!0,subtree:!0})}else _("body").on(t,e.selector,e._on);_("head").append('<style type="text/css">'+e.selector+".ap-link-webitem {pointer-events: auto;}</style>")}))};return e}();function mt(e,t){t=t||"click";var n=_(e);yt(Array.from(e.classList))&&vt(n,t)}function yt(e){return function(e){return!!e&&e.includes("ap-dialog")}(e)||function(e){return!!e&&e.includes("ap-inline-dialog")}(e)}function vt(e,t,n,i){var o=ct.getConfigFromTarget(e),r=o&&o.url?o.url:void 0,a={addon_key:ct.getExtensionKey(e),key:ct.getKey(e),options:ct.getOptionsForWebItem(e),url:r};if("com.addonengine.analytics"!==a.addon_key||bt.isModuleDefined("analytics"))if(Me.imperativeTriggerForDialogWebItems()||!i){var s=st(e);pt(s,{$target:e,eventType:t,extension:a})}else ft(i,n,a);else console.log("ACJS-1164 Dropping event "+t+" for plugin "+a.addon_key+" until AP.analytics loads...")}var _t=new ht;m.register("webitem-added",(function(e){_t._addTriggers(e.webitem)}));m.register("content-resolver-register-by-extension",(function(e){_t.setContentResolver(e.callback)}));document.addEventListener("aui-responsive-menu-item-created",(function(e){var t=e.detail.originalItem.querySelector('a[class*="ap-"]');if(t){var n=e.detail.newItem.querySelector("a");[].slice.call(t.classList).forEach((function(e){/^ap-/.test(e)&&n.classList.add(e)}))}}));var xt=function(){function e(){var e=this;this.targetSpecNoDialogs=j;this.triggerWebItem=mt;this.isDialogWebItem=yt;this.create=function(e){return We(Ne.extensionConfigSanitizer(e))};this.dialog={create:function(e,t){var n=ct.getModuleOptionsByAddonAndModuleKey("dialog",e.addon_key,e.key),i=$.extend({},n||{},t);R(e,i)},close:function(t,n){var i=e.getFrameworkAdaptor().getProviderByModuleName("dialog");if(i){te.assertActiveDialogOrThrow(i,t);F("dialog.close",{addon_key:t},n);i.close()}else z()}};this.registerContentResolver={resolveByExtension:function(t){e._contentResolver=t;Ce({callback:t})}};this.getContentResolver=function(){return e._contentResolver};this.registerProvider=function(e,t){dt.registerProvider(e,t)};this.getProvider=function(e){return dt.getProvider(e)};this.frameworkAdaptor=lt}var t=e.prototype;t.createExtension=function(e){e.options=e.options||{};e.options.noDom=!0;var t=Ne.createSimpleXdmExtension(e);Qe(t.extension);return t};t.registerExistingExtension=function(e,t){return M.registerExistingExtension(e,t)};t.setFrameworkAdaptor=function(e){this.frameworkAdaptor=e};t.getFrameworkAdaptor=function(){return this.frameworkAdaptor};t._cleanExtension=function(e){return $.pick(e,["id","addon_key","key","options","url"])};t.onIframeEstablished=function(e){e._wrapper=function(t){e.call({},{$el:t.$el,extension:this._cleanExtension(t.extension)})}.bind(this);m.register("after:iframe-bridge-established",e._wrapper)};t.offIframeEstablished=function(e){if(!e._wrapper)throw new Error("cannot unregister event dispatch listener without _wrapper reference");m.unregister("after:iframe-bridge-established",e._wrapper)};t.onIframeUnload=function(e){var t=this;m.register("after:iframe-unload",(function(n){e.call({},{$el:n.$el,extension:t._cleanExtension(n.extension)})}))};t.onPublicEventDispatched=function(e){e._wrapper=function(t){e.call({},{type:t.type,event:t.event,extension:this._cleanExtension(t.sender)})}.bind(this);m.register("after:event-public-dispatch",e._wrapper)};t.offPublicEventDispatched=function(e){if(!e._wrapper)throw new Error("cannot unregister event dispatch listener without _wrapper reference");m.unregister("after:event-public-dispatch",e._wrapper)};t.onKeyEvent=function(e,t,n,i){K({extension_id:e,key:t,modifiers:n,callback:i})};t.offKeyEvent=function(e,t,n,i){q({extension_id:e,key:t,modifiers:n,callback:i})};t.onFrameClick=function(e){if("function"!=typeof e)throw new Error("handleIframeClick must be a function");W(e)};t.offFrameClick=function(){G()};t.destroy=function(e){ne.notifyIframeDestroyed({id:e})};t.defineModule=function(e,t){Ge(e,t)};t.isModuleDefined=function(e){return M.isModuleDefined(e)};t.broadcastEvent=function(e,t,n){F(e,t,n)};t.getExtensions=function(e){return M.getExtensions(e)};t.trackDeprecatedMethodUsed=function(e,t){Xe(e,t)};t.trackAnalyticsEvent=function(e,t){Ye(e,t)};t.trackContentResolverEvent=function(e,t){Ze(e,t)};t.setJwtClockSkew=function(e){Ie(e)};t.isJwtExpired=function(e,t){return t?ke.isJwtExpired(e):Ae.isJwtExpired(e)};t.hasJwt=function(e){return Ae.hasJwt(e)};t.getBooleanFeatureFlag=function(e){return Te(e)};t.setExtensionConfigurationOptions=function(e,t){Pe.set(e,t)};t.getExtensionConfigurationOption=function(e){return Pe.get(e)};t.onIframeTimeout=function(e){e._wrapper=function(t){e.call({},{extension:this._cleanExtension(t.extension)})}.bind(this);m.register("after:iframe-bridge-timeout",e._wrapper)};t.offIframeTimeout=function(e){if(!e._wrapper)throw new Error("cannot unregister event dispatch listener without _wrapper reference");m.unregister("after:iframe-bridge-timeout",e._wrapper)};t.onIframePerformanceTelemetry=function(e){e._wrapper=function(t){e.call({},{metrics:t.metrics,extension:this._cleanExtension(t.extension)})}.bind(this);m.register("after:analytics-iframe-performance",e._wrapper)};t.offIframePerformanceTelemetry=function(e){if(!e._wrapper)throw new Error("cannot unregister event dispatch listener without _wrapper reference");m.unregister("after:analytics-iframe-performance",e._wrapper)};t.onIframeVisible=function(e){e._wrapper=function(t){e.call({},{extension:this._cleanExtension(t)})}.bind(this);m.register("after:iframe-visible",e._wrapper)};t.offIframeVisible=function(e){if(!e._wrapper)throw new Error("cannot unregister event dispatch listener without _wrapper reference");m.unregister("after:iframe-visible",e._wrapper)};t.onContentResolverEvent=function(e){e._wrapper=function(t){e.call({},t)}.bind(this);m.register("after:analytics-content-resolver-track",e._wrapper)};t.offContentResolverEvent=function(e){if(!e._wrapper)throw new Error("cannot unregister event dispatch listener without _wrapper reference");m.unregister("after:analytics-content-resolver-track",e._wrapper)};return e}(),bt=new xt,wt="ap-dialog-",kt="ap-aui-dialog2",Et=new RegExp("^ap-dialog-[0-9A-Za-z]+$"),At=["small","medium","large","xlarge","fullscreen","maximum"],Ct="ap-aui-dialog-button",Ot="aui-dialog2-footer-actions";function It(){var e=AJS.LayerManager.global.getTopLayer();if(e&&Et.test(e.attr("id"))){var t=AJS.dialog2(e);t._id=t.$el.attr("id").replace(wt,"");return t}}function St(e){var t=e.find(".header-control-panel");t.length||(t=e.find(".aui-dialog2-footer-actions"));return t}function Pt(e,t){return St(t).find(".aui-button").filter((function(){return Ke.getIdentifier(this)===e}))}var Tt=function(){function e(){}var t=e.prototype;t._renderHeaderCloseBtn=function(){var e=_("<a />").addClass("aui-dialog2-header-close"),t=_("<span />").addClass("aui-icon aui-icon-small aui-iconfont-close-dialog").text("Close");e.append(t);return e};t._renderFullScreenHeader=function(e,t){var n=_("<div />").addClass("header-title-container aui-item expanded"),i=_("<div />").append(_("<span />").addClass("header-title").text(t.header||""));n.append(i);e.append(n).append(this._renderHeaderActions(t.actions,t.extension));return e};t._renderHeader=function(e){var t=_("<header />").addClass("aui-dialog2-header");if("fullscreen"===e.size)return this._renderFullScreenHeader(t,e);if(e.header){var n=_("<h2 />").addClass("aui-dialog2-header-main").text(e.header);t.append(n)}t.append(this._renderHeaderCloseBtn());return t};t._renderHeaderActions=function(e,t){var n=_("<div />").addClass("aui-item header-control-panel");e[0].additionalClasses=["aui-icon","aui-icon-small","aui-iconfont-success"];e[1].additionalClasses=["aui-icon","aui-icon-small","aui-iconfont-close-dialog"];this._renderActionButtons(e,t).forEach((function(e){n.append(e)}));return n};t._renderContent=function(e){var t=_("<div />").addClass("aui-dialog2-content");e&&t.append(e);return t};t._renderFooter=function(e){var t=_("<footer />").addClass("aui-dialog2-footer");if("fullscreen"!==e.size){var n=this._renderFooterActions(e.actions,e.extension);t.append(n)}if(e.hint){var i=_("<div />").addClass("aui-dialog2-footer-hint").text(e.hint);t.append(i)}return t};t._renderActionButtons=function(e,t){var n=this,i=[];[].concat(e).forEach((function(e){i.push(n._renderDialogButton({text:e.text,name:e.name,type:e.type,additionalClasses:e.additionalClasses,custom:e.custom||!1,identifier:e.identifier,immutable:e.immutable,disabled:e.disabled||!1},t))}));return i};t._renderFooterActions=function(e,t){var n=_("<div />").addClass(Ot);this._renderActionButtons(e,t).forEach((function(e){n.append(e)}));return n};t._renderDialogButton=function(e,t){e.additionalClasses=e.additionalClasses||[];e.additionalClasses.push(Ct);e.custom&&e.additionalClasses.push("ap-dialog-custom-button");var n=Ke.render(e);n.extension=t;return n};t.render=function(e){var t=$.extend({},e),n=te.sanitizeOptions(e),i=_("<section />").attr({role:"dialog",id:wt+n.id});i.attr("data-aui-modal","true");i.data({"aui-remove-on-hide":!0,extension:n.extension});i.addClass("aui-layer aui-dialog2 "+kt);At.indexOf(n.size)>=0&&i.addClass("aui-dialog2-"+n.size);if("fullscreen"===n.size||"maximum"===n.size){n.chrome&&i.addClass("ap-header-controls");i.addClass("aui-dialog2-maximum")}i.append(this._renderContent(n.$content));if(n.chrome){i.prepend(this._renderHeader({header:n.header,actions:n.actions,size:n.size}));i.append(this._renderFooter({extension:n.extension,actions:n.actions,hint:n.hint,size:n.size}))}else i.addClass("aui-dialog2-chromeless");var o=AJS.dialog2(i);o._id=n.id;"fullscreen"===n.size&&(n.height=n.width="100%");n.size&&"fullscreen"!==n.size||AJS.layer(i).changeSize(n.width,n.height);n.onHide&&o.on("hide",n.onHide);o.show();o.$el.data("extension",n.extension);o.$el.data("originalOptions",t);return i};t.setIframeDimensions=function(e){Be.resize("100%","100%",e)};t.getActive=function(){return It()};t.buttonIsEnabled=function(e){var t=It();if(t){var n=Pt(e,t.$el);return Ke.isEnabled(n)}};t.buttonIsVisible=function(e){var t=It();if(t){var n=Pt(e,t.$el);return Ke.isVisible(n)}};t.getByExtension=function(e){var t;if("function"==typeof e)t=e;else{var n=Object.getOwnPropertyNames(e);t=function(t){var i=_(t).data("extension");return n.every((function(t){return i[t]===e[t]}))}}return _("."+kt).toArray().filter(t).map((function(e){return AJS.dialog2(e)}))};t.addButton=function(e,t){t.custom=!0;var n=this._renderDialogButton(t,e),i=this.getByExtension({addon_key:e.addon_key,key:e.key})[0].$el;St(i).append(n);return i};return e}(),Mt=new Tt;m.register("iframe-bridge-established",(function(e){if(e.extension.options.isDialog){var t,n=bt.getFrameworkAdaptor().getProviderByModuleName("dialog");if(n){t=n.close;n.setButtonDisabled("submit",!1)}else{U.toggleButton({identifier:"submit",enabled:!0});t=function(){U.close({dialog:It(),extension:e.extension})}}if(!e.extension.options.preventDialogCloseOnEscape){K({extension_id:e.extension.id,key:27,callback:t});m.registerOnce("dialog-close",(function(t){q({extension_id:e.extension.id,key:27})}))}}}));m.register("dialog-close-active",(function(e){var t=It();t&&U.close({customData:e.customData,dialog:t,extension:e.extension})}));m.register("dialog-close",(function(e){e.dialog&&e.dialog.hide()}));m.register("dialog-button-toggle",(function(e){var t=It();if(t){var n=Pt(e.identifier,t.$el);Je(n,!e.enabled)}}));m.register("dialog-button-toggle-visibility",(function(e){var t=It();if(t){var n=Pt(e.identifier,t.$el);Re(n,e.hidden)}}));m.register("button-clicked",(function(e){var t=e.$el;if(t.hasClass(Ct)){var n=t.parents("."+kt),i=n.find("iframe");i.length&&i[0].bridgeEstablished?U.clickButton(Ke.getIdentifier(t),t,n.data("extension")):U.close({dialog:It(),extension:t.extension})}}));if(_.fn){m.register("iframe-create",(function(e){e.extension.options&&e.extension.options.isDialog&&Mt.setIframeDimensions(e.extension.$el)}));m.register("dialog-button-add",(function(e){Mt.addButton(e.extension,e.button)}));m.register("host-window-resize",$.debounce((function(){_("."+kt).each((function(e,t){var n=_(t),i=te.sanitizeOptions(n.data("originalOptions"));t.style.width=i.width;t.style.height=i.height}))}),100))}V({keyCode:27,callback:function(){U.closeActive({customData:{},extension:null})}});function Dt(t){var n;if(null!=t&&t.options&&null!=(n=AJS)&&null!=(n=n.Meta)&&n.get){var i=e({},t.options.productContext||{});AJS.Meta.get("space-key")&&(i["an.spaceKey"]=AJS.Meta.get("space-key"));return e({},t,{options:e({},t.options,{productContext:i})})}return t}var jt=new(function(){function e(){}var t=e.prototype;t.render=function(e,t){e.options=e.options||{};t=t||{};e.options.isDialog=!0;e.options.dialogId=t.id;e.options.callbackExtensionId=e.callback_extension_id;e.options.preventDialogCloseOnEscape=!1===t.closeOnEscape;e.options.hostFrameOffset=t.hostFrameOffset;e.options.hideIframeUntilLoad=!0;var n=Ve.createExtension(e);return Mt.render({extension:e,$content:n,chrome:t.chrome,width:t.width,height:t.height,size:t.size,header:t.header,hint:t.hint,submitText:t.submitText,cancelText:t.cancelText,buttons:t.buttons,onHide:t.onHide})};t.getActiveDialog=function(){return Mt.getActive()};t.buttonIsEnabled=function(e){return Mt.buttonIsEnabled(e)};t.buttonIsVisible=function(e){return Mt.buttonIsVisible(e)};t.getByExtension=function(e){"string"==typeof e&&(e={id:e});return Mt.getByExtension(e)};return e}());m.register("dialog-extension-open",(function(e){var t=Dt(e.extension),n=te.sanitizeOptions(e.options),i=bt.getFrameworkAdaptor().getProviderByModuleName("dialog");if(i){var o=function(e){var n=t.key,i=t.addon_key,o={button:{identifier:e.identifier,name:e.identifier,text:e.text}};["submit","cancel"].indexOf(e.identifier)>=0&&F("dialog."+e.identifier,{addon_key:i,key:n},o);F("dialog.button.click",{addon_key:i,key:n},o)};t.options.preventDialogCloseOnEscape=!1===n.closeOnEscape;n.actions.map((function(e){return e.onClick=o.bind(null,e)}));i.create(n,t)}else jt.render(t,e.options)}));var Ft={};m.register("dialog-close",(function(e){if(e.dialog&&e.extension){var t={addon_key:e.extension.addon_key,id:e.extension.options.callbackExtensionId};F("dialog.close",t,e.customData)}}));m.register("dialog-button-click",(function(e){var t={button:{name:Ke.getName(e.$el),identifier:Ke.getIdentifier(e.$el),text:Ke.getText(e.$el)}},n={addon_key:e.extension.addon_key,key:e.extension.key};n.id=e.extension.id;e.$el.hasClass("ap-dialog-custom-button")||F("dialog."+t.button.name,n,t);F("dialog.button.click",n,t)}));var Lt=function(){function e(e,t){t=$.last(arguments);var n=bt.getFrameworkAdaptor(),i=n.getProviderByModuleName("dialog");if(i){te.assertActiveDialogOrThrow(i,t._context.extension.addon_key);this.name=e;this.identifier=e}else{if(!jt.getActiveDialog())throw new Error("Failed to find an active dialog.");this.name=e;this.identifier=e;this.enabled=jt.buttonIsEnabled(e);this.hidden=!jt.buttonIsVisible(e)}}var t=e.prototype;t.enable=function(){this.setState({enabled:!0})};t.disable=function(){this.setState({enabled:!1})};t.isEnabled=function(e){e=$.last(arguments);var t=bt.getFrameworkAdaptor(),n=t.getProviderByModuleName("dialog");e(n?!n.isButtonDisabled(this.identifier):this.enabled)};t.toggle=function(){var e=bt.getFrameworkAdaptor().getProviderByModuleName("dialog");e?e.toggleButton(this.identifier):this.setState({enabled:!this.enabled})};t.setState=function(e){var t=bt.getFrameworkAdaptor().getProviderByModuleName("dialog");if(t)t.setButtonDisabled(this.identifier,!e.enabled);else{this.enabled=e.enabled;U.toggleButton({identifier:this.identifier,enabled:this.enabled})}};t.trigger=function(e){e=$.last(arguments);this.enabled&&U.dialogMessage({name:this.name,extension:e._context.extension})};t.isHidden=function(e){e=$.last(arguments);var t=bt.getFrameworkAdaptor(),n=t.getProviderByModuleName("dialog");e(n?n.isButtonHidden(this.identifier):this.hidden)};t.hide=function(){this.setHidden(!0)};t.show=function(){this.setHidden(!1)};t.setHidden=function(e){var t=bt.getFrameworkAdaptor().getProviderByModuleName("dialog");if(t)t.setButtonHidden(this.identifier,e);else{this.hidden=e;U.toggleButtonVisibility({identifier:this.identifier,hidden:this.hidden})}};return e}();function Nt(e){return Ft[e.extension.options.dialogId]}var Bt={create:{constructor:function(e,t){var n=(t=$.last(arguments))._id,i=t._context.extension,o={addon_key:i.addon_key,key:e.key,options:$.pick(i.options,["customData","productContext"]),callback_extension_id:i.id};o.options.customData=e.customData;var r=te.moduleOptionsFromGlobal(o.addon_key,o.key);"number"==typeof(r||{}).hostFrameOffset&&(o.options.hostFrameOffset=r.hostFrameOffset);(e=$.extend({},r||{},e)).id=n;te.trackMultipleDialogOpening(o,e);R(o,e);this.customData=e.customData;Ft[n]=this}},close:function(e,t){t=$.last(arguments);var n=bt.getFrameworkAdaptor(),i=n.getProviderByModuleName("dialog");if(i){te.assertActiveDialogOrThrow(i,t._context.extension.addon_key);F("dialog.close",{addon_key:t._context.extension.addon_key},e);i.close()}else{var o;o=t._context.extension.options.isDialog?jt.getByExtension(t._context.extension.id)[0]:jt.getActiveDialog();U.close({customData:e,dialog:o,extension:t._context.extension})}},getCustomData:function(e){var t=Nt((e=$.last(arguments))._context);e(t?t.customData:void 0)},getButton:{constructor:Lt,enable:Lt.prototype.enable,disable:Lt.prototype.disable,toggle:Lt.prototype.toggle,isEnabled:Lt.prototype.isEnabled,trigger:Lt.prototype.trigger,hide:Lt.prototype.hide,show:Lt.prototype.show,isHidden:Lt.prototype.isHidden},createButton:{constructor:function(e,t){t=$.last(arguments);var n=bt.getFrameworkAdaptor(),i=n.getProviderByModuleName("dialog");if(i){te.assertActiveDialogOrThrow(i,t._context.extension.addon_key);i.createButton({identifier:e.identifier,text:e.text,hidden:!1,disabled:e.disabled||!1,onClick:function(){F("dialog.button.click",{addon_key:t._context.extension.addon_key,key:t._context.extension.key},{button:{identifier:e.identifier,text:e.text}})}})}else H({identifier:e.identifier,text:e.text},t._context.extension)}}};m.register("iframe-resize",(function(e){Be.resize(e.width,e.height,e.$el)}));m.register("iframe-size-to-parent",(function(e){var t,n=$.getIframeByExtensionId(e.extensionId);t=_(window).height()-n.offset().top-1+"px";n.get(0).name.length>0&&"jiraProjectPages"===JSON.parse(n.get(0).name).options.moduleType&&(t="100%");m.dispatch("iframe-resize",{width:"100%",height:t,$el:n})}));m.register("hide-footer",(function(e){e&&_("#footer").css({display:"none"})}));window.addEventListener("resize",(function(e){m.dispatch("host-window-resize",e)}),!0);var $t=function(e,t,n){var i;i=n.extension_id?$.getIframeByExtensionId(n.extension_id):n;m.dispatch("iframe-resize",{width:e,height:t,$el:i,extension:n.extension})},Jt=function(e,t){m.dispatch("iframe-size-to-parent",{hideFooter:t,extensionId:e})},Rt=function(e){m.dispatch("hide-footer",e)},zt=$.debounce,Ht={},Ut=[],Kt={},qt={getLocation:function(e){e=$.last(arguments);var t=dt.getProvider("get-location");e("function"==typeof t?t():window.location.href)},resize:function(e,t,n){n=$.last(arguments);var i=dt.getProvider("addon");if(i)i.resize(e,t,n._context);else{var o=n._context.extension.id,r=n._context.extension.options;if(-1!==Ut.indexOf(o)||r&&r.isDialog)return!1;Ht[o]||(Ht[o]=zt((function(e,t,n){$t(e,t,n._context)}),50));Ht[o](e,t,n)}return!0},sizeToParent:zt((function(e,t){t=$.last(arguments);var n=dt.getProvider("addon");if(n)n.sizeToParent(e,t._context);else if(t._context.extension.options.isFullPage){$.getIframeByExtensionId(t._context.extension_id).addClass("full-size-general-page");Me.isSetBlockDisplayFlagEnabled()&&$.getIframeByExtensionId(t._context.extension_id).addClass("sized-to-parent");Jt(t._context.extension_id,e);Kt[t._context.extension_id]={hideFooter:e}}else $.getIframeByExtensionId(t._context.extension_id).addClass("full-size-general-page-fail")})),hideFooter:function(e){e&&Rt(e)}},Vt=function(e){delete Ht[e];delete Kt[e];-1!==Ut.indexOf(e)&&Ut.splice(Ut.indexOf(e),1)};m.register("host-window-resize",(function(e){Object.getOwnPropertyNames(Kt).forEach((function(e){Jt(e,Kt[e].hideFooter)}))}));m.register("after:iframe-unload",(function(e){Vt(e.extension.id)}));m.register("after:iframe-destroyed",(function(e){Vt(e.extension.extension.id)}));m.register("before:iframe-size-to-parent",(function(e){-1===Ut.indexOf(e.extensionId)&&Ut.push(e.extensionId)}));var Wt=function(e){m.dispatch("inline-dialog-refresh",{$el:e})},Gt=function(){m.dispatch("inline-dialog-close",{})},Xt=function(e){m.dispatch("inline-dialog-opened",{$el:e.$el,trigger:e.trigger,extension:e.extension})},Qt={hide:function(e){e=$.last(arguments);var t=bt.getFrameworkAdaptor(),n=t.getProviderByModuleName("inlineDialog");n?n.hide(e._context):Gt()}},Yt="ac-message-container",Zt=["generic","error","warning","success","info","hint"],en="ap-message-",tn=new RegExp("^ap-message-[0-9A-fa-f]+$"),nn={};function on(e){return tn.test(e)}var rn=!1;function an(e,t,n,i){if(!rn){_(document).on("aui-message-close",(function(e,t){var n=t.attr("id").replace(en,"");if(nn[n]){_.isFunction(nn[n].onCloseTrigger)&&nn[n].onCloseTrigger();nn[n]._destroy()}}));rn=!0}var o=function(){var e=_("#"+Yt);e.length<1&&(e=_('<div id="'+Yt+'" />').appendTo("body"));return e}();i=function(e){var t={};"object"==typeof e&&["closeable","fadeout","delay","duration","id"].forEach((function(n){n in e&&(t[n]=e[n])}));return t}(i);_.extend(i,{title:t,body:AJS.escapeHtml(n)});if(Zt.indexOf(e)<0)throw"Invalid message type. Must be: "+Zt.join(", ");if(on(i.id)){AJS.messages[e](o,i);o.css("margin-left","-"+o.innerWidth()/2+"px")}}function sn(e,t,n,i,o){var r="AP.messages."+e;console.warn("DEPRECATED API - AP.messages."+e+" has been deprecated since ACJS 5.0 and will be removed in a future release. Use AP.flag.create instead.");Xe(r,o._context.extension);var a=bt.getFrameworkAdaptor().getProviderByModuleName("messages");if(a){var s=e,c=a[s];c||(a[s]=a.generic);c(t,n,i)}else an(e,t,n,i)}function cn(e){return{constructor:function(t,n,i,o){var r=(o=$.last(arguments))._id;"string"!=typeof t&&(t="");"string"!=typeof n&&(n="");"object"!=typeof i&&(i={});i.id=en+r;sn(e,t,n,i,o);nn[r]=this}}}var dn={clear:function(e){var t=en+e._id;if(on(t)){var n=bt.getFrameworkAdaptor().getProviderByModuleName("messages");n?n.clear(t):_("#"+t).closeMessage()}},onClose:function(e,t){t=$.last(arguments);var n=e._id,i=bt.getFrameworkAdaptor(),o=i.getProviderByModuleName("messages");if(o){var r=en+e._id;o.onClose(r,t)}else nn[n]&&(nn[n].onCloseTrigger=t)},generic:cn("generic"),error:cn("error"),warning:cn("warning"),success:cn("success"),info:cn("info"),hint:cn("hint")},ln={actionInvoked:function(e,t){m.dispatch("flag-action-invoked",{id:t,actionId:e})},open:function(e){m.dispatch("flag-open",{id:e})},close:function(e){m.dispatch("flag-close",{id:e})},closed:function(e){m.dispatch("flag-closed",{id:e})}},un="ap-flag-",fn="ac-flag-actions",pn=function(){function e(){}var t=e.prototype;t.cleanKey=function(e){var t=new RegExp("^ap-flag-(.+)$"),n=e.match(t);return n&&n[1]?n[1]:null};t._toHtmlString=function(e){return"string"===_.type(e)?e:"object"===_.type(e)&&e instanceof _?e.html():void 0};t._renderBody=function(e){e=this._toHtmlString(e);var t=_("<div />").html(e);_("<p />").addClass(fn).appendTo(t);return t.html()};t._renderActions=function(e,t,n){var i,o=e.find(".ac-flag-actions");n=n||{};Object.getOwnPropertyNames(n).forEach((function(e){i=_("<a />").attr("href","#").data({key:e,flag_id:t}).text(n[e]);o.append(i)}),this);return e};t.render=function(e){!function(){if(hn)return;_(document).on("aui-flag-close",(function(e){var t=e.target.id,n=gn.cleanKey(t);ln.closed(n)}));_(document).on("click",".ac-flag-actions",(function(e){var t=_(e.target),n=t.data("key"),i=t.data("flag_id");ln.actionInvoked(n,i)}));hn=!0}();var t=un+e.id,n=AJS.flag({type:e.type,title:e.title,body:this._renderBody(e.body),close:e.close});n.setAttribute("id",t);var i=_(n);this._renderActions(i,e.id,e.actions);i.addClass("ac-aui-flag");i.close=n.close;return i};t.close=function(e){document.getElementById(e).close()};return e}(),gn=new pn,hn=!1;m.register("flag-close",(function(e){gn.close(e.id)}));var mn={},yn=function(){function e(e,t){t=$.last(arguments);if("object"==typeof e){var n=t._id,i=bt.getFrameworkAdaptor(),o=i.getProviderByModuleName("flag");if(o){var r=[];"object"==typeof e.actions&&(r=Object.getOwnPropertyNames(e.actions).map((function(t){return{actionKey:t,actionText:e.actions[t],executeAction:ln.actionInvoked.bind(null,t,n)}})));var a=e.type||"info",s={id:n,title:e.title,body:e.body,actions:r,onClose:ln.closed,close:e.close,type:a.toLowerCase()};this.flag=o.create(s);var c=dt.getProvider("addon");c&&c.registerUnmountCallback&&c.registerUnmountCallback(this.close.bind(this),t._context)}else{this.flag=gn.render({type:e.type,title:e.title,body:AJS.escapeHtml(e.body),actions:e.actions,close:e.close,id:n});ln.open(this.flag.attr("id"))}this.onTriggers={};this.extension=t._context.extension;mn[t._id]=this;t.call(null,t._id)}}e.prototype.close=function(){this.flag.close()};return e}();function vn(e,t,n){if(mn[e]){var i=mn[e].extension;(n=n||{}).flagIdentifier=e;var o={id:i.id};F(t,o,n)}}m.register("flag-closed",(function(e){vn(e.id,"flag.close");mn[e.id]&&delete mn[e.id]}));m.register("flag-action-invoked",(function(e){vn(e.id,"flag.action",{actionIdentifier:e.actionId})}));var _n,xn,bn={create:{constructor:yn,close:yn.prototype.close}},wn={trackDeprecatedMethodUsed:function(e,t){t=$.last(arguments);Xe(e,t._context.extension)},trackIframePerformanceMetrics:function(e,t){t=$.last(arguments);et(e,t._context.extension)}};m.register("iframe-bridge-established",(function(e){if(e.extension.options.isFullPage){window.addEventListener("scroll",En);_n=e.extension.id}}));m.register("iframe-destroyed",(function(e){kn()}));m.register("iframe-unload",(function(e){kn()}));function kn(){window.removeEventListener("scroll",En);_n=void 0;xn=void 0}function En(){var e=document.documentElement.scrollHeight,t=window.innerHeight,n=.1*e;window.pageYOffset<=n?An("nearTop"):t+window.pageYOffset+n>=e?An("nearBottom"):xn=void 0}function An(e){if(xn!==e){F("scroll."+e,{id:_n},{});xn=e}}var Cn={getPosition:function(e){if((e=$.last(arguments))._context.extension.options.isFullPage){var t=$.getIframeByExtensionId(e._context.extension_id),n=t.offset(),i=_(window);e({scrollY:i.scrollTop()-n.top,scrollX:i.scrollLeft()-n.left,width:window.innerWidth,height:window.innerHeight})}},setVerticalPosition:function(e,t){if((t=$.last(arguments))._context.extension.options&&t._context.extension.options.isFullPage){var n=$.getIframeByExtensionId(t._context.extension_id),i=n.offset();"number"==typeof e&&(document.documentElement.scrollTop=i.top+e)}}},On=function(e,t,n){m.dispatch("dropdown-item-selected",{id:e,item:t,extension:n})};function In(e){return e.map((function(e){if(e.list&&Array.isArray(e.list)){var t={heading:e.heading};t.items=e.list.map((function(e){return function(e){var t={};if("string"==typeof e)t.content=e;else{if(!e.text||"string"!=typeof e.text)throw new Error("Unknown dropdown list item format.");t.content=e.text;"boolean"==typeof e.disabled&&(t.disabled=e.disabled);void 0!==e.itemId&&(t.itemId=e.itemId)}return t}(e)}));return t}}))}var Sn={create:function(e,t){t=$.last(arguments);if("object"==typeof e){var n=bt.getFrameworkAdaptor(),i=n.getProviderByModuleName("dropdown");if(i){var o=In(e.list),r={dropdownId:e.dropdownId,dropdownGroups:o,dropdownItemNotifier:function(e){On(e.dropdownId,e.item,t._context.extension)}};i.create(r,t._context);return r}}},showAt:function(e,t,n,i){var o=$.last(arguments),r={left:0,top:0},a=document.getElementById(o._context.extension_id);a?r=a.getBoundingClientRect():console.error("ACJS: no iframe found for dropdown");var s=bt.getFrameworkAdaptor(),c=s.getProviderByModuleName("dropdown");if(c){var d={dropdownId:e,x:t,y:n,width:i};c.showAt(d,{iframeDimensions:r,onItemSelection:function(e,t){On(e,t,o._context.extension)}})}},hide:function(e){var t=bt.getFrameworkAdaptor().getProviderByModuleName("dropdown");t&&t.hide(e)},itemDisable:function(e,t){var n=bt.getFrameworkAdaptor().getProviderByModuleName("dropdown");n&&n.itemDisable(e,t)},itemEnable:function(e,t){var n=bt.getFrameworkAdaptor().getProviderByModuleName("dropdown");n&&n.itemEnable(e,t)}};m.register("dropdown-item-selected",(function(e){F("dropdown-item-selected",{addon_key:e.extension.addon_key,key:e.extension.key},{dropdownId:e.id,item:e.item})}));m.register("iframe-destroyed",(function(e){var t=bt.getFrameworkAdaptor().getProviderByModuleName("dropdown");t&&t.destroyByExtension(e.extension.extension_id)}));m.register("after:iframe-unload",(function(e){var t=bt.getFrameworkAdaptor().getProviderByModuleName("dropdown");t&&t.destroyByExtension(e.extension.extension_id)}));var Pn,Tn,Mn,Dn,jn,Fn={focus:function(){window.document.querySelector("a").focus({preventScroll:!0});window.document.querySelector("a").blur()},getSelectedText:(Pn=function(e){e("")},Tn="AP.host.getSelectedText()",jn=!1,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(!jn&&"undefined"!=typeof console&&console.warn){jn=!0;console.warn("DEPRECATED API - "+Tn+" has been deprecated "+(Dn?"since ACJS "+Dn:"in ACJS")+" and will be removed in a future release. "+(Mn?"Use "+Mn+" instead.":"No alternative will be provided."));var i=$.last(t);i&&i._context&&i._context.extension&&wn.trackDeprecatedMethodUsed(Tn,i)}return Pn.apply(void 0,t)})},Ln=["light","dark","auto"],Nn=["light-increased-contrast","light","dark","dark-increased-contrast","legacy-light","legacy-dark","spacing","typography","shape","typography-adg3","typography-minor3"],Bn="data-theme",$n="data-color-mode",Jn="--".concat("ds","-elevation-surface-current");function Rn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function zn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,o,r,a,s=[],c=!0,d=!1;try{if(r=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(i=r.call(n)).done)&&(s.push(i.value),s.length!==t);c=!0);}catch(e){d=!0,o=e}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(d)throw o}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Rn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);return"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Rn(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Hn(e){return Hn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Hn(e)}function Un(e){var t=function(e,t){if("object"!==Hn(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==Hn(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===Hn(t)?t:String(t)}function Kn(e,t,n){(t=Un(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n;return e}var qn=["light","dark","spacing","typography","shape"],Vn="UNSAFE_themeOptions",Wn=function(e){return e.split(" ").map((function(e){return e.split(/:([\s\S]*)/)})).reduce((function(e,t){var n,i,o=zn(t,2),r=o[0],a=o[1];"colorMode"===r&&["light","dark","auto"].includes(a)&&(e[r]=a);(i=r,void 0!==qn.find((function(e){return e===i})))&&(n=a,void 0!==Nn.find((function(e){return e===n})))&&(e[r]=a);if(r===Vn)try{e.UNSAFE_themeOptions=JSON.parse(a)}catch(e){}return e}),{})};function Gn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1;i.configurable=!0;"value"in i&&(i.writable=!0);Object.defineProperty(e,Un(i.key),i)}}function Xn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Qn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Xn(Object(n),!0).forEach((function(t){Kn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Xn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Yn=function(){if("undefined"==typeof document)return{};var e=document.documentElement,t=e.getAttribute($n)||"",n=e.getAttribute(Bn)||"";return Qn(Qn({},Wn(n)),function(e){return void 0!==Ln.find((function(t){return t===e}))}(t)&&{colorMode:t})},Zn=function(){return Te("com.atlassian.connect.acjs.fetch-connect-theme-from-prefers-color-scheme")},ei=function(){return{isTokensCodesplittingEnabled:Te("connect-codesplitting_1tqgw")||Te("com.atlassian.connect.codesplitting")}},ti=function(){return window.matchMedia("(prefers-color-scheme: dark)")},ni=function(e){var t=document.getElementById(e);if(t){var n=getComputedStyle(t),i=n.getPropertyValue(Jn),o=n.getPropertyValue("--ds-surface-raised"),r=n.getPropertyValue("--ds-surface-overlay");return i===o?"raised":i===r?"overlay":void 0}},ii=function(e){var t={colorMode:ti().matches?"dark":"light",dark:"dark",light:"light"};return Object.assign(t,e||{})};function oi(){ti().addEventListener("change",(function(){ri(ii(Yn()))}))}function ri(e){var t=ei();ai.extensionIds.length&&ai.extensionIds.forEach((function(n){var i=ni(n);M.broadcast("theme_changed",{id:n},{newTheme:e,featureFlags:t,surface:i})}))}var ai={extensionIds:[],themeObserver:new(function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);Kn(this,"observer",null);Kn(this,"mediaObserver",null);this.callback=t}!function(e,t,n){t&&Gn(e.prototype,t);n&&Gn(e,n);Object.defineProperty(e,"prototype",{writable:!1})}(e,[{key:"observe",value:function(){var e=this;this.observer||(this.observer=new MutationObserver((function(){e.callback(Yn())})));this.observer.observe(document.documentElement,{attributeFilter:[Bn,$n]})}},{key:"disconnect",value:function(){this.observer&&this.observer.disconnect()}}]);return e}())((function(e){ri(e)}))},si={initializeTheming:function(){var e=$.last(arguments),t=1!==arguments.length&&arguments[0];if(e&&e._context&&e._context.extension_id){var n=e._context.extension_id;if(n){var i=Yn();Zn()&&(i=ii(i));var o=ni(n),r=ei();M.broadcast("theme_initialized",{id:n},{initialTheme:i,featureFlags:r,surface:o,forceNoCleanup:t});if(!ai.extensionIds.includes(n)){ai.extensionIds.push(n);ai.themeObserver.observe(document.documentElement);Zn()&&oi()}}}},_finishedInitTheming:function(){Zn()&&(e=document.getElementById("atlassian-connect-dark-mode-fix"))&&e.remove();var e}},ci={setTitle:function(e,t){if((t=$.last(arguments))._context.extension.options&&t._context.extension.options.isFullPage){var n=" - "+$.guessProductFromModuleDefined(window.connectHost);document.title=e+n}}},di=function(e){m.dispatch("inline-dialog-extension",{$el:e.$el,extension:e.extension})},li=new(function(){function e(){}var t=e.prototype;t.resize=function(e){var t=$.stringToDimension(e.width),n=$.stringToDimension(e.height),i=e.$el.find(".contents");if(1===i.length){i.css({width:t,height:n});Wt(e.$el)}};t.refresh=function(e){e.is(":visible")&&e[0].popup.reset()};t._getInlineDialog=function(e){return AJS.InlineDialog(e)};t._renderContainer=function(){return _("<div />").addClass("aui-inline-dialog-contents")};t._displayInlineDialog=function(e){Xt({$el:e.$el,trigger:e.trigger,extension:e.extension})};t.hideInlineDialog=function(e){e.hide()};t.closeInlineDialog=function(){_(".aui-inline-dialog").filter((function(){return _(this).find(".ap-iframe-container").length>0})).hide()};t.render=function(e){var t=this,n=_(document.getElementById("inline-dialog-"+e.id));0!==n.length&&n.remove();return AJS.InlineDialog(e.bindTo,e.id,(function(n,i,o){n.append(e.$content);t._displayInlineDialog({extension:e.extension,$el:n,trigger:i});o()}),e.inlineDialogOptions)};return e}());m.register("iframe-resize",(function(e){var t=e.$el.parents(".aui-inline-dialog");1===t.length&&li.resize({width:e.width,height:e.height,$el:t})}));m.register("inline-dialog-refresh",(function(e){li.refresh(e.$el)}));m.register("inline-dialog-hide",(function(e){li.hideInlineDialog(e.$el)}));m.register("inline-dialog-close",(function(e){li.closeInlineDialog()}));var ui="inline-dialog-target-uid",fi=new(function(){function e(){this._inlineDialogWebItemSpec={name:"inline-dialog",selector:".ap-inline-dialog",triggers:["mouseenter","click"]};this._inlineDialogWebItems={}}var t=e.prototype;t.getWebItem=function(){return this._inlineDialogWebItemSpec};t._createInlineDialog=function(e){return li.render({extension:e.extension,id:e.id,bindTo:e.$target,$content:_("<div />"),inlineDialogOptions:e.extension.options})};t.triggered=function(e){if("click"===(e.eventType||e.event.type)||e.extension.options.onHover){var t=e.$target||_(e.event.currentTarget),n=t.data(ui);this._createInlineDialog({id:n,extension:e.extension,$target:t,options:e.extension.options||{}}).show()}};t.opened=function(e){var t=e.$el.find("iframe");if(t&&1===t.length){var n=t.attr("src");if(n.length>0){var i=Ae.hasJwt(n);if(i&&!Ae.isJwtExpired(n)||!i)return!1}}var o=Dt(e.extension),r=_t.requestContent(o);if(!r){console.warn("no content resolver found");return!1}r.then((function(t){t.options=t.options||{};$.extend(t.options,{autoresize:!0,widthinpx:!0});di({$el:e.$el,extension:t})}));return!0};t.addExtension=function(e){var t=We(e.extension);e.$el.empty().append(t)};t.createIfNotExists=function(e){var t=e.$target||_(e.event.currentTarget),n=t.data(ui);if(!n){n=ct.uniqueId();t.data(ui,n)}};return e}()),pi=fi.getWebItem();m.register("before:webitem-invoked:"+pi.name,(function(e){fi.createIfNotExists(e)}));m.register("webitem-invoked:"+pi.name,(function(e){fi.triggered(e)}));m.register("inline-dialog-opened",(function(e){fi.opened(e)}));m.register("inline-dialog-extension",(function(e){fi.addExtension(e)}));ut(pi);var gi=["click"],hi="dialog-target-uid",mi={chrome:!0},yi=new(function(){function e(){this._dialogWebItem={name:"dialog",selector:".ap-dialog",triggers:gi}}var t=e.prototype;t.getWebItem=function(){return this._dialogWebItem};t._dialogOptions=function(e){return $.extend({},mi,e||{})};t.triggered=function(e){var t=(e.$target||_(e.event.currentTarget)).data(hi),n=this._dialogOptions(e.extension.options);n.id=t;R(e.extension,n)};t.createIfNotExists=function(e){var t=e.$target||_(e.event.currentTarget),n=t.data(hi);if(!n){n=ct.uniqueId();t.data(hi,n)}};return e}()),vi=yi.getWebItem();m.register("webitem-invoked:"+vi.name,(function(e){yi.triggered(e)}));m.register("before:webitem-invoked:"+vi.name,yi.createIfNotExists);ut(vi);window._AP||(window._AP={});window._AP.version||(window._AP.version="5.3.136");M.defineModule("messages",dn);M.defineModule("flag",bn);M.defineModule("dialog",Bt);M.defineModule("inlineDialog",Qt);M.defineModule("env",qt);M.defineModule("events",J);M.defineModule("_analytics",wn);M.defineModule("scrollPosition",Cn);M.defineModule("dropdown",Sn);M.defineModule("host",Fn);M.defineModule("theming",si);M.defineModule("page",ci);m.register("module-define-custom",(function(e){M.defineModule(e.name,e.methods)}));M.registerRequestNotifier((function(t){var n=function(){if("req"===t.type){var n=M.getExtensions((function(e){return e.extension_id===t.extension_id}))[0];if(n){var i=n.extension;m.dispatch("method-invoked",e({},t,{extension:i}))}}};"function"==typeof window.requestIdleCallback?window.requestIdleCallback(n,{timeout:1e3}):n()}));M.setFeatureFlagGetter(Te);return bt}));
}catch(e){WRMCB(e)};