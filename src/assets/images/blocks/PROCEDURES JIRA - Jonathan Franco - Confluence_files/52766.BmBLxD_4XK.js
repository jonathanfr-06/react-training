"use strict";(self._cf=self._cf||[]).push([[52766],{252766:(e,t,s)=>{s.d(t,{Z:()=>V});var n=s(615919),r=s(840506),i=s(199009),a=s(394367),o=s.n(a),c=s(278811),d=s(430564),u=Number.isNaN||function(e){return"number"==typeof e&&e!=e};function l(e,t){if(e.length!==t.length)return!1;for(var s=0;s<e.length;s++)if(n=e[s],r=t[s],!(n===r||u(n)&&u(r)))return!1;var n,r;return!0}var p=s(122529),h=s(347211),f=s(395470),m=s(123672);const I=(0,m.Z)("fabric-elements"),y=(e,t)=>{const{fieldId:s,objectId:n,containerId:r,childObjectId:i,prefetch:a,maxOptions:o,includeTeams:c,productKey:d,principalId:u,siteId:l,orgId:p,filterOptions:h}=e,{sessionId:f,query:m}=t,I=o||100;return{context:s,childObjectId:i,containerId:r,hasFilterOptions:Boolean(h),includeTeams:c,maxNumberOfResults:I,objectId:n,prefetch:a,principalId:u,productKey:d,queryLength:(m||"").length,siteId:l,orgId:p,sessionId:f}},b=(e,t,s={})=>(0,n.Z)({source:"smart-user-picker"},((e,t,s,r={})=>({eventType:e,action:t,actionSubject:s,attributes:(0,n.Z)({packageName:"platform-pkg",packageVersion:"0.0.0-use.local"},r)}))("operational",e,t,s)),g=(e,t,s={})=>b("loaded","preparedUsers",(0,n.Z)((0,n.Z)({},y(e,t)),s)),v=(e,t,s={})=>b("mounted","prefetch",(0,n.Z)((0,n.Z)({},y(e,t)),s)),U=(e,t,s={})=>b("filtered","users",(0,n.Z)((0,n.Z)({},y(e,t)),s)),E=(e,t,s={})=>b("requested","users",(0,n.Z)((0,n.Z)({},y(e,t)),s)),Z=(e,t,s={})=>b("successful","usersRequest",(0,n.Z)((0,n.Z)({},y(e,t)),s)),w=(e,t,s={})=>b("failed","usersRequest",(0,n.Z)((0,n.Z)({},y(e,t)),s));var S=s(659898);const O=async e=>{switch(e){case"cs":return s.e(35848).then(s.bind(s,950888)).then((e=>e.default));case"da":return s.e(66229).then(s.bind(s,826408)).then((e=>e.default));case"de":return s.e(89880).then(s.bind(s,921471)).then((e=>e.default));case"en":return s.e(15729).then(s.bind(s,325550)).then((e=>e.default));case"en_GB":return s.e(20688).then(s.bind(s,150041)).then((e=>e.default));case"es":return s.e(25038).then(s.bind(s,143949)).then((e=>e.default));case"et":return s.e(85990).then(s.bind(s,525467)).then((e=>e.default));case"fi":return s.e(37634).then(s.bind(s,771712)).then((e=>e.default));case"fr":return s.e(58522).then(s.bind(s,251120)).then((e=>e.default));case"hu":return s.e(87808).then(s.bind(s,15881)).then((e=>e.default));case"is":return s.e(67687).then(s.bind(s,660416)).then((e=>e.default));case"it":return s.e(32069).then(s.bind(s,524211)).then((e=>e.default));case"ja":return s.e(26264).then(s.bind(s,6590)).then((e=>e.default));case"ko":return s.e(92655).then(s.bind(s,840536)).then((e=>e.default));case"nb":return s.e(11319).then(s.bind(s,305578)).then((e=>e.default));case"nl":return s.e(78750).then(s.bind(s,667916)).then((e=>e.default));case"pl":return s.e(31884).then(s.bind(s,790322)).then((e=>e.default));case"pt_BR":case"pt-BR":return s.e(25613).then(s.bind(s,546269)).then((e=>e.default));case"pt_PT":case"pt-PT":return s.e(30593).then(s.bind(s,137203)).then((e=>e.default));case"ro":return s.e(47920).then(s.bind(s,395679)).then((e=>e.default));case"ru":return s.e(20018).then(s.bind(s,424222)).then((e=>e.default));case"sk":return s.e(23574).then(s.bind(s,451273)).then((e=>e.default));case"sv":return s.e(69186).then(s.bind(s,853265)).then((e=>e.default));case"th":return s.e(98562).then(s.bind(s,693341)).then((e=>e.default));case"tr":return s.e(73266).then(s.bind(s,187676)).then((e=>e.default));case"uk":return s.e(22589).then(s.bind(s,877536)).then((e=>e.default));case"vi":return s.e(82750).then(s.bind(s,716385)).then((e=>e.default));case"zh_TW":return s.e(4012).then(s.bind(s,963159)).then((e=>e.default));case"zh":return s.e(47660).then(s.bind(s,731448)).then((e=>e.default));default:{const t=e.split(/[_-]/);return 2===t.length?O(t[0]):s.e(15729).then(s.bind(s,325550)).then((e=>e.default))}}},x={},T=e=>{const{intl:t,children:s}=e,i=(e=>{const[t,s]=r.useState(x);return r.useEffect((()=>{let t=!1;return s(x),O(e).then((e=>{t||s(e)})).catch((e=>{console.error(e)})),()=>{t=!0}}),[e]),t})(t.locale),a=(0,r.useMemo)((()=>(0,n.Z)((0,n.Z)({},t.messages),i)),[t.messages,i]);return r.createElement(S.Z,{locale:t.locale,messages:a},s)};T.displayName="MessagesIntlProvider";const j=(0,p.ZP)(T);var P=s(528591),q=s(274706),A=s(391023),R=s(742685);const N="smart-user-picker",C=new A.I("smart-user-picker-rendered",{platform:{component:N},type:R.Z.Load,performanceType:R.R.PageSegmentLoad}),F=new A.I("smart-user-picker-options-shown",{platform:{component:N},type:R.Z.Operation,performanceType:R.R.InlineResult});class L extends r.Component{componentDidCatch(){C.getInstance(this.props.id).failure()}render(){return this.props.children}}L.displayName="UfoErrorBoundary";const k=e=>({metadata:{contextType:e}}),$=e=>(e||[]).map((({id:e,type:t})=>({id:e,type:t})));class B extends r.Component{constructor(e){var t;super(e),(0,i.Z)(this,"state",{users:[],loading:!1,closed:!0,query:"",defaultValue:[],bootstrapOptions:[]}),(0,i.Z)(this,"optionsShownUfoExperienceInstance",void 0),(0,i.Z)(this,"abortOptionsShownUfoExperience",(()=>{this.optionsShownUfoExperienceInstance.state.id===h.h.STARTED.id&&this.optionsShownUfoExperienceInstance.abort()})),(0,i.Z)(this,"startOptionsShownUfoExperience",(()=>{this.abortOptionsShownUfoExperience(),this.optionsShownUfoExperienceInstance.start()})),(0,i.Z)(this,"fireEvent",((e,...t)=>{const{createAnalyticsEvent:s}=this.props;s&&I(e(this.props,this.state,...t))(s)})),(0,i.Z)(this,"filterOptions",((e,t,s)=>s?s(e,t):e)),(0,i.Z)(this,"memoizedFilterOptions",function(e,t){void 0===t&&(t=l);var s=null;function n(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];if(s&&s.lastThis===this&&t(n,s.lastArgs))return s.lastResult;var i=e.apply(this,n);return s={lastResult:i,lastArgs:n,lastThis:this},i}return n.clear=function(){s=null},n}(this.filterOptions)),(0,i.Z)(this,"getUsers",o()((async()=>{const{query:e,sessionId:t,closed:s}=this.state,{baseUrl:n,childObjectId:r,containerId:i,fieldId:a,includeGroups:o,includeTeams:c,includeUsers:d,includeNonLicensedUsers:u,intl:l,maxOptions:p,objectId:h,onEmpty:f,onError:m,orgId:I,principalId:y,productAttributes:b,productKey:g,searchQueryFilter:v,siteId:U}=this.props,S=p||100,O=window.performance.now(),x={baseUrl:n,context:{containerId:i,contextType:a,objectId:h,principalId:y,productKey:g,siteId:U,organizationId:I,childObjectId:r,sessionId:t,productAttributes:b},includeUsers:d,includeGroups:o,includeTeams:c,includeNonLicensedUsers:u,maxNumberOfResults:S,query:e,searchQueryFilter:v};try{var T;this.fireEvent(E);const t=await(0,P.Z)(x,l),s=window.performance.now()-O,n=0===t.length&&f?null!==(T=await f(e))&&void 0!==T?T:[]:t;this.setState((r=>{const i=r.query===e,a=i?n:r.users,o=!i;return this.fireEvent(Z,{users:$(t),elapsedTimeMilli:s,displayedUsers:$(n),productAttributes:b,applicable:i}),{users:a,loading:o}}))}catch(q){const e=500<=(j=q.statusCode)&&j<600;s||m||!e||this.optionsShownUfoExperienceInstance.failure(k(this.props.fieldId)),this.setState({users:[]});let t=!1,n=[];try{n=m&&await m(q,x)||[]}catch(A){t=!0}t&&e&&this.optionsShownUfoExperienceInstance.failure(k(this.props.fieldId)),e||(m||s)&&!t||this.abortOptionsShownUfoExperience(),this.setState({users:n,loading:!1});const r=window.performance.now()-O;this.fireEvent(w,{elapsedTimeMilli:r,productAttributes:b})}var j}),null!==(t=this.props.debounceTime)&&void 0!==t?t:0)),(0,i.Z)(this,"onInputChange",((e,t)=>{const s=e||"",{closed:n}=this.state;s!==this.state.query&&(n||(this.startOptionsShownUfoExperience(),this.setState({loading:!0,query:s,sessionId:t}),this.props.onInputChange&&this.props.onInputChange(s,t)))})),(0,i.Z)(this,"filterUsers",(()=>{const{loading:e,users:t,query:s}=this.state,n=this.memoizedFilterOptions(t,s,this.props.filterOptions);if(this.props.bootstrapOptions&&0!==this.props.bootstrapOptions.length&&""===s){const e=this.memoizedFilterOptions(this.props.bootstrapOptions,s,this.props.filterOptions);return this.fireEvent(U,{filtered:$(e),all:$(this.props.bootstrapOptions)}),e}if(!e)return n;const r=n.filter((e=>{return t=e.name,n=s,null!=t&&(null===n||""===n||void 0===n||t.toLowerCase().includes(n.toLowerCase()));var t,n}));return this.fireEvent(U,{filtered:$(r),all:$(t)}),n})),(0,i.Z)(this,"onFocus",(e=>{const t={query:"",closed:!1};this.startOptionsShownUfoExperience(),0===this.state.users.length?(t.sessionId=e,t.loading=!0):this.fireEvent(g,{users:$(this.state.users),preparedSessionId:this.state.sessionId,sessionId:e}),this.setState((e=>(0,n.Z)((0,n.Z)({},e),t))),this.props.onFocus&&this.props.onFocus(e)})),(0,i.Z)(this,"onBlur",(e=>{this.getUsers.cancel(),this.abortOptionsShownUfoExperience();const t=0===this.state.query.length?this.state.users:[];this.setState({loading:!1,closed:!0,users:t}),this.props.onBlur&&this.props.onBlur(e)})),this.optionsShownUfoExperienceInstance=F.getInstance(e.inputId||e.fieldId)}async componentDidMount(){try{const e=await(0,q.Z)(this.props.baseUrl,this.props.defaultValue,this.props.productKey);this.setState({defaultValue:e})}catch(t){const e=await(this.props.onValueError&&this.props.onValueError(t,this.props.defaultValue)||Promise.resolve([]));this.setState({defaultValue:e})}const{prefetch:e}=this.props;if(e){const e=(0,c.v4)();this.fireEvent(v,{sessionId:e}),this.setState({sessionId:e})}}componentDidUpdate(e,t){var s,n;s=e,n=this.props,(s.siteId!==n.siteId||s.orgId!==n.orgId||s.productKey!==n.productKey||s.principalId!==n.principalId||s.containerId!==n.containerId||s.objectId!==n.objectId||s.childObjectId!==n.childObjectId||this.props.fieldId!==e.fieldId)&&this.setState({users:[]}),this.state.sessionId===t.sessionId&&this.state.query===t.query||""===this.state.query&&this.props.bootstrapOptions?this.state.closed||this.state.loading||[h.h.FAILED.id,h.h.SUCCEEDED.id,h.h.ABORTED.id].includes(this.optionsShownUfoExperienceInstance.state.id)||this.optionsShownUfoExperienceInstance.success(k(this.props.fieldId)):this.getUsers()}render(){return r.createElement(j,null,r.createElement(f.f,(0,n.Z)((0,n.Z)({},this.props),{},{onInputChange:this.onInputChange,onBlur:this.onBlur,onFocus:this.onFocus,defaultValue:this.state.defaultValue,isLoading:this.props.isLoading||this.state.loading&&!this.state.closed&&(!this.props.bootstrapOptions||""!==this.state.query),options:this.filterUsers()})))}}B.displayName="SmartUserPickerWithoutAnalytics",(0,i.Z)(B,"defaultProps",{baseUrl:"",includeUsers:!0,includeGroups:!1,includeTeams:!1,includeNonLicensedUsers:!1,prefetch:!1,principalId:"Context",debounceTime:150});const D=(0,d.Z)()((0,p.ZP)(B)),K=e=>{const t=e.inputId||e.fieldId;return((e,t)=>{const s=e.getInstance(t);(0,r.useState)((()=>{s.start()})),(0,r.useEffect)((()=>(s.state!==h.h.FAILED&&s.success(),()=>{[h.h.STARTED,h.h.IN_PROGRESS].includes(s.state)&&s.abort()})),[])})(C,t),r.createElement(L,{id:t},r.createElement(j,null,r.createElement(D,(0,n.Z)({},e))))};K.displayName="SmartUserPickerWithIntlProvider";const V=K},274706:(e,t,s)=>{s.d(t,{Z:()=>g});var n=s(92905),r=s(698161),i=s(615919);const a="Unknown",o={id:a,name:a,type:"user"},c={id:a,name:a,type:"team"};function d(e,t){const s=(()=>{const e=new Headers;return e.append("Content-Type","application/json"),e})();return fetch(new Request(`${e}`,{method:"POST",credentials:"include",mode:"cors",headers:s,body:JSON.stringify(t)})).then((e=>e.ok?e:Promise.reject({code:e.status,reason:e.statusText}))).then((e=>e.json())).then((e=>{var t;return e.errors?Promise.reject({reason:(null===(t=e.errors[0])||void 0===t?void 0:t.category)||"default"}):e.data}))}const u=(e,t)=>{const s=r.v.getGraphQLUrl(e);return new Promise((e=>{(async(e,t)=>{const s=(e=>({query:"query usersQuery($accountIds: [ID!]!) {\n    users(accountIds: $accountIds) {\n      name\n      accountId\n      picture\n    }\n  }",variables:{accountIds:e}}))(t);return await d(e,s)})(s,t).then((t=>{e(t.users.map((({accountId:e,name:t,picture:s})=>({avatarUrl:s,id:e,name:t,type:"user"}))))})).catch((()=>{e(t.map((e=>(0,i.Z)((0,i.Z)({},o),{},{id:e}))))}))}))},l=e=>{const t=`${r.v.getTeamsUrl(e.baseUrl)}/${e.id}`;return fetch(t,{method:"GET",credentials:"include",headers:{"content-type":"application/json"}}).then((e=>200===e.status?e.json():Promise.reject({message:`error calling Legion, statusCode=${e.status}, statusText=${e.statusText}`}))).then((t=>{return s=t,{id:e.id,name:s.displayName,type:"team",avatarUrl:s.smallAvatarImageUrl};var s})).catch((()=>(0,i.Z)((0,i.Z)({},c),{},{id:e.id})))},p=e=>e.values.map(h).filter((e=>!!e)).map((e=>e)),h=e=>e?{id:e.accountId,type:n.FW,avatarUrl:e.avatarUrls?e.avatarUrls["16x16"]:"",name:e.displayName,email:e.emailAddress}:null,f=e=>e.results.map(m).filter((e=>!!e)).map((e=>e)),m=e=>e?{id:e.accountId,type:n.FW,avatarUrl:e.profilePicture?e.profilePicture.path:"",name:e.publicName,email:e.email}:null,I=e=>void 0!==e.name,y=async(e,t)=>{if(0===t.length)return[];const s=t.map((t=>l({baseUrl:e,id:t.id})));return await Promise.all(s)},b=async(e,t,s)=>{if(0===s.length)return[];const n=s.map((e=>e.id));return"jira"===t||"confluence"===t?await(e=>{const t=`${r.v.getUsersServiceUrl(e.productKey,e.baseUrl)}`;let s=new URLSearchParams;return e.accountIds.map((e=>s.append("accountId",e))),s.append("maxResults","2000"),fetch(`${t}?${s}`,{method:"GET",credentials:"include",headers:{"content-type":"application/json"}}).then((e=>200===e.status?e.json():Promise.reject({message:`error calling users service, statusCode=${e.status}, statusText=${e.statusText}`}))).then("jira"===e.productKey?p:f)})({baseUrl:e,productKey:t,accountIds:n}):await u(e,n)};const g=async function(e,t,s){if(!t||Array.isArray(t)&&0===t.length)return[];const n=Array.isArray(t)?t:[t];if(!n.some((e=>!I(e))))return t;const[r,i]=await Promise.all([b(e,s,n.filter((e=>!I(e)&&"user"===e.type))),y(e,n.filter((e=>!I(e)&&"team"===e.type)))]);return((e,t)=>{const s=new Map(e.map((e=>[e&&e.id,e])));return t.map((e=>s.get(e.id)||{id:e.id,type:e.type,name:a}))})(n.filter((e=>I(e))).map((e=>e)).concat(r).concat(i),n)}}}]);
//# sourceMappingURL=52766.BmBLxD_4XK.js.map