"use strict";(self._cf=self._cf||[]).push([[60591],{983331:(e,t,n)=>{n.d(t,{c:()=>i});var o=n(763778);let a;const i=()=>(a||(a=new o.f),a)},825221:(e,t,n)=>{n.d(t,{Q:()=>i});var o=n(763778);let a;const i=()=>(a||(a=new o.f),a)},514226:(e,t,n)=>{n.d(t,{Z:()=>L});var o=n(615919),a=n(840506),i=n(142807),r=n(936368),l=n.n(r),s=n(822464),d=n(558877),c=n(16728),u=n(332072),m=n(796259),v=n(32503),p=n(684474),I=n(554187),y=n(625662),g=n(234461),f=n(9019),C=n(40994),E=n(15325),b=n(219263),S=n(934026),T=n(898039),h=n(486889),N=n(413864),R=n(900488),w=n(724764),k=n(923357);const M=({scrollableContainerSelector:e,pageId:t,isEditor:n,onNavigationClick:o})=>{const{createAnalyticsEvent:i}=(0,h._)(),[{unresolvedInlineComments:r}]=(0,R.K)(),[l,s]=(0,a.useState)(0),{unreadCommentCount:d}=(0,a.useContext)(N.z),c=async a=>{if(r.length<2)return;const s=(0,w.k2)(a,l,r),c=r[l];if(!s)return;const u=document.getElementById(s),v=document.getElementById(c);u&&(0,k.jR)(u),s&&await o(s);const p=v?(0,m.M6)(v):0,I=(0,m.M6)(u)-p;var y;(document.querySelector(`${e}`).scrollBy(0,I),(0,m.fo)(u,v,!0),u)&&(null===(y=window.getSelection())||void 0===y||y.setPosition(u));i({type:"sendUIEvent",data:{action:"clicked",actionSubject:"navigate",actionSubjectId:"inlineCommentArrowsNavigate",attributes:{unreadCommentCount:d},objectType:"inlineComment",objectId:t,source:n?"editPageScreen":"renderPageScreen"}}).fire()};return{currentCommentIndex:l,goToNextInlineComment:async()=>{await c("next")},goToPrevInlineComment:async()=>await c("previous"),setCurrentlyNavigatedComment:e=>{var t,n;const o=(e=>{if(r&&r.length>0)return r.findIndex((t=>t===e))})(null!==(t=null==e||null===(n=e.location)||void 0===n?void 0:n.inlineMarkerRef)&&void 0!==t?t:"");o&&s(o)},commentsCount:r.length}},A=({pageId:e,commentData:t,isEditor:n,onNavigationClick:o})=>{const i=n?".fabric-editor-popup-scroll-parent":"#content-body",{currentCommentIndex:r,goToNextInlineComment:l,goToPrevInlineComment:s,setCurrentlyNavigatedComment:d,commentsCount:c}=M({isEditor:n,scrollableContainerSelector:i,pageId:e,onNavigationClick:o});return(0,a.useEffect)((()=>{d(t)}),[t,d]),a.createElement(C.Mr,null,a.createElement(T.u,{allowShortcuts:Boolean(!n),goToNextInlineComment:l,goToPrevInlineComment:s,currentCommentIndex:r,commentsCount:c}))};A.displayName="CommentNavigation";const L=({pageId:e,onClose:t,annotationElement:n,navigationOptions:r,isEditor:T,isView:h,children:N})=>{const[R,w]=(0,a.useState)(!1),[k,M]=(0,a.useState)(0),L=(0,a.useRef)(null),{resetContentChanged:O,hasContentChanged:j}=(0,a.useContext)(v.i);(0,a.useEffect)((()=>{let e;return R&&L.current&&(e=new(l())(L.current),e.bind(E.INLINE_COMMENTS_SHORTCUT,(e=>{e.stopPropagation()}))),()=>{e&&e.reset()}}),[R]),(0,a.useEffect)((()=>{let e=0,t=null;if(n){const o=(0,m.M6)(n);T?(t=document.querySelector(".fabric-editor-popup-scroll-parent"),e=(0,m.M6)(n,t)):(t=document.querySelector("#content"),t&&(e=o+t.offsetTop))}M(e)}),[n,T]);const D=e=>{e.stopPropagation()},P=(0,a.useCallback)((e=>{j?e.showModal(I.v,{onConfirm:()=>{O(),t&&t(j)}}):t&&t(j)}),[j,t,O]),U=`${T?"editor":"renderer"}-${h?"comments":"create"}-sidebar`;return a.createElement(g.S,{attribution:f.x.COLLABORATION},a.createElement(s.xs,{to:[y.l]},(t=>a.createElement(p.I,{contentId:e},a.createElement(C._G,{onClick:D,offset:k,id:U,"data-testid":U,"data-cy":U,ref:e=>{L.current=e,w(!0)}},a.createElement(C.L2,{showNavigation:r&&r.showNavigation},r&&r.showNavigation&&a.createElement(A,{pageId:e,commentData:r.commentData,isEditor:T,onNavigationClick:r.onNavigationClick}),a.createElement(u.Z,{content:a.createElement(i.Z,(0,o.Z)({},S.ag.closeSidebarTooltip)),hideTooltipOnClick:!0,position:"top"},a.createElement(C.bX,null,a.createElement(C.PZ,{appearance:"subtle",onClick:()=>P(t),onMouseDown:e=>e.preventDefault(),testId:"close-sidebar-button","data-cy":`${T?"editor":"renderer"}-close-${h?"view":"create"}-comment`,iconBefore:a.createElement(d.default,{label:"close-icon",primaryColor:`var(--ds-icon-subtle, ${c.WA})`,size:"small"})})))),N,a.createElement(b.E,{accelerator:E.CLOSE_INLINE_COMMENTS_SHORTCUT,listener:()=>P(t)}))))))};L.displayName="CommentSidebar"},525813:(e,t,n)=>{n.d(t,{r:()=>ee});var o=n(840506),a=n(167347),i=n(486889),r=n(619412),l=n(852358),s=n(983331),d=n(825221),c=n(870797),u=n(190206),m=n(400318),v=n(487696),p=n(32503),I=n(298100),y=n(136879),g=n(258341),f=n(582463),C=n(179640),E=n(649233),b=n(973352);const S=n(779076).ZP`query InlineCommentQuery($annotationId:String$pageId:ID!$contentStatus:[GraphQLContentStatus]){comments(inlineMarkerRef:$annotationId pageId:$pageId contentStatus:$contentStatus){nodes{replies{id parentId body(representation:ATLAS_DOC_FORMAT){value}links{webui}author{displayName permissionType profilePicture{path}...on KnownUser{accountId}...on User{accountId}}version{when number}permissions{isEditable isRemovable isResolvable}}version{when number}location{type ...on InlineComment{inlineMarkerRef inlineText inlineResolveProperties{resolved resolvedTime resolvedUser}}}id body(representation:ATLAS_DOC_FORMAT){value}links{webui}author{displayName profilePicture{path}permissionType ...on KnownUser{accountId}...on User{accountId}}permissions{isEditable isRemovable isResolvable}}}}`;var T=n(7476),h=n(289049),N=n(288004),R=n(205559),w=n(702099),k=n(75872),M=n(596309),A=n(75978),L=n(115808),O=n(142765),j=n(724764),D=n(40994),P=n(697674),U=n(113059);const x=(0,P.is)({key:U.Wg}),_=(0,P.is)({key:U.NA});var $=n(934026),q=n(514226),B=n(615919),F=n(872342),Z=n(920839),V=n(767001),Q=n(77266),W=n.n(Q),z=n(16728),G=n(657294),J=n(614889);const K=["as","style"];n(558491),n(617930);const X=(0,J.j)("editor-comments:edit-comment"),H=(0,o.forwardRef)(((e,t)=>{let{as:n="div",style:a}=e,i=(0,F.Z)(e,K);return o.createElement(n,(0,B.Z)((0,B.Z)({},i),{},{style:(0,B.Z)((0,B.Z)({},a),{},{"--_ytujz3":(0,Z.Z)("var(--ds-space-150, 12px)"),"--_1g2og9c":(0,Z.Z)("var(--ds-space-200, 16px)"),"--_1khsbgs":(0,Z.Z)(`var(--ds-border, ${z.YS})`)}),ref:t,className:(0,V.Z)(["_1yt4q2p8 _n7zlf0bt",i.className])}))}));const Y=({annotationId:e,isReply:t,pageId:n,pageType:r,commentId:l,spaceId:s,content:d,displayCommentInViewMode:c,avatarUrl:v,displayName:I,onCancelEdit:y,mode:C})=>{const{userId:E}=(0,f.D)(),{createAnalyticsEvent:T}=(0,i._)(),h=(0,o.useContext)(u.F),{onChange:N}=(0,o.useContext)(p.i),{sideNavLearningLoopCohort:R}=(0,b.LO)(),[w]=(0,a.Db)(G.R);let k;try{k=JSON.parse(d)}catch(M){X.error`Unable to parse content ADF, ${M}`}return o.createElement(H,{"data-cy":"editor-edit-container"},o.createElement(L.N,{commentMode:"edit",userId:E,displayName:I,avatarUrl:v}),o.createElement(g.iB,{pageId:n,pageType:r,spaceId:s,appearance:"chromeless",commentMode:"edit",commentType:"view"===C?"inline":"edit-inline",onSaveComment:(o,a)=>{h.start({name:m.h7S,attributes:{mode:"edit"}});const i={input:{commentId:l,commentBody:{value:JSON.stringify(o),representationFormat:"ATLAS_DOC_FORMAT"}}};return w({variables:i,update:a=>{const i=a.readQuery({query:S,variables:{pageId:n,annotationId:e,contentStatus:["DRAFT","CURRENT"]}}),r=Object.assign({},i);let s;if(t){var d;const e=null==r||null===(d=r.comments)||void 0===d||null===(d=d.nodes[0])||void 0===d?void 0:d.replies;null==e||e.forEach((e=>{e.id===l&&(s=e)}))}else{var c;s=null==r||null===(c=r.comments)||void 0===c?void 0:c.nodes[0]}s&&W()(s,"body.value",JSON.stringify(o)),a.writeQuery({query:S,variables:{pageId:n,annotationId:e,contentStatus:["DRAFT","CURRENT"]},data:r})}}).then((()=>{h.succeed({name:m.Syn,attributes:{mode:"edit",type:t?"reply":"topLevel"}}),T({type:"sendTrackEvent",data:{action:"updated",actionSubject:"comment",actionSubjectId:l,objectType:r,objectId:n,source:"editPageScreen",attributes:{mode:"edit",sideNavLearningLoopCohort:R}}}).fire(),a(),c()})).catch((e=>{const{message:t}=(0,j.nU)(e);return h.stopOnError({name:m.h7S,error:e}),Promise.reject({error:(0,j.aS)(t,l)})}))},content:k,onCancelComment:()=>{c(),y&&y()},onContentChange:N,showCancelButton:!0,useNewWarningModal:!0,onEditorReady:()=>{h.succeed({name:m.lku})},hideWatchCheckbox:!0,pageMode:C}))};Y.displayName="EditComment";const ee=({annotation:e,onResolve:t,onClose:n,isEditor:P,onNavigationClick:U})=>{var B,F,Z,V,Q,W,z,G,J,K,X,H;const ee=(0,o.useRef)(null),[te]=(0,o.useState)((()=>P?(0,s.c)():(0,d.Q)())),[ne,oe]=(0,o.useState)(!1),ae=(0,o.useContext)(u.F),{contentId:ie}=(0,o.useContext)(v.z1),re=ie,{createAnalyticsEvent:le}=(0,i._)(),{userId:se}=(0,f.D)(),{sideNavLearningLoopCohort:de}=(0,b.LO)(),{focusedCommentId:ce,replyToCommentId:ue,editCommentId:me}=(0,I.fQ)(),[ve,pe]=(0,o.useState)(""),[Ie,ye]=(0,o.useState)(null),[ge,fe]=(0,o.useState)(!0),{onChange:Ce}=(0,o.useContext)(p.i),Ee=(0,C.T)($.Iq),be=P?x:_,Se=e=>{ae.stopOnError({name:m.Itq,error:e,attributes:{mode:P?O.Rb.EDIT:O.Rb.VIEW}})},{data:Te,loading:he}=(0,a.aM)(S,{variables:{pageId:re,annotationId:null==e?void 0:e.id,contentStatus:["DRAFT","CURRENT"]},onError:Se,fetchPolicy:"cache-and-network"}),{data:Ne,loading:Re}=(0,a.aM)(T.N,{variables:{pageId:re},onError:Se});(0,o.useEffect)((()=>{be.start(),ae.start({name:m.Itq,id:e.id,attributes:{mode:P?O.Rb.EDIT:O.Rb.VIEW}})}),[be,e,ae,P]),(0,o.useEffect)((()=>{if(!he){var e;const t=(null==Te||null===(e=Te.comments)||void 0===e||null===(e=e.nodes[0])||void 0===e?void 0:e.replies)||[];le({type:"sendTrackEvent",data:{action:"viewed",actionSubject:"inlineCommentsSidebar",objectType:"page",objectId:re,source:P?"editPageScreen":"viewPageScreen",attributes:{mode:P?O.Rb.EDIT:O.Rb.VIEW,commentsDeckSize:t.length+1}}}).fire(),ae.succeed({name:m.Itq,attributes:{mode:P?O.Rb.EDIT:O.Rb.VIEW}})}}),[he,le,Te,ae,re,P]);const[we]=(0,a.Db)(h.C),[ke]=(0,a.Db)(N.R,{update:(t,{data:n})=>{var o;const a=t.readQuery({query:S,variables:{pageId:re,annotationId:e.id,contentStatus:["DRAFT","CURRENT"]}}),i=null==a||null===(o=a.comments)||void 0===o?void 0:o.nodes[0];i.replies=null==i?void 0:i.replies.concat(null==n?void 0:n.replyInlineComment),t.writeQuery({query:S,data:a})}}),Me=null==Ne||null===(B=Ne.content)||void 0===B||null===(B=B.nodes)||void 0===B||null===(B=B[0])||void 0===B||null===(B=B.space)||void 0===B?void 0:B.id,Ae=null==Ne||null===(F=Ne.content)||void 0===F||null===(F=F.nodes)||void 0===F||null===(F=F[0])||void 0===F?void 0:F.type,Le=null==Te||null===(Z=Te.comments)||void 0===Z?void 0:Z.nodes[0],Oe=null==Le||null===(V=Le.author)||void 0===V?void 0:V.accountId,je=null==Le||null===(Q=Le.author)||void 0===Q||null===(Q=Q.profilePicture)||void 0===Q?void 0:Q.path,De=null==Le||null===(W=Le.author)||void 0===W?void 0:W.displayName,Pe=null==Le?void 0:Le.id,Ue=null==Le||null===(z=Le.version)||void 0===z?void 0:z.when,xe=null==Le?void 0:Le.permissions,_e=null==Le||null===(G=Le.body)||void 0===G?void 0:G.value,$e=null==Te||null===(J=Te.author)||void 0===J?void 0:J.permissionType,qe=null==Le||null===(K=Le.replies)||void 0===K?void 0:K.length,Be=null==Le||null===(X=Le.location)||void 0===X?void 0:X.inlineResolveProperties.resolvedTime,Fe=null==Le||null===(H=Le.location)||void 0===H?void 0:H.inlineResolveProperties.resolvedUser,Ze=null==Le?void 0:Le.links.webui,Ve=(null==Le?void 0:Le.readStatus)===R.NQ.UNREAD,Qe=P?Boolean((null==Le?void 0:Le.commentSource)===R.t4.IOS||(null==Le?void 0:Le.commentSource)===R.t4.ANDROID):void 0;(0,o.useEffect)((()=>{if(me){var e;(null==Le||null===(e=Le.replies)||void 0===e||null===(e=e.map((e=>e.id)))||void 0===e?void 0:e.includes(me))&&fe(!1),pe(me)}}),[me,Le]),(0,o.useEffect)((()=>{var e;const t=null==Le||null===(e=Le.replies)||void 0===e||null===(e=e.map((e=>e.id)))||void 0===e?void 0:e.includes(ue);oe(t||ue===Pe)}),[ue,Pe,Le]),(0,o.useEffect)((()=>{if(ce){var e;(null==Le||null===(e=Le.replies)||void 0===e||null===(e=e.map((e=>e.id)))||void 0===e?void 0:e.includes(ce))&&fe(!1)}}),[ce,Le]);const We=(e="")=>{pe(e)},ze=()=>{we({variables:{commentId:Pe,resolved:!0}}).then((()=>{const o=e.id;t(o),le({type:"sendTrackEvent",data:{action:"resolved",actionSubject:"comment",actionSubjectId:Pe,objectType:"page",objectId:re,source:"editPageScreen",attributes:{commentType:"inline",mode:P?O.Rb.EDIT:O.Rb.VIEW}}}).fire(),ae.succeed({name:m.ysG,attributes:{mode:P?O.Rb.EDIT:O.Rb.VIEW}}),P?te.emit("resolve",e.id):(te.emit(r.B.SET_ANNOTATION_STATE,{[o]:{id:o,annotationType:l.j9.INLINE_COMMENT,state:l.to.RESOLVED}}),ye({commentId:Pe,inlineMarkerRef:o}),setTimeout((()=>{n&&n()}),7500))})).catch((e=>{ae.stopOnError({name:m.ysG,error:e})}))},Ge=(0,o.useCallback)((t=>{var n;const a=(null==Te||null===(n=Te.comments)||void 0===n||null===(n=n.nodes[0])||void 0===n?void 0:n.replies)||[];return(t?a.slice(-1):a).map((t=>{const{id:n,permissions:a,body:i}=t;var r,l,s,d,c,u,m,v;return n===ve?o.createElement(Y,{key:n,commentId:n,annotationId:e.id,displayName:null==t||null===(r=t.author)||void 0===r?void 0:r.displayName,avatarUrl:null==t||null===(l=t.author)||void 0===l||null===(l=l.profilePicture)||void 0===l?void 0:l.path,pageId:re,pageType:Ae,spaceId:Me,content:null==i?void 0:i.value,displayCommentInViewMode:We,mode:P?"edit":"view",isReply:!0}):o.createElement(w.x,{key:n,userId:null==t||null===(s=t.author)||void 0===s?void 0:s.accountId,displayName:null==t||null===(d=t.author)||void 0===d?void 0:d.displayName,avatarUrl:null==t||null===(c=t.author)||void 0===c||null===(c=c.profilePicture)||void 0===c?void 0:c.path,date:null==t||null===(u=t.version)||void 0===u?void 0:u.when,dateUrl:P||null==t?void 0:t.links.webui,commentId:n,pageId:re,pageType:Ae,isReply:!0,permissions:a,editComment:()=>We(n),content:null==t||null===(m=t.body)||void 0===m?void 0:m.value,isCommentActive:!0,mode:P?"edit":"view",permissionType:null==t||null===(v=t.author)||void 0===v?void 0:v.permissionType,supportedActions:["edit","resolve"],isFocused:ce===n,isUnread:Ve})}))}),[Te,ve,Ae,re,Me,e,P,ce,Ve]),Je=(0,o.useCallback)((()=>{const e=""===ve;ae.abort({name:e?m.i5Z:m.Syn,reason:"comment discarded by user"}),(0,y.UU)(P?"edit-inline":"inline",e?"reply":"edit"),fe(!0),oe(!1),n&&n()}),[ae,ve,P,n]),Ke=(0,o.useCallback)((e=>{te.emit(r.B.SET_ANNOTATION_STATE,{[e]:{id:e,annotationType:l.j9.INLINE_COMMENT,state:l.to.ACTIVE}}),ye(null)}),[te,ye]),Xe=(0,o.useMemo)((()=>({showNavigation:!Ie&&(!P||Ee),commentData:Le,onNavigationClick:U})),[P,Ee,Ie,Le,U]);if(he||Re)return null;ee.current=document.getElementById(e.id);const He=ge&&qe>$.z7;return o.createElement(q.Z,{pageId:re,annotationElement:ee.current,navigationOptions:Xe,onClose:P?Je:n,isEditor:P,isView:!0},Ie?o.createElement(M.y,{commentId:Ie.commentId,reopenComment:Ke,pageId:re,inlineMarkerRef:Ie.inlineMarkerRef,mode:"view"}):o.createElement(o.Fragment,null,Pe===ve?o.createElement(o.Fragment,null,o.createElement(Y,{pageId:re,pageType:Ae,annotationId:e.id,commentId:Pe,spaceId:Me,content:_e,isReply:!1,displayCommentInViewMode:We,avatarUrl:je,displayName:De,mode:P?"edit":"view"})):o.createElement(o.Fragment,null,o.createElement(w.x,{userId:Oe,avatarUrl:je,displayName:De,date:Ue,dateUrl:P?void 0:Ze,pageId:re,pageType:Ae,commentId:Pe,isReply:!1,permissions:xe,editComment:()=>We(Pe),content:_e,isCommentActive:!0,mode:P?"edit":"view",onClose:n,permissionType:$e,resolveComment:ze,isFromMobile:Qe,supportedActions:["edit","resolve"],isFocused:Pe===ce,isUnread:Ve}),o.createElement(k.S,{resolvedUser:Fe,resolvedTime:Be}),o.createElement(c.M,{key:`stop-${Pe}`,metric:be})),o.createElement(D.Lv,{"data-testid":"inline-comment-reply-container"},He&&o.createElement(A.Q,{numCollapsedReplies:qe-1,onClick:()=>fe(!1)}),Ge(He)),o.createElement(o.Fragment,null,o.createElement(D.ff,{mode:P?"edit":"view","data-cy":"editor-reply-container"},o.createElement(L.N,{commentMode:"reply",userId:se,size:"small",permissionType:$e}),o.createElement(g.iB,{pageId:re,pageType:Ae,appearance:"chromeless",onSaveComment:(e,t)=>{const n={input:{containerId:re,parentCommentId:Pe,commentBody:{value:JSON.stringify(e),representationFormat:"ATLAS_DOC_FORMAT"}}};return ke({variables:n}).then((({data:e})=>{var n;t(),me&&pe(""),le({type:"sendTrackEvent",data:{action:"created",actionSubject:"comment",actionSubjectId:Pe,objectType:Ae,objectId:re,source:"editPageScreen",attributes:{commentType:"inline",parentCommentId:null==e||null===(n=e.replyInlineComment)||void 0===n?void 0:n.id,mode:O.Rb.EDIT,sideNavLearningLoopCohort:de}}}).fire(),ae.succeed({name:m.i5Z,attributes:{mode:O.Rb.EDIT}})})).catch((e=>{ae.stopOnError({name:m.i5Z,error:e});const{message:t}=(0,j.nU)(e);return(0,E.Xb)(e),Promise.reject({error:(0,j.aS)(t,Pe)})}))},onContentChange:Ce,onEditorReady:()=>{ae.succeed({name:m.bWV})},commentMode:"reply",commentType:P?"edit-inline":"inline",spaceId:Me,showCancelButton:!0,useNewWarningModal:!0,hideWatchCheckbox:!0,expandEditor:ne,pageMode:P?"edit":"view"})))))};ee.displayName="InlineComment"},934026:(e,t,n)=>{n.d(t,{Iq:()=>a,ag:()=>r,z7:()=>i});var o=n(93972);const a="confluence.frontend.editor.inline.comment.navigation",i=5,r=(0,o.defineMessages)({closeSidebarTooltip:{id:"annotation-provider-inline-comments.close.icon.tooltip",defaultMessage:"Close sidebar (])"}})},115613:(e,t,n)=>{n.d(t,{q:()=>u});var o=n(840506),a=n(147760),i=n(54685),r=n(9019),l=n(740223),s=n(229230);const d=()=>{},c=(0,o.memo)((({metric:e,onComplete:t=d,timing:n=l.H.RENDER_BODY,isCustomStart:i=!1})=>{const r=(0,o.useCallback)((()=>{e&&(a.n.getPageLoadMetric().mark(`${s.w}:${e.key}`),i?e.start():e.startFromPageLoad(),t())}),[e,t,i]);return(0,l.G)(r,n),null})),u=(0,i.m)({attribution:r.x.BACKBONE})(c)},405238:(e,t,n)=>{n.d(t,{j:()=>I,f:()=>y});var o=n(318122),a=n(443037),i=n.n(a),r=n(852358),l=n(784569),s=n(649233),d=n(722755),c=n(614889);const u=n(779076).ZP`query AnnotationStateQuery($annotationList:[String]$pageId:ID!$contentStatus:[GraphQLContentStatus]){comments(inlineMarkerRefList:$annotationList pageId:$pageId contentStatus:$contentStatus){nodes{location{type ...on InlineComment{inlineMarkerRef inlineResolveProperties{resolved}}}id}}}`,m=(0,c.j)("inline-comments-common:state-resolver"),v=(0,o.default)(((e,t,n)=>{const o={},a=[];e.forEach(((e,t)=>{o[e]=t,a.push({annotationType:r.j9.INLINE_COMMENT,id:e,state:r.to.RESOLVED})})),null==n||n.forEach((e=>{var t;if(!Boolean(null===(t=e.location)||void 0===t||null===(t=t.inlineResolveProperties)||void 0===t?void 0:t.resolved)){const t=e.location.inlineMarkerRef;if(t){const e=o[t];(e||0===e)&&(a[e].state=r.to.ACTIVE)}}}));return t(e.filter((e=>{const t=o[e];return a[t].state===r.to.ACTIVE}))),a}),i()),p=(0,o.default)(((e,t,n)=>{const o={},a=[];e.forEach(((e,t)=>{o[e]=t,a.push({annotationType:r.j9.INLINE_COMMENT,id:e,state:{resolved:!0}})})),t.forEach((e=>{var t;if(!Boolean(null==e||null===(t=e.location)||void 0===t||null===(t=t.inlineResolveProperties)||void 0===t?void 0:t.resolved)){var n;const t=(null==e||null===(n=e.location)||void 0===n?void 0:n.inlineMarkerRef)||"",i=o[t];(i||0===i)&&(a[i].state.resolved=!1)}}));return n(e.filter((e=>{const t=o[e];if(!a[t].state.resolved)return e}))),a}),i()),I=({annotations:e,pageId:t,triggerAnalyticsEvent:n,updateUnresolvedInlineComment:o})=>(0,l.WQ)().query({query:u,fetchPolicy:"network-only",variables:{pageId:t,annotationList:e,contentStatus:["DRAFT","CURRENT"]}}).then((t=>p(e,t.data.comments.nodes,o))).catch((e=>{try{n&&n({data:{source:"editorComponent",action:"failed",actionSubject:"annotationState",actionSubjectId:"inlineComments",attributes:{errorName:e.name,errorMessage:e.message}},type:"sendOperationalEvent"}).fire()}catch(t){m.error`Error when logging analytics event, ${t}`}if((0,d.T)(e)||null!=e&&e.message.includes("java.lang.NullPointerException")||null!=e&&e.message.includes("confluence.api.service.exceptions.NotFoundException"))return(0,s.Xb)(e),[];throw m.error`Error when retrieving resolved status for marks, ${e}`,e})),y=({annotations:e,pageId:t,triggerAnalyticsEvent:n,validAnnotationsCallback:o})=>(0,l.WQ)().query({query:u,fetchPolicy:"network-only",variables:{pageId:t,annotationList:e}}).then((t=>{var n;const a=null===(n=t.data.comments)||void 0===n||null===(n=n.nodes)||void 0===n?void 0:n.filter((e=>null!==e));return v(e,o,a)})).catch((e=>{if(n&&n({source:"rendererComponent",action:"failed",actionSubject:"annotationState",actionSubjectId:"inlineComments",attributes:{errorName:e.name,errorMessage:e.message}}).fire(),(0,d.T)(e)||null!=e&&e.message.includes("java.lang.NullPointerException")||null!=e&&e.message.includes("No comments found for the given markerRefList"))return(0,s.Xb)(e),[];throw m.error`Error when retrieving resolved status for marks, ${e}`,e}))},923357:(e,t,n)=>{n.d(t,{Vf:()=>d,aX:()=>u,jR:()=>s,w5:()=>c});var o=n(852358),a=n(731462),i=n(75119),r=n(983331),l=n(405238);const s=e=>{var t,n;let o=e;let a=null;if(null!==(t=o)&&void 0!==t&&null!==(n=t.closest)&&void 0!==n&&n.call(t,".ak-editor-expand")){for(;o;){if(o.classList.contains("ak-editor-expand")){a=o.querySelector(".ak-editor-expand__icon-container");break}var i;o=null===(i=o)||void 0===i?void 0:i.parentElement}!o.classList.contains("ak-editor-expand__expanded")&&a&&a.click()}},d=(e,t)=>{var n;const o=(0,r.c)();s(e),o.emit("setselectedannotation",t),null===(n=window.getSelection())||void 0===n||n.setPosition(e);document.querySelector(".fabric-editor-popup-scroll-parent").scrollTo(0,(e=>{let t=0,n=e;for(;n&&!n.classList.contains("fabric-editor-popup-scroll-parent");)t+=n.offsetTop,n=n.offsetParent;return t})(e)-100)},c=({contentId:e,dialogState:t,setDialogState:n,createAnalyticsEvent:o,isUnreadCommentsEnabled:a,setUnreadCommentCount:i,unreadMarkerRefsList:r,setUnreadMarkerRefsList:l,unreadCommentsList:s,setUnreadCommentsList:c})=>{const u=document.querySelector(".ak-editor-annotation-focus,.ak-editor-annotation-blur");if(a&&r.length){const e=r[0],t=document.getElementById(e);d(t,e);l(r.slice(1));const n=s.filter((t=>t.location.inlineMarkerRef!==e));c(n),i(n.length)}else if(u){n(!1);const e=u.closest(".annotationView-content-wrap").id;d(u,e)}else n(!t);o&&o({type:"sendUIEvent",data:{action:"clicked",actionSubject:"navigationItem",actionSubjectId:"inlineCommentsIcon",attributes:{pageHasInlineComments:!!u,icontype:"header",context:"default",newState:"showComments",unreadCommentCount:s.length},objectType:"page",objectId:e,source:"editPageScreen"}}).fire()},u=async({editorActions:e,contentId:t,triggerAnalyticsEvent:n,updateUnresolvedInlineComment:o})=>{const a=await m(e),i=await v(a);(0,l.j)({annotations:i,pageId:t,triggerAnalyticsEvent:n,updateUnresolvedInlineComment:o}).catch((()=>{}))},m=async e=>{const t=await e.getValue();return a.NB.fromJSON(i.R4,t)},v=async e=>{const t=new Set;return e.descendants((e=>(e.marks.filter((e=>"annotation"===e.type.name)).filter(p).forEach((e=>t.add(e.attrs.id))),!0))),Array.from(t)},p=e=>{const{id:t,annotationType:n}=e.attrs;return function(e){if(!e||"string"!=typeof e)return!1;return!["null","undefined"].includes(e.toLowerCase())}(t)&&function(e){if(!e||"string"!=typeof e)return!1;return Object.values(o.j9).includes(e)}(n)}},825688:(e,t,n)=>{function o(e){var t,n,o;const a=null==e||null===(t=e.properties)||void 0===t?void 0:t.nodes,i=null==a?void 0:a.filter((e=>"editor"===(null==e?void 0:e.key))),r=null==i||null===(n=i[0])||void 0===n?void 0:n.value,l=(s=r)?null!=s&&s.includes("v2")?"v2":null!=s&&s.includes("v1")?"v1":"unset":"";var s,d;return null!=e&&null!==(o=e.metadata)&&void 0!==o&&o.frontend&&"fabricEditorSupported"in e.metadata.frontend?{queryDataId:null==e?void 0:e.id,editorProperty:l,fabricEditorSupported:null==e||null===(d=e.metadata)||void 0===d||null===(d=d.frontend)||void 0===d?void 0:d.fabricEditorSupported}:{queryDataId:null==e?void 0:e.id,editorProperty:l,fabricEditorSupported:null}}n.d(t,{T:()=>o})},900488:(e,t,n)=>{n.d(t,{K:()=>l});var o=n(834232),a=n(944547),i=n(437020);const r=(0,o.M)({initialState:{unresolvedInlineComments:[]},actions:{updateUnresolvedInlineComment:e=>({setState:t})=>{t({unresolvedInlineComments:e})}}}),l=(0,a.Bi)(r);(0,i.C)(r)},7476:(e,t,n)=>{n.d(t,{N:()=>o});const o=n(779076).ZP`query PageInfoQuery($pageId:ID){content(id:$pageId status:["current" "archived" "draft"]){nodes{id type space{id}operations{operation targetType}}}}`},763778:(e,t,n)=>{n.d(t,{f:()=>a});var o=n(867035);class a extends o.EventEmitter{on(e,t){return super.on(e,t)}off(e,t){return super.removeListener(e,t)}}}}]);
//# sourceMappingURL=60591.wYoJPKCd3X.js.map