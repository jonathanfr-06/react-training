WRMCB=function(e){var c=console;if(c&&c.log&&c.error){c.log('Error running batched script.');c.error(e);}}
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-highlight-actions:highlighting-experiment-resources', location = '/js/doctheme-utils.js' */
define("confluence-highlight-actions/js/doctheme-utils",["jquery"],function(c){function d(f){var e=c(f);c(f).appendTo(c("body"));return e}function a(){return c(document).scrollTop()}function b(){return c(document).scrollLeft()}return{appendAbsolutePositionedElement:d,getMainContentScrollTop:a,getMainContentScrollLeft:b}});require("confluence/module-exporter").exportModuleAsGlobal("confluence-highlight-actions/js/doctheme-utils","Confluence.DocThemeUtils");
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-highlight-actions:highlighting-experiment-resources', location = '/js/scrolling-inline-dialog.js' */
define("confluence-highlight-actions/js/scrolling-inline-dialog",["ajs","jquery"],function(a,b){return function(c,f,e,d){d=d||{};var g=function(k,s,J,z){var v;var L="auto";var G;var p=-7;var q;var w;var u=b(window).width();var K=s.target.position();var i=s.target.outerWidth();var m=K.left+i/2;var C=(window.pageYOffset||document.documentElement.scrollTop)+b(window).height();var n=10;var o=20;G=K.top+s.target.outerHeight()+z.offsetY;var H=k.find(".arrow").outerWidth();var j=k.outerWidth();var D=s.target.outerWidth();if(z.centerOnHighlight){if(j>D){v=K.left-(j-D)/2;q=m-v-H/2}else{v=K.left+z.offsetX;q=(j-H)/2}}else{v=K.left+z.offsetX;if(j>D){q=m-v-H/2}else{q=(j-H)/2}}q=(q<0)?0:q;var h=(K.top-(window.pageYOffset||document.documentElement.scrollTop));var A=z.maxHeight||0;var t=k.height();var r=h>Math.max(t,A);var l=(G+k.height())<C;w=(!l&&r)||z.onTop;z.onTop=w;var y=u-(v+j+n);if(w){G=K.top-t-8;p=t}if(w===false&&l===false){var x=(G+t)-C;var E=(window.pageYOffset||document.documentElement.scrollTop)+x+o;var F=b("html, body");F.stop().animate({scrollTop:E},500)}if(z.isRelativeToMouse){if(y<0){L=n;v="auto";q=J.x-(b(window).width()-z.width)}else{v=J.x-20;q=J.x-v}}else{if(y<0){L=n;v="auto";var I=u-L;var B=I-j;q=m-B-H/2}}return{displayAbove:w,popupCss:{left:v,right:L,top:G},arrowCss:{position:"absolute",left:q,right:"auto",top:p}}};if(!d.calculatePositions){d.calculatePositions=g}return a.InlineDialog.call(this,c,f,e,d)}});require("confluence/module-exporter").exportModuleAsGlobal("confluence-highlight-actions/js/scrolling-inline-dialog","Confluence.ScrollingInlineDialog");
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-highlight-actions:highlighting-experiment-resources', location = 'js/highlight-ranger-helper.js' */
define("confluence-highlight-actions/js/highlight-ranger-helper",["ajs","jquery","confluence/legacy","confluence-highlight-actions/js/doctheme-utils"],function(e,b,h,l){function r(s){return s.replace(/\u00a0/g,"\u0020")}function d(u,t){var s={};s.first=t[0];s.last=t[t.length-1];if(u.endOffset!=="undefined"){if(u.endOffset===0&&t.length>1){s.last=t[t.length-2]}}return s}function o(t){var u=l.getMainContentScrollTop();var v=l.getMainContentScrollLeft();var z=t.getClientRects();if(!z.length&&t.parentElement()){var A=b(t.parentElement());var s=A.offset();z=[{top:s.top-u,left:s.left-v,bottom:s.top+A.height(),right:s.left+A.width()}]}var C=d(t,z);var x=function(G,F){var E={};E.top=G.top;E.left=G.left+v;E.bottom=F.bottom;if(G.left>=F.right){E.right=G.right}else{E.right=F.right}E.right=E.right+v;E.top=E.top+u;E.bottom=E.bottom+u;E.width=E.right-E.left;E.height=E.bottom-E.top;return E};var w=function(F){var E={};E.width=F.right-F.left;E.height=F.bottom-F.top;E.left=F.left+v;E.right=F.right+v;E.top=F.top+u;E.bottom=F.bottom+u;return E};var D=x(C.first,C.last);var y=w(C.first);if(h.HighlightAction.debug){var B=b("<div>").attr("id","highlight-actions-debug-helper");l.appendAbsolutePositionedElement(B).css(b.extend({position:"absolute",outline:"1px solid red"},D))}return{first:y,average:D}}function p(t){var s=(t.text!==undefined)?t.text:t.toString();return r(s)}function q(s){return(s.cloneContents)?b("<div>").append(s.cloneContents()).html():s.htmlText}function a(t){if(t.commonAncestorContainer){var s=t.commonAncestorContainer;if(s.nodeType===3){return s.parentNode}return s}else{if(t.parentElement){return t.parentElement()}}}function g(s){return{area:o(s),text:p(s),html:q(s),containingElement:a(s),range:s}}function m(s,v){var t=a(v);var u=function(){var w=false;b.each(s,function(x,y){if(y===t||b.contains(y,t)){w=true;return false}});return w};return u()}function i(){if(window.getSelection&&window.getSelection().isCollapsed){return false}if(document.selection&&(document.selection.type==="None"||document.selection.createRange().htmlText==="")){return false}var v;if(window.getSelection){var s=window.getSelection();v=s.getRangeAt(s.rangeCount-1)}else{if(document.selection){v=document.selection.createRange()}}if(/^\s*$/.test(p(v))){var t=q(v);if(!t){return false}var u=t.toLowerCase().indexOf("<img ")!==-1;if(!u){return false}}if(!m(b(".wiki-content, [data-highlight-actions-target=true]"),v)){return false}return v}function c(u,t){var s;if(document.createRange){s=document.createRange();s.setStart(u.get(0),0);s.setEnd(t.endContainer,t.originalEndOffset)}else{s=document.body.createTextRange();s.moveToElementText(u.get(0));s.setEndPoint("EndToEnd",t)}return s}function k(t){if(document.createRange){return t.text()}else{var s=document.body.createTextRange();s.moveToElementText(t.get(0));return s.text}}function j(x,w,u){var v=w.find('.user-mention, a[href^="/"]');w.find('.conf-macro[data-hasbody="false"]').each(function(){if(b(this).text().indexOf(x)>-1){v=v.add(this)}});if(v.length>0){var s=x.replace(/\S/g," ");var t=new RegExp(x.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),"g");v.each(function(){var y=b(this).text();b(this).text(y.replace(t,s))});return k(w)}return u}function f(x,v){var t=k(v);t=j(x,v.clone(),t);t=r(t);var w=0;var u=-1;var s=[];while((u=t.indexOf(x,w))>-1){s.push(u);w=u+1}return s}function n(u,t){var s=p(c(u,t));var w=b.trim(p(t));var v=f(w,u);s=s.replace(/\s*$/,"");return{pageId:e.Meta.get("page-id"),selectedText:w,index:b.inArray(s.length-w.length,v),numMatches:v.length}}return{getRangeOption:g,getUserSelectionRange:i,getSelectionRects:o,getSelectionText:p,getSelectionHTML:q,getContainingElement:a,getFirstAndLastSelectionRect:d,isSelectionInsideContent:m,computeSearchTextObject:n}});require("confluence/module-exporter").exportModuleAsGlobal("confluence-highlight-actions/js/highlight-ranger-helper","Confluence.HighlightAction.RangeHelper");
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-highlight-actions:highlighting-experiment-resources', location = 'js/highlight-actions.js' */
define("confluence-highlight-actions/js/highlight-actions",["ajs","jquery","confluence/legacy","confluence-highlight-actions/js/highlight-ranger-helper"],function(n,e,o,g){var d={};var b={MAINCONTENT_AND_COMMENT:function(p){return g.isSelectionInsideContent(e(".wiki-content, [data-highlight-actions-target=true]"),p)},MAINCONTENT_ONLY:function(q){var p=e(".wiki-content, [data-highlight-actions-target=true]").first();return g.isSelectionInsideContent(p,q)},COMMENT_ONLY:function(p){return g.isSelectionInsideContent(e(".comment-content"),p)}};function a(q,r){var p={onClick:function(){},shouldDisplay:b.MAINCONTENT_AND_COMMENT};d[q]=e.extend(p,r)}function l(p){var q=d[p];if(!q){q=function(){n.logError("The button with key "+p+" doesn't have a registered handler")}}return q}function c(q){var p=o.getContextPath()+"/rest/highlighting/1.0/insert-storage-fragment";return e.ajax({type:"POST",contentType:"application/json",url:p,data:JSON.stringify(q)})}function f(p){var q=o.getContextPath()+"/rest/highlighting/1.0/insert-storage-column-table";return e.ajax({type:"POST",contentType:"application/json",url:q,data:JSON.stringify(p)})}function k(s,r){var q={};var p=r?new Date(r).getTime():null;q.pageId=s.pageId;q.selectedText=s.selectedText;q.index=s.index;q.numMatches=s.numMatches;q.lastFetchTime=p||e('meta[name="confluence-request-time"]').attr("content");return q}function j(r,q,t,s){var p=k(t,s);p.tableColumnIndex=q;p.cellModifications=r;return p}function h(p,s,r){var q=k(s,r);q.xmlModification=p[0].xmlInsertion;return q}function i(p,r){var q=k(r);q.xmlModification=p;return q}function m(){if(window.getSelection){window.getSelection().empty&&window.getSelection().empty();window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges()}else{window.document.selection&&window.document.selection.empty()}}return{registerButtonHandler:a,getButtonHandler:l,insertContentAtSelectionEnd:c,insertContentsInTableColumnCells:f,createTableInsertionBean:j,createInsertionBean:h,createXMLModificationBean:i,clearTextSelection:m,WORKING_AREA:b}});require("confluence/module-exporter").exportModuleAsGlobal("confluence-highlight-actions/js/highlight-actions","Confluence.HighlightAction");
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-highlight-actions:highlighting-experiment-resources', location = '/js/highlight-panel.js' */
define("confluence-highlight-actions/js/highlight-panel",["ajs","confluence/meta","skate","jquery","confluence/legacy","confluence-highlight-actions/js/highlight-ranger-helper","confluence-highlight-actions/js/doctheme-utils","confluence-highlight-actions/js/scrolling-inline-dialog","confluence-highlight-actions/js/highlight-actions"],function(g,j,q,d,h,p,k,v,t){var m=d("<div>").attr("id","action-dialog-target");var a;var l="selection-action-panel";var w;var e;var s=function(x){var y=h.getContextPath()+"/rest/highlighting/1.0/panel-items?pageId="+x;var z=d.ajax({url:y,cache:false,success:function(A){if(A.length){u(A)}}});f(z)};function o(){var y=d("#confluence-ui").length===0;if(y){var x=j.get("page-id");if(x){s(x)}}var z="spa-highlight-actions-placeholder";q(z,{type:q.types.CLASS,attributes:{"data-content-id":{created:function(A,B){if(B.newValue){s(B.newValue)}else{g.debug("content-id value is not defined.")}}}}})}var c=function(){return d(".wiki-content, [data-highlight-actions-target=true]").first()};function u(C){var F=r();var x=29;var G=false;var I=C.length*x;var H=h.HighlightPanel.Templates.panelContent({webItems:C});var E=false;var z=function(K,J,L){if(!E){K.append(H);K.find(".aui-button").tooltip({gravity:"s"});n(K.parent());K.find("button").click(function(P){var N=d(this).attr("data-key");var Q=t.getButtonHandler(N);G=true;a.hide();var O=p.getRangeOption(w);if(d.trim(O.text)!==""){var M=c();O.searchText=p.computeSearchTextObject(M,w)}Q.onClick(O)})}L();E=true;return false};var D=function(J){var K=false;J.find("button").each(function(L){var N=d(this);var M=N.attr("data-key");var P=t.getButtonHandler(M);var O=false;if(P&&P.shouldDisplay){O=P.shouldDisplay(w)}N.css("display",O?"inline-block":"none");K=K||O});if(!K){a.hide()}else{J.find(".contents").width("auto")}};var y=function(){D(this.popup);F.bindHideEvents();m.show()};var B=function(){F.unbindHideEvents();m.hide()};var A={centerOnHighlight:true,onTop:true,fadeTime:0,width:I,persistent:true,initCallback:y,hideCallback:B};a=v(m,l,z,A)}function n(x){x.children().attr("unselectable","on").on("selectstart",false)}function f(A){var x;var z=0;var y=300;d(document).on("mouseup",function(B){A.done(function(D){if(!(D&&D.length>0)){return}var C=d(B.target);if(C.closest(".aui-inline-dialog").length!==0){return}setTimeout(function(){clearTimeout(x);var E=y;if(d(a[0]).is(":visible")){E=z}x=setTimeout(function(){i()},E)},z)})});A.done(function(){g.bind("quickedit.success",function(){a.hide()})})}function i(){w=p.getUserSelectionRange();var x=function(C){return d.trim(C.toString())!==""};if(w&&w.endOffset!==undefined){w.originalEndOffset=w.endOffset}var B=window.Confluence&&window.Confluence.HighlightAction?window.Confluence.HighlightAction.getButtonHandler("com.atlassian.confluence.plugins.confluence-inline-comments:create-inline-comment"):null;var A=B&&typeof B.shouldDisplay==="function"?B.shouldDisplay(w):false;if(!A||!w||!x(w)){a.hide();return}var z=p.getSelectionRects(w);if(!z){return}var y=b(z);if(y||!d(a[0]).is(":visible")){d(a[0]).hide();a.show()}}function r(){var A=function(){C();z()};var D=function(){x();F()};var y=false;var E=l+".inline-dialog-check";var C=function(){if(!y){d("body").bind("click."+E,function(H){var G=d(H.target);if(G.closest("#inline-dialog-"+l+" .contents").length===0){if(!w){a.hide()}}});y=true}};var x=function(){if(y){d("body").unbind("click."+E)}y=false};var B=function(G){if(G.keyCode===27){a.hide()}};var z=function(){d(document).on("keydown",B)};var F=function(){d(document).off("keydown",B)};return{bindHideEvents:A,unbindHideEvents:D}}function b(y){k.appendAbsolutePositionedElement(m);var x=false;if(!e||y.first.top!=e.first.top||y.first.height!=e.first.height||y.first.left!=e.first.left||y.first.width!=e.first.width){m.css({top:y.first.top,height:y.first.height,left:y.first.left,width:y.first.width});e=y;x=true}return x}return{init:o}});require("confluence/module-exporter").safeRequire("confluence-highlight-actions/js/highlight-panel",function(a){a.init()});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-highlight-actions:highlighting-experiment-resources', location = '/js/quote-in-comment.js' */
define("confluence-highlight-actions/js/quote-in-comment",["ajs","jquery","confluence-highlight-actions/js/highlight-actions"],function(i,e,f){var a=true;var h=false;function b(m){var l=m.getBody().createTextRange();l.moveToElementText(m.getBody());l.collapse(false);l.select()}function d(){var l=40;var m=e("#rte-toolbar").offset().top;e(document).scrollTop(m-l)}function k(m,n){var o="<p><br/></p>";if(e.browser.msie&&!h){b(m);o="<p></p>"}var l="<blockquote><p>"+n.html+"</p></blockquote>"+o;m.execCommand("mceInsertContent",false,l);h=false}function j(l){f.clearTextSelection();setTimeout(function(){var m=i&&i.Rte&&i.Rte.getEditor&&i.Rte.getEditor();if(m){d();k(m,l)}else{h=true;var n=function(){k(i.Rte.getEditor(),l);i.unbind("quickedit.visible",n)};i.bind("quickedit.visible",n);c(g(l.containingElement))}},0)}function g(l){var m=e(l).closest("div.comment");return m}function c(l){if(!l.length>0){e(".quick-comment-prompt").click()}else{l.find(".comment-actions .action-reply-comment").click()}}return{actionCallback:j}});require("confluence/module-exporter").safeRequire("confluence-highlight-actions/js/quote-in-comment",function(b){var c="com.atlassian.confluence.plugins.confluence-highlight-actions:quote-comment";var a=require("confluence-highlight-actions/js/highlight-actions");a.registerButtonHandler(c,{onClick:b.actionCallback,shouldDisplay:a.WORKING_AREA.MAINCONTENT_AND_COMMENT})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-highlight-actions:highlighting-experiment-resources', location = '/js/highlight-test-helper.js' */
define("confluence-highlight-actions/js/highlight-test-helper",["ajs","window","confluence-highlight-actions/js/highlight-actions"],function(a,b,c){function d(){c.registerButtonHandler("com.atlassian.confluence.plugins.confluence-highlight-actions-test:create-JIRA-issue",{onClick:function(f){var e=new a.Dialog({id:"hilightext-action-dialog",closeOnOutsideClick:true});e.addHeader(f.text);e.show()},shouldDisplay:function(){return true}});c.registerButtonHandler("com.atlassian.confluence.plugins.confluence-highlight-actions-test:append-xxx",{onClick:function(f){var e=c.createXMLModificationBean("<span>XXX</span>",f.searchText);c.insertContentAtSelectionEnd(e).done(function(h){if(h){b.location.reload()}else{var g=new a.Dialog({id:"hilightext-append-xxx-dialog",closeOnOutsideClick:true});g.addHeader("Cannot insert");g.show()}})},shouldDisplay:function(){return true}});c.registerButtonHandler("com.atlassian.confluence.plugins.confluence-highlight-actions-test:insert-table-content",{onClick:function(j){var h=[];for(var g=0;g<3;g++){var k={};k.rowIndex=g;k.xmlInsertion="Insert content";h.push(k)}var f=0;var e=c.createTableInsertionBean(h,f,j.searchText);c.insertContentsInTableColumnCells(e).done(function(l){if(l){b.location.reload()}else{var i=new a.Dialog({id:"hilightext-insert-table-content-dialog",closeOnOutsideClick:true});i.addHeader("Cannot insert");i.show()}})},shouldDisplay:function(){return true}})}return d});require("confluence/module-exporter").safeRequire("confluence-highlight-actions/js/highlight-test-helper",function(a){a()});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-highlight-actions:highlighting-experiment-resources', location = '/soy/templates.soy' */
// This file was automatically generated from templates.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.HighlightPanel.Templates.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.HighlightPanel == 'undefined') { Confluence.HighlightPanel = {}; }
if (typeof Confluence.HighlightPanel.Templates == 'undefined') { Confluence.HighlightPanel.Templates = {}; }


Confluence.HighlightPanel.Templates.panelContent = function(opt_data, opt_ignored) {
  var output = '';
  var webItemList3 = opt_data.webItems;
  var webItemListLen3 = webItemList3.length;
  for (var webItemIndex3 = 0; webItemIndex3 < webItemListLen3; webItemIndex3++) {
    var webItemData3 = webItemList3[webItemIndex3];
    output += (webItemData3['key'] == 'com.atlassian.confluence.plugins.confluence-inline-comments:create-inline-comment') ? '<button data-key="' + soy.$$escapeHtml(webItemData3.key) + '" class="aui-button aui-button-compact aui-button-subtle" style="height: 2.4em;" title="' + soy.$$escapeHtml(webItemData3.tooltip) + '"><span class="aui-icon aui-icon-small ' + soy.$$escapeHtml(webItemData3.styleClass) + '"></span><span style="font-size: 15px; margin-left: 4px;">' + soy.$$escapeHtml(webItemData3.label) + '</span></button>' : (webItemData3['key'] == 'com.atlassian.confluence.plugins.confluence-jira-content:create-JIRA-issue-summary') ? '<button data-key="' + soy.$$escapeHtml(webItemData3.key) + '" class="aui-button aui-button-compact aui-button-subtle" style="height: 2.4em;" title="' + soy.$$escapeHtml(webItemData3.tooltip) + '"><span class="aui-icon aui-icon-small ' + soy.$$escapeHtml(webItemData3.styleClass) + '"></span><span style="font-size: 15px; margin-left: 4px;">' + soy.$$escapeHtml(webItemData3.label) + '</span></button>' : '<button data-key="' + soy.$$escapeHtml(webItemData3.key) + '" class="aui-button aui-button-compact aui-button-subtle" title="' + soy.$$escapeHtml(webItemData3.label) + '"><span class="aui-icon aui-icon-small ' + soy.$$escapeHtml(webItemData3.styleClass) + '"></span></button>';
  }
  return output;
};
if (goog.DEBUG) {
  Confluence.HighlightPanel.Templates.panelContent.soyTemplateName = 'Confluence.HighlightPanel.Templates.panelContent';
}

}catch(e){WRMCB(e)};