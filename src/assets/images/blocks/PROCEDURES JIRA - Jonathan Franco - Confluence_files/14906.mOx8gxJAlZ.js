"use strict";(self._cf=self._cf||[]).push([[14906,37705,24466],{912638:(e,t,i)=>{i.d(t,{Q4:()=>s,rs:()=>n});class a{constructor(e){this.value=e,this.valueOf=this.toString=this.toJSON=()=>this.value}}const n=e=>new a(e),s=(...e)=>t=>e.includes(t)?Object.freeze(new a(t)):t},303574:(e,t,i)=>{i.d(t,{Yn:()=>s,cP:()=>n,qJ:()=>r});var a=i(940155);const n=(0,a.ZR)({__loadable_id__:"hVpSE",name:"SatisfactionSurveyFlag",loader:async()=>(await Promise.all([i.e(12705),i.e(11216),i.e(32072),i.e(45159),i.e(92336),i.e(39599)]).then(i.bind(i,290448))).SatisfactionSurveyFlag}),s=(0,a.ZR)({__loadable_id__:"8ItNp",name:"SatisfactionSurveyComponent",loader:async()=>(await Promise.all([i.e(12705),i.e(11216),i.e(32072),i.e(45159),i.e(92336)]).then(i.bind(i,842539))).SatisfactionSurveyComponent}),r=(0,a.ZR)({__loadable_id__:"-D1ZP",name:"SatisfactionSurveyModal",loader:async()=>(await Promise.all([i.e(12705),i.e(11216),i.e(14248),i.e(21488),i.e(84185),i.e(32072),i.e(45159),i.e(92336),i.e(74190)]).then(i.bind(i,548454))).SatisfactionSurveyModal})},371318:(e,t,i)=>{i.d(t,{e:()=>l,u:()=>u});var a=i(329687),n=i.n(a),s=i(167347),r=i(559787);const o=i(779076).ZP`query IsSuperAdmin{user(current:true){id confluence{roles{isSuperAdmin}}}}`,u=()=>{var e;const t=(0,r.TT)(),{loading:i,error:a,data:n}=(0,s.aM)(o,{skip:!t});return t?{loading:i,error:a,isSuperAdmin:Boolean(null==n||null===(e=n.user)||void 0===e||null===(e=e.confluence)||void 0===e||null===(e=e.roles)||void 0===e?void 0:e.isSuperAdmin)}:{loading:!1,isSuperAdmin:!1}},l=({children:e})=>{const{isSuperAdmin:t,loading:i,error:a}=u();return e({loading:i,error:a,isSuperAdmin:t})};l.propTypes={children:n().func.isRequired}},34481:(e,t,i)=>{i.r(t),i.d(t,{Banner:()=>I,SuperAdminBanner:()=>P,SuperAdminBannerComponent:()=>B});var a=i(615919),n=i(872342),s=i(840506),r=i(767001),o=i(920839),u=i(142807),l=i(822464),d=i(629670),c=i(16728),m=i(486889),p=i(482997),f=i(637418),S=i(107663),y=i(559787),v=i(346084),g=i(627521),E=i(371318),A=i(319746),h=i(31413),b=i(188286);const T=["as","style"],M=["as","style"],_=["as","style"],k=["as","style"];i(583068),i(32970),i(837389),i(513493),i(494908),i(506840),i(472181),i(78517),i(90455),i(589519),i(320374),i(249651),i(784320),i(413076),i(716613),i(782269),i(424420),i(456928),i(354326),i(520700);const Z="SuperAdminBanner",w=(0,s.forwardRef)(((e,t)=>{let{as:i="div",style:o}=e,u=(0,n.Z)(e,T);return s.createElement(i,(0,a.Z)((0,a.Z)({},u),{},{style:o,ref:t,className:(0,r.Z)(["_1bsb1osq",u.className])}))}));const R=3.5*v.ww,x=R+2*(R/2-v.ww/4),I=(0,s.forwardRef)(((e,t)=>{let{as:i="div",style:u}=e,l=(0,n.Z)(e,M);return s.createElement(i,(0,a.Z)((0,a.Z)({},l),{},{style:(0,a.Z)((0,a.Z)({},u),{},{"--_kfui38":(0,o.Z)(`var(--ds-background-warning-bold, ${c.jC})`),"--_fxujlc":(0,o.Z)(`var(--ds-text-warning-inverse, ${c.TG})`),"--_1z0xxks":(0,o.Z)("var(--ds-font-weight-regular, 500)")}),ref:t,className:(0,r.Z)(["_1bsb1osq _1e0c1txw _4cvr1h6o _4t3i1f4h _bfhkj9xj _syaz1ua6 _1wybdlk8 _k48pg76b _ca0q1crf _u5f31crf _n3td1crf _19bv1crf",l.className])}))}));const D=(0,s.forwardRef)(((e,t)=>{let{as:i="span",style:u}=e,l=(0,n.Z)(e,_);return s.createElement(i,(0,a.Z)((0,a.Z)({},l),{},{style:(0,a.Z)((0,a.Z)({},u),{},{"--_1nvt7kj":(0,o.Z)("var(--ds-space-050, 4px)")}),ref:t,className:(0,r.Z)(["_1yt416re",l.className])}))}));v.ww;const C=(0,s.forwardRef)(((e,t)=>{let{as:i="a",style:o}=e,u=(0,n.Z)(e,k);return s.createElement(i,(0,a.Z)((0,a.Z)({},u),{},{style:o,ref:t,className:(0,r.Z)(["_syaz1kw7 _80omtlke _k48p4jg8 _18u014y2 _4bfu1r31 _1hms8stv _ajmmnqa1",u.className])}))}));const N=s.createElement(d.default,{label:"Warning icon",size:"medium",primaryColor:`var(--ds-icon-warning-inverse, ${c.q2})`,secondaryColor:`var(--ds-icon-warning, ${c.zx})`}),B=({bannerState:e})=>{const[t,i]=(0,s.useState)(!1),[n,r]=(0,s.useState)(x),{createAnalyticsEvent:o}=(0,m._)();(0,s.useEffect)((()=>{f.LT.getItemAsBoolean(S.keys.SUPERADMIN_SURVEY_REQUESTED)&&i(!0)}),[]);const l=(0,s.useCallback)((()=>o({type:"sendUIEvent",data:{action:"clicked",actionSubject:"link",actionSubjectId:"adminKeyExit",source:"superAdminBanner"}}).fire()),[o]),d=(0,s.useCallback)((()=>o({type:"sendTrackEvent",data:{action:"failed",actionSubject:"exitAdminKeySession",source:"superAdminBanner"}}).fire()),[o]),c=(0,s.useCallback)((()=>{var e;e=!1,f.LT.getItemAsBoolean(S.keys.SUPERADMIN_SURVEY_SUBMITTED)||(f.LT.setItem(S.keys.SUPERADMIN_SURVEY_REQUESTED,"true"),e&&i(!0)),f.LT.removeItem(S.keys.RESTRICTED_PAGE_CONFIRMED),l()}),[l]),p=()=>{Promise.resolve(d())},v=(t,i,o)=>i?s.createElement(g.X,{error:i}):t?null:o?(()=>{const t={role:"alert"};return e.getTotalHeight()!==x&&(r(x),e.show(Z,n)),s.createElement(h.t,{handleMutationCompleteCallback:c,handleMutationErrorCallback:p},(e=>s.createElement(s.Fragment,null,s.createElement(w,null,s.createElement(I,(0,a.Z)({},t),N,s.createElement(D,null,s.createElement(u.Z,{id:"super-admin.banner.message",defaultMessage:"You’re using admin key, which gives you temporary access to restricted pages."}),s.createElement(C,{onClick:e},s.createElement(u.Z,{id:"super-admin.banner.exit",defaultMessage:"Stop using admin key"}))))))))})():(e.hide(Z),null);return s.createElement(s.Fragment,null,(0,y.TT)()&&s.createElement(E.e,null,(({loading:e,error:t,isSuperAdmin:i})=>v(e,t,i))),t&&s.createElement(A.SuperAdminSatisfactionSurvey,{onDone:()=>{f.LT.removeItem(S.keys.SUPERADMIN_SURVEY_REQUESTED),i(!1)}}),s.createElement(b.SuperAdminExpiration,null))},P=()=>s.createElement(l.xs,{to:[p.S]},(e=>s.createElement(B,{bannerState:e})));P.displayName="SuperAdminBanner"},319746:(e,t,i)=>{i.r(t),i.d(t,{SuperAdminSatisfactionSurvey:()=>p,SuperAdminSatisfactionSurveyComponent:()=>m});var a=i(199009),n=i(840506),s=i(122529),r=i(430564),o=i(912638),u=i(303574),l=i(637418),d=i(107663);const c=(0,i(93972).defineMessages)({superAdminSatisfactionSurveyTitle:{id:"super-admin.satisfaction.survey.title",defaultMessage:"How was your admin key experience?"},superAdminSatisfactionSurveyFinalTitle:{id:"super-admin.satisfaction.survey.final.title",defaultMessage:"Thank you"},superAdminSatisfactionSurveyFinalDescription:{id:"super-admin.satisfaction.survey.final.description",defaultMessage:"Your feedback has been submitted"},superAdminSatisfactionSurveyReactionTerrible:{id:"super-admin.satisfaction.survey.reaction.terrible",defaultMessage:"Terrible"},superAdminSatisfactionSurveyReactionBad:{id:"super-admin.satisfaction.survey.reaction.bad",defaultMessage:"Bad"},superAdminSatisfactionSurveyReactionOkay:{id:"super-admin.satisfaction.survey.reaction.okay",defaultMessage:"Okay"},superAdminSatisfactionSurveyReactionGreat:{id:"super-admin.satisfaction.survey.reaction.great",defaultMessage:"Great"},superAdminSatisfactionSurveyReactionAmazing:{id:"super-admin.satisfaction.survey.reaction.amazing",defaultMessage:"Amazing"},superAdminSatisfactionSurveyQuestionBad:{id:"super-admin.satisfaction.survey.question.bad",defaultMessage:"We're sorry to hear that. What went wrong? (optional)"},superAdminSatisfactionSurveyQuestionGood:{id:"super-admin.satisfaction.survey.question.good",defaultMessage:"Thanks! What did you like about it? What could be improved? (optional)"},superAdminSatisfactionSurveyButtonSubmit:{id:"super-admin.satisfaction.survey.button.submit",defaultMessage:"Submit"},superAdminSatisfactionSurveyButtonClose:{id:"super-admin.satisfaction.survey.button.close",defaultMessage:"Close"}});class m extends n.Component{constructor(...e){super(...e),(0,a.Z)(this,"state",{eventSent:!1}),(0,a.Z)(this,"initializeText",(()=>{if(!this.formQuestions){const{intl:e}=this.props;this.title=e.formatMessage(c.superAdminSatisfactionSurveyTitle),this.finalTitle=e.formatMessage(c.superAdminSatisfactionSurveyFinalTitle),this.finalDescription=e.formatMessage(c.superAdminSatisfactionSurveyFinalDescription),this.submitButtonText=e.formatMessage(c.superAdminSatisfactionSurveyButtonSubmit),this.closeButtonText=e.formatMessage(c.superAdminSatisfactionSurveyButtonClose),this.reactionTitles=[e.formatMessage(c.superAdminSatisfactionSurveyReactionTerrible),e.formatMessage(c.superAdminSatisfactionSurveyReactionBad),e.formatMessage(c.superAdminSatisfactionSurveyReactionOkay),e.formatMessage(c.superAdminSatisfactionSurveyReactionGreat),e.formatMessage(c.superAdminSatisfactionSurveyReactionAmazing)];const t=e.formatMessage(c.superAdminSatisfactionSurveyQuestionBad),i=e.formatMessage(c.superAdminSatisfactionSurveyQuestionGood);this.formQuestions=[t,t,i,i,i]}})),(0,a.Z)(this,"fireAnalyticsEvent",(({reaction:e=null,feedback:t="",submitted:i=!1})=>{const{createAnalyticsEvent:a}=this.props;t=i?t:"",a({type:"sendTrackEvent",data:{action:"submitted",actionSubject:"adminKeyFeedbackSurvey",attributes:{reaction:i&&e?e.value:0,feedback:(0,o.rs)(t)},source:"adminKeyCsatSurvey"}}).fire()})),(0,a.Z)(this,"markUserAsSubmitted",(()=>{l.LT.setItem(d.keys.SUPERADMIN_SURVEY_SUBMITTED,"true",259200)})),(0,a.Z)(this,"handleInteraction",(async e=>{const{onDone:t}=this.props,{eventSent:i}=this.state;i||(this.fireAnalyticsEvent(e),e.submitted&&this.markUserAsSubmitted(),await this.setState({eventSent:!0})),e.dismissed&&t()}))}render(){const{eventSent:e}=this.state;return this.initializeText(),n.createElement(u.cP,{size:"medium",title:this.title,description:"",finalTitle:this.finalTitle,finalDescription:this.finalDescription,reactionTitles:this.reactionTitles,formQuestions:this.formQuestions,submitButtonText:this.submitButtonText,closeButtonText:this.closeButtonText,onInteraction:this.handleInteraction,isOnFinalStage:e,autoHideTime:-1,autoHideFinalTime:2e3})}}m.displayName="SuperAdminSatisfactionSurveyComponent";const p=(0,r.Z)()((0,s.ZP)(m))},31413:(e,t,i)=>{i.d(t,{t:()=>f});var a=i(840506),n=i(911492),s=i(93972),r=i(747472),o=i(822464),u=i(191061),l=i(213064),d=i(559787),c=i(943401);const m=i(779076).ZP`mutation DisableSuperAdmin{disableSuperAdmin{user{id confluence{roles{isSuperAdmin}}}}}`,p=(0,s.defineMessages)({disableSuperAdminErrorTitle:{id:"super-admin.disable.super.admin.error.title",defaultMessage:"Something went wrong"},disableSuperAdminErrorDescription:{id:"super-admin.disable.super.admin.error.description-with-link",defaultMessage:"If this keeps happening, let us know at {atlassianSupportLink}"}}),f=({handleMutationCompleteCallback:e,handleMutationErrorCallback:t,children:i})=>{const s=(0,r.Z)(),f=t=>i=>{var a;(null==i||null===(a=i.disableSuperAdmin)||void 0===a||null===(a=a.user)||void 0===a||null===(a=a.confluence)||void 0===a||null===(a=a.roles)||void 0===a?void 0:a.isSuperAdmin)?S(t)():((0,d.Yb)(),(0,c._N)(),e(),window.location.reload())},S=e=>()=>{e.showErrorFlag({title:s.formatMessage(p.disableSuperAdminErrorTitle),description:s.formatMessage(p.disableSuperAdminErrorDescription,{atlassianSupportLink:a.createElement(u.l,{showHostname:!0})})}),t()};return a.createElement(o.xs,{to:[l.Q]},(e=>a.createElement(n.mm,{mutation:m,onCompleted:f(e),onError:S(e)},(t=>i(t,e)))))};f.displayName="DisableSuperAdminMutation"},188286:(e,t,i)=>{i.r(t),i.d(t,{SuperAdminExpiration:()=>_});var a=i(199009),n=i(840506),s=i(430564),r=i(637418),o=i(107663),u=i(31413),l=i(615919),d=i(872342),c=i(767001),m=i(93972),p=i(747472),f=i(142807),S=i(486889),y=i(943401);const v=({initialCountdown:e})=>{const[t,i]=(0,n.useState)(e),[a,s]=(0,n.useState)(null),r=(0,n.useRef)((()=>{})),o=e=>{e&&clearInterval(e)};return r.current=()=>{t>0?i(t-1):o(a)},(0,n.useEffect)((()=>{const t=(()=>{if(e>0){const e=setInterval((()=>r.current()),1e3);return s(e),e}return null})();return()=>{o(t)}}),[]),n.createElement(f.Z,{id:"super-admin.timeout.super.admin.description.counter",defaultMessage:"{count, plural, =0 {0 seconds} one {1 second} other {# seconds}}",values:{count:t}})};v.displayName="Counter";const g=["as","style"];i(401933),i(990713);const E=(0,m.defineMessages)({timeoutSuperAdminTitle:{id:"super-admin.timeout.super.admin.title",defaultMessage:"Still there?"},superAdminTimerFlagAction:{id:"super-admin.timer.flag.action",defaultMessage:"Keep using admin key"}}),A=(0,n.forwardRef)(((e,t)=>{let{as:i="div",style:a}=e,s=(0,d.Z)(e,g);return n.createElement(i,(0,l.Z)((0,l.Z)({},s),{},{style:a,ref:t,className:(0,c.Z)(["_k48p8n31 _1e0c1nu9",s.className])}))}));const h=({flags:e,disableSuperAdminTrigger:t})=>{const[i,a]=(0,n.useState)(),s=(0,n.useRef)();s.current=i;const r=(0,p.Z)(),{createAnalyticsEvent:o}=(0,S._)(),u=e=>{setTimeout(e,1e3)},l=()=>{void 0!==s.current&&e.hideFlag(s.current)},d=e=>n.createElement("div",{"data-testid":"super-admin.timeout.flag.description"},n.createElement(f.Z,{id:"super-admin.timeout.super.admin.description",defaultMessage:"Due to inactivity, you will be signed out in {counter}.",values:{counter:n.createElement(A,null,n.createElement(v,{initialCountdown:(0,y.vS)(e)}))}})),c=()=>()=>{(0,y.iu)(),m(),l()},m=()=>{o({type:"sendTrackEvent",data:{source:"superAdminExpiration",action:"extended",actionSubject:"adminKeySession"}}).fire()},g=i=>{(0,y.aX)((0,y.yZ)())({beforeNotify:()=>u((()=>{i&&l(),g(!1)})),afterNotify:t=>u((()=>{i||(t=>{e.showWarningFlag({title:r.formatMessage(E.timeoutSuperAdminTitle),description:d(t),actions:[{content:r.formatMessage(E.superAdminTimerFlagAction),onClick:c()}]}).then((e=>a(e.id)))})(t),g(!0)})),afterExpiry:()=>t(),noTimeout:()=>{}})};return(0,n.useEffect)((()=>{g(!1)}),[t]),null},b=(0,m.defineMessages)({sessionExpirationTitle:{id:"super-admin.session.expiration.title",defaultMessage:"Access to restricted pages has ended"},sessionExpirationDescription:{id:"super-admin.session.expiration.description",defaultMessage:"You’ve been inactive for a while. To keep things secure, we’ve ended your access to restricted pages."}}),T=({flags:e})=>{const t=(0,p.Z)();return(0,n.useEffect)((()=>{r.LT.getAndRemoveItem(o.keys.SUPERADMIN_SESSION_EXPIRED)&&e.showInfoFlag({title:t.formatMessage(b.sessionExpirationTitle),description:t.formatMessage(b.sessionExpirationDescription)})}),[e,t]),null};class M extends n.Component{constructor(...e){super(...e),(0,a.Z)(this,"fireAdminKeyExpiredAnalyticsEvent",(()=>{this.props.createAnalyticsEvent({type:"sendTrackEvent",data:{source:"superAdminExpiration",action:"expired",actionSubject:"adminKeySession"}}).fire()})),(0,a.Z)(this,"deleteStoredRestrictedPage",(()=>r.LT.removeItem(o.keys.RESTRICTED_PAGE_CONFIRMED))),(0,a.Z)(this,"fireAdminKeyExpiryFailedAnalyticsEvent",(()=>this.props.createAnalyticsEvent({type:"sendTrackEvent",data:{action:"failed",actionSubject:"exitAdminKeySession",source:"superAdminExpiration"}}).fire())),(0,a.Z)(this,"setAKSessionExpired",(()=>r.LT.setItem(o.keys.SUPERADMIN_SESSION_EXPIRED,!0,(0,y.ZX)(new Date,10).getTime()))),(0,a.Z)(this,"render",(()=>n.createElement(u.t,{handleMutationCompleteCallback:()=>{this.fireAdminKeyExpiredAnalyticsEvent(),this.deleteStoredRestrictedPage(),this.setAKSessionExpired()},handleMutationErrorCallback:()=>(this.fireAdminKeyExpiryFailedAnalyticsEvent(),Promise.resolve())},((e,t)=>n.createElement(n.Fragment,null,n.createElement(h,{flags:t,disableSuperAdminTrigger:e}),n.createElement(T,{flags:t}))))))}}const _=(0,s.Z)()(M)},943401:(e,t,i)=>{i.d(t,{ZX:()=>o,_N:()=>d,aX:()=>u,iu:()=>c,vS:()=>s,yZ:()=>l});const a=(0,i(614889).j)("super-admin"),n="confluence.super.admin.timeout",s=e=>Math.round((e-(new Date).getTime())/1e3),r=e=>60*e,o=(e,t)=>new Date(e.getTime()+1e3*t),u=e=>({beforeNotify:t,afterNotify:i,afterExpiry:a,noTimeout:n})=>{if(e){const n=s(e);return n>0?n<=60?i(e):t(e):a(e)}return n()},l=()=>{const e=localStorage.getItem(n);return e?parseInt(e):0},d=()=>{localStorage.removeItem(n)},c=()=>{var e,t;(e=>{try{localStorage.setItem(n,e.toString())}catch(t){a.error`Unable to set local storage. key = "${n}", value = "${e}"`}})((e=new Date,t=10,o(e,r(t))).getTime())}}}]);
//# sourceMappingURL=14906.mOx8gxJAlZ.js.map