"use strict";(self._cf=self._cf||[]).push([[3071],{32503:(e,t,n)=>{n.d(t,{i:()=>a,m:()=>r});var o=n(840506);const a=(0,o.createContext)({hasContentChanged:!1,onChange:()=>{},resetContentChanged:()=>{},isCommentContentReady:!1,onCommentContentReady:()=>{}});a.displayName="CommentContentContext";const r=({children:e})=>{const[t,n]=(0,o.useState)(!1),[r,l]=(0,o.useState)(!1),s=(0,o.useMemo)((()=>({hasContentChanged:t,onChange:e=>n(e),resetContentChanged:()=>n(!1),isCommentContentReady:r,onCommentContentReady:()=>l(!0)})),[t,r]);return o.createElement(a.Provider,{value:s},e)};r.displayName="CommentContentProvider"},413864:(e,t,n)=>{n.d(t,{z:()=>c,k:()=>d});var o=n(840506),a=n(167347),r=n(654927),l=n.n(r);const s=n(779076).ZP`query UnreadInlineCommentsQuery($pageId:ID!){comments(pageId:$pageId type:UNRESOLVED depth:ALL readStatus:UNREAD){nodes{id location{...on InlineComment{type inlineMarkerRef}}}totalCount}}`;var i=n(179640);const c=(0,o.createContext)({unreadCommentCount:0,setUnreadCommentCount:()=>{},unreadCommentsList:[],setUnreadCommentsList:()=>{},unreadMarkerRefsList:[],setUnreadMarkerRefsList:()=>{}});c.displayName="UnreadCommentsContext";const d=({pageId:e,children:t})=>{const[n,r]=(0,o.useState)(0),[d,m]=(0,o.useState)([]),[u,C]=(0,o.useState)([]),g=(0,i.T)("confluence.frontend.navigate.unread.comments")&&"variation"===l().getExperimentValue("unread_comments_navigation","cohort","control"),{data:h}=(0,a.aM)(s,{variables:{pageId:e},fetchPolicy:"cache-and-network",skip:!g||!e});(0,o.useEffect)((()=>{var e,t;const n=null==h||null===(e=h.comments)||void 0===e?void 0:e.nodes;if(n){m(n);const e=Array.from(new Set(n.map((e=>e.location.inlineMarkerRef))));C(e)}r((null==h||null===(t=h.comments)||void 0===t?void 0:t.totalCount)||0)}),[h]);const E=(0,o.useMemo)((()=>({unreadCommentCount:n,setUnreadCommentCount:r,unreadCommentsList:d,setUnreadCommentsList:m,unreadMarkerRefsList:u,setUnreadMarkerRefsList:C})),[n,d,u]);return o.createElement(c.Provider,{value:E},t)};d.displayName="UnreadCommentsProvider"},554187:(e,t,n)=>{n.d(t,{q:()=>r,v:()=>a});var o=n(940155);const a=(0,o.y$)({__loadable_id__:"1Jncp",name:"CommentWarningDialog",loader:async()=>(await Promise.all([n.e(12705),n.e(11216),n.e(84185),n.e(41476)]).then(n.bind(n,922107))).CommentWarningDialog}),r=(0,o.y$)({__loadable_id__:"w0IHL",name:"InlineEditWarningDialog",loader:async()=>(await Promise.all([n.e(12705),n.e(11216),n.e(84185),n.e(53298)]).then(n.bind(n,251602))).InlineEditWarningDialog})},625662:(e,t,n)=>{n.d(t,{l:()=>i});var o=n(615919),a=n(199009),r=n(840506),l=n(822464),s=n(978421);class i extends l.W2{constructor(e=[]){if(super(),(0,a.Z)(this,"showModal",((e,t,n)=>{this.showDialog(e,t,n)})),(0,a.Z)(this,"showDialog",((e,t,n)=>{const a=s.e.nextKey,l=t||{},i=r.createElement(e,(0,o.Z)((0,o.Z)({},l),{},{onClose:(...e)=>this.onChildClose(a,...e),onCloseComplete:(...e)=>this.onChildCloseComplete(a,...e)}),n);return this.setState((e=>({stack:[...e.stack,{key:a,component:i,alive:!0,originalProps:{onClose:"onClose"in l?l.onClose:void 0,onCloseComplete:"onCloseComplete"in l?l.onCloseComplete:void 0}}]}))),()=>{this.onChildClose(a)}})),this.state={stack:e},e.length){const t=Math.max(...e.map((e=>e.key)));s.e.nextKey=t+1}}onChildClose(e,...t){const n=this.state.stack.find((t=>t.key===e));n&&(n.originalProps.onClose&&n.originalProps.onClose(...t),this.setState((e=>({stack:e.stack.map((e=>e===n?(0,o.Z)((0,o.Z)({},e),{},{alive:!1}):e))}))))}onChildCloseComplete(e,...t){const n=this.state.stack.find((t=>t.key===e));n&&(n.originalProps.onCloseComplete&&n.originalProps.onCloseComplete(...t),this.setState((e=>({stack:e.stack.filter((e=>e!==n))}))))}}},978421:(e,t,n)=>{n.d(t,{e:()=>a});var o=n(199009);const a=new class{constructor(){(0,o.Z)(this,"_nextKey",0)}get nextKey(){return this._nextKey++}set nextKey(e){e>this._nextKey&&(this._nextKey=e)}}},17593:(e,t,n)=>{n.r(t),n.d(t,{InlineCommentsHighlighter:()=>U,InlineCommentsHighlighterComponent:()=>D});var o=n(840506),a=n(822464),r=n(16728),l=n(486889),s=n(32503),i=n(413864),c=n(878196),d=n(796259),m=n(298100),u=n(870797),C=n(115613),g=n(625662),h=n(554187),E=n(846313),f=n(9019),p=n(614889),v=n(906552),_=n(434735),y=n(734233),k=n(211230),b=n(582463),I=n(179640),S=n(92560),L=n(928782),N=n(552679),R=n(423128),x=n(940155),w=n(600765),O=n(865040);const T=(0,x.y$)({__loadable_id__:"78jJ9",name:"LoadableSampleInlineComment",loader:async()=>(await n.e(15477).then(n.bind(n,683276))).SampleInlineComment}),M=(0,p.j)("inline-comment"),A=e=>e&&null!==(0,d.w)(e),D=({pageId:e,dialogs:t})=>{const{match:n}=(0,o.useContext)(y.M),{removeCommentQueryParams:a}=(0,m.fQ)(),{cohort:C}=(0,k.a)("confluence.frontend.renderer.annotation.provider.inline.comments",["annotation-provider","not-enrolled","query-selectors"],"not-enrolled",!0),g="annotation-provider"===C,{markerRefs:E,markerRefMap:f,loading:p}=(0,_.Q)({pageId:e,shouldFireQuery:!g}),{featureFlagClient:x,locale:D}=(0,b.D)(),{isNewUser:U}=(0,o.useContext)(R.wu),{hasContentChanged:P,resetContentChanged:H}=(0,o.useContext)(s.i),{unreadCommentCount:q}=(0,o.useContext)(i.z),{createAnalyticsEvent:B}=(0,l._)(),{onHighlightClick:V}=(0,o.useContext)(c.s),G=(0,o.useRef)(null),$=(0,o.useRef)(null),F="string"==typeof(null==n?void 0:n.query.focusedCommentId)?null==n?void 0:n.query.focusedCommentId:void 0,{setOnboardingState:K}=(0,L.Gs)(),Z=(0,I.T)("confluence.frontend.onboarding.experience"),{data:j,error:Q,loading:W}=(0,L.Si)([...Object.values(N.T)],!Z),{isCollaboratorOnboardingEligibleUser:z,mockInlineCommentPageId:J,hasDismissedInlineComment:X}=(0,L.Hi)(j),Y=(0,o.useCallback)(((e,t=!1)=>{let n=!1;for(;e&&A(e);){if(t){const t=(0,d.w)(e);n=Boolean(t&&E.includes(t))}else n=e.classList.contains(w.EL);if(n)break;e=e.parentElement}return{isValid:n,element:e}}),[E]),ee=(0,o.useCallback)(((e,t)=>{const n=Object.keys(f).find((t=>(null==f?void 0:f[t])===e));B({type:"sendUIEvent",data:{action:"clicked",actionSubject:"inlineCommentHighlight",attributes:{mode:"view",context:"default",isSSR:t,unreadCommentCount:q},objectType:"inlineComment",objectId:n&&f[n],source:"viewPageScreen"}}).fire()}),[B,f,q]),te=(0,o.useCallback)((({element:e,markerRef:t,isSSR:n=!1}={})=>{H(),!n&&e.classList.contains(w.GR)?((0,w.o1)(),V(null)):((0,w.o1)(),e.classList.add(w.GR),(0,w.QR)(t),V(t),ee(t,n))}),[V,H,ee]),ne=(0,o.useCallback)((e=>{const{isValid:t,element:n}=Y(e,!0);if(!n||!t)return;O.M.start();const o=(0,d.w)(n);G.current=o,te({element:n,markerRef:o,isSSR:!0})}),[te,Y]),oe=(0,o.useCallback)((e=>{const{target:n}=e,{isValid:o,element:r}=Y(n);if(!r||!o)return;e.preventDefault(),O.M.start(),a();const l=(0,d.w)(r);P?t.showModal(h.v,{onConfirm:()=>te({element:r,markerRef:l})}):te({element:r,markerRef:l})}),[P,t,te,Y,a]),ae=()=>{const e=document.getElementById("onboarding-highlight"),t=document.querySelector("#content");e&&(e.classList.contains("mock-active-highlight")?(e.style.backgroundColor=`var(--ds-background-accent-yellow-subtler, ${r.a8})`,e.style.borderBottom="2px solid var(--ds-border, rgba(255, 196, 0, 0.82))",e.style.boxShadow="",e.classList.remove("mock-active-highlight"),t&&t.dispatchEvent(new CustomEvent("click-sample-highlight",{detail:"unfocus"}))):(e.style.backgroundColor=`var(--ds-background-accent-yellow-subtle, ${r.ii})`,e.style.borderBottom=`2px solid var(--ds-border-accent-yellow, ${r.Z3})`,e.style.boxShadow=`var(--ds-shadow-overlay, 0 2px 2px ${r.uv})`,e.classList.add("mock-active-highlight"),t&&t.dispatchEvent(new CustomEvent("click-sample-highlight",{detail:"focus"}))))};(0,o.useEffect)((()=>{try{if(!G.current&&E.length>0&&window.__SSR_INLINE_COMMENTS_EVENTS_CAPTURE__&&window.__SSR_INLINE_COMMENTS_EVENTS_CAPTURE__.clickedInlineHighlightElements&&Array.isArray(window.__SSR_INLINE_COMMENTS_EVENTS_CAPTURE__.clickedInlineHighlightElements)){const e=window.__SSR_INLINE_COMMENTS_EVENTS_CAPTURE__.clickedInlineHighlightElements,t=e[e.length-1];t&&ne(t)}}catch(e){M.log`An error occurred when opening SSR Inline higlight - ${e}`}}),[E]);const re=(0,o.useCallback)((e=>{if(null==e||!e.target)return;const t=e.target,n=t.closest('[data-node-type="expand"]')||t.closest('[data-node-type="nestedExpand"]'),o=(null==n?void 0:n.querySelector(".expand-content-wrapper"))||(null==n?void 0:n.querySelector(".nestedExpand-content-wrapper")),a=null==o?void 0:o.querySelector(".active-highlight");"true"===(null==n?void 0:n.getAttribute("data-expanded"))&&a&&((0,w.o1)(),V(null))}),[V]);(0,o.useEffect)((()=>{const e=document.querySelector("#content");if(!e)return;e.addEventListener("click",oe);const t=document.querySelectorAll('button[aria-labelledby^="expand-title"]');return t&&t.forEach((e=>{e.addEventListener("click",re)})),()=>{e.removeEventListener("click",oe),t&&t.forEach((e=>{e.removeEventListener("click",re)}))}}),[oe,e]),(0,o.useEffect)((()=>{const e=document.querySelectorAll((0,w.YU)()),t={};new Set(Array.from(e).map((e=>(0,d.w)(e)))).forEach((n=>{const o=Array.from(e).filter((e=>(0,d.w)(e)===n));n&&(t[n]={start:o[0],end:o[o.length-1]})})),e.forEach((e=>{const n=(0,d.w)(e);if(n){E.includes(n)?(e.classList.add(w.EL),e===t[n].start&&e.classList.add(w.dX),e===t[n].end&&e.classList.add(w.QM)):(e.classList.remove(w.EL),e.classList.remove(w.dX),e.classList.remove(w.QM)),G.current===n?(e.classList.add(w.GR),G.current=null):!$.current&&F&&f[F]===n&&(e.classList.add(w.GR),$.current=!0)}})),O.nH.markFMP((0,v.es)("CFP-63.ssr-ttr")),O.nH.mark("highlightsRendered")}),[E,e,F,f]),(0,o.useEffect)((()=>{const t=document.querySelector(".ak-renderer-document");if(!t)return;if(document.querySelectorAll((0,w.YU)()).length>0)return;const n=t.querySelectorAll("p");let o,a,l;if(0===n.length)return;if(n.length<2?(o=(0,w._z)(n[0].textContent),a=(0,w.UO)(n[0]),l=n[0]):(o=(0,w._z)(n[1].textContent),a=(0,w.UO)(n[1]),l=n[1]),!a||!o)return;if(Q||W)return;if(!z||U||X)return;if(!(0,S.df)(x,"confluence.frontend.onboarding.collaborator-onboarding",D,!0))return;if(J||K({key:N.T.COLLABORATOR_ONBOARDING_INLINE_COMMENT_PAGE,value:e}),J!==e)return;const s=document.createElement("span");s.addEventListener("click",ae),s.setAttribute("id","onboarding-highlight"),s.style.cursor="pointer",s.style.backgroundColor=`var(--ds-background-accent-yellow-subtler, ${r.a8})`,s.style.borderBottom="2px solid var(--ds-border, rgba(255, 196, 0, 0.82))";const i=(0,w.GO)(s,o,a);return l.innerHTML="",l.appendChild(i),()=>{s.removeEventListener("click",ae)}}),[e,x,D,z,J,X,Q,W,U,K]);const le=E&&Array.isArray(E)?E.length:0;return p?null:o.createElement(o.Fragment,null,o.createElement(u.M,{key:`stop-${e}`,metric:O.nH,customData:{numberOfInlineComments:le}}),X&&J===e?null:o.createElement(T,null))},U=({pageId:e})=>o.createElement(E.k,{attribution:f.x.COLLABORATION},o.createElement(a.xs,{to:[g.l]},(t=>o.createElement(o.Fragment,null,o.createElement(C.q,{key:`start-${e}`,metric:O.nH}),o.createElement(D,{pageId:e,dialogs:t})))));U.displayName="InlineCommentsHighlighter"},552679:(e,t,n)=>{n.d(t,{T:()=>o});const o={COLLABORATOR_ONBOARDING_ELIGIBLE_USER:"collaborator-onboarding:isCollaboratorOnboardingEligibleUser",COLLABORATOR_ONBOARDING_INLINE_COMMENT_PAGE:"collaborator-onboarding:mockInlineCommentPageId",HAS_DISMISSED_INLINE_COMMENT:"collaborator-onboarding:hasDismissedInlineComment",INVITE_TO_EDIT_NUDGE_SEEN:"collaborator-onboarding:inviteToEditNudgeSeen",INVITE_TO_EDIT_NUDGE_SEEN_BUT_NOT_CLICKED:"collaborator-onboarding:inviteToEditNudgeSeenButNotClicked"}},92560:(e,t,n)=>{n.d(t,{df:()=>i,nJ:()=>s,w4:()=>c});var o=n(654927),a=n.n(o),r=n(719323),l=n(908990);function s({featureFlagClient:e,flagName:t,isUserLocaleCorrect:n,shouldTrackExposureEvent:o=!0,isStatSig:l=!1,exposureData:s}){const i=r.H.NOT_ENROLLED,c=n&&o,d=l?function(e,t,n){try{return a().getExperimentValue(e,"cohort",t,{fireExperimentExposure:n})}catch(o){return t}}(t,i,c):e.getVariantValue(t,{default:i,oneOf:Object.values(r.H),shouldTrackExposureEvent:c,exposureData:s});return d===r.H.EXPERIMENT&&n?n:d===r.H.ENROLLED}const i=(e,t,n,o=!0,a)=>s({featureFlagClient:e,flagName:t,isUserLocaleCorrect:(0,l.RV)(n),shouldTrackExposureEvent:o,exposureData:a}),c=(e,t,n=!0,o)=>s({featureFlagClient:e,flagName:t,isUserLocaleCorrect:!0,shouldTrackExposureEvent:n,exposureData:o})}}]);
//# sourceMappingURL=3071.eCyimhFlvI.js.map