"use strict";(self._cf=self._cf||[]).push([[82995],{725790:(e,o,r)=>{r.d(o,{w:()=>i});var t=r(840506),l=r(93972),n=r(747472),a=r(332072);const s=(0,l.defineMessages)({follow:{id:"profile.card.follow",defaultMessage:"Follow"},unfollow:{id:"profile.card.unfollow",defaultMessage:"Unfollow"},followTooltip:{id:"profile.card.follow.tooltip",defaultMessage:"See activity in feed"},unfollowTooltip:{id:"profile.card.unfollow.tooltip",defaultMessage:"Stop seeing activity in feed"}}),i=({followed:e})=>{const o=(0,n.Z)();return t.createElement(a.Z,{content:o.formatMessage(e?s.unfollowTooltip:s.followTooltip),position:"bottom"},t.createElement("span",null,o.formatMessage(e?s.unfollow:s.follow)))};i.displayName="FeedFollow"},310773:(e,o,r)=>{r.d(o,{K:()=>d});var t=r(615919),l=r(840506),n=r(822464),a=r(93972),s=r(142807),i=r(627521),c=r(213064);const u=(0,a.defineMessages)({followMutationErrorTitle:{id:"profile.card.feed.follow.mutation.error.title",defaultMessage:"We're having trouble doing that"},followMutationErrorDescription:{id:"profile.card.feed.follow.mutation.error.description",defaultMessage:"Try following or unfollowing this user again"}}),d=({feedConfigError:e,mutationError:o,showErrorFlag:r})=>l.createElement(l.Fragment,null,e?l.createElement(i.X,{error:e}):null,o?l.createElement(i.X,{error:o},l.createElement(n.xs,{to:[c.Q]},(e=>(r&&e.showErrorFlag({title:l.createElement(s.Z,(0,t.Z)({},u.followMutationErrorTitle)),description:l.createElement(s.Z,(0,t.Z)({},u.followMutationErrorDescription))}),null)))):null)},894280:(e,o,r)=>{r.d(o,{M:()=>f});var t=r(840506),l=r(167347),n=r(486889),a=r(582463),s=r(779076);const i=s.ZP`query FeedFollowQuery{getFeedUserConfig{accountIds}}`,c=s.ZP`mutation FeedFollowMutation($follow:[ID]$unfollow:[ID]){setFeedUserConfig(input:{followUsers:$follow unfollowUsers:$unfollow}){success}}`,u=e=>{var o;return null==e||null===(o=e.graphQLErrors)||void 0===o?void 0:o.some((e=>{var o,r;return(null==e||null===(o=e.path)||void 0===o?void 0:o.includes("getFeedUserConfig"))&&(null==e||null===(r=e.message)||void 0===r?void 0:r.includes("User not permitted to access Confluence"))}))};let d=!1;function f(){const{isLicensed:e}=(0,a.D)(),{createAnalyticsEvent:o}=(0,n._)(),{data:r,loading:s,error:f}=(0,l.aM)(i,{skip:!e||d,onError:e=>d=u(e)}),[p,{error:w}]=(0,l.Db)(c,{refetchQueries:["FeedFollowQuery"]}),g=null==r?void 0:r.getFeedUserConfig.accountIds,m=(0,t.useCallback)(((e,r,t)=>async()=>{if(e){o({type:"sendUIEvent",data:{action:"clicked",actionSubject:"button",actionSubjectId:"feedFollow",source:t,attributes:{id:e,settingType:"user",actionType:r?"unfollow":"follow"}}}).fire();try{r?await p({variables:{unfollow:[e]}}):await p({variables:{follow:[e]}})}catch(l){}}}),[p,o]);return{renderFeedFollow:!(s||f||d)&&e,loading:s,getToggleFollowUser:m,feedConfigError:f,mutationError:w,followedUsers:g}}},782995:(e,o,r)=>{r.d(o,{t:()=>b});var t=r(615919),l=r(840506),n=r(93972),a=r(142807),s=r(822464),i=r(486889),c=r(994074),u=r(688763),d=r(570489),f=r(734233),p=r(582463),w=r(213064),g=r(627521),m=r(894280),E=r(725790),v=r(675845),F=r(495302),h=r(310773);const y=(0,n.defineMessages)({viewProfile:{id:"profile.card.viewProfile",defaultMessage:"View profile"}}),b=({position:e="bottom-start",userId:o,isAnonymous:r=!1,canViewProfile:n=!0,children:b,trigger:C="hover"})=>{const{push:I}=(0,l.useContext)(f.M),{canViewUserProfile:M,error:U}=(0,u.t)(),P=U&&l.createElement(g.X,{error:U}),{userId:Z,cloudId:T,featureFlags:$}=(0,p.D)(),{createAnalyticsEvent:R}=(0,i._)(),{feedConfigError:A,followedUsers:N,getToggleFollowUser:L,mutationError:k,renderFeedFollow:D}=(0,m.M)();if(r||!n||!o||!Z||!M)return l.createElement(l.Fragment,null,P,b);const S={label:l.createElement(a.Z,(0,t.Z)({},y.viewProfile)),id:"view-profile",callback:()=>(0,F.Rq)(o).then(I),shouldRender:e=>!!e&&(e.status&&"inactive"!==e.status),link:(0,F.p)(o,"",d.b)},q=!(!o||null==N||!N.includes(o)),_={label:l.createElement(E.w,{followed:q}),id:"feed-follow-user",callback:L(o,q,"profileCard"),shouldRender:e=>D&&Boolean(o)&&o!==Z&&"active"===(null==e?void 0:e.status)};return l.createElement(s.xs,{to:[w.Q]},(r=>l.createElement(l.Fragment,null,P,l.createElement(h.K,{feedConfigError:A,mutationError:k,showErrorFlag:!0}),l.createElement(c.ZP,{cloudId:T,userId:o,resourceClient:(0,v.F)(T,$),position:e,trigger:C,actions:[S,_],reportingLinesProfileUrl:`${d.b}/people`,onReportingLinesClick:e=>{return o=e.accountIdentifier,R({type:"sendUIEvent",data:{source:"profileCardWrapper",action:"clicked",actionSubject:"viewProfile",actionSubjectId:"userProfileCard",attributes:{clickTarget:"userReportingLine"}}}).fire(),void(window.self!==window.top?window.open((0,F.p)(o,"",d.b),"_blank","noreferrer"):(0,F.Rq)(o).then(I,(()=>{})));var o},addFlag:e=>r.showFlag(e)},b))))};b.displayName="ProfileCardWrapper"},675845:(e,o,r)=>{r.d(o,{F:()=>v});var t=r(615919),l=r(318122),n=r(26304),a=r(336712),s=r(189445),i=r(784569);let c=function(e){return e.ANONYMOUS="ANONYMOUS",e.APP="APP",e.EXTERNAL="EXTERNAL",e.INTERNAL="INTERNAL",e.JSD="JSD",e}({});var u=r(779076),d=r(649567);const f=u.ZP`query UserProfileClientForConfluenceQuery($userId:ID){user(current:false id:$userId){id confluence{permissionType}}...ExternalCollaboratorEntitlementFragment}${d.$}`;var p=r(697674),w=r(734875);const g=(0,p.FO)({key:w.T1});class m extends n._l{async makeRequest(e,o){g.start();const r=(0,i.WQ)().query({query:f,variables:{userId:o}}),[l,n]=await Promise.allSettled([r,super.makeRequest(e,o)]);if("rejected"===n.status)return g.stop({customData:{success:!1}}),Promise.reject(n.reason);const u=[];if("fulfilled"===l.status){var d;const e=l.value.data;(0,s.D)(e)&&(null==e||null===(d=e.user)||void 0===d||null===(d=d.confluence)||void 0===d?void 0:d.permissionType)===c.EXTERNAL&&u.push((0,t.Z)((0,t.Z)({},a.ExternalUserLozengeProps),{},{key:"ExternalUserLozenge"}))}return g.stop({customData:{success:!0}}),(0,t.Z)((0,t.Z)({},n.value),{},{customLozenges:u})}}const E={url:"/gateway/api/directory/graphql",cacheSize:100,cacheMaxAge:3e5},v=(0,l.default)(((e,o)=>{const r=!0===o["confluence.frontend.enable.profilecard.with.atlas.features"]?(0,t.Z)((0,t.Z)({},E),{},{teamCentralUrl:"/gateway/api/watermelon/graphql",teamCentralBaseUrl:"https://team.atlassian.com",productIdentifier:"confluence",cloudId:e}):E;return new n.ZP(r,{userClient:new m(r)})}))},495302:(e,o,r)=>{r.d(o,{Cc:()=>a,Rq:()=>n,ns:()=>c,p:()=>l});var t=r(570489);const l=(e,o,r="")=>e?`${r}/people/${e}?ref=confluence${o?`&src=${encodeURIComponent(o)}`:""}`:"",n=async(e,o)=>e?`${t.b}/people/${e}?ref=confluence${o?`&src=${encodeURIComponent(o)}`:""}`:"",a=(e,o,r="")=>e?`${r}/people/team/${e}?ref=confluence${o?`&src=${encodeURIComponent(o)}`:""}`:"",s=e=>e.getAttribute("data-account-id"),i=e=>{const o={class:"className"},r={};return(e=>Array.from(e.attributes).map((e=>e.name)))(e).forEach((t=>{r[o[t]||t]=e.getAttribute(t)})),r.dangerouslySetInnerHTML={__html:e.innerHTML},r};function c(e){return e.filter(s).map((e=>{const o=i(e);o["data-user-hover-bound"]="true",o.href=l(o["data-account-id"],null);const r=window.document.createElement("span");return e.parentNode?(e.parentNode.replaceChild(r,e),{props:o,placeholder:r}):{}}))}},26304:(e,o,r)=>{r.d(o,{ZP:()=>n,_l:()=>l.ZP});r(963444);var t=r(116215),l=(r(951135),r(207684));const n=t.Z},994074:(e,o,r)=>{r.d(o,{ZP:()=>t});r(187258);const t=r(390077).Z}}]);
//# sourceMappingURL=82995.AOMWP4mjVh.js.map