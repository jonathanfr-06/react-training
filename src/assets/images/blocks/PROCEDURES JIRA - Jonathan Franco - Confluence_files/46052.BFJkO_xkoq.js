"use strict";(self._cf=self._cf||[]).push([[46052,45110,49534],{552110:(e,t,n)=>{n.d(t,{Ej:()=>p,NJ:()=>u,yW:()=>c});var r=n(840506),o=n(486889),a=n(166258),s=n(714912),i=n(3858),d=n(326102);const l="dataProvider",c=({connectHost:e})=>{const{createAnalyticsEvent:t}=(0,o._)();return(0,r.useEffect)((()=>{const n=(0,s.EO)();m({connectHost:e,createAnalyticsEvent:t,isViewPage:n})}),[e,t]),null},u=()=>{var e;return!(null===(e=window.connectHost)||void 0===e||!e.isModuleDefined(l))},m=({connectHost:e,createAnalyticsEvent:t,isViewPage:n})=>{const r={emitToDataProvider:async(...e)=>{var r,o;const a=e.length>1?e[0]:null,s=e.length>1?e[e.length-1]:e[0],l=null==s?void 0:s._context,c=null==l||null===(r=l.extension)||void 0===r||null===(r=r.options)||void 0===r||null===(r=r.productContext)||void 0===r?void 0:r["macro.localId"],u=null==l||null===(o=l.extension)||void 0===o?void 0:o.key,m=(0,d.r)({isViewPage:n,extensionKey:u});if(t(m).fire(),!u)throw Error("Missing Connect app extensionKey while transferring data.");const p=(0,i.v)();return s(await p.transfer(u,c,a,t,n))}};u()||e.defineModule(l,r)},p=async({logger:e,isViewPage:t,createAnalyticsEvent:n})=>{await new Promise((r=>{(0,a.N)(["wr!confluence.web.resources:querystring","wr!confluence.web.resources:navigator-context","wr!com.atlassian.plugins.atlassian-connect-plugin:confluence-atlassian-connect-resources-v5"],(()=>{const e=window.connectHost;m({connectHost:e,createAnalyticsEvent:n,isViewPage:t}),r()}),(()=>{e.error`Error loading WRM for dataProvider!`,r()}))}))}},326102:(e,t,n)=>{n.d(t,{K:()=>r,r:()=>o});const r=({isViewPage:e,extensionKey:t,error:n})=>({type:"sendTrackEvent",data:{containerType:"page",objectType:"connectAddon",source:e?"viewPageScreen":"editPageScreen",action:"failed",actionSubject:"connectRefEventDataValidation",attributes:{extensionKey:t,message:n.message}}}),o=({isViewPage:e,extensionKey:t})=>({type:"sendTrackEvent",data:{containerType:"page",objectType:"connectAddon",source:e?"viewPageScreen":"editPageScreen",action:"received",actionSubject:"connectRefEventData",attributes:{extensionKey:t}}})},3858:(e,t,n)=>{n.d(t,{v:()=>m});var r=n(199009);let o=function(e){return e.Success="Success",e.Error="Error",e}({});var a=n(794655);let s,i=!1;async function d(){return i||(s=await async function(){const e=(await(0,a.Z)()).filter((e=>null!=e.refDataSchema)).map((e=>[e.macroName,e.refDataSchema.outputType]));return new Map(e)}(),i=!0),s}var l=n(326102);let c;class u{constructor(){(0,r.Z)(this,"emit",void 0)}init({emit:e}){this.emit=e}static async validate(e,t){const{validateSchema:r,DataTransferValidationError:o}=await n.e(14050).then(n.bind(n,262542));if(!t.eventData)throw new o({message:"Passed data is missing 'eventData'."});const a=Object.keys(t.eventData);if(1!==a.length)throw new o({message:"'eventData' should only include a single key. The key should be same with 'refDataSchema.outputType'."});const s=await d();if(!s.has(e))throw new Error("extensionKey is not found in the macro metadata.");if(s.get(e)!==a[0])throw new o({message:`'eventData' should contain 'refDataSchema.outputType' defined in the app manifest (${s.get(e)}).`});r(a[0],t.eventData[a[0]])}async transfer(e,t,r,a,s){if(this.emit&&t&&r){const{DataTransferValidationError:d}=await n.e(14050).then(n.bind(n,262542));try{await u.validate(e,r)}catch(i){if(a((0,l.K)({isViewPage:s,extensionKey:e,error:i})).fire(),i instanceof d)return{status:o.Error,message:i.message,module:"data_provider",errors:i.errors};throw i}return this.emit(t,r.eventData),{status:o.Success,message:"Data accepted and emitted",module:"data_provider"}}return{status:o.Error,message:"There was an issue accepting the data",module:"data_provider"}}}const m=()=>(c||(c=new u),c)},695235:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{V:()=>evalLegacyConnectInlineScripts});var _confluence_wrm__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(166258);function evalLegacyConnectInlineScripts(container){return container?new Promise((resolve=>{const connectScripts=Array.from(container.querySelectorAll("script.ap-iframe-body-script")),macroScripts=Array.from(container.querySelectorAll("script.cc-macro-body-script")),allScripts=connectScripts.concat(macroScripts);allScripts.length>0?(0,_confluence_wrm__WEBPACK_IMPORTED_MODULE_0__.N)(["wr!confluence.web.resources:querystring","wr!confluence.web.resources:navigator-context","wr!com.atlassian.plugins.atlassian-connect-plugin:confluence-atlassian-connect-resources-v5"],(()=>{allScripts.forEach((elementScript=>{eval(elementScript.innerHTML)})),resolve(null)}),(()=>{0})):resolve(null)})):Promise.reject(new Error("evalLegacyConnectInlineScripts missing container argument"))}},458814:(e,t,n)=>{n.d(t,{r:()=>l});var r=n(615919),o=n(872342),a=n(840506),s=n(767001);const i=["as","style"];n(244677),n(242263),n(563952);const d=(0,a.forwardRef)(((e,t)=>{let{as:n="span",style:d}=e,l=(0,o.Z)(e,i);return a.createElement(n,(0,r.Z)((0,r.Z)({},l),{},{style:d,ref:t,className:(0,s.Z)(["_1e0c1o8l _4t3i1x4e _1bsbidpf",l.className])}))}));const l=({node:e,isSSR:t})=>{var n;const o=Boolean(null==e||null===(n=e.parameters)||void 0===n||null===(n=n.macroParams)||void 0===n||null===(n=n.hidden)||void 0===n?void 0:n.value),s=(e=>{var t;const n=null==e||null===(t=e.parameters)||void 0===t||null===(t=t.macroParams)||void 0===t||null===(t=t[""])||void 0===t?void 0:t.value;return"string"!=typeof n?null:n.replaceAll(/[%"']/g,"")})(e),i=!!s,l=t?{}:{name:s};return a.createElement(a.Fragment,null,!o&&i?a.createElement(d,null,a.createElement("a",(0,r.Z)({"data-group":"deeplink"},l))):null)}},597756:(e,t,n)=>{n.d(t,{L:()=>c});var r=n(615919),o=n(840506),a=n(925194),s=n(925192),i=n(612958),d=n(14136),l=n(150686);const c=({contentId:e,extensionKey:t,mode:n,node:c,spaceKey:u,appearance:m,showTemplateVariablesInPreview:p,showTemplateInputInPreview:v,Renderer:h,isLegacyRenderer:y,getExtensionHandlers:f})=>{var g;(0,i.Aw)([d.N.ClassicRendererLoader]);const E=Boolean(null==c||null===(g=c.parameters)||void 0===g||null===(g=g.macroParams)||void 0===g||null===(g=g.hidden)||void 0===g?void 0:g.value),I=(0,a.iQ)(c),w={type:"doc",version:1,content:null==c?void 0:c.content},b=f&&!y?f({adf:w,contentId:e,appearance:m,showTemplateInputInPreview:v,showTemplateVariablesInPreview:p}):void 0;return o.createElement("div",{"data-fabric-macro":(0,l.R)(c)},E?null:o.createElement(h,(0,r.Z)((0,r.Z)({},(0,l.o)(y,{contentId:e,document:w})),{},{showTemplateInputInPreview:v,showTemplateVariablesInPreview:p,extensionHandlers:b,appearance:m||"default",spaceKey:u})),o.createElement(s.N,{name:(0,a.ag)(n,c),extensionKey:t,mode:n,attributes:I,contentId:e}))};c.displayName="DetailsExtensionHandler"},138105:(e,t,n)=>{n.d(t,{G:()=>c});var r=n(615919),o=n(840506),a=n(925194),s=n(925192),i=n(612958),d=n(14136),l=n(150686);const c=({contentId:e,extensionKey:t,mode:n,node:c,spaceKey:u,appearance:m,showTemplateVariablesInPreview:p,showTemplateInputInPreview:v,Renderer:h,isLegacyRenderer:y,getExtensionHandlers:f})=>{var g;(0,i.Aw)([d.N.ClassicRendererLoader]);const E=null==c||null===(g=c.parameters)||void 0===g||null===(g=g.macroParams)||void 0===g||null===(g=g.hidden)||void 0===g?void 0:g.value,I="false"!==E&&Boolean(E),w=(0,a.iQ)(c),b={type:"doc",version:1,content:null==c?void 0:c.content},C=f&&!y?f({adf:b,contentId:e,appearance:m,showTemplateInputInPreview:v,showTemplateVariablesInPreview:p}):void 0;return o.createElement("div",{"data-fabric-macro":(0,l.R)(c)},I?null:o.createElement(h,(0,r.Z)((0,r.Z)({},(0,l.o)(y,{contentId:e,document:b})),{},{spaceKey:u,appearance:m||"default",allowStickyHeaders:!1,extensionHandlers:C,showTemplateInputInPreview:v,showTemplateVariablesInPreview:p})),o.createElement(s.N,{name:(0,a.ag)(n,c),extensionKey:t,mode:n,attributes:w,contentId:e}))};c.displayName="ExcerptExtensionHandler"},959:(e,t,n)=>{n.d(t,{f:()=>h});var r=n(615919),o=n(840506),a=n(142807),s=n(328167),i=n(872779),d=n(925194),l=n(925192),c=n(612958),u=n(14136),m=n(150686);const p={transition:"opacity 0.5s",height:"auto",opacity:1,paddingLeft:45},v={transition:"0s",height:0,opacity:0,overflow:"hidden",paddingLeft:45,pointerEvents:"none"},h=({contentId:e,extensionKey:t,mode:n,node:h,appearance:y,showTemplateVariablesInPreview:f,showTemplateInputInPreview:g,Renderer:E,isLegacyRenderer:I,getExtensionHandlers:w})=>{var b;(0,c.Aw)([u.N.ClassicRendererLoader]);const[C,N]=(0,o.useState)(!1),T=(0,o.useCallback)((()=>{N((e=>!e))}),[]);(0,o.useEffect)((()=>{C&&window.dispatchEvent(new Event("resize"))}),[C]);const S=(0,d.iQ)(h),x={type:"doc",version:1,content:null==h?void 0:h.content},A=null==h||null===(b=h.parameters)||void 0===b||null===(b=b.macroParams)||void 0===b?void 0:b.title,_=w&&!I?w({adf:x,contentId:e,appearance:y,showTemplateInputInPreview:g,showTemplateVariablesInPreview:f}):void 0;return o.createElement(o.Fragment,null,o.createElement(s.Z,{appearance:"link",iconBefore:o.createElement("div",{style:{transform:C?"rotate(90deg)":"rotate(0deg)",transition:"0.2s"}},o.createElement(i.default,{label:""})),onClick:T},void 0!==A?A:o.createElement(a.Z,{id:"content-renderer-extension-handlers.expand-macro.default-title",defaultMessage:"Click here to expand..."})),o.createElement("div",{style:C?p:v},o.createElement(E,(0,r.Z)((0,r.Z)({},(0,m.o)(I,{contentId:e,document:x})),{},{extensionHandlers:_,showTemplateInputInPreview:g,showTemplateVariablesInPreview:f}))),o.createElement(l.N,{name:(0,d.ag)(n,h),contentId:e,extensionKey:t,mode:n,attributes:S}))};h.displayName="ExpandExtensionHandler"},150686:(e,t,n)=>{n.d(t,{R:()=>o,o:()=>r});const r=(e,t)=>e?{adf:t.document,objectId:t.contentId}:t,o=e=>{var t;return null==e||null===(t=e.parameters)||void 0===t||null===(t=t.macroMetadata)||void 0===t||null===(t=t.macroId)||void 0===t?void 0:t.value}},119881:(e,t,n)=>{n.d(t,{Z:()=>m});var r=n(615919),o=n(946972),a=n(840506),s=n(925194),i=n(261198);const d=/(<iframe.*)\ssrc=((?:".*?")|(?:'.*?'))(.*>)/gim,l=/<iframe/gi,c=(0,a.memo)((({contentId:e,className:t,isInline:n,nodeProps:o,macroDataProps:s,macroRepresentation:c,macroRenderedOutput:u,style:m,children:p,featureFlags:v,extensionHandlers:h,mediaToken:y,ssredElement:f,delayIframe:g})=>{const E=n?"span":"div",I=null==o?void 0:o.ref,w=(0,a.useRef)(null);if((0,a.useLayoutEffect)((()=>{const e=w.current;e&&f&&(e.insertAdjacentElement("afterend",f),I&&"function"==typeof I&&I(f))}),[I,f]),((e,t)=>{(0,a.useLayoutEffect)((()=>{t&&(e?t.setAttribute("data-delay-iframe","true"):t.removeAttribute("data-delay-iframe"))}),[t,e]),(0,a.useEffect)((()=>{const n="data-delayed-src";if(t){const r=t.querySelector("iframe");if(r&&!e){const e=r.getAttribute(n);e&&(r.setAttribute("src",e),r.removeAttribute(n))}}}),[t,e])})(g,f),p)return a.createElement(E,(0,r.Z)((0,r.Z)({className:t,style:m},o),s),p);if("atlas_doc_format"===c)return u?a.createElement(E,(0,r.Z)((0,r.Z)((0,r.Z)({className:t,style:m},o),s),{},{"data-testid":"legacy-macro-adf"}),a.createElement(i.J,{document:JSON.parse(u),contentId:e,featureFlags:null!=v?v:{},extensionHandlers:h,mediaToken:y})):null;{if(f)return a.createElement("input",{type:"hidden",ref:w,"data-legacy-ssred-element-ref":!0});const e=g?(b=u)?b.split(l).map(((e,t)=>0===t?e:`<iframe${e}`.replace(d,"$1 data-delayed-src=$2$3"))).join(""):b:u;return a.createElement(E,(0,r.Z)((0,r.Z)((0,r.Z)((0,r.Z)({className:t,style:m,dangerouslySetInnerHTML:{__html:`${e}`}},o),s),g?{"data-delay-iframe":"1"}:{}),{},{"data-testid":"legacy-macro-element"}))}var b})),u=e=>{var t,n;const r=(null==e||null===(t=e.attrs)||void 0===t||null===(t=t.parameters)||void 0===t?void 0:t.macroParams)||{},o=(null==e||null===(n=e.attrs)||void 0===n?void 0:n.extensionKey)||"";let a=`macro${o}`;return"jira"!==o||r.key||r.count||(a+="Table"),a},m=(0,o.Z)(c,{target:"ey937e10"})('white-space:normal;p{white-space:normal;}[data-node-type="expand"]{margin-left:0px;margin-right:0px;}',(e=>("macrojiraTable"===u(e.adf)||"macroinclude"===u(e.adf))&&".ak-renderer-document > div.ak-renderer-extension {\n       width: 100% !important;\n     }")," ",(e=>"macroinclude"===u(e.adf)&&".ak-renderer-document .ak-renderer-extension-overflow-container .error {\n         padding: 5px;\n       }")," ",(e=>"macrojiraTable"===u(e.adf)&&"display: block;\n         max-width: 100%;\n         overflow-x: auto;\n         th {\n           word-break: normal;\n         }")," ",(e=>e.mode===s.Uw&&"position: relative; user-select: none;")," ",(e=>e.isInline?"clear: none;":"clear: both;")," ",(e=>e.mode===s._B&&e.isInline&&"display: inline-block; padding: 2px;")," ",(e=>"macroinclude"===u(e.adf)&&'.ak-renderer-document > .pm-table-container > .pm-table-wrapper {\n         padding: 0;\n         margin: 0;\n       }\n       .ak-renderer-document [data-testid="sticky-table-fixed"] > .pm-table-container {\n         margin-bottom: 0;\n       }\n       .ak-renderer-document [data-testid="sticky-table-fixed"] > .pm-table-container table {\n         margin-top: 0;\n       }')," table.confluenceTable{tr{th.confluenceTh:nth-child(1),td.confluenceTd:nth-child(1){padding-left:10px;}}}")},161176:(e,t,n)=>{n.d(t,{Nh:()=>l,Te:()=>d,Wd:()=>m,j6:()=>c});var r=n(840506),o=n(734233);const a=1e4,s=new Map,i=new Set;function d(){document.querySelectorAll("[data-fabric-macro][data-skate-created]").forEach((e=>{const t=e.getAttribute("data-fabric-macro");t&&s.set(t,e)}))}function l(){s.clear()}function c(){setTimeout(u,a)}function u(){for(const e of s.keys())i.has(e)||s.delete(e)}function m(e){const{transitionId:t}=(0,r.useContext)(o.M);i.add(e);return{ssredElement:t?void 0:s.get(e)}}},41798:(e,t,n)=>{n.d(t,{U:()=>A});var r=n(615919),o=n(840506),a=n(486889),s=n(586183),i=n(468542),d=n(743876),l=n(779894),c=n(142578),u=n(582463),m=n(584791),p=n(686692),v=n(119881),h=n(161176),y=n(59716);const f=({node:e,mode:t,contentId:n,featureFlags:r})=>o.createElement(y.n,{node:e});f.displayName="FabricLegacyMacrosServerLoader";var g=n(167347),E=n(621081),I=n(988167);var w=n(872342),b=n(104283);const C=(e,t)=>{var n;return(null==e||null===(n=e.attrs)||void 0===n||null===(n=n.parameters)||void 0===n||null===(n=n.macroParams)||void 0===n||null===(n=n._parentId)||void 0===n?void 0:n.value)||t};var N=n(83634);const T=["isMacroContentAndBody"],S=(e,t,n)=>{const r=(({adf:e,node:t,mode:n="RENDERER",contentId:r,featureFlags:o})=>{const a=e||(0,d.MK)(t),s=Boolean(o["confluence.frontend.fabric.editor.macro.adf.frontend.render"]);return{adf:(0,b.o)(a),mode:n.toUpperCase(),contentId:s?C(a,r):r,isMacroContentAndBody:s}})({node:t,contentId:e,featureFlags:n}),{isMacroContentAndBody:o}=r,a=(0,w.Z)(r,T),s=o?N.O:N.V,{data:i}=(0,g.aM)(s,{fetchPolicy:"cache-only",variables:a});return i};var x=n(569027);const A=({macroRenderedOutput:e,macroDefaultProps:t,containerRef:n,macroOutput:y,reuseSSRedElement:w})=>{var b,C,N,T,A,_,P,R,M,k,O,L,Z;const{featureFlags:D,cloudId:F,userId:B}=(0,u.D)(),z=y,{createAnalyticsEvent:H}=(0,a._)(),{node:K,contentId:U,mode:V,extensionKey:$}=t;Object.keys(K).forEach((e=>{void 0!==K[e]&&null!==K[e]||delete K[e]}));const j=null===(b=K.parameters)||void 0===b||null===(b=b.macroMetadata)||void 0===b||null===(b=b.macroId)||void 0===b?void 0:b.value,W=null===(C=K.parameters)||void 0===C||null===(C=C.macroParams)||void 0===C||null===(C=C.isMissingRequiredParameters)||void 0===C?void 0:C.value;(0,o.useEffect)((()=>{z&&H({type:"sendTrackEvent",data:{action:"viewed",actionSubject:"macro.with.macroOutput",source:"FabricLegacyMacrosServerRenderer",attributes:{extensionKey:$,contentId:U}}}).fire()}),[z,H,$,U]);const q=S(U,K,D),{ssredElement:G}=(0,h.Wd)(j),Q=e?e.filter((e=>(null==e?void 0:e.key)===j)):[];let J=(null==q||null===(N=q.macroBodyRenderer)||void 0===N?void 0:N.value)||(null===(T=Q[0])||void 0===T||null===(T=T.value)||void 0===T?void 0:T.value)||z;Boolean(D["confluence.frontend.scope-style-macro-in-fabric"])&&$&&e&&(J=(0,p.LC)(J,p.g1).contentWithScopedCSS);const X=function(e,t){var n;const r=null===(n=e.parameters)||void 0===n||null===(n=n.macroParams)||void 0===n?void 0:n.__bodyContent,o=e.type===i.OR&&Boolean(r),a=e.type===i.x9,s=(0,g.aM)(E.p,{variables:(0,I.W)({content:e.content,contentId:t}),fetchPolicy:"cache-only",skip:!a});var d;return a?s.data?{value:null===(d=s.data.contentConverter)||void 0===d?void 0:d.value}:{missing:!0}:o?{value:(null==r?void 0:r.value)||""}:{value:""}}(K,U),Y=W&&"tasks-report-macro"!==$;if(W&&"tasks-report-macro"===$&&(null===(A=K.parameters)||void 0===A||null===(A=A.macroParams)||void 0===A||!A.pages)&&(null===(_=K.parameters)||void 0===_||null===(_=_.macroParams)||void 0===_||!_.spaces)){const e={title:"Task report",macroName:$,icon:{height:80,location:"/download/resources/com.atlassian.confluence.plugins.confluence-inline-tasks/tasks-report-image-resources/task-report.png",relative:!0,width:80}};return o.createElement(m.y2,{isEditor:!1,macro:e,description:m.Ky})}if(!z&&Y)return null;const ee=q&&!X.missing;if(!z&&0===Q.length&&!ee)return(0,l.zX)(j,$),o.createElement(f,(0,r.Z)((0,r.Z)({},t),{},{featureFlags:D}));if(!J)return null;const te=(null==q||null===(P=q.macroBodyRenderer)||void 0===P||null===(P=P.webResourceDependencies)||void 0===P||null===(P=P.tags)||void 0===P?void 0:P.css)||(null===(R=Q[0])||void 0===R||null===(R=R.value)||void 0===R||null===(R=R.webresource)||void 0===R||null===(R=R.tags)||void 0===R?void 0:R.css),ne=(null==q||null===(M=q.macroBodyRenderer)||void 0===M||null===(M=M.webResourceDependencies)||void 0===M||null===(M=M.tags)||void 0===M?void 0:M.js)||(null===(k=Q[0])||void 0===k||null===(k=k.value)||void 0===k||null===(k=k.webresource)||void 0===k||null===(k=k.tags)||void 0===k?void 0:k.js),re=(0,d.MK)(t.node),oe=re.type===i.gU,ae={"data-fabric-macro":j,"data-macro-body":X.value,"data-macro-parameters":(0,d.Z6)(K),"data-skate-created":void 0},se={ref:n||null},ie=(null==q||null===(O=q.macroBodyRenderer)||void 0===O?void 0:O.representation)||(null===(L=Q[0])||void 0===L||null===(L=L.value)||void 0===L?void 0:L.representation)||"view",de="atlas_doc_format"===ie?(0,x.A)({adf:J,contentId:U,userId:B,cloudId:F}):void 0,le=null==q||null===(Z=q.macroBodyRenderer)||void 0===Z||null===(Z=Z.mediaToken)||void 0===Z?void 0:Z.token,ce={adf:re,isInline:oe,contentId:U,mode:V,extensionKey:$,macroRepresentation:ie,macroDataProps:ae,macroRenderedOutput:J,featureFlags:D,nodeProps:se,mediaToken:le,extensionHandlers:de,ssredElement:G,delayIframe:!0};return o.createElement(o.Fragment,null,te&&o.createElement("div",{key:"css-container","data-testid":"macro_css",dangerouslySetInnerHTML:{__html:`${te}`},style:{display:"none"}}),o.createElement(v.Z,(0,r.Z)({},ce)),o.createElement(s.YU,{macroId:j,renderType:(0,s.rc)(z,q)}),ne&&o.createElement("div",{"data-testid":"macro_js",dangerouslySetInnerHTML:{__html:`${(0,c.ac)(ne)}`},style:{display:"none"}}))};A.displayName="FabricLegacyMacrosServerRenderer"},59716:(e,t,n)=>{n.d(t,{n:()=>p});var r=n(615919),o=n(872342),a=n(840506),s=n(920839),i=n(767001),d=n(16728);const l=["as","style"],c=["as","style"];n(40592),n(778683),n(520700),n(114486),n(78517),n(878660),n(2155),n(234369),n(494834),n(563952);const u=(0,a.forwardRef)(((e,t)=>{let{as:n="span",style:c}=e,u=(0,o.Z)(e,l);return a.createElement(n,(0,r.Z)((0,r.Z)({},u),{},{style:(0,r.Z)((0,r.Z)({},c),{},{"--_1ur7qvb":(0,s.Z)(`var(--ds-skeleton, ${d.IR})`),"--_1nvt7kj":(0,s.Z)("var(--ds-space-050, 4px)")}),ref:t,className:(0,i.Z)(["_1e0c1o8l _bfhk18gw _2rko14y2 _1ul912am _4t3i10yn _1yt416re",u.className])}))}));const m=(0,a.forwardRef)(((e,t)=>{let{as:n="div",style:l}=e,u=(0,o.Z)(e,c);return a.createElement(n,(0,r.Z)((0,r.Z)({},u),{},{style:(0,r.Z)((0,r.Z)({},l),{},{"--_1ur7qvb":(0,s.Z)(`var(--ds-skeleton, ${d.IR})`),"--_1nvt7kj":(0,s.Z)("var(--ds-space-050, 4px)")}),ref:t,className:(0,i.Z)(["_1e0c1ule _bfhk18gw _2rko14y2 _1bsb1osq _1ul91wqb _4t3i10yn _1yt416re _vchhusvi",u.className])}))}));const p=({node:e})=>e&&"inlineExtension"===e.type?a.createElement(u,{"data-testid":"ext-skeleton"}):a.createElement(m,{"data-testid":"ext-skeleton"})},569027:(e,t,n)=>{n.d(t,{A:()=>_});var r=n(615919),o=n(840506),a=n(90651),s=n(468542),i=n(524119),d=n(925194),l=n(261198),c=n(116761),u=n(274997),m=n(597756),p=n(959),v=n(138105),h=n(458814),y=n(487173),f=n(612958),g=n(14136);const E=({contentId:e,extensionKey:t,mode:n,node:a,spaceKey:s,appearance:i,showTemplateVariablesInPreview:d,showTemplateInputInPreview:l,Renderer:c,getExtensionHandlers:u,featureFlags:m})=>{(0,f.Aw)([g.N.ClassicRendererLoader,g.N.ClassicEditorContextProviderLoader]);const p=(0,o.useMemo)((()=>({targetContentId:e,adf:t,mediaToken:n})=>{const r={type:"doc",version:1,content:t},a=u({adf:r,contentId:e,appearance:i,showTemplateInputInPreview:l,showTemplateVariablesInPreview:d});return o.createElement(c,{contentId:e,document:r,hasInlineComments:!1,showTemplateInputInPreview:l,showTemplateVariablesInPreview:d,extensionHandlers:a,appearance:i||"default",spaceKey:s,mediaToken:n})}),[u,i,l,d,s,c]),v={mode:n,contentId:e,spaceKey:s,extensionKey:t,macroNode:a,RendererWrapper:p,isLegacyRenderer:!1,featureFlags:m};return o.createElement(y.s,(0,r.Z)({},v))};E.displayName="ExcerptIncludeSSRExtensionHandler";var I=n(743876),w=n(163490);const b=({macroDefaultProps:e})=>{const{node:t}=e,n=(0,I.MK)(t);return o.createElement(w.q,{macroNode:n})};b.displayName="LiveSearchHandler";var C=n(411557);const N=({macroDefaultProps:e,adf:t,cloudId:n,userId:r})=>o.createElement(C.w,{userId:r,cloudId:n,adf:t,macroDefaultProps:e});N.displayName="TableOfContentsHandler";var T=n(358673);const S=({macroDefaultProps:e,adf:t,cloudId:n,userId:r,ssrButtonLabel:a})=>o.createElement(T.Q,{userId:r,cloudId:n,adf:t,macroDefaultProps:e,ssrButtonLabel:a});S.displayName="CreateFromTemplateHandler";var x=n(41798);const A={insertCss:e=>e._insertCss()},_=({adf:e,contentId:t,spaceKey:n,cloudId:r,userId:o,macroRenderedOutput:a,includeSuperbatch:i,featureFlagClient:d,showModernizedMacro:l})=>({[s.UE.MACRO_CORE]:R({adf:e,contentId:t,spaceKey:n,cloudId:r,userId:o,macroRenderedOutput:a,includeSuperbatch:i,featureFlagClient:d,showModernizedMacro:l}),[s.UE.MACRO_WITH_REFERENCES]:P(),[s.UE.MIGRATION]:P(),[s.UE.TEMPLATE]:P()}),P=()=>(0,i.V)((()=>null)),R=({adf:e,contentId:t,spaceKey:n,cloudId:y,userId:f,includeSuperbatch:g,macroRenderedOutput:I,featureFlagClient:w,showModernizedMacro:C})=>(0,i.V)((i=>{var T;const{extensionKey:P}=i,R={node:i,contentId:t,spaceKey:n,context:A,mode:d._B,extensionKey:P};g&&g();const M=(({macroRenderedOutput:e,macroDefaultProps:t,extension:n,cloudId:a,contentId:i,userId:d,adf:u,featureFlagClient:y,showModernizedMacro:f})=>{const g={[s.jK]:!(null==f||!f["excerpt-include"]),[s.Jg]:!(null==y||!y.getBooleanValue(s.Jg,{default:!1}))};function I(){const{buttonLabel:e,createButtonLabel:n}=t.node.parameters.macroParams;return(null==e?void 0:e.value)||(null==n?void 0:n.value)||void 0}function w(){var r;return o.createElement(x.U,{macroRenderedOutput:e,macroDefaultProps:t,macroOutput:null==n||null===(r=n.parameters)||void 0===r?void 0:r.macroOutput,reuseSSRedElement:!0})}return{[s.rI.TOC]:()=>o.createElement(N,{macroDefaultProps:t,adf:u,cloudId:a,userId:d}),[s.rI.CREATE_FROM_TEMPLATE]:()=>o.createElement(S,{macroDefaultProps:t,adf:u,cloudId:a,userId:d,ssrButtonLabel:I()}),[s.rI.LIVE_SEARCH]:()=>o.createElement(b,{macroDefaultProps:t}),[s.rI.DETAILS]:()=>o.createElement(m.L,(0,r.Z)((0,r.Z)({},t),{},{Renderer:l.J,isLegacyRenderer:!1,getExtensionHandlers:_})),[s.rI.EXPAND]:()=>o.createElement(p.f,(0,r.Z)((0,r.Z)({},t),{},{Renderer:l.J,isLegacyRenderer:!1,getExtensionHandlers:_})),[s.rI.EXCERPT]:()=>o.createElement(v.G,(0,r.Z)((0,r.Z)({},t),{},{Renderer:l.J,isLegacyRenderer:!1,getExtensionHandlers:_})),[s.rI.ANCHOR]:()=>o.createElement(h.r,(0,r.Z)((0,r.Z)({},t),{},{isSSR:!0})),[s.rI.DETAILS_SUMMARY]:()=>w(),[s.rI.EXCERPT_INCLUDE]:()=>i?o.createElement(E,(0,r.Z)((0,r.Z)({},t),{},{Renderer:l.J,getExtensionHandlers:_,featureFlags:g})):null,[s.rI.CHILDREN]:()=>{var e;return o.createElement(c.B,{contentId:i,params:null==n||null===(e=n.parameters)||void 0===e?void 0:e.macroParams,legacyMacroRenderer:w})},[s.rI.REDACTED_MACRO_PLACEHOLDER]:()=>null}})({adf:e,userId:f,contentId:t,cloudId:y,extension:i,macroDefaultProps:R,macroRenderedOutput:I,featureFlagClient:w,showModernizedMacro:C}),k=M[P];return o.createElement(a.DF,null,"function"==typeof k?o.createElement(u.I,{placeholderId:`ssr-extension-handler-placeholder-${P}`,tag:"div"},k()):o.createElement(x.U,{macroRenderedOutput:I,macroDefaultProps:R,macroOutput:null==i||null===(T=i.parameters)||void 0===T?void 0:T.macroOutput}))}))},358673:(e,t,n)=>{n.d(t,{Q:()=>o,p:()=>a});var r=n(940155);const o=(0,r.tM)({__loadable_id__:"yxXRw",name:"CreateFromTemplateLoader",loader:async()=>(await Promise.all([n.e(12705),n.e(91192),n.e(45523),n.e(99845)]).then(n.bind(n,517846))).CreateFromTemplate}),a=(0,r.ZR)({__loadable_id__:"HG0f0",name:"LazyCreateFromTemplateLoader",loader:async()=>(await Promise.all([n.e(12705),n.e(91192),n.e(45523),n.e(99845)]).then(n.bind(n,517846))).CreateFromTemplate})},458237:(e,t,n)=>{n.d(t,{L:()=>r});const r=n(840506).createContext({})},256944:(e,t,n)=>{n.d(t,{$W:()=>d,CO:()=>c,FS:()=>v,JW:()=>m,L4:()=>s,Ov:()=>l,UK:()=>r,Yo:()=>p,ed:()=>o,rA:()=>i,y1:()=>u,yr:()=>a});const r="confluence.frontend.extension.config-panel.opt-out",o="confluence.frontend.fabric.editor.add-column-custom-step",a="confluence.frontend.fabric.editor.enable-sticky-table-headers",s="confluence.frontend.connect.macro.view-as-forge",i="confluence.frontend.connect.macro.save-as-forge",d="confluence.frontend.fabric.editor.macro.adf.frontend.render",l="confluence.frontend.preload.draft.body.content.next.editor",c="confluence.frontend.fabric.editor.inline-edit",u="confluence.frontend.fabric.editor.editor-plugin-ai",m="platform.ai.enable-ai-upsell",p="confluence.frontend.fabric.editor.composable-template-editor",v="confluence.frontend.fabric.editor.composable-embedded-editor"},116349:(e,t,n)=>{n.d(t,{E:()=>a,e:()=>s});var r=n(199009),o=n(840506);class a{static init(e,t){if(null===this.macroActions){const e=e=>{var t;const n=null==e||null===(t=e._context)||void 0===t||null===(t=t.extension)||void 0===t||null===(t=t.options)||void 0===t||null===(t=t.productContext)||void 0===t?void 0:t["macro.id"];if(!n)throw new Error("No macro ID found in the call.");return n},n=(e,t)=>{var n;const r=this.macrosCache.get(t);if("function"!=typeof(null==r||null===(n=r.actions)||void 0===n?void 0:n[e]))throw new Error("Failed to execute this method. Please ensure that you are calling this method from within a multi-body extension inside your Connect application.");return r.actions[e]},r=e=>{const t=this.macrosCache.get(e);if(t&&t.readonly)throw new Error("This method is not allowed in view mode");return!0},o=e=>Object.assign(e,{returnsPromise:!0});this.macroActions={addBody:o(((...o)=>{try{const t=o[o.length-1],a=e(t);r(a);const s=n("addChild",a);return Promise.resolve(s())}catch(a){return t(a.toString()),Promise.reject(a)}})),removeBody:o(((...o)=>{try{if(2!==o.length||"number"!=typeof o[0])throw new Error("The removeBody method expects an index number as its argument.");const[t,a]=o,s=e(a);r(s);const i=n("removeChild",s);return Promise.resolve(i(t))}catch(a){return t(a.toString()),Promise.reject(a)}})),showBody:o(((...r)=>{try{var o,a;if(2!==r.length||"number"!=typeof(null===(o=r[0])||void 0===o?void 0:o.body)||"number"!=typeof(null===(a=r[0])||void 0===a?void 0:a.frame))throw new Error("The showBody method expects an object with body and frame properties as its argument.");const[t,s]=r,i=e(s),d=n("changeActive",i);return Promise.resolve(d(t.body))}catch(s){return t(s.toString()),Promise.reject(s)}})),getBodyCount:o(((...r)=>{try{const t=r[r.length-1],o=e(t),a=n("getChildrenCount",o);return Promise.resolve(a())}catch(o){return t(o.toString()),Promise.reject(o)}})),getParameters:o(((...n)=>{try{const t=n[n.length-1],r=e(t),o=this.macrosCache.get(r);if(!o)throw new Error("Failed to execute this method. Please ensure that you are calling this method from within a multi-body extension inside your Connect application.");return Promise.resolve(JSON.parse(o.parameters))}catch(r){return t(r.toString()),Promise.reject(r)}})),updateParameters:o(((...o)=>{try{if(2!==o.length||!o[0]||"object"!=typeof o[0])throw new Error("The updateParameters method expects an object with macro parameters as its argument.");const[t,a]=o,s=e(a);r(s);const i=n("updateParameters",s);return Promise.resolve(i(t))}catch(a){return t(a.toString()),Promise.reject(a)}}))}}e.isModuleDefined(this.macroName)||e.defineModule(this.macroName,this.macroActions)}static register(e,t,n,r){this.macrosCache.has(e)||this.macrosCache.set(e,{actions:n,parameters:t,readonly:r})}static deregister(e){this.macrosCache.has(e)&&this.macrosCache.delete(e)}static cleanCache(){this.macrosCache.clear()}}(0,r.Z)(a,"macroName","macro"),(0,r.Z)(a,"macroActions",null),(0,r.Z)(a,"macrosCache",new Map);const s=({connectHost:e})=>((0,o.useEffect)((()=>(a.init(e,console.warn),()=>{a.cleanCache()})),[e]),null)},712842:(e,t,n)=>{n.d(t,{P:()=>r});const r="confluence.frontend.ecosystem.multi-bodied-macro"},225464:(e,t,n)=>{n.d(t,{W:()=>i});var r=n(840506),o=n(142807),a=n(292139),s=n(570047);class i extends r.PureComponent{render(){const{shouldPanelBeDisplayed:e,targetContentTitle:t}=this.props;return e?r.createElement("span",{"data-testid":"excerpt-include-panel",style:s.Bn},r.createElement("span",{style:s.HE},t||r.createElement(o.Z,{id:"editor.excerpt.include.panel.title.loading"})),r.createElement("span",{style:s.p1},r.createElement(a.L,{size:"medium",style:{minHeight:100}}))):r.createElement(a.L,{size:"medium",style:{minHeight:100}})}}i.displayName="ExcerptIncludeComponentShadow"},487173:(e,t,n)=>{n.d(t,{s:()=>a});var r=n(940155),o=n(225464);const a=(0,r.tM)({__loadable_id__:"-_isu",name:"ExcerptIncludeLoader",loader:async()=>(await Promise.all([n.e(12705),n.e(18831)]).then(n.bind(n,399217))).ExcerptInclude,loading:o.W})},570047:(e,t,n)=>{n.d(t,{Bn:()=>o,HE:()=>a,p1:()=>s,zD:()=>i});var r=n(16728);const o={display:"block",borderWidth:"1px",borderRadius:"3px",borderStyle:"solid",borderColor:"var(--ds-border, rgb(193, 199, 208))",borderImage:"initial"},a={display:"block",backgroundColor:"var(--ds-background-accent-gray-subtlest, rgb(244, 245, 247))",minWidth:"128px",padding:"var(--ds-space-100, 8px)",fontSize:"16px"},s={display:"block",minWidth:"128px",borderWidth:"1px 0px 0px 0px",borderStyle:"solid",borderColor:"var(--ds-border, rgb(193, 199, 208))",padding:"var(--ds-space-100, 8px)"},i={color:`var(--ds-text-subtlest, ${r.TG})`,paddingLeft:"var(--ds-space-050, 4px)"}},695903:(e,t,n)=>{n.d(t,{jX:()=>i,vs:()=>l,yG:()=>d});var r=n(840506),o=n(887922),a=n(468542);const s=r.createContext({indexes:new Map}),i="UNKNOWN",d=({document:e,children:t})=>{const n=(0,r.useMemo)((()=>{const t=(n=e,(0,o.h)(n,(e=>a.j7.has(e.type))));var n;return new Map(t.map(((e,t)=>{var n,r;return window.unsupportedExtension=window.unsupportedExtension||{},null!==(n=e.attrs)&&void 0!==n&&null!==(n=n.parameters)&&void 0!==n&&null!==(n=n.nestedContent)&&void 0!==n&&n.content&&"__confluenceADFMigrationUnsupportedContentInternalExtension__"===e.attrs.extensionKey&&e.attrs.parameters.nestedContent.content.forEach((e=>{var n;window.unsupportedExtension[null===(n=e.attrs)||void 0===n||null===(n=n.parameters)||void 0===n||null===(n=n.macroMetadata)||void 0===n||null===(n=n.macroId)||void 0===n?void 0:n.value]=t})),[null===(r=e.attrs)||void 0===r||null===(r=r.parameters)||void 0===r||null===(r=r.macroMetadata)||void 0===r||null===(r=r.macroId)||void 0===r?void 0:r.value,t]})))}),[e]),i=(0,r.useMemo)((()=>({indexes:n})),[n]);return r.createElement(s.Provider,{value:i},t)};d.displayName="ExtrensionIndexProvider";const l=e=>{const{indexes:t}=(0,r.useContext)(s);let n=t.get(e);const o=window.unsupportedExtension;let a=!1;return o&&o[e]&&(n=o[e],a=!0),{extensionIndex:"number"==typeof n?n:i,isUnsupportedExtension:a}}},586183:(e,t,n)=>{n.d(t,{Xk:()=>o,YU:()=>a,rc:()=>r});const r=(e,t)=>e?"ssr-new":t?"ssr-exp":"ssr-legacy",o=e=>{var t;return null===(t=window.__LEGACY_MACRO_SSRED__)||void 0===t?void 0:t[e]},a=({macroId:e,renderType:t})=>null},14469:(e,t,n)=>{n.d(t,{M:()=>h});var r=n(840506),o=n(487696),a=n(243578),s=n(779894),i=n(744209),d=n(697674),l=n(734875);const c=(0,d.zG)({key:l.CW});var u=n(695903),m=n(586183);const p="none",v=e=>{if(!e)return!1;const t=e.getBoundingClientRect();return t.top>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)},h=({node:e,contentId:t,extensionKey:n})=>{var d;const{routeName:l}=(0,r.useContext)(o.z1),{localId:h}=e,y=null===(d=e.parameters)||void 0===d||null===(d=d.macroMetadata)||void 0===d||null===(d=d.macroId)||void 0===d?void 0:d.value,f=(0,i.h)("confluence.frontend.extensions.server-render-top-x.blocklist")||"",g=(0,r.useRef)(null),{extensionIndex:E,isUnsupportedExtension:I}=(0,u.vs)(y),w=E===u.jX||E>=10;return(0,r.useEffect)((()=>{var e,r,o,i,d;if(w||!(0,a.W)())return;const l=(0,a.W)()?null===(e=performance.getEntriesByName("rendererRendered.end").pop())||void 0===e?void 0:e.startTime:null===(r=performance.getEntriesByName("browser-metric:tti").pop())||void 0===r?void 0:r.duration,u=(0,a.W)()?null===(o=performance.getEntriesByName("CFP-63.ssr-ttr").pop())||void 0===o?void 0:o.startTime:l,f=null===(i=performance.getEntriesByName("browser-metric.start").pop())||void 0===i?void 0:i.startTime,b=(0,s.FC)(y)||"",C=(0,a.W)()?(0,m.Xk)(y)||(e=>null!=e&&e.startsWith("blocklist")?"ssr-blocked":p)(b):p,N=null!==(d=(0,a.W)()?u:f)&&void 0!==d?d:0,T={isExtensionSSRed:C,extensionIndex:E,extensionKey:n,contentId:t,pageFMP:null!=u?u:0,pageTTI:null!=l?l:0,isATF:v(g.current),ssrPreloadFailure:I?"unsupportedContentInternalExtension":b,clientRouteStart:null!=f?f:0},S=c(`${n}.${t}.${h}`);S.start({startTime:N}),S.stop({customData:T})}),[w,f,n,E,I,l,h,t,y]),r.createElement("span",{ref:g})};h.displayName="ExtensionLoadingComplete"},973105:(e,t,n)=>{n.d(t,{N:()=>r});const r=n(840506).createContext({shouldRefetchMacroQuery:!1})},147674:(e,t,n)=>{n.d(t,{b:()=>fe});var r=n(615919),o=n(199009),a=n(329687),s=n.n(a),i=n(840506),d=n(911492),l=n(944480),c=n(443037),u=n.n(c),m=n(142807),p=n(784569),v=n(614889),h=n(582463),y=n(59716),f=n(925194),g=n(190206),E=n(132464),I=n(743876),w=n(468542),b=n(256944),C=n(621081),N=n(988167),T=n(83634),S=n(104283),x=n(486889),A=n(98576),_=n(166258),P=n(695235),R=n(261198),M=n(161176),k=n(41798),O=n(119881),L=n(686692),Z=n(193795),D=n(14469),F=n(608553),B=n(925192),z=n(15385),H=n(683400),K=n(458237),U=n(552110),V=n(712842),$=n(804929),j=n(9019),W=n(116349);const q=({macroId:e,macroParams:t,editorActions:n,readonly:r=!1})=>((0,i.useEffect)((()=>{if(n)return W.E.register(e,t,n,r),()=>{W.E.deregister(e)};(0,$.UJ)().submitError(new Error(`No editor actions has been provided to MultiBodiedExtensionHandler for macro ${e}.`),{attribution:j.x.ECOSYSTEM})}),[e,t,n,r]),null);var G=n(548854),Q=n.n(G),J=n(714912);const X=e=>{const t=e.split("__");return 3===t.length?t[1]:"UNKOWN_EXTENSION_KEY"},Y=({references:e,macroContainer:t})=>{const[n,r]=(0,i.useState)(null),{createAnalyticsEvent:o}=(0,x._)();(0,i.useEffect)((()=>{n&&Array.isArray(e)&&e.length>0&&((e,t,n)=>{const r={id:t},o={eventData:e};n({type:"sendTrackEvent",data:{containerType:"page",objectType:"connectAddon",source:(0,J.EO)()?"viewPageScreen":"editPageScreen",action:"broadcasted",actionSubject:"connectRefEventData",attributes:{extensionKey:X(t)}}}).fire(),Q().connectHost.broadcastEvent("data_provider",r,o)})(e,n,o)}),[e,n,o]);const a=(0,i.useCallback)((e=>{var n,o,a,s,i;if("event_query"!==(null===(n=e.data)||void 0===n?void 0:n.type)||null===(o=e.data)||void 0===o||!o.eid||null===(a=e.data)||void 0===a||null===(a=a.args)||void 0===a||null===(s=a.includes)||void 0===s||!s.call(a,"data_provider"))return;const d=document.getElementById(e.data.eid);d&&null!=t&&null!==(i=t.contains)&&void 0!==i&&i.call(t,d)&&r(e.data.eid)}),[t,r]);return(0,i.useEffect)((()=>(Q().addEventListener("message",a),()=>{Q().removeEventListener("message",a)})),[a]),null};var ee=n(113930),te=n(583192);const ne=({error:e,mode:t,extensionKey:n,node:r,contentId:o})=>i.createElement(i.Fragment,null,i.createElement(te.M,{extensionKey:n,error:e||Error(`Unable to render ${n}`),mode:t,attributes:(0,f.iQ)(r),contentId:o,name:(0,f.ag)(t,r)}),i.createElement("div",{style:{display:"flex",backgroundColor:"var(--ds-background-neutral-subtle, #F4F5F7)",borderRadius:5,minWidth:200,padding:5}},i.createElement(ee.default,{label:"",size:"medium"}),i.createElement("span",{style:{paddingLeft:5}},i.createElement(m.Z,{id:"fabric-extension-legacy-macro-renderer.legacymacrorenderer.error",defaultMessage:"Failed to get macro details"}))));ne.displayName="LegacyMacroRendererError";var re=n(744209);const oe=(e,t,n)=>{var r;const o=null!==(r=(0,re.h)("confluence.frontend.open-macro-links-in-new-tab-allowlist"))&&void 0!==r?r:"",a=(0,i.useMemo)((()=>{const e=new Set;return n?(o.split(",").map((e=>e.trim().toLowerCase())).forEach((t=>t&&e.add(t))),e):e}),[o,n]);(0,i.useEffect)((()=>{if(!n||!t)return;if(null==a||!a.has(e.toLowerCase()))return;function r(e){(e=>{if(!e)return!1;const t=new URL(e);return t.origin!==window.location.origin||!t.pathname.includes("/wiki/rest/api")&&!t.pathname.includes("changes.action")&&!t.pathname.includes("confirmattachmentremoval.action")&&(t.pathname.includes(".action"),!0)})(this.href)&&(e.preventDefault(),window.open(this.href,"_blank","noopener, noreferrer"))}const o=t.querySelectorAll("a");return null==o||o.forEach((e=>{e.addEventListener("click",r)})),()=>{null==o||o.forEach((e=>{e.removeEventListener("click",r)}))}}),[t,a,e,n])},ae=/data-macro-id="([0-9a-fA-F\-]+?)"/,se=/macro\.id\\":\\"([0-9a-fA-F\-]+?)\\"/,ie=(0,v.j)("LegacyMacroRenderer"),de=()=>i.createElement("div",{style:{position:"absolute",top:0,bottom:0,left:0,right:0,cursor:"default",zIndex:2}});de.displayName="Overlay";const le=["include","contentbylabel","children","content-report-table","tasks-report-macro","recently-updated-dashboard","recently-updated"],ce=(0,H.i)((({adf:e,macroRepresentation:t,macroRenderedOutput:n,mode:o,node:a,contentId:s,attributes:d,experienceName:l,featureFlags:c,webresource:u,body:m,parameters:p,navigationPolicy:v,references:h,multiBodiedExtensionActions:y,macroRenderedOutputFromSSR:g,macroOutput:E,context:I,spaceKey:b,providers:C,mediaToken:N,noOverlay:T,isWithinEditor:S})=>{var H,K;const{createAnalyticsEvent:$}=(0,x._)(),j=e.type===w.gU,W=e.type===w.pN,G=(null==e||null===(H=e.attrs)||void 0===H?void 0:H.extensionKey)||"",Q=(0,i.useRef)(null);n||(n="");Boolean(c["confluence.frontend.scope-style-macro-in-fabric"])&&G&&n&&(n="style"===G?(0,L.LC)(n,L.g1,/(<style[^>]*>)((.|\n|\r)*?)(<\/style>)/gm).contentWithScopedCSS:(0,L.LC)(n,L.g1).contentWithScopedCSS);const J=(e=>{var t;const n=null!==(t=(0,re.h)("confluence.frontend.extension-overlay-removal-list"))&&void 0!==t?t:"";return(0,i.useMemo)((()=>!(!e||!n)&&n.split(",").map((e=>e.trim().toLowerCase())).includes(e.toLowerCase())),[e,n])})(G),X=Boolean(c[V.P]),[ee,te]=(0,i.useState)("gadget"===G?"":n),[ce,ue]=(0,i.useState)(null);(0,i.useEffect)((()=>{if(ce){(async()=>{if(!(0,U.NJ)()){const e=o===f._B;await(0,U.Ej)({logger:ie,isViewPage:e,createAnalyticsEvent:$})}await(0,z.bS)(u,g,E,(()=>{ee!==n&&te(n)}),null==Q?void 0:Q.current)})(),(0,P.V)(ce),(async e=>{"calendar"===e&&(0,_.N)((0,z.CT)(),(()=>{try{window.require("tc/init-resources").requireResources()}catch(e){ie.error(e)}}),(()=>{ie.error`Error loading team calendar WRM!`}))})(G)}}),[u,G,n,ee,ce,Q,g,E,o,$]),oe(null!=G?G:"",ce,o===f.Uw);const me=((e,t)=>{var n,r,o;const a=null==e||null===(n=e.attrs)||void 0===n||null===(n=n.parameters)||void 0===n||null===(n=n.macroMetadata)||void 0===n||null===(n=n.macroId)||void 0===n?void 0:n.value;if(a)return a;let s=ae.exec(t||"");return null!==(r=s)&&void 0!==r&&r[1]?s[1]:(s=se.exec(t||""),null!==(o=s)&&void 0!==o&&o[1]?s[1]:(ie.error`Cannot find macro id from ${t}`,""))})(e,n),{ssredElement:pe}=(0,M.Wd)(me),ve={ref:ue},he={"data-fabric-macro":me,"data-macro-body":m||"","data-macro-parameters":p||"","data-node-type":"include"===G?"include":void 0},ye=(e,t)=>{var n;return(null==e||null===(n=e.attrs)||void 0===n||null===(n=n.parameters)||void 0===n||null===(n=n.macroParams)||void 0===n||null===(n=n._parentId)||void 0===n?void 0:n.value)||t},{getExtensionHandlers:fe}=C,ge=fe?fe({adf:"atlas_doc_format"==t?g||E||n:e,contentId:ye(e,s),spaceKey:b,macroRenderedOutput:g||E||n,shouldIncludeMacroWithReferencesHandlers:!0,referentialityDataSourceProvider:new A.LX,mediaToken:N}):{},Ee={adf:e,isInline:j,contentId:ye(e,s),mode:o,extensionKey:G,nodeProps:ve,macroRepresentation:t,macroDataProps:he,macroRenderedOutput:ee,extensionHandlers:ge,mediaToken:N,ssredElement:pe,delayIframe:!1};if(o===f._B||o===f.g5){var Ie;try{const e=null!=d&&d.macroId?d.macroId:"",t=null!=d&&d.type?d.type:"none";$({type:"sendTrackEvent",data:{action:"renderer",actionSubject:"macro",source:"legacyMacroRenderer",attributes:{mode:o,extensionKey:G,macroId:e,contentId:s,type:t}}}).fire()}catch(Ne){ie.error`An error occurred while firing the analytics event for legacyMacroRendererComponent: ${Ne}`}if(g||E){const e={node:a,context:I,references:h,contentId:s,spaceKey:b||"",mode:f._B,extensionKey:G,attributes:d};return i.createElement(i.Fragment,null,i.createElement(Y,{references:h,macroContainer:ce}),i.createElement(D.M,{extensionKey:(null==d?void 0:d.extensionKey)||G,contentId:s,node:a}),i.createElement(k.U,{macroRenderedOutput:g,macroDefaultProps:e,containerRef:ue,macroOutput:E}),i.createElement(F.Z,{node:ce}),"attachments"===G&&i.createElement(Z.w.Consumer,null,(({EditorLoaderLoader:e})=>!S&&e&&i.createElement(e,null))),i.createElement(B.N,{name:l,contentId:s,extensionKey:G,mode:o,attributes:d}))}return i.createElement(i.Fragment,null,i.createElement(Y,{references:h,macroContainer:ce}),X&&W&&i.createElement(q,{macroId:me,macroParams:p,editorActions:y,readonly:!0}),i.createElement("div",{dangerouslySetInnerHTML:{__html:`${(null==u||null===(Ie=u.tags)||void 0===Ie?void 0:Ie.css)||""}`},style:{display:"none"}}),i.createElement(D.M,{extensionKey:(null==d?void 0:d.extensionKey)||G,contentId:s,node:a}),i.createElement(O.Z,(0,r.Z)((0,r.Z)({},Ee),{},{macroRenderedOutput:le.includes(G)?v.shimHtmlUrls(ee):ee})),i.createElement(F.Z,{node:ce}),"attachments"===G&&i.createElement(Z.w.Consumer,null,(({EditorLoaderLoader:e})=>!S&&e&&i.createElement(e,null))),i.createElement("div",{key:"js-container",ref:Q,style:{display:"none"}}),i.createElement(B.N,{name:l,contentId:s,extensionKey:G,mode:o,attributes:d}))}let we,be,Ce;try{"atlas_doc_format"===t&&(we=JSON.parse(ee),Ce=i.createElement(R.J,{document:we,contentId:ye(e,s),featureFlags:null!=c?c:{},extensionHandlers:ge,mediaToken:N}))}catch(Te){be=Te,ie.error`An error occurred while parsing adf output: ${ee}`,Ce=i.createElement(ne,{error:be,node:a,mode:o,extensionKey:G,contentId:s})}return i.createElement(i.Fragment,null,i.createElement("div",{dangerouslySetInnerHTML:{__html:`${(null==u||null===(K=u.tags)||void 0===K?void 0:K.css)||""}`},style:{display:"none"}}),X&&W&&i.createElement(q,{macroId:me,macroParams:p,editorActions:y}),i.createElement(O.Z,(0,r.Z)({},Ee),T||J||W?null:i.createElement(de,null),i.createElement(Y,{references:h,macroContainer:ce}),"atlas_doc_format"===t?i.createElement("div",{ref:ue},Ce):i.createElement("div",{ref:ue,dangerouslySetInnerHTML:{__html:`${ee}`}}),i.createElement(B.N,{name:l,contentId:s,extensionKey:G,mode:o,attributes:d})),i.createElement("div",{key:"js-container",ref:Q,style:{display:"none"}}))})),ue=e=>{var t;const n=(0,i.useContext)(Z.w),o=(0,i.useContext)(K.L),a=null!==(t=null==o?void 0:o.isWithinEditor)&&void 0!==t&&t,s=(0,r.Z)((0,r.Z)({},o),n),d=(0,r.Z)((0,r.Z)({},e),{},{providers:s,isWithinEditor:a});return i.createElement(ce,(0,r.Z)({},d))};ue.displayName="LegacyMacroRendererComponent";const me=(0,n(93972).defineMessages)({highlightedPageIncludeRenderedError:{id:"fabric-extension-legacy-macro-renderer.legacy-macro-renderer-query.highlightedPageIncludeError",defaultMessage:"Unable to render { include }"},nonhighlightedPageIncludeRenderedError:{id:"fabric-extension-legacy-macro-renderer.legacy-macro-renderer-query.nonhighlightedPageIncludeRenderedError",defaultMessage:"Already included page ''{pageTitle}'', stopping."}});var pe=n(973105);const ve=i.createContext({listOfRenderedPageIncludeNodes:[]}),he=e=>e.type===w.x9;class ye extends i.Component{constructor(...e){super(...e),(0,o.Z)(this,"state",{body:"",hasBodyBeenFetched:!1}),(0,o.Z)(this,"logger",(0,v.j)("LegacyMacroRendererQuery")),(0,o.Z)(this,"getQueryForMacroContentAndBodyForPossibleFrontendRendering",((e,t,n,o,a,s,l,c,u,p,v,h,g,E)=>i.createElement(d.AE,{query:T.O,variables:(0,r.Z)((0,r.Z)({adf:(0,S.o)(e)},"0"!==t?{contentId:this.getContentId(e,t)}:{}),{},{mode:o&&o.toUpperCase()}),fetchPolicy:g?"no-cache":"cache-first",context:{throttle:!0,allowOnExternalPage:!0},skip:Boolean(u)||Boolean(p)},(({data:d,loading:g,error:w})=>{var b,C,N,T;return u||p?i.createElement(ue,{contentId:t,experienceName:(0,f.ag)(o,a),adf:e,attributes:(0,f.iQ)(a),references:s,multiBodiedExtensionActions:l,macroRenderedOutput:null==d||null===(b=d.macroBodyRenderer)||void 0===b?void 0:b.value,macroRepresentation:(null==d||null===(C=d.macroBodyRenderer)||void 0===C?void 0:C.representation)||"view",mediaToken:null==d||null===(N=d.macroBodyRenderer)||void 0===N||null===(N=N.mediaToken)||void 0===N?void 0:N.token,node:a,webresource:null==d||null===(T=d.macroBodyRenderer)||void 0===T?void 0:T.webResourceDependencies,mode:o,body:this.state.body,parameters:(0,I.Z6)(a),featureFlags:c,macroRenderedOutputFromSSR:u,macroOutput:p,spaceKey:v,context:h,noOverlay:E}):g?i.createElement(y.n,{node:a}):!w&&d&&d.macroBodyRenderer?i.createElement(i.Fragment,null,i.createElement(ve.Consumer,null,(({listOfRenderedPageIncludeNodes:n})=>{var u,p,y,g;let w;const b=n.some((e=>{const t=e;return w=n[n.length-1],"include"===t.extensionKey&&this.getReferencedContentId(e)===(null==e?void 0:e.parentContentId)}));if(b){var C;const e=null===(C=w)||void 0===C||null===(C=C.parameters)||void 0===C||null===(C=C.macroParams)||void 0===C||null===(C=C[""])||void 0===C?void 0:C.value;return N=e,i.createElement("div",{className:"error"},i.createElement("span",{className:"error"},i.createElement(m.Z,(0,r.Z)({},me.highlightedPageIncludeRenderedError))),i.createElement(m.Z,(0,r.Z)((0,r.Z)({},me.nonhighlightedPageIncludeRenderedError),{},{values:{pageTitle:N}})))}var N;const T=[...n,(0,r.Z)((0,r.Z)({},this.props.node),{},{parentContentId:t})];return i.createElement(ve.Provider,{value:{listOfRenderedPageIncludeNodes:T}},i.createElement(ue,{contentId:t,experienceName:(0,f.ag)(o,a),adf:e,attributes:(0,f.iQ)(a),references:s,multiBodiedExtensionActions:l,macroRenderedOutput:null===(u=d.macroBodyRenderer)||void 0===u?void 0:u.value,macroRepresentation:(null===(p=d.macroBodyRenderer)||void 0===p?void 0:p.representation)||"view",mediaToken:null==d||null===(y=d.macroBodyRenderer)||void 0===y||null===(y=y.mediaToken)||void 0===y?void 0:y.token,node:a,webresource:null===(g=d.macroBodyRenderer)||void 0===g?void 0:g.webResourceDependencies,mode:o,body:this.state.body,parameters:(0,I.Z6)(a),featureFlags:c,spaceKey:v,context:h,noOverlay:E}))}))):i.createElement(ne,{error:w,node:a,mode:o,extensionKey:n,contentId:t})})))),(0,o.Z)(this,"getQueryForMacroContentFromBackend",((e,t,n,r,o,a,s,l,c,u,m,p,v,h)=>i.createElement(d.AE,{query:T.V,variables:{adf:(0,S.o)(e),contentId:t,mode:r&&r.toUpperCase()},fetchPolicy:v?"no-cache":"cache-first",context:{throttle:!0,allowOnExternalPage:!0},skip:Boolean(c)||Boolean(u)},(({data:d,loading:v,error:g})=>{var E,w;return c||u?i.createElement(ue,{contentId:t,experienceName:(0,f.ag)(r,o),adf:e,node:o,attributes:(0,f.iQ)(o),macroRenderedOutput:null==d||null===(E=d.contentRenderer)||void 0===E?void 0:E.html,references:a,multiBodiedExtensionActions:s,macroRepresentation:"view",webresource:null==d||null===(w=d.contentRenderer)||void 0===w?void 0:w.webResourceDependencies,mode:r,body:this.state.body,parameters:(0,I.Z6)(o),featureFlags:l,macroRenderedOutputFromSSR:c,macroOutput:u,spaceKey:m,context:p,noOverlay:h}):v?i.createElement(y.n,{node:o}):!g&&d&&d.contentRenderer?i.createElement(i.Fragment,null,i.createElement(ue,{contentId:t,experienceName:(0,f.ag)(r,o),adf:e,node:o,attributes:(0,f.iQ)(o),macroRenderedOutput:d.contentRenderer.html,references:a,multiBodiedExtensionActions:s,macroRepresentation:"view",webresource:d.contentRenderer.webResourceDependencies,mode:r,body:this.state.body,parameters:(0,I.Z6)(o),featureFlags:l,context:p,noOverlay:h})):i.createElement(ne,{error:g,node:o,mode:r,extensionKey:n,contentId:t})})))),(0,o.Z)(this,"getReferencedContentId",(e=>{var t;return(null==e||null===(t=e.parameters)||void 0===t||null===(t=t.macroParams)||void 0===t||null===(t=t._referencedContentId)||void 0===t?void 0:t.value)||void 0}))}getChildContext(){const{context:e}=this.props;return{insertCss:e.insertCss||(()=>{})}}componentDidMount(){this.setMacroData()}shouldComponentUpdate(e,t){var n,r;return this.props.contentId!==e.contentId||!u()(null===(n=this.props)||void 0===n||null===(n=n.node)||void 0===n?void 0:n.parameters,null==e||null===(r=e.node)||void 0===r?void 0:r.parameters)||(e.references||this.props.references)&&this.props.references!==e.references||this.state.hasBodyBeenFetched!==t.hasBodyBeenFetched||this.state.body!==t.body}componentDidUpdate(){this.setMacroData()}componentWillUnmount(){const{node:e,mode:t,contentId:n}=this.props,r=(0,f.iQ)(e);(0,f.uD)(t,n,name,r)}async setRichTextMacroBody(){const{contentId:e,node:t}=this.props,n=(null==t?void 0:t.content)||[];try{const t=await(async(e,t)=>{var n;return null===(n=(await(0,p.WQ)().query({query:C.p,variables:(0,N.W)({content:t,contentId:e})})).data)||void 0===n||null===(n=n.contentConverter)||void 0===n?void 0:n.value})(e,n);this.setState({body:t,hasBodyBeenFetched:!0})}catch(r){this.logger.error`${r}`}}setPlainTextMacroBody(){var e;const{node:t}=this.props,n=(null==t||null===(e=t.parameters)||void 0===e||null===(e=e.macroParams)||void 0===e||null===(e=e.__bodyContent)||void 0===e?void 0:e.value)||"";this.setState({body:n,hasBodyBeenFetched:!0})}setMacroData(){const{node:e}=this.props;!e||he(e)&&this.state.hasBodyBeenFetched||((e=>{var t;return e.type===w.OR&&Boolean(null==e||null===(t=e.parameters)||void 0===t||null===(t=t.macroParams)||void 0===t?void 0:t.__bodyContent)})(e)?this.setPlainTextMacroBody():he(e)?this.setRichTextMacroBody():this.setState({hasBodyBeenFetched:!0}))}getContentId(e,t){var n;return(null==e||null===(n=e.attrs)||void 0===n||null===(n=n.parameters)||void 0===n||null===(n=n.macroParams)||void 0===n||null===(n=n._parentId)||void 0===n?void 0:n.value)||t}render(){const{node:e,references:t,multiBodiedExtensionActions:n,contentId:r,extensionKey:o,macroRenderedOutputFromSSR:a,macroOutput:s,spaceKey:d,context:c,noOverlay:u}=this.props;let m=this.props.mode;window.location.pathname.startsWith("/wiki/pdf/")&&(m="pdf");const{hasBodyBeenFetched:v}=this.state;if(!e)return null;if(!v)return i.createElement(y.n,{node:e});const h=(0,I.MK)(e);return i.createElement(pe.N.Consumer,null,(({shouldRefetchMacroQuery:v})=>i.createElement(l.eT,{client:(0,p.WQ)()},i.createElement(g.F.Provider,{value:(0,E.OV)()},Boolean(this.props.featureFlags[b.$W])?this.getQueryForMacroContentAndBodyForPossibleFrontendRendering(h,r,o,m,e,t,n,this.props.featureFlags,a,s,d,c,v,u):this.getQueryForMacroContentFromBackend(h,r,o,m,e,t,n,this.props.featureFlags,a,s,d,c,v,u)))))}}ye.displayName="LegacyMacroRendererQueryComponent",(0,o.Z)(ye,"childContextTypes",{insertCss:s().func.isRequired});const fe=e=>{const{featureFlags:t}=(0,h.D)();return i.createElement(ye,(0,r.Z)({featureFlags:t},e))};fe.displayName="LegacyMacroRendererQuery"},524119:(e,t,n)=>{n.d(t,{V:()=>c});var r=n(840506),o=n(944480),a=n(234461),s=n(9019),i=n(419539),d=n(966793),l=n(784569);const c=e=>(t,...n)=>r.createElement(a.S,{attribution:s.x.CONTENT_EXPERIENCE},r.createElement(o.eT,{client:(0,l.WQ)()},r.createElement(i.e,null,(o=>r.createElement(d.g.Provider,{value:o},e(t,n))))))},621081:(e,t,n)=>{n.d(t,{p:()=>r});const r=n(779076).ZP`query ContentConverterQuery($content:String!$contentId:ID!$from:String!$to:String!$spaceKeyContext:String=""){contentConverter(from:$from to:$to content:$content contentIdContext:$contentId spaceKeyContext:$spaceKeyContext){value}}`},83634:(e,t,n)=>{n.d(t,{O:()=>a,V:()=>o});var r=n(779076);const o=r.ZP`query MacroContentRendererQueryWithTags($adf:String!$containedRender:Boolean=false$contentId:ID!$mode:ContentRendererMode=RENDERER){contentRenderer(adf:$adf containedRender:$containedRender contentId:$contentId mode:$mode){html webResourceDependencies{contexts keys tags{js css}}}}`,a=r.ZP`query MacroBodyRendererQueryWithTags($adf:String!$containedRender:Boolean=false$contentId:ID$mode:ContentRendererMode=RENDERER){macroBodyRenderer(adf:$adf containedRender:$containedRender contentId:$contentId mode:$mode){value representation mediaToken{token}webResourceDependencies{contexts keys tags{js css}}}}`},988167:(e,t,n)=>{n.d(t,{W:()=>o});var r=n(104283);const o=({content:e,contentId:t})=>{const n=e||[],o={type:"doc",content:Array.isArray(n)?n:[n],version:1};return{content:(0,r.o)(o),from:"atlas_doc_format",to:"storage",contentId:t}}},104283:(e,t,n)=>{n.d(t,{o:()=>o});const r=(e,t)=>null===t||"object"!=typeof t||t instanceof Array?t:Object.keys(t).sort().reduce(((e,n)=>(e[n]=t[n],e)),{}),o=e=>JSON.stringify(e,r)},163490:(e,t,n)=>{n.d(t,{$:()=>a,q:()=>o});var r=n(940155);const o=(0,r.tM)({__loadable_id__:"RXLlP",name:"LiveSearchLoader",loader:async()=>(await Promise.all([n.e(12705),n.e(35824),n.e(77249),n.e(70623)]).then(n.bind(n,307901))).LiveSearch}),a=(0,r.ZR)({__loadable_id__:"moWct",name:"LazyLiveSearchLoader",loader:async()=>(await Promise.all([n.e(12705),n.e(35824),n.e(77249),n.e(70623)]).then(n.bind(n,307901))).LiveSearch})},14136:(e,t,n)=>{n.d(t,{N:()=>r});let r=function(e){return e.ClassicRendererLoader="ClassicRendererLoader",e.ClassicEditorContextProviderLoader="ClassicEditorContextProviderLoader",e}({})},583192:(e,t,n)=>{n.d(t,{M:()=>i});var r=n(483647),o=n(179640),a=n(925194),s=n(137253);function i({attributes:e,children:t=null,error:n,contentId:i,mode:d,name:l}){const c=(0,o.T)(a.Sx);return(0,s.K)((()=>{c&&(n?function(e,t,n,o,s){(0,r.S)(t)?(0,a.SY)(n,o).abort({name:e,reason:`Aborted ${e} because of network error: ${t.toString()}`,checkForTimeout:!1,attributes:s}):(0,a.SY)(n,o).fail({name:e,error:t,attributes:s})}(l,n,d,i,e):(0,a.SY)(d,i).succeed({name:l,attributes:e}))}),[e,i,n,c,d,l]),t}},714912:(e,t,n)=>{n.d(t,{C$:()=>a,EO:()=>o,sw:()=>i,xF:()=>s});var r=n(284186);const o=()=>Boolean(r.SM.match(window.location.pathname)),a=()=>Boolean(r.Ch.match(window.location.pathname)),s=()=>Boolean(r.y4.match(window.location.pathname)),i=e=>{if(!e)return!1;return[r.N4.name,r.uV.name,r.tz.name,r.zh.name,r.ri.name].includes(e)}},116761:(e,t,n)=>{n.d(t,{B:()=>d});var r=n(840506),o=n(582463),a=n(940155);const s=e=>Boolean(e),i=(0,a.tM)({__loadable_id__:"nZ5cS",name:"ChildrenMacroLoader",loader:async()=>(await Promise.all([n.e(12705),n.e(99313)]).then(n.bind(n,842342))).ChildrenMacro}),d=({contentId:e,params:t,legacyMacroRenderer:n,isEditor:a})=>{const{featureFlagClient:s}=(0,o.D)();return l(s,t)?r.createElement(i,{contentId:e,isEditor:a}):n()},l=(e,t)=>e.getBooleanValue("confluence.frontend.children-macro.spa",{default:!1})&&(e=>!(!s(e)||e.all||e.excerptType||e.first||e.page||e.reverse||e.sort||e.style||e.depth&&"1"!==e.depth.value))(t)},608553:(e,t,n)=>{n.d(t,{Z:()=>u});var r=n(615919),o=n(199009),a=n(840506),s=n(150030),i=n(570489),d=n(782995),l=n(495302);const c=["a.user-mention","a.confluence-userlink","a.userLogoLink","span.user-hover-trigger","img.confluence-userlink"];class u extends a.Component{constructor(...e){super(...e),(0,o.Z)(this,"renderPortal",(e=>{const{position:t}=this.props,n=e.props["data-account-id"];return e.props.href=(0,l.p)(e.props["data-account-id"],null,i.b),s.createPortal(a.createElement(d.t,{isAnonymous:!n,userId:n,position:t},a.createElement("a",(0,r.Z)({},e.props),e.props.children)),e.placeholder)}))}shouldComponentUpdate(e){return e.node!==this.props.node}getLegacyUserElements(){const{node:e}=this.props;return e?Array.from(e.querySelectorAll(c.join(","))):[]}render(){return(0,l.ns)(this.getLegacyUserElements()).map((e=>this.renderPortal(e)))}}u.displayName="LegacyUserElementsHover"},683400:(e,t,n)=>{n.d(t,{i:()=>s});var r=n(615919),o=n(840506),a=n(756106);function s(e){function t(t){const n=(0,a.f)();return o.createElement(e,(0,r.Z)((0,r.Z)({},t),{},{navigationPolicy:n}))}return t.displayName=`withNavigationPolicy(${e.displayName||e.name})`,t}},411557:(e,t,n)=>{n.d(t,{I:()=>a,w:()=>o});var r=n(940155);const o=(0,r.tM)({__loadable_id__:"XHW04",name:"TableOfContentsLoader",loader:async()=>(await Promise.all([n.e(12705),n.e(54936),n.e(61769),n.e(33963),n.e(18213),n.e(78866),n.e(23822)]).then(n.bind(n,963890))).TableOfContents}),a=(0,r.ZR)({__loadable_id__:"_MSwn",name:"LazyTableOfContentsLoader",loader:async()=>(await Promise.all([n.e(12705),n.e(54936),n.e(61769),n.e(33963),n.e(18213),n.e(78866),n.e(23822)]).then(n.bind(n,963890))).TableOfContents})},861181:(e,t,n)=>{n.d(t,{M:()=>r});let r=function(e){return e.RELEVANCY_SORT="web.item.sorting.scheme.relevancy",e.ALPHABETICAL_SORT="web.item.sorting.scheme.alphabetical",e}({})},903670:(e,t,n)=>{n.d(t,{CC:()=>o,H0:()=>d,JJ:()=>i,ax:()=>s,uy:()=>a});var r=n(318122);const o="template.category.featured",a="template.category.my-templates",s="template.category.starred",i=(0,r.default)(((e,t,n="")=>{const r={};for(const a of e)for(const e of a.categoryIds)e&&(r[e]||(r[e]=0),r[e]++);const o=[];for(const a of t){if(null==a||!a.id||null==a||!a.name)continue;const e=r[a.id],t=a.id===n;(e||t)&&o.push({id:a.id,name:a.name,count:e})}return o})),d=(e,t)=>Object.values(t).some((t=>t.id===e))},47808:(e,t,n)=>{n.d(t,{Ag:()=>c,B5:()=>f,BP:()=>h,D0:()=>u,DZ:()=>I,E6:()=>p,ER:()=>v,Hp:()=>N,Ky:()=>T,UL:()=>m,YD:()=>w,ft:()=>C,oF:()=>y,rN:()=>b,vx:()=>g});var r=n(615919),o=n(93972),a=n(318122),s=n(924431),i=n(903670),d=n(861181);const l=(0,o.defineMessages)({featuredCategoryName:{id:"template-utils.featured.category.name",defaultMessage:"Featured"},myTemplatesCategoryName:{id:"template-utils.my-templates.category.name",defaultMessage:"My Templates"},starredCategoryName:{id:"template-utils.starred.category.name",defaultMessage:"Starred"},promotedCategoryName:{id:"template-utils.promoted.category.name",defaultMessage:"Promoted"}}),c="00000000-0000-0000-0000-000000000001",u=e=>!/^[0-9]+$/.test(e),m=e=>(null==e?void 0:e.blueprintModuleCompleteKey)||(null==e?void 0:e.templateId)||(null==e?void 0:e.itemModuleCompleteKey)||"",p=e=>e.contentBlueprintId||e.templateId||"",v=e=>e?"blueprint"===e.templateType&&e.hasGlobalBlueprintContent&&e.contentBlueprintId!==c?e.blueprintModuleCompleteKey:p(e):null,h=e=>null==e?void 0:e.filter((e=>e.categoryIds.includes("template.category.promoted")||e.categoryIds.includes("template.category.custom"))).length,y=(e,t)=>null==e?void 0:e.filter((e=>e.categoryIds.includes(i.ax)||e.author===t)).length,f=(e,t)=>e.filter((e=>t.includes(e.id))).map((e=>e.id)),g=((0,a.default)(((e,t)=>e.filter((e=>e.categoryIds.includes(i.ax)||t.has(v(e)))))),(e,t,n,r,o)=>{if(!t.length)return e;null!=t&&t.includes(i.uy)&&((e,t,n)=>{e.forEach((e=>{(e.categoryIds.includes(i.ax)||(null==n?void 0:n.has(v(e)))||e.author===t)&&!e.categoryIds.includes(i.uy)&&e.categoryIds.push(i.uy)}))})(e,r,o);const a=(null==t?void 0:t.includes(i.CC))?((e,t)=>{const n=[],r=[],o=[];return e.forEach((e=>{e.categoryIds.includes("template.category.promoted")||e.categoryIds.includes("template.category.custom")?(e.categoryIds.includes(i.CC)||e.categoryIds.push(i.CC),e.categoryIds.includes("template.category.promoted")?r.push(e):o.push(e)):n.push(e)})),t!==d.M.ALPHABETICAL_SORT?[...r,...o,...n]:e})(e,n):e;return null==a?void 0:a.filter((e=>{var n;return null==e||null===(n=e.categoryIds)||void 0===n?void 0:n.some((n=>(null==t?void 0:t.includes(n))||(null==o?void 0:o.has(v(e)))))}))}),E=(e,t,n,r,o,a,s,d,c,u)=>{const m=u&&(null==u?void 0:u.has(v(d)));!t.includes(r.formatMessage(l.starredCategoryName))&&a||m?t.push(r.formatMessage(l.starredCategoryName)):!t.includes(r.formatMessage(l.promotedCategoryName))&&s&&t.push(r.formatMessage(l.promotedCategoryName));const p=e.includes("template.category.promoted")||e.includes("template.category.custom"),h=e.includes(i.ax)||o===c;!t.includes(r.formatMessage(l.featuredCategoryName))&&p&&t.push(r.formatMessage(l.featuredCategoryName)),!t.includes(r.formatMessage(l.myTemplatesCategoryName))&&h&&t.push(r.formatMessage(l.myTemplatesCategoryName));return t.some((e=>null==e?void 0:e.toLowerCase().includes(n)))},I=(0,a.default)(((e,t,n,r,o)=>{if(r){const a=((e,t,n,r)=>o=>{const a=e.toLowerCase(),s=o.name||"",i=o.description||"",d=o.author||"",l=o.keywords||[],c=o.categoryIds||[],u=o.isFavourite||!1,m=o.isPromoted||!1,p=o.blueprintModuleCompleteKey?d:"",v=E(c,l,a,t,d,u,m,o,n,r);return s.toLowerCase().includes(a)||i.toLowerCase().includes(a)||p.toLowerCase().includes(a)||v})(r,t,n,o);e=e.filter(a)}return e})),w=(e,t,n,r)=>{if(!r)return{searchQueryMatchesTitle:!1,searchQueryMatchesDescription:!1,searchQueryMatchesAuthor:!1,searchQueryMatchesKeywords:!1};const o=r.toLowerCase(),a=e.name||"",s=e.description||"",i=e.author||"",d=e.keywords||[],l=e.categoryIds||[],c=e.isFavourite,u=e.isPromoted,m=E(l,d,o,t,i,c,u,e,n);return{searchQueryMatchesTitle:a.toLowerCase().includes(o),searchQueryMatchesDescription:s.toLowerCase().includes(o),searchQueryMatchesAuthor:i.toLowerCase().includes(o),searchQueryMatchesKeywords:m}},b=(0,a.default)(((e,t,n)=>{const r=e.filter((e=>!!e)),o=r.findIndex((e=>e.blueprintModuleCompleteKey===s.VP||e.blueprintModuleCompleteKey===s.Ux));if(-1===o)return r;const a=r[o];return t?(n!==d.M.ALPHABETICAL_SORT&&(r.splice(o,1),r.unshift(a)),r):(r.splice(o,1),r)})),C=(0,a.default)(((e,t)=>t.length?e.filter((e=>t.includes(m(e)))):e)),N=e=>e.blueprintModuleCompleteKey?{idType:"blueprint",id:e.blueprintModuleCompleteKey}:e.templateId?{idType:"template",id:e.templateId}:{idType:"other",id:e.itemModuleCompleteKey},T=(e,t)=>{const n=e.filter((e=>!!e));return t?n.map((e=>{const n=t.some((t=>t===v(e))),o=e.categoryIds.filter((e=>e!==i.ax));return n&&o.push(i.ax),(0,r.Z)((0,r.Z)({},e),{},{isFavourite:n,categoryIds:o})})):n}},872779:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,o=(r=n(840506))&&r.__esModule?r:{default:r},a=n(340531);const s=e=>o.default.createElement(a.Icon,Object.assign({dangerouslySetGlyph:'<svg width="24" height="24" viewBox="0 0 24 24" role="presentation"><path d="M10.294 9.698a.988.988 0 010-1.407 1.01 1.01 0 011.419 0l2.965 2.94a1.09 1.09 0 010 1.548l-2.955 2.93a1.01 1.01 0 01-1.42 0 .988.988 0 010-1.407l2.318-2.297-2.327-2.307z" fill="currentColor" fill-rule="evenodd"/></svg>'},e));s.displayName="ChevronRightIcon";var i=s;t.default=i},113930:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,o=(r=n(840506))&&r.__esModule?r:{default:r},a=n(340531);const s=e=>o.default.createElement(a.Icon,Object.assign({dangerouslySetGlyph:'<svg width="24" height="24" viewBox="0 0 24 24" role="presentation"><path d="M13.31 5.343l7.359 13.17A1 1 0 0119.796 20H4.204a1 1 0 01-.873-1.488l7.36-13.169a1.5 1.5 0 012.618 0zM12 8.5a1.091 1.091 0 00-1.081 1.239l.513 3.766a.573.573 0 001.136 0l.513-3.766A1.091 1.091 0 0012 8.5zm0 8.63a1.125 1.125 0 100-2.25 1.125 1.125 0 000 2.25z" fill="currentColor" fill-rule="evenodd"/></svg>'},e));s.displayName="EditorWarningIcon";var i=s;t.default=i},887922:(e,t,n)=>{n.d(t,{h:()=>o});var r=n(710358);function o(e,t){const n=[];return(0,r.f)(e,{any:e=>{t(e)&&n.push(e)}}),n}},98576:(e,t,n)=>{n.d(t,{Fs:()=>I,LX:()=>l,bk:()=>pe,zS:()=>ve,fH:()=>me,d8:()=>ye});var r=n(615919),o=n(704825),a=n(443998);const s=new a.H$("referentialityPlugin"),i=e=>e&&s.getState(e);var d=n(199009);class l{constructor(){(0,d.Z)(this,"subscriptions",new Map),(0,d.Z)(this,"dataSources",new Map)}createOrUpdate(e,t){this.dataSources.set(e,t);const n=window.requestIdleCallback||window.requestAnimationFrame,r=window.cancelIdleCallback||window.cancelAnimationFrame,o=n((()=>{r(o),this.notifySubscribers(e,t)}))}notifySubscribers(e,t){var n;this.subscriptions.has(e)&&(null===(n=this.subscriptions.get(e))||void 0===n||n.forEach((e=>{e(t)})))}subscribe(e,t){var n;this.subscriptions.has(e)||this.subscriptions.set(e,new Set),null===(n=this.subscriptions.get(e))||void 0===n||n.add(t)}unsubscribe(e,t){var n;this.subscriptions.has(e)&&(null===(n=this.subscriptions.get(e))||void 0===n||n.delete(t))}delete(e){this.dataSources.delete(e),this.notifySubscribers(e,null)}get(e){return this.dataSources.get(e)||null}clear(){this.dataSources.clear(),this.subscriptions.clear()}}class c{constructor(e){(0,d.Z)(this,"dataSourceProvider",void 0),this.dataSourceProvider=e}emit(e,t){this.dataSourceProvider.createOrUpdate(e,t)}}var u=n(325413),m=n(840506),p=n(887641),v=n(850172),h=n(344597);const y=e=>{const t=(({editorView:e,node:t,dataSourceProvider:n})=>{var r;const o=null===(r=t.marks)||void 0===r||null===(r=r.find((t=>{var n;return t.type===(null===(n=e.state.schema.marks)||void 0===n?void 0:n.dataConsumer)})))||void 0===r||null===(r=r.attrs)||void 0===r||null===(r=r.sources)||void 0===r?void 0:r[0],[a,s]=m.useState((()=>{const e=null==n?void 0:n.get(o);if(e)return e}));return m.useEffect((()=>(null==n||n.unsubscribe(o,s),null==n||n.subscribe(o,s),()=>null==n?void 0:n.unsubscribe(o,s))),[n,o]),a?[a]:[]})(e);return m.createElement(h.h,(0,r.Z)((0,r.Z)({},e),{},{references:t}))};y.displayName="ExtensionWithDataSource";const f=y;class g extends p.b{render(e,t){return m.createElement(v.z,{nodeType:this.node.type.name},m.createElement(f,{editorAppearance:e.appearance,editorView:this.view,node:this.node,getPos:this.getPos,providerFactory:e.providerFactory,handleContentDOMRef:t,extensionHandlers:e.extensionHandlers,dataSourceProvider:e.dataSourceProvider,pluginInjectionApi:e.pluginInjectionApi}))}}function E(e,t,n,r,o,a){return(s,d,l)=>{const c=i(d.state);return new g(s,d,l,e,t,{providerFactory:n,extensionHandlers:r,appearance:o,dataSourceProvider:null==c?void 0:c.dataSourceProvider,pluginInjectionApi:a},void 0,void 0,void 0,!0).init()}}g.displayName="ExtensionNodeWithDataSource";let I=function(e){return e.TABLE="table-adf",e}({}),w=function(e){return e.INITIALISE_FRAGMENT_MARKS="initialiseFragmentMarks",e.CONNECT_NODES="connectNodes",e.UPDATE_SOURCE="updateSource",e.DISCONNECT_SOURCE="disconnectSource",e.UPDATE_TARGET="updateTarget",e.DISCONNECT_TARGET="disconnectTarget",e.UPDATE_FRAGMENT_MARK_NAME="updateFragmentMarkName",e.GET_CONNECTIONS="getConnections",e}({});var b=n(312482),C=n(169147),N=n(679997),T=n(731462),S=n(986487),x=n(24359);class A extends Error{constructor(e){super(`Unable to attach, Incorrect configuration: ${e}`),this.reason=e}}class _ extends Error{constructor(e){super(`Unable to execute ${e}, API hasn't been initialized`),this.handlerName=e}}class P extends Error{constructor(e){super(`Unsupported type (${e})`)}}class R extends ReferenceError{constructor(e){super(`Node (${e}) could not be found`),this.localId=e}}class M extends R{constructor(e){super(e),this.localId=e}}class k extends R{constructor(e){super(e),this.localId=e}}class O extends ReferenceError{constructor(e,t){super(`Connecting Target (${e}) to Source (${t}) will result in a Circular Reference`),this.targetLocalId=e,this.sourceLocalId=t}}class L extends ReferenceError{constructor(e){super(`LocalId (${e}) Collision has occured`),this.localId=e}}const Z=e=>{const{table:t,extension:n,bodiedExtension:r,inlineExtension:o}=e.nodes;return new Map([[t,"Table"],[n,"Extension"],[r,"Extension"],[o,"Extension"]])},D=(e,t,n)=>({linkNode:{localId:t,name:null!=n?n:t,node:{type:e.type.name,attrs:(0,r.Z)({},e.attrs)}},sources:[],targets:[]}),F=({type:e,attrs:t},n,r,o)=>{var a;const s=Z(n),i=(e=>{const{extension:t,bodiedExtension:n,inlineExtension:r}=e.nodes;return new Set([t,n,r].filter(Boolean))})(n);let d="";var l;(i.has(e)&&o&&(d=o({node:{type:e.name,attrs:t}})),d)||(d=null!==(l=s.get(e))&&void 0!==l?l:"Element");const c=(null!==(a=null==r?void 0:r[d])&&void 0!==a?a:0)+1;return{markNameWithNumber:`${d} ${c}`,markName:d,markNameNumber:c}},B=({normalizedId:e,name:t,node:n})=>z(e,t,n),z=(e,t,n)=>{const r=(new C.x).encodeNode(n);return{localId:e,name:t,node:{type:r.type,attrs:r.attrs}}},H=(e,t,n)=>{var r;return t.normalizedId===n.normalizedId||!(null===(r=n.dataConsumer)||void 0===r||!r.attrs.sources.some((n=>{const r=e.getById(n);return!!r&&H(e,t,r)})))},K=(e,t)=>{const{doc:n,schema:r}=t,o=r.marks.fragment,a=Z(r);let s=null;return n.descendants(((t,n)=>{var r;if(s)return!1;if(!a.has(t.type))return!0;const i=null!==(r=o.isInSet(t.marks))&&void 0!==r?r:null;return i&&i.attrs.localId===e?(s={node:t,pos:n,fragmentMark:i},!1):t.attrs.localId!==e||(s={node:t,pos:n,fragmentMark:i},!1)})),s},U=(e,t)=>{const{tableCell:n,tableHeader:r,tableRow:o}=e.nodes,a=[],s=[];for(let d=0;d<3;d++){const e=n.createAndFill();e&&a.push(e);const t=r.createAndFill();t&&s.push(t)}const i=[];for(let d=0;d<3;d++)i.push(o.createChecked(null,0===d?s:a));return i},V=(e,t)=>{const{bodiedExtension:n,paragraph:r}=e.nodes;return t===n?[r.createChecked()]:T.HY.empty},$=(e,t,n,r,o)=>{var a;r=null!==(a=r)&&void 0!==a?a:n.tr;const s=K(e,n),i=s?s.pos+s.node.nodeSize:void 0;return r=(0,S.Z3)(t,i)(r)},j=(e,t)=>{var n;return null!==(n=null==t?void 0:t.reduce(((t,n)=>{var r;const o=null===(r=e.getById(n))||void 0===r?void 0:r.normalizedId;return o?t.add(o):t}),new Set))&&void 0!==n?n:new Set},W=(e,t,n)=>r=>q(e,t.node,t.pos,n,t.dataConsumer)(r),q=(e,t,n,r,o)=>a=>{var s,i;const{dataConsumer:d}=e.marks,l=null===(s=null!=o?o:d.isInSet(t.marks))||void 0===s?void 0:s.attrs.sources;if(!(null!=r&&r.size||null!=l&&l.length))return a;if((null==r?void 0:r.size)===(null==l?void 0:l.length)&&l.every((e=>r.has(e))))return a;const c=(null!==(i=null==d?void 0:d.removeFromSet(t.marks))&&void 0!==i?i:t.marks).concat();return null!=r&&r.size&&c.push(d.create({sources:Array.from(r)})),a.setNodeMarkup(n,void 0,t.attrs,c),a},G=(e,t,n)=>r=>{var o,a,s,i,d;const{fragment:l}=e.marks;if(n===(null===(o=t.fragmentMark)||void 0===o?void 0:o.attrs.name))return r;const c=(null!==(a=null===(s=t.fragmentMark)||void 0===s?void 0:s.removeFromSet(t.node.marks))&&void 0!==a?a:t.node.marks).concat();return c.push(l.create({localId:null!==(i=null===(d=t.fragmentMark)||void 0===d?void 0:d.attrs.localId)&&void 0!==i?i:b.V.generate(),name:n})),r.setNodeMarkup(t.pos,void 0,t.node.attrs,c)},Q=(e,t,n,o)=>{const a=e.schema.nodes[t.type];if(!Z(e.schema).has(a))throw new P(t.type);const s=b.V.generate();if(e.hasId(s))throw new L(s);let i;"table"!==t.type&&(i=t.attrs);const{markNameWithNumber:d}=F({type:a,attrs:i},e.schema,e.getMaxNumberUsedInFragmentMarkNames(),n);"table"===t.type&&(0,x.e)("platform.editor.custom-table-width")&&(i={width:760});const l=((e,t,n,o)=>{const{table:a}=e.nodes,s=t===a?U:V;return t.createChecked((0,r.Z)((0,r.Z)({},n),{},{localId:b.V.generate()}),s(e,t),o)})(e.schema,a,i,((e,t,n,r)=>{var o;const{fragment:a,dataConsumer:s}=e.marks;return[a.create({localId:t,name:n}),r&&s.create({sources:null!==(o=Array.from(r))&&void 0!==o?o:[]})].filter(Boolean)})(e.schema,s,d,o)),{inlineExtension:c,paragraph:u}=e.schema.nodes,m=a===c?u.create(void 0,[l]):l;return{linkNode:z(s,d,l),node:m}},J=(e,t,n,r)=>{var o;const a=e.getById(t);if(!a)throw new M(t);const s=e.getById(n);if(!s)throw new k(n);if(a.normalizedId===s.normalizedId)throw new O(t,n);const i=!(null===(o=a.dataConsumer)||void 0===o||!o.attrs.sources.some((e=>s.ids.has(e))));if(i)return{target:B(a),source:B(s),tr:r};{var d;if(H(e,a,s))throw new O(t,n);const o=j(e,null===(d=a.dataConsumer)||void 0===d?void 0:d.attrs.sources);o.add(s.normalizedId),r=W(e.schema,a,o)(r)}return{target:B(a),source:B(s),tr:r}},X=(e,t,n,r)=>{var o;const a=e.getById(n);if(!a)throw new k(n);const s=e.getById(t);if(!s)throw new M(t);const i=j(e,null===(o=s.dataConsumer)||void 0===o?void 0:o.attrs.sources);return i.delete(a.normalizedId)?W(e.schema,s,i)(r):r},Y=(e,t,n,r,o,a)=>{const s=e.schema.nodes[n.type];if(!Z(e.schema).has(s))throw new P(n.type);if(!e.hasId(t))throw new k(t);const{linkNode:i,node:d}=Q(e,n,o,[e.getById(t).normalizedId]);return a&&(r=X(e,a,t,r)),{linkNode:i,tr:r=$(t,d,e.state,r)}};class ee{constructor(e,t,n=!0){this.view=e,this.normalizeLocalId=t,this.shallow=n,(0,d.Z)(this,"maxNumberUsedInFragmentMarkName",{}),(0,d.Z)(this,"connections",new Map),(0,d.Z)(this,"uniqueNormalizedIds",new Set),(0,d.Z)(this,"uniqueSourceNormalizedIds",new Set),(0,d.Z)(this,"namelessNormalizedIds",new Set);const{doc:r,schema:o}=this.view.state,{fragment:a,dataConsumer:s}=o.marks,i=Z(o),l=new Map;r.descendants(((e,t,r)=>{var o,d,c,u,m,p,v;if(!i.has(e.type))return!0;const h=a.isInSet(e.marks);if(!(h||null!==(o=e.attrs)&&void 0!==o&&o.localId))return!0;const y=this.normalizeLocalId(null===(d=e.attrs)||void 0===d?void 0:d.localId,null==h||null===(c=h.attrs)||void 0===c?void 0:c.localId);if(!y||this.connections.has(y))return!0;let f;if(null!=h&&h.attrs.name){if(f=(e=>{const t=e.split(" ");if(t.length<2)return null;const n=Number(t[t.length-1]);return"number"!=typeof n?null:{defaultName:t.slice(0,t.length-1).join(" "),defaultNameNumber:n}})(h.attrs.name),f){const e=this.maxNumberUsedInFragmentMarkName[f.defaultName];(void 0===e||e<f.defaultNameNumber)&&(this.maxNumberUsedInFragmentMarkName[f.defaultName]=f.defaultNameNumber)}}else this.namelessNormalizedIds.add(y);const g=s.isInSet(e.marks),E={node:e,pos:t,parent:r,normalizedId:y,name:null!==(u=null==h||null===(m=h.attrs)||void 0===m?void 0:m.name)&&void 0!==u?u:y,ids:new Set,targets:new Set,fragmentMark:h,dataConsumer:g,decodedName:f};return null!=h&&null!==(p=h.attrs)&&void 0!==p&&p.localId&&(E.ids.add(h.attrs.localId),this.connections.set(h.attrs.localId,E)),null!==(v=e.attrs)&&void 0!==v&&v.localId&&(E.ids.add(e.attrs.localId),this.connections.set(e.attrs.localId,E)),this.uniqueNormalizedIds.add(y),g&&g.attrs.sources.forEach((e=>{var t,n;return l.set(e,null!==(t=null===(n=l.get(e))||void 0===n?void 0:n.add(y))&&void 0!==t?t:new Set([y]))})),!(n&&g)}));for(const[d,c]of l){const e=this.connections.get(d);e&&(this.uniqueSourceNormalizedIds.add(e.normalizedId),e.targets=new Set([...e.targets,...c]))}}get state(){return this.view.state}get schema(){return this.view.state.schema}getById(e){return this.connections.get(e)}hasId(e){return this.connections.has(e)}getMaxNumberUsedInFragmentMarkNames(){return(0,r.Z)({},this.maxNumberUsedInFragmentMarkName)}getMaxNumberUsedInFragmentMarkName(e){var t;return null!==(t=this.maxNumberUsedInFragmentMarkName[e])&&void 0!==t?t:0}updateMaxNumberUsedInFragmentMarkNames(e,t){this.maxNumberUsedInFragmentMarkName[e]=t}*uniqueConnections(){for(const e of this.uniqueNormalizedIds){const t=this.connections.get(e);t&&(yield t)}}*consumerOnlyConnections(){for(const t of this.uniqueNormalizedIds){var e;const n=this.connections.get(t);n&&null!==(e=n.dataConsumer)&&void 0!==e&&e.attrs.sources.length&&(yield n)}}*sourceOnlyConnections(){for(const e of this.uniqueSourceNormalizedIds){const t=this.connections.get(e);t&&(yield t)}}*namelessOnlyConnections(){for(const e of this.namelessNormalizedIds){const t=this.connections.get(e);t&&(yield t)}}}var te=n(431676);const ne=e=>(0,r.Z)({actionSubject:te.Wt.DOCUMENT,eventType:te.Ze.OPERATIONAL,tags:["editor"]},e),re=({docSize:e,sourceNodeType:t,targetNodeType:n,type:r,actionType:o,tr:a,editorAnalyticsAPI:s})=>i=>{const d=ne({action:te.om.CONNECTED_NODES,attributes:{duration:i,docSize:e,sourceNodeType:t,targetNodeType:n,type:r,actionType:o}});null==s||s.attachAnalyticsEvent(d)(a)},oe=({docSize:e,oldSourceNodeType:t,newSourceNodeType:n,type:r,tr:o,editorAnalyticsAPI:a})=>s=>{const i=ne({action:te.om.UPDATED_SOURCE,attributes:{duration:s,docSize:e,oldSourceNodeType:t,newSourceNodeType:n,type:r}});null==a||a.attachAnalyticsEvent(i)(o)},ae=({docSize:e,newTargetNodeType:t,oldTargetNodeType:n,sourceNodeType:r,type:o,tr:a,editorAnalyticsAPI:s})=>i=>{const d=ne({action:te.om.UPDATED_TARGET,attributes:{duration:i,docSize:e,newTargetNodeType:t,oldTargetNodeType:n,sourceNodeType:r,type:o}});null==s||s.attachAnalyticsEvent(d)(a)};class se{constructor({nodeNameCallback:e,nodeFocusCallback:t,editorAnalyticsAPI:n,editorView:r,featureFlags:o}={}){(0,d.Z)(this,"nodeNameCallback",void 0),(0,d.Z)(this,"nodeFocusCallback",void 0),(0,d.Z)(this,"normalizeLocalId",void 0),(0,d.Z)(this,"editorAnalyticsAPI",void 0),(0,d.Z)(this,"editorView",void 0),(0,d.Z)(this,"selectedLocalId",void 0),this.nodeNameCallback=e,this.nodeFocusCallback=t,this.editorAnalyticsAPI=n,this.editorView=r,this.normalizeLocalId=(e,t)=>null!=o&&o["confluence.frontend.ecosystem.insert.fragment-mark"]&&null!=t?t:e}get isAttached(){return!!this.editorView}attach(e){const{state:{schema:t}}=e;if(!t.marks.fragment)throw new A("fragmentMark not supported");this.editorView=e}detach(){this.editorView=void 0}setNodeFocusCallback(e){this.nodeFocusCallback=e}setNodeNameCallback(e){this.nodeNameCallback=e}setSelectedLocalId(e){if(this.selectedLocalId!==e&&(this.selectedLocalId=e,this.nodeFocusCallback)){if(!e)return void this.nodeFocusCallback(void 0);if(this.editorView){const{state:r}=this.editorView,o=K(e,r);var t,n;if(o)this.nodeFocusCallback(z(this.normalizeLocalId(e,null===(t=o.fragmentMark)||void 0===t?void 0:t.attrs.localId),(null===(n=o.fragmentMark)||void 0===n?void 0:n.attrs.name)||"",o.node))}}}initialiseFragmentMarks(){if(!this.editorView)throw new _("initialiseFragmentMarks");(0,N.MZ)(w.INITIALISE_FRAGMENT_MARKS);const{state:e,dispatch:t}=this.editorView;let{tr:n}=e;const r=e.doc.nodeSize,o=new ee(this.editorView,this.normalizeLocalId,!1);let a=0;const s=o.getMaxNumberUsedInFragmentMarkNames();for(const i of o.namelessOnlyConnections()){const{markNameWithNumber:t,markName:r,markNameNumber:o}=F(i.node,e.schema,s,this.nodeNameCallback);s[r]=o,n=G(e.schema,i,t)(n),a++}n.setMeta("addToHistory",!1),(0,N.H0)(w.INITIALISE_FRAGMENT_MARKS,(({docSize:e,count:t,tr:n,editorAnalyticsAPI:r})=>o=>{const a=ne({action:te.om.INITIALISED_FRAGMENT_MARK,attributes:{duration:o,docSize:e,count:t}});null==r||r.attachAnalyticsEvent(a)(n)})({docSize:r,count:a,tr:n,editorAnalyticsAPI:this.editorAnalyticsAPI})),t(n)}getConnections(){(0,N.MZ)(w.GET_CONNECTIONS);const e={};if(!this.editorView)return(0,N.H0)(w.GET_CONNECTIONS),e;const{state:{tr:t,doc:{nodeSize:n}}}=this.editorView,r=new ee(this.editorView,this.normalizeLocalId);for(const{node:o,normalizedId:a,name:s}of r.uniqueConnections())e[a]=D(o,a,s);for(const{normalizedId:o,dataConsumer:a}of r.consumerOnlyConnections()){const t=e[o];a.attrs.sources.forEach((n=>{var a,s;const i=null!==(a=null===(s=r.getById(n))||void 0===s?void 0:s.normalizedId)&&void 0!==a?a:n,d=e[i];d&&i!==o&&(d.targets.push(o),null==t||t.sources.push(i))}))}return(0,N.H0)(w.GET_CONNECTIONS,(({count:e,docSize:t,tr:n,editorAnalyticsAPI:r})=>o=>{const a=ne({action:te.om.GOT_CONNECTIONS,attributes:{docSize:t,duration:o,count:e}});null==r||r.attachAnalyticsEvent(a)(n)})({tr:t,editorAnalyticsAPI:this.editorAnalyticsAPI,docSize:n,count:Object.keys(e).length})),e}select(e,t=!1){if(!this.editorView||!e)throw new _("select");const{state:n,dispatch:r}=this.editorView,o=K(e,n);if(o){const{tr:e}=n;e.setSelection(a.qv.create(n.doc,o.pos)),t&&e.scrollIntoView(),e.setMeta("addToHistory",!1),r(e)}}updateName(e,t){try{var n;if((0,N.MZ)(w.UPDATE_FRAGMENT_MARK_NAME),!this.isAttached||!this.editorView)throw new _("updateName");const{state:r,state:{schema:o},dispatch:a}=this.editorView,s=K(e,r);if(!s)throw new R(e);const{fragment:i}=o.marks,{fragmentMark:d,node:l,pos:c}=s,u=null!==(n=null==d?void 0:d.attrs.localId)&&void 0!==n?n:b.V.generate(),m=i.create({localId:u,name:t}),p=d?l.marks.filter((e=>e.type!==m.type)):l.marks.concat();p.push(m);let v=r.tr.setNodeMarkup(c,void 0,l.attrs,p);a(v);const h=z(this.normalizeLocalId(l.attrs.localId,u),t,l);return(0,N.H0)(w.UPDATE_FRAGMENT_MARK_NAME,(({nodeType:e,tr:t,editorAnalyticsAPI:n})=>r=>{const o=ne({action:te.om.UPDATED_FRAGMENT_MARK_NAME,attributes:{duration:r,nodeType:e}});null==n||n.attachAnalyticsEvent(o)(t)})({tr:v,editorAnalyticsAPI:this.editorAnalyticsAPI,nodeType:l.type.name})),h}catch(r){throw(0,N.H0)(w.UPDATE_FRAGMENT_MARK_NAME),r}}getADFFromLocalId(e){if(!this.isAttached||!this.editorView)throw new _("getADFFromLocalId");const{state:t}=this.editorView,n=K(e,t);if(!n)throw new R(e);return(new C.x).encodeNode(n.node)}connectSource(e,t){try{if((0,N.MZ)(w.CONNECT_NODES),!this.editorView)throw new _("connectSource");const{dispatch:n,state:r}=this.editorView,o=r.doc.nodeSize,a=new ee(this.editorView,this.normalizeLocalId),{source:s,target:i,tr:d}=J(a,e,t,r.tr);return n(d),(0,N.H0)(w.CONNECT_NODES,re({tr:d,editorAnalyticsAPI:this.editorAnalyticsAPI,docSize:o,actionType:"connectSource",type:"connect",sourceNodeType:s.node.type,targetNodeType:i.node.type})),s}catch(n){throw(0,N.H0)(w.CONNECT_NODES),n}}connectTarget(e,t){try{if((0,N.MZ)(w.CONNECT_NODES),!this.editorView)throw new _("connectTarget");const{dispatch:n,state:r}=this.editorView,o=r.doc.nodeSize,a=new ee(this.editorView,this.normalizeLocalId),{source:s,target:i,tr:d}=J(a,t,e,r.tr);return n(d),(0,N.H0)(w.CONNECT_NODES,re({tr:d,editorAnalyticsAPI:this.editorAnalyticsAPI,docSize:o,actionType:"connectTarget",type:"connect",sourceNodeType:s.node.type,targetNodeType:i.node.type})),i}catch(n){throw(0,N.H0)(w.CONNECT_NODES),n}}updateTarget(e,t,n){try{var r;if((0,N.MZ)(w.UPDATE_TARGET),!this.editorView)throw new _("updateTarget");const{dispatch:o,state:a}=this.editorView,s=a.doc.nodeSize,i=new ee(this.editorView,this.normalizeLocalId),{target:d,source:l,tr:c}=J(i,n,e,X(i,t,e,a.tr));return o(c),(0,N.H0)(w.UPDATE_TARGET,ae({tr:c,editorAnalyticsAPI:this.editorAnalyticsAPI,docSize:s,newTargetNodeType:d.node.type,oldTargetNodeType:(null===(r=i.getById(t))||void 0===r?void 0:r.node.type.name)||"",sourceNodeType:l.node.type,type:"update"})),d}catch(o){throw(0,N.H0)(w.UPDATE_TARGET),o}}updateSource(e,t){try{if((0,N.MZ)(w.UPDATE_SOURCE),!this.editorView)throw new _("updateSource");const{dispatch:n,state:r}=this.editorView,o=r.doc.nodeSize,a=new ee(this.editorView,this.normalizeLocalId),{target:s,source:i,tr:d}=((e,t,n,r)=>{var o;const a=e.getById(t);if(!a)throw new M(t);const s=e.getById(n);if(!s)throw new k(n);if(a.normalizedId===s.normalizedId)throw new O(t,n);const i=!(null===(o=a.dataConsumer)||void 0===o||!o.attrs.sources.every((e=>s.ids.has(e))));if(i)return{target:B(a),source:B(s),tr:r};if(H(e,a,s))throw new O(t,n);return r=W(e.schema,a,new Set([s.normalizedId]))(r),{target:B(a),source:B(s),tr:r}})(a,e,t,r.tr);return n(d),(0,N.H0)(w.UPDATE_SOURCE,oe({tr:d,editorAnalyticsAPI:this.editorAnalyticsAPI,docSize:o,oldSourceNodeType:s.node.type,newSourceNodeType:i.node.type,type:"update"})),i}catch(n){throw(0,N.H0)(w.UPDATE_SOURCE),n}}disconnectTarget(e,t){try{var n,r;if((0,N.MZ)(w.DISCONNECT_TARGET),!this.editorView)throw new _("disconnectTarget");const{dispatch:o,state:a}=this.editorView,s=a.doc.nodeSize,i=new ee(this.editorView,this.normalizeLocalId),d=X(i,t,e,a.tr);o(d),(0,N.H0)(w.DISCONNECT_TARGET,(({docSize:e,sourceNodeType:t,targetNodeType:n,tr:r,editorAnalyticsAPI:o})=>a=>{const s=ne({action:te.om.DISCONNECTED_TARGET,attributes:{duration:a,docSize:e,sourceNodeType:t,targetNodeType:n}});null==o||o.attachAnalyticsEvent(s)(r)})({tr:d,editorAnalyticsAPI:this.editorAnalyticsAPI,docSize:s,sourceNodeType:(null===(n=i.getById(e))||void 0===n?void 0:n.node.type.name)||"",targetNodeType:(null===(r=i.getById(t))||void 0===r?void 0:r.node.type.name)||""}))}catch(o){throw(0,N.H0)(w.DISCONNECT_TARGET),o}}disconnectSource(e){try{if((0,N.MZ)(w.DISCONNECT_SOURCE),!this.editorView)throw new _("disconnectSource");const{dispatch:t,state:n}=this.editorView,r=n.doc.nodeSize,o=K(e,n);if(!o)throw new M(e);const a=q(n.schema,o.node,o.pos)(n.tr);t(a),(0,N.H0)(w.DISCONNECT_SOURCE,(({docSize:e,targetNodeType:t,tr:n,editorAnalyticsAPI:r})=>o=>{const a=ne({action:te.om.DISCONNECTED_SOURCE,attributes:{duration:o,docSize:e,targetNodeType:t}});null==r||r.attachAnalyticsEvent(a)(n)})({tr:a,editorAnalyticsAPI:this.editorAnalyticsAPI,docSize:r,targetNodeType:o.node.type.name}))}catch(t){throw(0,N.H0)(w.DISCONNECT_SOURCE),t}}insertAndConnectTarget(e,t){try{var n;if((0,N.MZ)(w.CONNECT_NODES),!this.editorView)throw new _("insertAndConnectTarget");const{dispatch:r,state:o}=this.editorView,a=new ee(this.editorView,this.normalizeLocalId),{linkNode:s,tr:i}=Y(a,e,t,o.tr,this.nodeNameCallback);r(i);const d=i.doc.nodeSize;return(0,N.H0)(w.CONNECT_NODES,re({tr:i,editorAnalyticsAPI:this.editorAnalyticsAPI,docSize:d,actionType:"connectTarget",type:"insertAndConnect",sourceNodeType:(null===(n=a.getById(e))||void 0===n?void 0:n.node.type.name)||"",targetNodeType:t.type})),s}catch(r){throw(0,N.H0)(w.CONNECT_NODES),r}}insertAndConnectSource(e,t){try{var n,r;if((0,N.H0)(w.CONNECT_NODES),!this.editorView)throw new _("insertAndConnectSource");const{state:o,dispatch:a}=this.editorView,s=o.schema.nodes[t.type];if(!Z(o.schema).has(s))throw new P(t.type);const i=new ee(this.editorView,this.normalizeLocalId),d=i.getById(e);if(!d)throw new M(e);const{linkNode:l,node:c}=Q(i,t,this.nodeNameCallback);let u=o.tr;const m=j(i,null===(n=d.dataConsumer)||void 0===n?void 0:n.attrs.sources).add(l.localId);u=W(o.schema,d,m)(u),u=$(e,c,o,u),a(u);const p=u.doc.nodeSize;return(0,N.H0)(w.CONNECT_NODES,re({tr:u,editorAnalyticsAPI:this.editorAnalyticsAPI,docSize:p,actionType:"connectSource",type:"insertAndConnect",sourceNodeType:c.type.name,targetNodeType:(null===(r=i.getById(e))||void 0===r?void 0:r.node.type.name)||""})),l}catch(o){throw(0,N.H0)(w.CONNECT_NODES),o}}replaceAndUpdateTarget(e,t,n){try{var r,o;if((0,N.H0)(w.UPDATE_TARGET),!this.editorView)throw new _("replaceAndUpdateTarget");const{dispatch:a,state:s}=this.editorView,i=new ee(this.editorView,this.normalizeLocalId),{linkNode:d,tr:l}=Y(i,e,n,s.tr,this.nodeNameCallback,t);a(l);const c=l.doc.nodeSize;return(0,N.H0)(w.UPDATE_TARGET,ae({tr:l,editorAnalyticsAPI:this.editorAnalyticsAPI,docSize:c,type:"replaceAndUpdate",newTargetNodeType:n.type,oldTargetNodeType:(null===(r=i.getById(t))||void 0===r?void 0:r.node.type.name)||"",sourceNodeType:(null===(o=i.getById(e))||void 0===o?void 0:o.node.type.name)||""})),d}catch(a){throw(0,N.H0)(w.UPDATE_TARGET),a}}replaceAndUpdateSource(e,t){try{if((0,N.MZ)(w.UPDATE_SOURCE),!this.editorView)throw new _("replaceAndUpdateSource");const{state:{schema:n},state:r,dispatch:o}=this.editorView,a=n.nodes[t.type];if(!Z(n).has(a))throw new P(t.type);const s=new ee(this.editorView,this.normalizeLocalId),i=s.getById(e);if(!i)throw new M(e);const{linkNode:d,node:l}=Q(s,t,this.nodeNameCallback);let c=W(s.schema,i,new Set([d.localId]))(r.tr);c=$(e,l,r,c),o(c);const u=c.doc.nodeSize;return(0,N.H0)(w.UPDATE_SOURCE,oe({tr:c,editorAnalyticsAPI:this.editorAnalyticsAPI,docSize:u,oldSourceNodeType:i.node.type.name,newSourceNodeType:t.type,type:"replaceAndUpdate"})),d}catch(n){throw(0,N.H0)(w.UPDATE_SOURCE),n}}}var ie=Number.isNaN||function(e){return"number"==typeof e&&e!=e};function de(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(r=e[n],o=t[n],!(r===o||ie(r)&&ie(o)))return!1;var r,o;return!0}const le="TABLE_DELETED",ce=new C.x,ue=function(e,t){void 0===t&&(t=de);var n=null;function r(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];if(n&&n.lastThis===this&&t(r,n.lastArgs))return n.lastResult;var a=e.apply(this,r);return n={lastResult:a,lastArgs:r,lastThis:this},a}return r.clear=function(){n=null},r}((e=>ce.encodeNode(e)));const me=({config:e,api:t})=>({name:"referentiality",pmPlugins:()=>[{name:"referentiality",plugin:({providerFactory:n,portalProviderAPI:a,eventDispatcher:d})=>{var m,p;return function(e,t,n,a,d,m={},p,v){return new o.J({key:s,state:{init(){const e=new l,t=new c(e);return d.forEach((t=>t.init({emit:(t,n)=>e.createOrUpdate(t,n)}))),{dataSourceProvider:e,nodeMutationObserver:t,changedSources:new Map,selectedNodeLocalId:void 0}},apply(e,t,n,o){let a=t.selectedNodeLocalId;if(v&&!n.selection.eq(o.selection)){var s;const t=(e=>{const{table:t,extension:n,bodiedExtension:r,inlineExtension:o}=e.nodes;return[t,n,r,o]})(n.schema),{fragment:r}=n.schema.marks,o=(0,S.a1)(t)(e.selection)||(0,S.Tr)(t)(e.selection);a=(null==o?void 0:o.node)&&((null==r||null===(s=r.isInSet(null==o?void 0:o.node.marks))||void 0===s?void 0:s.attrs.localId)||(null==o?void 0:o.node.attrs.localId))}const i=a!==t.selectedNodeLocalId;if(!e.docChanged)return i?(0,r.Z)((0,r.Z)({},t),{},{selectedNodeLocalId:a}):t;const d=new Map;for(const[r,c]of t.changedSources.entries()){const t=e.mapping.map(r);d.set(t,c)}const l=(0,u.qh)(e).filter((({node:t})=>"cut"!==e.getMeta("uiEvent")&&((e,t)=>{var n,r;const o="string"==typeof e.type?e.type:e.type.name;return[null===(n=t.nodes.table)||void 0===n?void 0:n.name].includes(o)&&(null===(r=e.attrs)||void 0===r?void 0:r.localId)})(t,n.schema)&&(e=>{try{return e.check(),!0}catch(t){return!1}})(t)));return l.forEach((({node:e,pos:t})=>{d.set(t,e)})),l.length?(0,r.Z)((0,r.Z)({},t),{},{changedSources:d,selectedNodeLocalId:a}):i?(0,r.Z)((0,r.Z)({},t),{},{selectedNodeLocalId:a}):t}},view:e=>{null==v||v.attach(e);const t=e.state.schema.nodes.table,n=i(e.state);if(!n)return{};let r;const o=n.dataSourceProvider,s=n.nodeMutationObserver;return o&&(r=n=>{if(n&&n.attrs){let r=!1;(0,S.D0)(e.state.doc,t).forEach((({node:e})=>{e.attrs.localId===n.attrs.localId&&(r=!0)})),r||o.delete(n.attrs.localId)}},a.on(le,r)),s&&(0,S.D0)(e.state.doc,t).forEach((({node:e})=>{s.emit(e.attrs.localId,{get[I.TABLE](){return ue(e)}})})),{update(e,t){const n=i(e.state);if(!n)return;const r=i(t),{changedSources:o,nodeMutationObserver:a,selectedNodeLocalId:s}=n;s!==(null==r?void 0:r.selectedNodeLocalId)&&(null==v||v.setSelectedLocalId(s)),o.forEach(((e,t)=>{var n,r;const o=null==e||null===(n=e.marks)||void 0===n||null===(n=n.find((e=>"fragment"===e.type.name)))||void 0===n||null===(n=n.attrs)||void 0===n?void 0:n.localId;o&&a.emit(o,{get[I.TABLE](){return ue(e)}}),null!==(r=e.attrs)&&void 0!==r&&r.localId&&a.emit(e.attrs.localId,{get[I.TABLE](){return ue(e)}})})),o.clear()},destroy(){null==v||v.detach(),o&&(a.off(le,r),o.clear&&o.clear())}}},props:{nodeViews:{extension:E(n,a,e,t,m.appearance,p),bodiedExtension:E(n,a,e,t,m.appearance,p),inlineExtension:E(n,a,e,t,m.appearance,p)}}})}(n,null!==(m=null==e?void 0:e.extensionHandlers)&&void 0!==m?m:{},a,d,null!==(p=null==e?void 0:e.externalObservers)&&void 0!==p?p:[],{appearance:null==e?void 0:e.appearance},t,null==e?void 0:e.api)}}]}),pe=e=>{var t;const n=null!==(t=null==e?void 0:e.api)&&void 0!==t?t:new se(e);return{api:n,plugin:me({config:(0,r.Z)((0,r.Z)({},e),{},{api:n})})}},ve=e=>{var t;const n=null==e||null===(t=e._privateGetEditorView())||void 0===t?void 0:t.state;if(!n)return null;const r=n.selection;if(r instanceof a.qv){var o,s;const e=null===(o=r.node.marks)||void 0===o||null===(o=o.find((e=>{var t;return e.type===(null===(t=n.schema)||void 0===t||null===(t=t.marks)||void 0===t?void 0:t.dataConsumer)})))||void 0===o||null===(o=o.attrs)||void 0===o?void 0:o.sources[0];if(!e)return null;const t=null===(s=i(n))||void 0===s?void 0:s.dataSourceProvider;return null==t?void 0:t.get(e)}},he=(e=[])=>{let t=new Map;return e.forEach((e=>{var n,r,o;const a=null===(n=e.marks)||void 0===n?void 0:n.find((e=>"fragment"===e.type)),s=null==a||null===(r=a.attrs)||void 0===r?void 0:r.localId;s&&t.set(s,e),null!==(o=e.attrs)&&void 0!==o&&o.localId&&t.set(e.attrs.localId,e),e.content&&(t=new Map([...t,...he(e.content)]))})),t},ye=({adf:e,extensionParams:t,dataSourceProvider:n})=>{var r;const o=(0,m.useMemo)((()=>he(e.content)),[e]),a=o.get(t.localId),s=null==a||null===(r=a.marks)||void 0===r||null===(r=r.find((e=>"dataConsumer"===e.type)))||void 0===r||null===(r=r.attrs)||void 0===r||null===(r=r.sources)||void 0===r?void 0:r[0],[i,d]=(0,m.useState)((()=>{const e=o.get(s);if("table"===(null==e?void 0:e.type))return{[I.TABLE]:e}}));return(0,m.useEffect)((()=>{if(s)return null==n||n.subscribe(s,d),()=>null==n?void 0:n.unsubscribe(s,d)}),[n,s]),{references:i?[i]:[]}}}}]);
//# sourceMappingURL=46052.BFJkO_xkoq.js.map