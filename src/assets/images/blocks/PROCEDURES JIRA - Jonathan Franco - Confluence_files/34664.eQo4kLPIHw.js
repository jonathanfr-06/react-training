"use strict";(self._cf=self._cf||[]).push([[34664],{430733:function(e,t,r){var n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},n.apply(this,arguments)},i=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function o(e){try{c(n.next(e))}catch(t){a(t)}}function s(e){try{c(n.throw(e))}catch(t){a(t)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,s)}c((n=n.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var r,n,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(o=0)),o;)try{if(r=1,n&&(i=2&s[0]?n.return:s[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,s[1])).done)return i;switch(n=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,n=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(c){s=[6,c],n=0}finally{r=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.tryGetArtifactData=t.getArtifactFromSource=void 0;var o=r(942504),s=r(672554),c=r(328973),f=r(715536),u=r(533192);function d(e,t,r){return i(this,void 0,void 0,(function(){var s,c,f=this;return a(this,(function(u){switch(u.label){case 0:s=t.publishMetadata;try{c=(0,o.interpolateTagScheme)(t.tagScheme,n(n({},r),{name:t.name}))}catch(d){return[2,{type:"tag-scheme-interpolation-error",publishMetadata:s}]}return[4,e.getArtifact(t.name,c)];case 1:return[2,u.sent().fold((function(e){return Promise.resolve({type:"artifact-fetch-error",error:e,publishMetadata:s})}),(function(e){return i(f,void 0,void 0,(function(){return a(this,(function(t){return[2,{type:"success",data:e,publishMetadata:s,artifactVersion:r.version}]}))}))}))]}}))}))}t.getArtifactFromSource=function(e,t,r){return i(this,void 0,void 0,(function(){var n=this;return a(this,(function(o){switch(o.label){case 0:return[4,e.getManifest(t.name,t.version)];case 1:return[2,o.sent().fold((function(e){return Promise.resolve({type:"manifest-fetch-error",error:e})}),(function(o){return i(n,void 0,void 0,(function(){var n,i,u;return a(this,(function(a){if("success"!==(n=(0,s.checkManifest)(o,{name:t.name,version:t.version})).key)return[2,{type:n.key}];if(i=o.publishMetadata,o.frontend&&"frontend"===r)return[2,{type:"denied-artifact-type",deniedType:"frontend",publishMetadata:i}];if(!o.frontend&&"backend"===r)return[2,{type:"denied-artifact-type",deniedType:"backend",publishMetadata:i}];switch((u=(0,c.getDimensionContext)(t,o)).type){case"missing-dimension-specification":return[2,{type:"missing-dimension-specification",publishMetadata:i}];case"unsupported-value-specified-for-supported-dimension":return[2,{type:"unsupported-value-specified-for-supported-dimension",publishMetadata:i}];case"success":return[2,d(e,o,u.dimensionContext)];default:(0,f.assertUnreachable)(u)}return[2]}))}))}))]}}))}))},t.tryGetArtifactData=function(e,t){switch(e.type){case"manifest-fetch-error":throw new Error("Unable to fetch manifest due to ".concat(t," response error: ").concat((0,u.toPrettyJson)(e.error)));case"artifact-fetch-error":throw new Error("Unable to fetch artifact due to ".concat(t," response error: ").concat((0,u.toPrettyJson)(e.error)));case"denied-artifact-type":throw new Error("No artifacts should be denied, but type ".concat(e.deniedType," was denied."));case"unsupported-value-specified-for-supported-dimension":throw new Error("An unsupported value was specified for a supported dimension");case"missing-dimension-specification":throw new Error("A required dimension specification was missing");case"tag-scheme-interpolation-error":throw new Error("Ran into failure when trying to interpolate tag scheme");case"mismatched-manifest-name":throw new Error("Manifest has been corrupted. Manifest name is mismatched.");case"mismatched-manifest-version":throw new Error("Manifest has been corrupted. Manifest version is mismatched.");case"success":return e.data;default:(0,f.assertUnreachable)(e)}}},864595:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function o(e){try{c(n.next(e))}catch(t){a(t)}}function s(e){try{c(n.throw(e))}catch(t){a(t)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,s)}c((n=n.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,n,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(o=0)),o;)try{if(r=1,n&&(i=2&s[0]?n.return:s[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,s[1])).done)return i;switch(n=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,n=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(c){s=[6,c],n=0}finally{r=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigRegistryDataSource=void 0;var a=r(942504),o=r(707874),s=r(217624),c=r(244225),f=function(){function e(e,t){this.manifestVersion=e,this.configRegistryHttpClient=t}return e.prototype.getManifest=function(e,t){return n(this,void 0,void 0,(function(){var r,n;return i(this,(function(i){switch(i.label){case 0:r=(0,a.getDataTagForManifest)(e,this.manifestVersion,t),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.configRegistryHttpClient.getBlob(r)];case 2:return[2,i.sent().leftMap((function(e){return e})).map(s.parseArtifactManifest)];case 3:return n=i.sent(),[2,o.Either.left({key:"config-registry-error",error:n})];case 4:return[2]}}))}))},e.prototype.getArtifact=function(e,t){return n(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return[4,this.configRegistryHttpClient.getBlob(t)];case 1:return[2,e.sent()]}}))}))},e.prototype.getLatestVersionMetadata=function(){return n(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return e=(0,a.getVersionMetadataTag)(),[4,this.configRegistryHttpClient.getBlob(e)];case 1:return[2,t.sent().bimap((function(e){return e}),(function(e){return(0,c.parseVersionMetadata)(e)}))]}}))}))},e}();t.ConfigRegistryDataSource=f},419509:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Versions=t.UriSegments=t.BaseUrls=void 0;var r=function(){function e(){}return e.ConfigRegistryProd="https://config-registry.prod.atl-paas.net",e.FrontendProxyStaging="https://fd-frontend-sidecar-proxy.us-east-1.staging.atl-paas.net",e}();t.BaseUrls=r;var n=function(){function e(){}return e.ConfigRegistryProxy="config-registry-proxy",e}();t.UriSegments=n;var i=function(){function e(){}return e.ManifestVersion="v1",e}();t.Versions=i},328973:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getDimensionContext=void 0,t.getDimensionContext=function(e,t){var r={};for(var n in t.dimensions){var i=t.dimensions[n],a=e[n],o=i.fallback;if(void 0===a){if(void 0===o)return{type:"missing-dimension-specification"};a=o}if(!i.supported.includes(a)){if(void 0===o)return{type:"unsupported-value-specified-for-supported-dimension"};a=o}r[n]=a}return{type:"success",dimensionContext:r}}},707874:function(e,t){var r,n=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Either=void 0;var i=function(){function e(){}return e.prototype.map=function(t){return this.flatMap((function(r){return e.right(t(r))}))},e.right=function(e){return new a(e)},e.left=function(e){return new o(e)},e}();t.Either=i;var a=function(e){function t(t){var r=e.call(this)||this;return r.right=t,r}return n(t,e),t.prototype.bimap=function(e,t){return i.right(t(this.right))},t.prototype.flatMap=function(e){return e(this.right)},t.prototype.fold=function(e,t){return t(this.right)},t.prototype.leftMap=function(e){return i.right(this.right)},t}(i),o=function(e){function t(t){var r=e.call(this)||this;return r.left=t,r}return n(t,e),t.prototype.bimap=function(e,t){return i.left(e(this.left))},t.prototype.flatMap=function(e){return i.left(this.left)},t.prototype.fold=function(e,t){return e(this.left)},t.prototype.leftMap=function(e){return i.left(e(this.left))},t}(i)},672554:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UriSegments=t.Versions=t.BaseUrls=t.ConfigRegistryDataSource=t.checkManifest=t.parseVersionMetadata=t.parseArtifactManifest=t.tryGetArtifactData=t.getArtifactFromSource=t.Either=void 0;var n=r(707874);Object.defineProperty(t,"Either",{enumerable:!0,get:function(){return n.Either}});var i=r(430733);Object.defineProperty(t,"getArtifactFromSource",{enumerable:!0,get:function(){return i.getArtifactFromSource}}),Object.defineProperty(t,"tryGetArtifactData",{enumerable:!0,get:function(){return i.tryGetArtifactData}});var a=r(217624);Object.defineProperty(t,"parseArtifactManifest",{enumerable:!0,get:function(){return a.parseArtifactManifest}});var o=r(244225);Object.defineProperty(t,"parseVersionMetadata",{enumerable:!0,get:function(){return o.parseVersionMetadata}});var s=r(436214);Object.defineProperty(t,"checkManifest",{enumerable:!0,get:function(){return s.checkManifest}});var c=r(864595);Object.defineProperty(t,"ConfigRegistryDataSource",{enumerable:!0,get:function(){return c.ConfigRegistryDataSource}});var f=r(419509);Object.defineProperty(t,"BaseUrls",{enumerable:!0,get:function(){return f.BaseUrls}}),Object.defineProperty(t,"Versions",{enumerable:!0,get:function(){return f.Versions}}),Object.defineProperty(t,"UriSegments",{enumerable:!0,get:function(){return f.UriSegments}})},436214:function(e,t){var r=this&&this.__spreadArray||function(e,t,r){if(r||2===arguments.length)for(var n,i=0,a=t.length;i<a;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0}),t.checkManifest=void 0,t.checkManifest=function(e,t){if(e.name!==t.name)return{key:"mismatched-manifest-name"};var n=e.dimensions.version;if(t.version){var i=n?r([null==n?void 0:n.fallback],null==n?void 0:n.supported,!0).filter((function(e){return!!e})):[];if(!i.every((function(e){return e===t.version}))||0===i.length)return{key:"mismatched-manifest-version"}}return{key:"success"}}},857389:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.parseUndefinedOr=t.parseUnknownObject=t.parseBoolean=t.parseArray=t.parseString=void 0,t.parseString=function(e){if("string"==typeof e)return e;throw new Error("Couldn't parse String")},t.parseArray=function(e){if(Array.isArray(e))return e;throw new Error("Couldn't parse List or Undefined")},t.parseBoolean=function(e){if("boolean"==typeof e)return e;throw new Error("Couldn't parse Boolean or undefined")},t.parseUnknownObject=function(e){if("object"==typeof e)return e;throw new Error("Couldn't parse object")},t.parseUndefinedOr=function(e,t){return void 0===t?t:e(t)}},217624:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.parseArtifactManifest=void 0;var n=r(857389);function i(e){var t=(0,n.parseUnknownObject)(e);return{metricTags:"metricTags"in t?function(e){for(var t=(0,n.parseUnknownObject)(e),r={},i=0,a=Object.keys(t);i<a.length;i++){var o=a[i],s=(0,n.parseString)(t[o]);r[o]=s}return r}(t.metricTags):void 0}}t.parseArtifactManifest=function(e){var t=(0,n.parseUnknownObject)(e),r=(0,n.parseString)(t.name),a=(0,n.parseString)(t.tagScheme);return{name:r,frontend:(0,n.parseUndefinedOr)(n.parseBoolean,t.frontend),tagScheme:a,dimensions:function(e){for(var t,r,i,a={},o=(0,n.parseUnknownObject)(e),s=0,c=Object.keys(o);s<c.length;s++){var f=c[s],u=(t=o[f],r=void 0,i=void 0,r=(0,n.parseUnknownObject)(t),i=(0,n.parseArray)(r.supported).map(n.parseString),{fallback:(0,n.parseUndefinedOr)(n.parseString,r.fallback),supported:i});a[f]=u}return a}(t.dimensions),publishMetadata:i(t.publishMetadata)}}},244225:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.parseVersionMetadata=void 0;var n=r(857389);t.parseVersionMetadata=function(e){var t=(0,n.parseUnknownObject)(e);return{version:(0,n.parseString)(t.version),publishTime:new Date((0,n.parseString)(t.publishTime)),sidecarImageDigestVersion:(0,n.parseString)(t.sidecarImageDigestVersion)}}},715536:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.assertUnreachable=void 0,t.assertUnreachable=function(e){throw new Error("This function should never be called. This is for yielding compile errors on non-exhaustive case checking.")}},533192:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.toPrettyJson=t.toJson=void 0,t.toJson=function(e){return JSON.parse(e.toString())},t.toPrettyJson=function(e){return JSON.stringify(e,null,2)}},634664:(e,t,r)=>{r.d(t,{Z:()=>U});var n=r(199009),i=r(277191),a=r(426026),o=r(391762),s=r(672554),c=r(942504);class f{constructor(e,t){this.cdnClient=e,this.manifestVersion=t}async getLatestVersionMetadata(){const e=(0,c.getVersionMetadataTag)();return(await this.cdnClient.getBlob(`${e}.json`)).fold((e=>s.Either.left(e)),(e=>{try{const t=(0,s.parseVersionMetadata)(e);return s.Either.right(t)}catch(t){const e={key:"invalid-version-metadata"};return s.Either.left(e)}}))}async getManifest(e,t){const r=(0,c.getDataTagForManifest)(e,this.manifestVersion,t);return(await this.cdnClient.getBlob(`${r}.json`,e)).fold((e=>s.Either.left(e)),(e=>{try{const t=(0,s.parseArtifactManifest)(e);return s.Either.right(t)}catch(t){const e={key:"invalid-manifest"};return s.Either.left(e)}}))}async getArtifact(e,t){return this.cdnClient.getBlob(`${t}.json`,e)}}class u{constructor(){(0,n.Z)(this,"baseUrl","https://fd-config.us-east-1.prod.public.atl-paas.net")}async getBlob(e,t){const r=void 0!==t?`${this.baseUrl}/${t}/${e}`:`${this.baseUrl}/${e}`,n=await fetch(r);return n.ok?s.Either.right(await n.json()):s.Either.left({key:"unexpected-response-code",httpResponseCode:n.status,httpResponseStatusText:n.statusText})}}class d{constructor(e,t,r){this.dataSource=e,this.artifactExperience=t,this.versionMetadataExperience=r}getLatestVersionMetadata(){this.versionMetadataExperience.mark("start-fetch-metadata");const e=this.dataSource.getLatestVersionMetadata();return this.versionMetadataExperience.mark("end-fetch-metadata"),e}async getManifest(e,t){this.artifactExperience.mark("start-fetch-artifact");const r=await this.dataSource.getManifest(e,t);return r.leftMap((e=>(this.artifactExperience.failure(),e))),this.artifactExperience.mark("end-fetch-artifact"),r}async getArtifact(e,t){this.artifactExperience.mark("start-fetch-manifest");const r=await this.dataSource.getArtifact(e,t);return r.leftMap((e=>(this.artifactExperience.failure(),e))),this.artifactExperience.mark("end-fetch-manifest"),r}}function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}class h{constructor(e,t,r,n){this.fetchArtifactExperience=r,this.versionMetadataExperience=n,this.dataSource=new d(e,this.fetchArtifactExperience,this.versionMetadataExperience),this.dataSourceName=t}async getArtifact(e,t){this.fetchArtifactExperience.addMetadata(t),this.fetchArtifactExperience.start();const r=p(p({},t),{},{name:e}),n=await(0,s.getArtifactFromSource)(this.dataSource,r,"backend");return"success"===n.type?this.fetchArtifactExperience.success():(this.fetchArtifactExperience.addMetadata({error:n.type}),this.fetchArtifactExperience.failure()),(0,s.tryGetArtifactData)(n,this.dataSourceName)}async getLatestVersionMetadata(){this.versionMetadataExperience.start();return(await this.dataSource.getLatestVersionMetadata()).fold((e=>{throw this.versionMetadataExperience.addMetadata({error:e.key}),this.versionMetadataExperience.failure(),new Error(`Unable to get latest version metadata from ${this.dataSourceName} due to error: ${e.key}`)}),(e=>(this.versionMetadataExperience.success(),e)))}}class g{constructor(e,t){(0,n.Z)(this,"headers",{}),this.namespace=e,this.headers={"X-SSRF-Protection":"definitely-protected","User-Agent":t}}async getBlob(e){const t=await fetch(`${s.BaseUrls.FrontendProxyStaging}/${s.UriSegments.ConfigRegistryProxy}/api/v1/namespaces/${encodeURIComponent(this.namespace)}/tags/${e}`,{method:"GET",headers:this.headers});if(!t.ok){const e=429===t.status?{key:"rate-limit-error"}:404===t.status?{key:"live-unavailable"}:{key:"config-registry-error",error:t.status};return s.Either.left(e)}return s.Either.right(await t.json())}}class y{constructor(e){this.experience=e}start(e){return this.experience.start(e)}success(){return this.experience.success()}failure(){return this.experience.failure()}addMetadata(e){return this.experience.addMetadata(e)}mark(e){return this.experience.mark(e)}}class m{start(){return Promise.resolve()}success(){return Promise.resolve(null)}failure(){return Promise.resolve(null)}mark(){}addMetadata(){}}async function v(e,t,n){try{if(100*Math.random()>10)return new m;const{UFOExperience:i,ExperienceTypes:a,ExperiencePerformanceTypes:o}=await r.e(29453).then(r.bind(r,629453)),s=new i(e,{type:a.Operation,performanceType:o.Custom,platform:{component:"flight-deck-client"},timings:t});return s.addMetadata(n),new y(s)}catch(i){return new m}}const b=()=>v("fetch",[{key:"fetch-artifact",endMark:"end-fetch-artifact",startMark:"start-fetch-artifact"},{key:"fetch-manifest",endMark:"end-fetch-manifest",startMark:"start-fetch-manifest"}],{}),w=()=>v("fetch-version-metadata",[{key:"fetch-metadata",startMark:"start-fetch-metadata",endMark:"end-fetch-metadata"}],{});r(765737);const k="flight-deck";async function M(e,t={}){const r={environment:function(e){if(void 0===e||"prod"===e)return"prod-west";switch(e){case"stg":return"stg-west";case"adev":return"adev";case"ddev":return"ddev";case"pdev":return"pdev-apse2"}}(t.environmentType),locale:t.locale&&(0,o.Z)(t.locale)};return(await O(t)).getArtifact(e,r)}async function O(e){const t=await b(),r=await w();return void 0===e.environmentType||"prod"===e.environmentType?new h(new f(new u,s.Versions.ManifestVersion),"CDN",t,r):"adev"===e.environmentType||"pdev"===e.environmentType||"ddev"===e.environmentType||"stg"===e.environmentType?new h(new s.ConfigRegistryDataSource(s.Versions.ManifestVersion,new g(null!==(n=e.namespace)&&void 0!==n?n:k,"flight-deck-front-end-sdk")),"Config Registry",t,r):void function(e){throw new Error("This function should never be called. This is for yielding compile errors on non-exhaustive case checking.")}(e.environmentType);var n}class E extends Error{constructor({artifact:e,dimensions:t,error:r}){super(r instanceof Error&&r.message?r.message:"Unknown Flight Deck SDK error"),this.name="FlightDeckSDKError",this.error=r,this.artifact=e,this.environmentType=null==t?void 0:t.environmentType,this.locale=null==t?void 0:t.locale}}const j=(e,t)=>`${e}${t?"_"+Object.keys(t).sort().map((e=>t[e])).filter(Boolean).join("_"):""}`;var S=r(747298),x=r(288920);function P(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?P(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):P(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const A=()=>new S.Q("retrieve-artifact",{type:x.Z.Operation,performanceType:x.R.Custom,platform:{component:"flight-deck-client"}}),C=e=>e instanceof Error?_(_({},e),{},{cause:void 0}):"unknown";function T(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function $(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?T(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):T(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const D=["Failed to fetch","NetworkError when attempting to fetch resource.","Load failed"];class U{constructor(e,t={handlers:{}},r=[]){(0,n.Z)(this,"fallbackArtifactMap",new Map),(0,n.Z)(this,"fetchFromFlightDeckPromises",new Map),this.expiryMS=t.expiryMS,this.handlers=t.handlers,this.product=e,this.storageClient=new a.Z("@atlassiansox/flight-deck-frontend-client",t),r.forEach((e=>this.fallbackArtifactMap.set(j(e.name,e.dimensions),e.value))),this.captureException=this.captureException.bind(this)}captureException(e,t){this.handlers.captureException&&this.handlers.captureException(e,t)}async fetchAndCacheArtifact(e,t){const r=await(0,i.AQ)((async()=>{try{return await M(e.name,e.dimensions)}catch(t){throw new E({artifact:e.key,dimensions:e.dimensions,error:t})}}),{captureException:this.captureException,retryOn:e=>D.includes(e.message),intervalsMS:null==t?void 0:t.intervalsMS,onRetry:null==t?void 0:t.onRetry});if(!r){const t=new Error(`Missing artifact: ${e.key}`);throw this.captureException(t),t}return this.storageClient.setItemWithExpiry(e.key,r,this.expiryMS),this.fetchFromFlightDeckPromises.delete(e.key),r}async fetchArtifactPromise(e,t){if(this.fetchFromFlightDeckPromises.has(e.key))return this.fetchFromFlightDeckPromises.get(e.key);const r=this.fetchAndCacheArtifact(e,t);return this.fetchFromFlightDeckPromises.set(e.key,r),r}async fetchConfigFromFlightDeck(e,t){const r=A();r.start();try{const n=$($({},e),{},{key:j(e.name,e.dimensions)});r.addMetadata({key:n.key,product:this.product});const i=this.fetchArtifactPromise(n,t),a=this.storageClient.getItem(n.key);if(a)return r.addMetadata({configSource:"localStorage"}),a;if(this.fallbackArtifactMap.has(n.key))return r.addMetadata({configSource:"fallback"}),this.fallbackArtifactMap.get(n.key);r.addMetadata({configSource:"fetch"});return await i}catch(n){throw r.failure({metadata:{error:C(n)}}),n}finally{r.success()}}}},942504:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getVersionMetadataTag=t.getDataTagForManifest=t.getDimensionsFromTagScheme=t.generateTagScheme=t.interpolateTagScheme=void 0;function r(e){const t=/\$([A-Za-z]+)\$/g;if(!/^v\d{3}(?:-[a-z]_(\$[A-Za-z]+\$))+$/.test(e))throw new Error(`The provided tag scheme: "${e}" is invalid.\n                Tag schemes must have the following format:\n                v<3 digit number>-<letter>$<dimension_name>$\n                where -<letter>$<dimension_name>$ can be repeated\n                and all characters of <letter> and <dimension_name>\n                must be alphabetical characters\n                e.g "v001-n_$name$-d_$dimension$" is a valid tag scheme`);const r=Array.from(e.matchAll(t));try{const e=r.map((([e,t])=>t));return new Set(e)}catch(n){throw new Error(`Could not capture dimensions. Expected dimension format to look like \n             ${t}`)}}t.interpolateTagScheme=function(e,t){return Array.from(r(e)).reduce(((e,r)=>{if(t.hasOwnProperty(r))return e.replace(new RegExp(`\\$${r}\\$`,"g"),t[r]);{const e=(n=t,JSON.stringify(n,null,2));throw new Error(`Bad variable "${r}" found enclosed in '$', so cannot infer\n                     filename for artifact from tag schema: was expecting that\n                     '${r}' would be a known dimension passed in context. This\n                     is most likely a bug in Flight Deck. To help you debug, the Context\n                     received was:\n"${e}"\nOne of the keys in that object should\n                     have been '${e}'.`)}var n}),e)},t.generateTagScheme=function(e,t,r=(e=>e)){const n=new Set([...e].map(r));for(const a of n)if(!t.has(r(a)))throw new Error([`Building a tag scheme failed! The dimension '${a}' is not `,`recognized as a dimension (known dimensions are ${[...t.keys()].join(", ")}!`].join(" "));let i=`v${2..toString().padStart(3,"0")}`;for(const a of t.entries()){const[e,t]=a;n.has(e)&&(i+=`-${t}_$${e}$`)}return i},t.getDimensionsFromTagScheme=r,t.getDataTagForManifest=function(e,t,r){return void 0===r?`${e}_manifest_${t}`:`${e}_${r}_manifest_${t}`},t.getVersionMetadataTag=function(e){return e?`version_metadata_${e}`:"version_metadata"}},765737:(e,t,r)=>{var n=r(833321);var i=r(799950)},833321:function(e,t,r){var n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},n.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.parseConfigWithTargeting=void 0;var i=r(799950);function a(e){if("object"==typeof e){if(Array.isArray(e))return e.map((function(e){return a(e)}));if(e){var t=e,r=Object.keys(t);if(1===r.length&&t.defaultConfig)return new i.TargetedConfig({defaultConfig:a(t.defaultConfig)});if(2===r.length&&t.defaultConfig&&t.targeting){var s=function(e){if("object"==typeof e&&e&&!Array.isArray(e)){var t=e;if(2==Object.keys(t).length&&t.targets&&t.targetedConfig)return{type:"match",result:{targets:o(t.targets),targetedConfig:a(t.targetedConfig)}}}return{type:"no-match"}}(t.targeting);if("match"===s.type)return new i.TargetedConfig({targeting:s.result,defaultConfig:a(t.defaultConfig)})}return r.reduce((function(e,r){var i;return n(n({},e),((i={})[r]=a(t[r]),i))}),{})}return null}return e}function o(e){if(Array.isArray(e))return e.map((function(e){return{orgIds:s(e.orgIds),siteIds:s(e.siteIds),userIds:s(e.userIds)}}));throw new Error("The targets for Flight Deck targeted configuration must come in an array.")}function s(e){if(void 0!==e){if(Array.isArray(e))return e.map((function(e){if("string"==typeof e)return e;throw new Error("Identifiers for targets must be strings!")}));throw new Error("Identifier list must be an array!")}}t.parseConfigWithTargeting=a},799950:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TargetedConfig=void 0;var r=function(){function e(e){this.targetedConfigDefinition=e}return e.prototype.resolve=function(e){var t=this.targetedConfigDefinition.targeting;if(t&&t.targets.some((function(t){var r=[];return t.orgIds&&r.push({allowList:t.orgIds,identifier:e.orgId}),t.siteIds&&r.push({allowList:t.siteIds,identifier:e.siteId}),t.userIds&&r.push({allowList:t.userIds,identifier:e.userId}),0!==r.length&&r.every((function(e){return function(e){return!!e.identifier&&e.allowList.includes(e.identifier)}(e)}))})))return{type:"targeted",value:t.targetedConfig};return{type:"default",value:this.targetedConfigDefinition.defaultConfig}},e}();t.TargetedConfig=r},461547:(e,t,r)=>{r.d(t,{Z:()=>n});const n=e=>{let t;if(e instanceof Error)t=e;else if("string"==typeof e)t=new Error(e);else if("object"==typeof e)try{t=new Error("Object error instance thrown for operation: "+JSON.stringify(e))}catch(r){t=new Error("Object serialisation error thrown during operation: "+String(e))}else t=new Error("No error instance thrown for operation: "+String(e));return t}},990814:(e,t,r)=>{r.d(t,{Z:()=>i});var n=r(199009);class i extends Error{constructor({error:e,path:t,method:r}){super(),(0,n.Z)(this,"method",void 0),(0,n.Z)(this,"originalName",void 0),(0,n.Z)(this,"path",void 0),(0,n.Z)(this,"stack",void 0),this.name="FailedFetchError",this.message=e.message||"Unknown fetch error",this.stack=e.stack,this.originalName=e.name,this.method=r;const i=t.split("?")[0];this.path=/^[/-a-z]+$/i.test(i)?i:""}}},277191:(e,t,r)=>{r.d(t,{AQ:()=>c});var n=r(461547);const i=[];var a=r(990814);const o=e=>new Promise((t=>{setTimeout(t,e)})),s="No calls made",c=async(e,{intervalsMS:t=i,retryOn:r=[a.Z],captureException:c,onRetry:f})=>{const u=[...t];let d=0,l=new Error(s);for(;void 0!==d;)try{return d>0&&await o(d),f&&l.message!==s&&f(l),await e()}catch(p){l=(0,n.Z)(p),c&&c(l),d=("function"==typeof r?r(l):r.some((e=>l instanceof e)))?u.shift():void 0}throw l}},391762:(e,t,r)=>{r.d(t,{Z:()=>n});const n=e=>{const t=e.replace("_","-");switch(t){case"en-US":case"en-GB":case"pt-BR":case"zh-CN":case"zh-TW":return t;case"en-UK":return"en-GB";case"en":return"en-US";default:return t.split("-")[0]}}}}]);
//# sourceMappingURL=34664.eQo4kLPIHw.js.map