"use strict";(self._cf=self._cf||[]).push([[3421,94205],{827765:(e,t,n)=>{n.d(t,{Z:()=>o});var r=Number.isNaN||function(e){return"number"==typeof e&&e!=e};function i(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(i=e[n],o=t[n],!(i===o||r(i)&&r(o)))return!1;var i,o;return!0}function o(e,t){void 0===t&&(t=i);var n=null;function r(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];if(n&&n.lastThis===this&&t(r,n.lastArgs))return n.lastResult;var o=e.apply(this,r);return n={lastResult:o,lastArgs:r,lastThis:this},o}return r.clear=function(){n=null},r}},271888:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,i=(r=n(840506))&&r.__esModule?r:{default:r},o=n(340531);const s=e=>i.default.createElement(o.Icon,Object.assign({dangerouslySetGlyph:'<svg width="24" height="24" viewBox="0 0 24 24" role="presentation"><path d="M7 6.5c0-.276.228-.5.491-.5H13l4 4v7.5c0 .276-.228.5-.51.5H7.51a.508.508 0 01-.51-.5v-11zm5 1v2.999c0 .271.225.501.501.501H15.5L12 7.5z" fill="currentColor" fill-rule="evenodd"/></svg>'},e));s.displayName="EditorFileIcon";var a=s;t.default=a},244625:(e,t,n)=>{n.d(t,{h:()=>o,p:()=>i});var r=n(199009);class i{constructor(){(0,r.Z)(this,"listeners",{})}on(e,t){this.listeners[e]||(this.listeners[e]=new Set),this.listeners[e].add(t)}has(e,t){return!!this.listeners[e]&&this.listeners[e].has(t)}off(e,t){this.listeners[e]&&this.listeners[e].has(t)&&this.listeners[e].delete(t)}emit(e,t){this.listeners[e]&&this.listeners[e].forEach((e=>e(t)))}destroy(){this.listeners={}}}function o(e){return(t,n)=>{if(!t)throw new Error("event name is required!");e.emit(function(e){return"string"==typeof e?e:e.key}(t),n)}}},344597:(e,t,n)=>{n.d(t,{h:()=>ae});var r=n(199009),i=n(840506),o=n(568846),s=n(423196),a=n(827765),d=n(773543),c=n(777163),l=n(615919),p=n(872342),h=n(39030),u=n(777014),m=n.n(u),v=n(131819),f=n(264141),y=n(310151),g=n(170080),x=n(271888);const b=({node:e,type:t})=>{if(!e.attrs.parameters)return;const{macroMetadata:n}=e.attrs.parameters;if(n&&n.placeholder){let e;return n.placeholder.forEach((n=>{n.type===t&&n.data&&n.data.url&&(e=n.data)})),e}};var w=n(16728);const E=h.iv`
  background: ${`var(--ds-background-neutral, ${w.IR})`};
  border-radius: ${"var(--ds-border-radius, 3px)"};
  position: relative;
  vertical-align: middle;

  .ProseMirror-selectednode > span > & > .extension-overlay {
    box-shadow: inset 0px 0px 0px 2px ${`var(--ds-border-selected, ${w.VY})`};
    opacity: 1;
  }

  &.with-overlay {
    .extension-overlay {
      background: ${`var(--ds-background-neutral-hovered, ${w.os})`};
      color: transparent;
    }

    &:hover .extension-overlay {
      opacity: 1;
    }
  }
`,Z=h.iv`
  border-radius: ${"var(--ds-border-radius, 3px)"};
  position: absolute;
  width: 100%;
  height: 100%;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s;
`,S=h.iv`
  display: inline-flex;
  align-items: center;

  & > img {
    margin: 0 ${"var(--ds-space-050, 4px)"};
  }
  /* TODO: fix in develop: https://atlassian.slack.com/archives/CFG3PSQ9E/p1647395052443259?thread_ts=1647394572.556029&cid=CFG3PSQ9E */
  /* stylelint-disable-next-line */
  label: placeholder-fallback;
`,A=h.iv`
  display: inline-block;
  max-width: 200px;
  margin-left: 5px;
  color: ${`var(--ds-text-subtlest, ${w.n2})`};
  text-overflow: ellipsis;
  white-space: nowrap;
  overflow: hidden;
`,R=h.iv`
  max-height: 16px;
  max-width: 16px;
  /* TODO: fix in develop: https://atlassian.slack.com/archives/CFG3PSQ9E/p1647395052443259?thread_ts=1647394572.556029&cid=CFG3PSQ9E */
  /* stylelint-disable-next-line */
  label: lozenge-image;
`,N=["url"];class P extends i.Component{render(){const{node:e}=this.props,t=b({node:e,type:"image"});if(t&&"extension"!==e.type.name)return this.renderImage(t);const n=b({node:e,type:"icon"});return this.renderFallback(n)}renderImage(e){const{extensionKey:t}=this.props.node.attrs,{url:n}=e,r=(0,p.Z)(e,N);return(0,h.tZ)("img",(0,l.Z)((0,l.Z)({css:R,src:n},r),{},{alt:t}))}renderFallback(e){const{parameters:t,extensionKey:n}=this.props.node.attrs,{name:r}=this.props.node.type,i=t&&t.macroParams,o=t&&t.extensionTitle||t&&t.macroMetadata&&t.macroMetadata.title||n,s="extension"===r;return(0,h.tZ)("div",{"data-testid":"lozenge-fallback",css:S},e&&!s?this.renderImage((0,l.Z)({height:24,width:24},e)):(0,h.tZ)(x.default,{label:o}),(0,h.tZ)("span",{className:"extension-title"},(a=o).charAt(0).toUpperCase()+a.slice(1)),i&&!s&&(0,h.tZ)("span",{css:A},Object.keys(i).map((e=>e&&` | ${e} = ${i[e].value}`))));var a}}P.displayName="ExtensionLozenge";var C=n(114657);const T=h.iv`
  ${E}

  &.without-frame {
    background: transparent;
  }
  cursor: pointer;
  width: 100%;

  .extension-overflow-wrapper:not(.with-body) {
    overflow-x: auto;
  }
`,O=h.iv`
  padding: ${C.m/2}px ${C.m/2}px 0px;
  vertical-align: middle;

  &.with-children:not(.without-frame) {
    padding: ${"var(--ds-space-050, 4px)"} ${"var(--ds-space-100, 8px)"}
      ${"var(--ds-space-100, 8px)"};
  }
  &.without-frame {
    padding: 0;
  }
`,D=h.iv`
  padding: ${C.m}px;
  background: ${"var(--ds-surface, white)"};
  border: 1px solid ${`var(--ds-border, ${w.gt})`};
  border-radius: ${"var(--ds-border-radius, 3px)"};
  cursor: initial;
  width: 100%;
`,I=h.iv`
  padding: 0 ${C.m}px ${C.m}px;
  display: flex;
  justify-content: center;
`,k=["type"];function $(e){const{node:t,handleContentDOMRef:n,children:r,widthState:o={width:0},handleRef:s,shadowClassNames:a,hideFrame:d,editorAppearance:c}=e,u=["bodiedExtension","multiBodiedExtension"].includes(t.type.name),v=!!r,f=d&&!("mobile"===c)&&!u||!1,{getPos:y,view:x}=e,b=i.useMemo((()=>{const e="function"==typeof y?y():void 0;return void 0!==e&&!isNaN(e)&&0===x.state.doc.resolve(e).depth}),[x,y]),w=["full-width","wide"].includes(t.attrs.layout)&&b&&"full-width"!==c,E=m()("extension-container","block",a,{"with-overlay":!u,"without-frame":f,"wider-layout":w}),S=m()({"with-children":v,"without-frame":f});let A={width:"100%"},R={};if(w){const e=(0,g.wV)({mode:t.attrs.layout,widthStateWidth:o.width,widthStateLineLength:o.lineLength}),{type:n}=e,r=(0,p.Z)(e,k);R=(0,l.Z)({},r),A=r}return R=(0,l.Z)((0,l.Z)({},R),I),(0,h.tZ)("div",{ref:s,"data-layout":t.attrs.layout,className:E,css:T,style:A},(0,h.tZ)("div",{className:"extension-overflow-wrapper "+(u?"with-body":"")},(0,h.tZ)("div",{css:Z,className:"extension-overlay"}),(0,h.tZ)("div",{css:O,contentEditable:!1,className:S},!f&&(0,h.tZ)(P,{node:t}),r),u&&(0,h.tZ)("div",{css:R},(0,h.tZ)("div",{css:D,ref:n,className:"extension-content block"}))))}$.displayName="ExtensionWithPluginState";const M=e=>{const{pluginInjectionApi:t}=e,{widthState:n}=(0,f.B)(t,["width"]);return(0,h.tZ)($,(0,l.Z)({widthState:n},e))};M.displayName="ExtensionWithSharedState";const _={key:"widthPlugin$",getState:e=>e.widthPlugin$},F=e=>(0,h.tZ)(v.f,{editorView:e.view,plugins:{widthState:_},render:({widthState:t})=>(0,h.tZ)($,(0,l.Z)({widthState:t},e))});F.displayName="ExtensionDeprecated";const V=(0,y.Z)((e=>{const{pluginInjectionApi:t}=e;return void 0===t?(0,h.tZ)(F,(0,l.Z)({},e)):(0,h.tZ)(M,(0,l.Z)({},e))}),{overflowSelector:".extension-overflow-wrapper"}),j=h.iv`
  ${E}

  cursor: pointer;
  display: inline-flex;
  margin: 1px 1px ${"var(--ds-space-050, 4px)"};

  > img {
    border-radius: ${"var(--ds-border-radius, 3px)"};
  }

  &::after,
  &::before {
    vertical-align: text-top;
    display: inline-block;
    width: 1px;
    content: '';
  }

  &.with-children {
    padding: 0;
    background: ${"var(--ds-background-neutral-subtle, white)"};
  }
`;class W extends i.Component{render(){const{node:e,children:t}=this.props,n=!!t?"with-overlay with-children":"with-overlay";return(0,h.tZ)("div",{css:j,className:`extension-container inline ${n}`},(0,h.tZ)("div",{css:Z,className:"extension-overlay"}),t||(0,h.tZ)(P,{node:e}))}}W.displayName="InlineExtension";var L=n(547357),B=n(178825),U=n(443998),H=n(431676),K=n(244625),z=n(667266);const G=(e,t,n)=>{(0,K.h)(n)(z.DQ,{payload:{action:e,actionSubject:H.Wt.MULTI_BODIED_EXTENSION,eventType:H.Ze.TRACK,attributes:{extensionType:t.attrs.extensionType,extensionKey:t.attrs.extensionKey,localId:t.attrs.localId,maxFramesCount:t.attrs.maxFrames,currentFramesCount:t.content.childCount}}})},J=h.iv`
  ${E};
  cursor: pointer;
  .extension-title {
    display: flex;
    align-items: center;
    line-height: 16px !important;
    margin-bottom: ${"var(--ds-space-100, 8px)"};
    margin-left: ${"var(--ds-space-050, 4px)"} !important;
    margin-right: ${"var(--ds-space-100, 8px)"};
    padding-top: ${"var(--ds-space-100, 8px)"} !important;
  }
`,q=h.iv`
  background: transpaent !important;
  padding: {
    bottom: ${"var(--ds-space-100, 8px)"} !important;
    left: ${"var(--ds-space-100, 8px)"} !important;
    right: ${"var(--ds-space-100, 8px)"} !important;
  }
  padding-bottom: ${"var(--ds-space-100, 8px)"};
  position: relative;
  vertical-align: middle;
  cursor: pointer;

  .multiBodiedExtension-content-dom-wrapper > [data-extension-frame='true'] {
    display: none;
    background: ${"var(--ds-surface, white)"};
  }
`,Q=h.iv`
  // make sure the user can't see a range selection inside the navigation
  // This is really important to keep the navigation working properly
  border-top-left-radius: ${"var(--ds-border-radius, 3px)"};
  border-top-right-radius: ${"var(--ds-border-radius, 3px)"};

  user-select: none;
  -webkit-user-modify: read-only;
  border: 1px solid ${`var(--ds-border, ${w.YS})`};
  border-bottom: none;
  background: ${"var(--ds-surface, white)"};
  margin-left: ${"var(--ds-space-100, 8px)"};
  margin-right: ${"var(--ds-space-100, 8px)"};
`,Y=h.iv`
  padding: ${"var(--ds-space-100, 8px)"} !important;
  border: 1px solid ${`var(--ds-border, ${w.gt})`};
  display: block;
  min-height: 100px;
  background: ${"var(--ds-surface, white)"};
  border-bottom-left-radius: ${"var(--ds-border-radius, 3px)"};
  border-bottom-right-radius: ${"var(--ds-border-radius, 3px)"};

  margin-left: ${"var(--ds-space-100, 8px)"};
  margin-right: ${"var(--ds-space-100, 8px)"};
  cursor: initial;

  .pm-table-container {
    margin-left: ${"var(--ds-space-100, 8px)"} !important;
    padding-right: ${"var(--ds-space-200, 16px)"} !important;
  }
  .pm-table-with-controls {
    margin-left: ${"var(--ds-space-150, 12px)"} !important;
    padding-right: ${"var(--ds-space-150, 12px)"} !important;
  }
  .bodiedExtensionView-content-wrap {
    margin-top: ${"var(--ds-space-150, 12px)"} !important;
  }
  // Extension wrap have an additional margin on all four borders, so we need to adjust the spacing
  // compared to the bodiedExtensionView-content-wrap
  .extensionView-content-wrap {
    margin-top: ${"var(--ds-space-100, 8px)"} !important;
  }
`,X=["url"],ee=(e,t)=>{if(e){const{url:n}=e,r=(0,p.Z)(e,X);return(0,h.tZ)("div",{className:"extension-title"},(0,h.tZ)("img",(0,l.Z)((0,l.Z)({css:h.iv`
            max-height: 24px;
            max-width: 24px;
          `,src:n},r),{},{alt:t})),t)}return(0,h.tZ)("div",{className:"extension-title"},(0,h.tZ)(x.default,{label:t}),t)};ee.displayName="getWrapperTitleContent";const te=({node:e,handleContentDOMRef:t,getPos:n,tryExtensionHandler:r,editorView:o,eventDispatcher:s,widthState:a,editorAppearance:d})=>{const{parameters:c,extensionKey:p}=e.attrs,u=c&&c.extensionTitle||c&&c.macroMetadata&&c.macroMetadata.title||p||e.type.name,v=b({node:e,type:"image"}),[f,y]=(0,i.useState)(0),x=(({updateActiveChild:e,editorView:t,getPos:n,node:r,eventDispatcher:o})=>i.useMemo((()=>({changeActive(n){const{state:i,dispatch:s}=t,a=e(n);o&&G(H.om.CHANGE_ACTIVE,r,o);const d=i.doc.nodeAt(i.tr.selection.from);let c=i.tr.selection.from||0;if(d&&null!=d&&d.content){for(let e=0;e<=n&&e<(null==d||null===(l=d.content)||void 0===l?void 0:l.childCount);e++){var l,p;c+=(null==d||null===(p=d.content)||void 0===p||null===(p=p.child(e))||void 0===p?void 0:p.nodeSize)||0}s(i.tr.setSelection(new U.Bs(i.doc.resolve(c-1))))}return a},addChild(){const{state:e,dispatch:i}=t;if(r.content.childCount>=r.attrs.maxFrames)throw new Error(`Cannot add more than ${r.attrs.maxFrames} frames`);const s=e.schema.nodes.paragraph.createAndFill({});if(!s)throw new Error("Could not create paragraph");const a=e.schema.nodes.extensionFrame.createAndFill({},[s]),d=n();if("number"!=typeof d||!a)throw new Error("Could not create frame or position not valid");const c=Math.min((d||1)+r.content.size,e.doc.content.size);return i(e.tr.insert(c,a)),o&&G(H.om.ADD_CHILD,r,o),!0},getChildrenCount:()=>r.content.childCount,removeChild(e){const i=n();if("number"!=typeof i||"number"!=typeof e)throw new Error("Position or index not valid");const{state:s,dispatch:a}=t;if(1===r.content.childCount){const e=s.tr;return e.deleteRange(i,i+r.content.size),a(e),!0}const d=s.doc.resolve(i),c=s.doc.resolve(d.start(d.depth+1)).posAtIndex(e),l=s.doc.nodeAt(c);if(!l)throw new Error("Could not find frame node");const p=l.content.size+c,h=s.tr;return h.deleteRange(c,p),a(h),o&&G(H.om.REMOVE_CHILD,r,o),!0},updateParameters(e){var i;const{state:s,dispatch:a}=t,d=n();if("number"!=typeof d)throw new Error("Position not valid");const c=(0,l.Z)((0,l.Z)({},r.attrs),{},{parameters:(0,l.Z)((0,l.Z)({},r.attrs.parameters),{},{macroParams:(0,l.Z)((0,l.Z)({},null===(i=r.attrs)||void 0===i||null===(i=i.parameters)||void 0===i?void 0:i.macroParams),e)})});return a(s.tr.setNodeMarkup(d,null,c)),o&&G(H.om.UPDATE_PARAMETERS,r,o),!0},getChildren(){var e;const{state:i}=t,s=n();if("number"!=typeof s)return[];const a=null===(e=i.doc.nodeAt(s))||void 0===e?void 0:e.content;return o&&G(H.om.GET_CHILDERN,r,o),a?a.toJSON():[]}})),[r,t,n,e,o]))({updateActiveChild:i.useCallback((e=>{if("number"!=typeof e)throw y(0),new Error("Index is not valid");return y(e),!0}),[y]),editorView:o,getPos:n,eventDispatcher:s,node:e}),w=i.useMemo((()=>r(x)),[r,x]),E=i.useCallback((e=>t(e)),[t]),Z=h.iv`
    ${q};
    .multiBodiedExtension-content-dom-wrapper
      > [data-extension-frame='true']:nth-of-type(${f+1}) {
      ${Y}
    }
  `;let S={};if(["full-width","wide"].includes(e.attrs.layout)&&"full-width"!==d){const t=(0,g.wV)({mode:e.attrs.layout,widthStateLineLength:null==a?void 0:a.lineLength,widthStateWidth:null==a?void 0:a.width});S=(0,B.Z)({},((0,L.Z)(t),t))}const A=m()("multiBodiedExtension--wrapper","extension-container","block");return(0,h.tZ)("div",{className:A,css:J,"data-testid":"multiBodiedExtension--wrapper",style:S},ee(v,u),(0,h.tZ)("div",{className:"multiBodiedExtension--container",css:Z,"data-testid":"multiBodiedExtension--container","data-active-child-index":f},(0,h.tZ)("nav",{className:"multiBodiedExtension-navigation",css:Q,"data-testid":"multiBodiedExtension-navigation"},w),(0,h.tZ)("article",{className:"multiBodiedExtension--frames","data-testid":"multiBodiedExtension--frames",ref:E})))};te.displayName="MultiBodiedExtensionWithWidth";const ne=e=>{const{pluginInjectionApi:t}=e,{widthState:n}=(0,f.B)(t,["width"]);return(0,h.tZ)(te,(0,l.Z)({widthState:n},e))};ne.displayName="MultiBodiedExtensionWithSharedState";const re={key:"widthPlugin$",getState:e=>e.widthPlugin$},ie=e=>(0,h.tZ)(v.f,{editorView:e.editorView,plugins:{widthState:re},render:({widthState:t})=>(0,h.tZ)(te,(0,l.Z)({widthState:t},e))});ie.displayName="MultiBodiedExtensionDeprecated";const oe=e=>{const{pluginInjectionApi:t}=e;return void 0===t?(0,h.tZ)(ie,(0,l.Z)({},e)):(0,h.tZ)(ne,(0,l.Z)({},e))};class se extends i.Component{constructor(...e){super(...e),(0,r.Z)(this,"privatePropsParsed",!1),(0,r.Z)(this,"state",{}),(0,r.Z)(this,"mounted",!1),(0,r.Z)(this,"getNodeRenderer",(0,a.Z)(d.ZY)),(0,r.Z)(this,"getExtensionModuleNodePrivateProps",(0,a.Z)(d.tV)),(0,r.Z)(this,"setStateFromPromise",((e,t)=>{t&&t.then((t=>{this.mounted&&this.setState({[e]:t})}))})),(0,r.Z)(this,"parsePrivateNodePropsIfNeeded",(async()=>{if(this.privatePropsParsed||!this.state.extensionProvider)return;this.privatePropsParsed=!0;const{extensionType:e,extensionKey:t}=this.props.node.attrs;try{const n=await this.getExtensionModuleNodePrivateProps(this.state.extensionProvider,e,t);this.setState({_privateProps:n})}catch(n){console.error("Provided extension handler has thrown an error\n",n)}})),(0,r.Z)(this,"handleExtension",((e,t)=>{var n;const{extensionHandlers:r,editorView:o}=this.props,{extensionType:s,extensionKey:a,parameters:d,text:l}=e.attrs;if("bodiedExtension"===e.type.name)return;const p=null==e||null===(n=e.marks)||void 0===n||null===(n=n.find((e=>"fragment"===e.type.name)))||void 0===n||null===(n=n.attrs)||void 0===n?void 0:n.localId,h={type:e.type.name,extensionType:s,extensionKey:a,parameters:d,content:l,localId:e.attrs.localId,fragmentLocalId:p};let u;if(r&&r[s]){u=(0,c.c)(r[s])(h,o.state.doc,t)}if(!u){const e=this.state.extensionProvider&&this.getNodeRenderer(this.state.extensionProvider,s,a);if(e){const n=e;return"multiBodiedExtension"===h.type?i.createElement(n,{node:h,references:this.props.references,actions:t}):i.createElement(n,{node:h,references:this.props.references})}}return u}))}UNSAFE_componentWillMount(){this.mounted=!0}componentDidMount(){const{extensionProvider:e}=this.props;e&&this.setStateFromPromise("extensionProvider",e)}componentDidUpdate(){this.parsePrivateNodePropsIfNeeded()}componentWillUnmount(){this.mounted=!1}UNSAFE_componentWillReceiveProps(e){const{extensionProvider:t}=e;t&&this.props.extensionProvider!==t&&this.setStateFromPromise("extensionProvider",t)}render(){var e;const{node:t,handleContentDOMRef:n,editorView:r,references:o,editorAppearance:s,pluginInjectionApi:a,getPos:d,eventDispatcher:c}=this.props;if("multiBodiedExtension"===t.type.name)return i.createElement(oe,{node:t,editorView:r,getPos:d,handleContentDOMRef:n,tryExtensionHandler:this.tryExtensionHandler.bind(this),eventDispatcher:c,pluginInjectionApi:a,editorAppearance:s});const l=this.tryExtensionHandler(void 0);switch(t.type.name){case"extension":case"bodiedExtension":return i.createElement(V,{node:t,getPos:this.props.getPos,references:o,extensionProvider:this.state.extensionProvider,handleContentDOMRef:n,view:r,editorAppearance:s,hideFrame:null===(e=this.state._privateProps)||void 0===e?void 0:e.__hideFrame,pluginInjectionApi:a},l);case"inlineExtension":return i.createElement(W,{node:t},l);default:return null}}tryExtensionHandler(e){const{node:t}=this.props;try{const n=this.handleExtension(t,e);if(n&&i.isValidElement(n))return n}catch(n){console.error("Provided extension handler has thrown an error\n",n)}return null}}se.displayName="ExtensionComponent";class ae extends i.Component{constructor(e){super(e),(0,r.Z)(this,"providerFactory",void 0),(0,r.Z)(this,"renderWithProvider",(({extensionProvider:e})=>{const{node:t,getPos:n,editorView:r,handleContentDOMRef:o,extensionHandlers:s,references:a,editorAppearance:d,pluginInjectionApi:c,eventDispatcher:l}=this.props;return i.createElement(se,{editorView:r,node:t,getPos:n,references:a,extensionProvider:e,handleContentDOMRef:o,extensionHandlers:s,editorAppearance:d,pluginInjectionApi:c,eventDispatcher:l})})),this.providerFactory=e.providerFactory||new o.Z}componentWillUnmount(){this.props.providerFactory||this.providerFactory.destroy()}render(){return i.createElement(s.S,{providers:["extensionProvider"],providerFactory:this.providerFactory,renderNode:this.renderWithProvider})}}ae.displayName="Extension",(0,r.Z)(ae,"displayName","Extension")},850172:(e,t,n)=>{n.d(t,{z:()=>o});var r=n(840506),i=n(152475);const o=({children:e,nodeType:t})=>r.createElement("span",null,e,"inlineExtension"===t&&i.$);o.displayName="ExtensionNodeWrapper"},887641:(e,t,n)=>{n.d(t,{Z:()=>d,b:()=>a});var r=n(840506),i=n(15660),o=n(344597),s=n(850172);class a extends i.ZP{ignoreMutation(e){return this.node.type.isAtom||"selection"!==e.type&&"data-layout"!==e.attributeName}getContentDOM(){if(this.node.isInline)return;const e=document.createElement("div");return e.className=`${this.node.type.name}-content-dom-wrapper`,{dom:e}}render(e,t){var n;return r.createElement(s.z,{nodeType:this.node.type.name},r.createElement(o.h,{editorView:this.view,node:this.node,eventDispatcher:this.eventDispatcher,getPos:this.getPos,providerFactory:e.providerFactory,handleContentDOMRef:t,extensionHandlers:e.extensionHandlers,editorAppearance:null===(n=e.extensionNodeViewOptions)||void 0===n?void 0:n.appearance,pluginInjectionApi:e.pluginInjectionApi}))}}function d(e,t,n,r,i,o){return(s,d,c)=>new a(s,d,c,e,t,{providerFactory:n,extensionHandlers:r,extensionNodeViewOptions:i,pluginInjectionApi:o},void 0,void 0,void 0,!0).init()}a.displayName="ExtensionNode"},264141:(e,t,n)=>{n.d(t,{B:()=>d});var r=n(615919),i=n(840506),o=n(394367),s=n.n(o);function a(e,t){return Object.entries(e).reduce(((e,[n,i])=>(0,r.Z)((0,r.Z)({},e),{},{[n]:t(i)})),{})}function d(e,t){const n=function(e){return(0,i.useMemo)((()=>e),[])}(t);return function(e){const[t,n]=(0,i.useState)(a(e,(e=>null==e?void 0:e.sharedState.currentState()))),o=(0,i.useRef)({}),d=(0,i.useRef)(!1);return(0,i.useLayoutEffect)((()=>{const t=s()((()=>{n((e=>(0,r.Z)((0,r.Z)({},e),o.current)))}));d.current&&(o.current=a(e,(e=>null==e?void 0:e.sharedState.currentState())),t());const i=Object.entries(e).map((([e,n])=>null==n?void 0:n.sharedState.onChange((({nextSharedState:n,prevSharedState:r})=>{r!==n&&(o.current[e]=n,t())}))));return d.current=!0,()=>{o.current={},i.forEach((e=>null==e?void 0:e()))}}),[e]),t}((0,i.useMemo)((()=>n.reduce(((t,n)=>(0,r.Z)((0,r.Z)({},t),{},{[`${n}State`]:null==e?void 0:e[n]})),{})),[e,n]))}},15660:(e,t,n)=>{n.d(t,{ZP:()=>p});var r=n(615919),i=n(199009),o=n(840506),s=n(431676),a=n(244625),d=n(108678),c=n(306665),l=n(667266);class p{constructor(e,t,n,r,o,s,d,c=!1,p,h=!1){(0,i.Z)(this,"domRef",void 0),(0,i.Z)(this,"contentDOMWrapper",void 0),(0,i.Z)(this,"reactComponent",void 0),(0,i.Z)(this,"portalProviderAPI",void 0),(0,i.Z)(this,"hasAnalyticsContext",void 0),(0,i.Z)(this,"_viewShouldUpdate",void 0),(0,i.Z)(this,"eventDispatcher",void 0),(0,i.Z)(this,"hasIntlContext",void 0),(0,i.Z)(this,"decorations",[]),(0,i.Z)(this,"reactComponentProps",void 0),(0,i.Z)(this,"view",void 0),(0,i.Z)(this,"getPos",void 0),(0,i.Z)(this,"contentDOM",void 0),(0,i.Z)(this,"node",void 0),(0,i.Z)(this,"handleRef",(e=>this._handleRef(e))),(0,i.Z)(this,"dispatchAnalyticsEvent",(e=>{if(this.eventDispatcher){(0,a.h)(this.eventDispatcher)(l.DQ,{payload:e})}})),this.node=e,this.view=t,this.getPos=n,this.portalProviderAPI=r,this.reactComponentProps=s||{},this.reactComponent=d,this.hasAnalyticsContext=c,this._viewShouldUpdate=p,this.eventDispatcher=o,this.hasIntlContext=h}init(){this.domRef=this.createDomRef(),this.setDomAttrs(this.node,this.domRef);const{dom:e,contentDOM:t}=this.getContentDOM()||{dom:void 0,contentDOM:void 0};this.domRef&&e&&(this.domRef.appendChild(e),this.contentDOM=t||e,this.contentDOMWrapper=e||t),this.domRef.classList.add(`${this.node.type.name}View-content-wrap`);const{samplingRate:n,slowThreshold:r,trackingEnabled:i}=(0,c.Rz)(this.view);return i&&(0,c.vy)({nodeTypeName:this.node.type.name}),this.renderReactComponent((()=>this.render(this.reactComponentProps,this.handleRef))),i&&(0,c.qH)({nodeTypeName:this.node.type.name,dispatchAnalyticsEvent:this.dispatchAnalyticsEvent,samplingRate:n,slowThreshold:r}),this}renderReactComponent(e){if(!this.domRef||!e)return;this.portalProviderAPI.render((()=>{var t,n;return o.createElement(d.S,{component:s.Wt.REACT_NODE_VIEW,componentId:null!==(t=null==this||null===(n=this.node)||void 0===n||null===(n=n.type)||void 0===n?void 0:n.name)&&void 0!==t?t:s.VJ.UNKNOWN_NODE,dispatchAnalyticsEvent:this.dispatchAnalyticsEvent},e())}),this.domRef,this.hasAnalyticsContext,this.hasIntlContext)}createDomRef(){if(!this.node.isInline)return document.createElement("div");return document.createElement("span")}getContentDOM(){}_handleRef(e){const t=this.contentDOMWrapper||this.contentDOM;e&&t&&!e.contains(t)&&e.appendChild(t)}render(e,t){return this.reactComponent?o.createElement(this.reactComponent,(0,r.Z)({view:this.view,getPos:this.getPos,node:this.node,forwardRef:t},e)):null}update(e,t,n,r=(()=>!0)){const i=this.node.type===e.type&&r(this.node,e);return this.decorations=t,!!i&&(this.domRef&&!this.node.sameMarkup(e)&&this.setDomAttrs(e,this.domRef),this.viewShouldUpdate(e,t)?(this.node=e,this.renderReactComponent((()=>this.render(this.reactComponentProps,this.handleRef))),!0):(this.node=e,!0))}viewShouldUpdate(e,t){return!this._viewShouldUpdate||this._viewShouldUpdate(e)}setDomAttrs(e,t){Object.keys(e.attrs||{}).forEach((n=>{t.setAttribute(n,e.attrs[n])}))}get dom(){return this.domRef}destroy(){this.domRef&&(this.portalProviderAPI.remove(this.domRef),this.domRef=void 0,this.contentDOM=void 0)}static fromComponent(e,t,n,r,i,o=!1){return(s,a,d)=>new p(s,a,d,t,n,r,e,!1,i,o).init()}}p.displayName="ReactNodeView"},704825:(e,t,n)=>{n.d(t,{J:()=>o});var r=n(199009),i=n(443998);class o extends i.Sy{constructor(e){super((e=>{var t;if(null==e||null===(t=e.props)||void 0===t||!t.nodeViews)return e;const n=e.props.nodeViews,r=new Proxy(n,{get(e,t,n){const r=new Proxy(Reflect.get(e,t,n),{apply(e,t,n){const[r,i,o,...s]=n,a=(()=>{try{return o()}catch(e){return}}).bind(t);return Reflect.apply(e,t,[r,i,a,...s])}});return r}});return e.props.nodeViews=r,e})(e)),(0,r.Z)(this,"_isATypeSafePlugin",void 0)}}},108678:(e,t,n)=>{n.d(t,{S:()=>a});var r=n(199009),i=n(840506),o=n(431676),s=n(813719);class a extends i.Component{constructor(...e){super(...e),(0,r.Z)(this,"state",{errorCaptured:!1})}hasFallback(){return void 0!==this.props.fallbackComponent}shouldRecover(){return this.hasFallback()&&this.state.errorCaptured}componentDidCatch(e,t){this.props.dispatchAnalyticsEvent&&this.props.dispatchAnalyticsEvent({action:o.om.EDITOR_CRASHED,actionSubject:this.props.component,actionSubjectId:this.props.componentId,eventType:o.Ze.OPERATIONAL,attributes:{error:e,errorInfo:t,errorRethrown:!this.hasFallback()}}),(0,s.O)(e,{location:"editor-common"}),this.hasFallback()&&this.setState({errorCaptured:!0})}render(){return this.shouldRecover()?this.props.fallbackComponent:this.props.children}}a.displayName="ErrorBoundary"},325413:(e,t,n)=>{n.d(t,{yZ:()=>F,qh:()=>U,O3:()=>$,RK:()=>M,Fp:()=>L,RL:()=>_,Lf:()=>B,wt:()=>V,wy:()=>j});var r=n(334006),i=n(615919),o=n(710358);const s=e=>{let t=!1;return{transformedAdf:(0,o.f)(e,{text:e=>{if((e=>{var t;const n=null===(t=e.marks)||void 0===t?void 0:t.map((e=>e.type));return(null==n?void 0:n.includes("link"))&&(null==n?void 0:n.includes("code"))})(e))return t=!0,(e=>e.marks?(0,i.Z)((0,i.Z)({},e),{},{marks:e.marks.filter((e=>"code"!==e.type))}):e)(e)}}),isTransformed:t}},a=new Set(["strong","underline","textColor","link","em","subsup","strike"]),d=e=>{let t=!1,n=[];const r=(0,o.f)(e,{text:e=>{if((e=>{var t;const n=null===(t=e.marks)||void 0===t||null===(t=t.map((e=>e.type)))||void 0===t?void 0:t.filter((e=>a.has(e)||"annotation"===e));return!(null==n||!n.length)&&new Set(n).size!==n.length})(e)){const r=(e=>{const t=new Map,n=new Map,r=[];if(a.forEach((e=>{t.set(e,!1)})),!e.marks)return{discardedMarks:r};let o=e.marks.filter((e=>{const i=e.type;if("annotation"===i){var o;const t=null===(o=e.attrs)||void 0===o?void 0:o.id;return n.has(t)?(r.push(e),!1):(n.set(t,!0),!0)}return!t.has(i)||(t.get(i)?(r.push(e),!1):(t.set(i,!0),!0))}));return{node:(0,i.Z)((0,i.Z)({},e),{},{marks:o}),discardedMarks:r}})(e),o=r.discardedMarks;if(o.length)return n.push(...o),t=!0,r.node}}});return{transformedAdf:r,isTransformed:t,discardedMarks:n}},c=e=>({type:"text",text:e});function l(e){return"string"==typeof e?c(e):e}const p=(...e)=>{return{type:"paragraph",content:(t=e,t.map(l))};var t},h=e=>({type:"listItem",content:e}),u=e=>({type:"tableRow",content:e}),m=e=>(...t)=>({type:"tableCell",attrs:e,content:t}),v=e=>{var t;return!(null!=e&&null!==(t=e.content)&&void 0!==t&&t.length)},f=e=>"tableCell"===e.type?[p()]:[],y=e=>t=>{if(v(t))return e(),(0,i.Z)((0,i.Z)({},t),{},{content:f(t)})},g=e=>t=>{if((e=>{var t;return null===(t=e.content)||void 0===t?void 0:t.some((e=>"listItem"!==(null==e?void 0:e.type)))})(t)||(e=>{var t;return null===(t=e.content)||void 0===t?void 0:t.some((e=>{var t;return"listItem"===(null==e?void 0:e.type)&&!(null!==(t=e.content)&&void 0!==t&&t.length)}))})(t))return e(),(0,i.Z)((0,i.Z)({},t),{},{content:(n=t,null===(r=n.content)||void 0===r?void 0:r.map((e=>{if(e)switch(e.type){case"listItem":return v(e)?h([p()]):e;case"text":return h([p(e)]);default:return h([e])}return e})))});var n,r},x=e=>{var t;const n=(e=>{var t;let n=1;return null===(t=e.content)||void 0===t||t.forEach((e=>{var t;"tableRow"===(null==e?void 0:e.type)&&"number"==typeof(null===(t=e.content)||void 0===t?void 0:t.length)&&e.content.length>n&&(n=e.content.length)})),n})(e);return null===(t=e.content)||void 0===t?void 0:t.map((e=>{if(e)switch(e.type){case"text":return u([m({})(p(e)),...new Array(n-1).fill(m({})(p()))]);case"tableCell":return u([e]);case"tableRow":return v(e)?u([...new Array(n).fill(m({})(p()))]):e;default:return e}return e}))},b=e=>t=>{if((e=>{var t;return null==e||null===(t=e.content)||void 0===t?void 0:t.some((e=>{var t;return"tableRow"===(null==e?void 0:e.type)&&0===(null==e||null===(t=e.content)||void 0===t?void 0:t.length)}))})(t)||(e=>{var t;return null===(t=e.content)||void 0===t?void 0:t.some((e=>"tableRow"!==(null==e?void 0:e.type)))})(t))return e(),(0,i.Z)((0,i.Z)({},t),{},{content:x(t)})},w=e=>t=>{if(v(t))return e(),!1},E=e=>{let t=!1;const n=()=>{t=!0};let r=(0,o.f)(e,{tableCell:y(n)});return r=(0,o.f)(r||e,{mediaSingle:w(n)}),r=(0,o.f)(r||e,{bulletList:g(n),orderedList:g(n),table:b(n)}),{transformedAdf:r,isTransformed:t}},Z=e=>{var t,n;return null!==(t=null===(n=e.content)||void 0===n?void 0:n.some((e=>{var t;return"heading"===(null==e?void 0:e.type)&&(null==e||null===(t=e.marks)||void 0===t?void 0:t.some((e=>"indentation"===e.type)))})))&&void 0!==t&&t},S=e=>{var t;return(0,i.Z)((0,i.Z)({},e),{},{content:null===(t=e.content)||void 0===t?void 0:t.map((e=>{var t;return"heading"===(null==e?void 0:e.type)?(0,i.Z)((0,i.Z)({},e),{},{marks:null===(t=e.marks)||void 0===t?void 0:t.filter((e=>"indentation"!==e.type))}):e}))})},A=e=>{let t=!1;return{transformedAdf:(0,o.f)(e,{tableCell:e=>{if(Z(e))return t=!0,S(e)},tableHeader:e=>{if(Z(e))return t=!0,S(e)}}),isTransformed:t}},R=(e,t)=>{let n={};return e.forEach(((e,r)=>{null!=e&&e.type&&t.includes(e.type)&&(n[e.type]?n[e.type]++:n[e.type]=1)})),n},N=(e,t,n)=>{let r=10,i=R(t,[e])[e],o=t.findIndex(n);for(;i>1&&o>-1&&r-- >0;)t.splice(o,1),o=t.findIndex(n),i=R(t,[e])[e]},P=e=>{let t=!1;return{transformedAdf:(0,o.f)(e,{mediaSingle:e=>{var n;if(null==e||null===(n=e.content)||void 0===n||!n.length)return;const r=R(e.content,["media","caption"]);return Object.values(r).some((e=>e>1))?(t=!0,((e,t)=>{if(!e.content)return;const n=[...e.content];return Object.keys(t).forEach((e=>{N(e,n,(t=>(null==t?void 0:t.type)===e&&v(t))),N(e,n,(t=>(null==t?void 0:t.type)===e))})),(0,i.Z)((0,i.Z)({},e),{},{content:n})})(e,r)):void 0}}),isTransformed:t}};var C=n(731462),T=n(431676),O=n(898933),D=n(454812);var I=n(326482),k=n(306014);const $=e=>{let t=-1,n=-1;return e.mapping.maps.forEach(((r,i)=>{r.forEach(((r,o)=>{const s=e.mapping.slice(i).map(r,-1),a=e.mapping.slice(i).map(o);t=s<t||-1===t?s:t,n=a>n||-1===n?a:n}))})),-1!==t?{from:t,to:n}:null};function M(e){return 1===e.depth}function _(e){const t=e.content.firstChild;return!(1!==e.childCount||!t)&&(0,O.bG)(t)}function F(e){const{selection:t}=e,{$cursor:n,$anchor:r}=t;if(!n)return!1;const i=n.nodeBefore;if(!i)return!1;if("text"===i.type.name&&"{"===i.text){return 0===r.node().marks.length&&M(r)}return!1}function V(e,t,n){const r=$(e);r&&e.doc.nodesBetween(r.from,r.to,t,n)}function j(e,t,n,i,o,a){if(!t)return;let c;if("string"==typeof t)try{if(o){c=o.parse(t).toJSON()}else c=JSON.parse(t)}catch(p){return void console.error(`Error processing value: ${t} isn't a valid JSON`)}else c=t;var l;if(Array.isArray(c))console.error(`Error processing value: ${c} is an array, but it must be an object.`);else try{if("doc"===c.type&&(Array.isArray(c.content)&&0===c.content.length&&c.content.push({type:"paragraph",content:[]}),c.version||(c.version=1)),o)return C.NB.fromJSON(e,c);let{transformedAdf:t,isTransformed:l}=(0,r.e)(c);l&&a&&a({action:T.om.MEDIA_LINK_TRANSFORMED,actionSubject:T.Wt.EDITOR,eventType:T.Ze.OPERATIONAL}),({transformedAdf:t,isTransformed:l}=s(t)),l&&a&&a({action:T.om.TEXT_LINK_MARK_TRANSFORMED,actionSubject:T.Wt.EDITOR,eventType:T.Ze.OPERATIONAL});let p=[];({transformedAdf:t,isTransformed:l,discardedMarks:p}=d(t)),l&&a&&a({action:T.om.DEDUPE_MARKS_TRANSFORMED_V2,actionSubject:T.Wt.EDITOR,eventType:T.Ze.OPERATIONAL,attributes:{discardedMarkTypes:p.map((e=>e.type))}}),({transformedAdf:t,isTransformed:l}=E(t)),l&&a&&a({action:T.om.NODES_MISSING_CONTENT_TRANSFORMED,actionSubject:T.Wt.EDITOR,eventType:T.Ze.OPERATIONAL}),({transformedAdf:t,isTransformed:l}=A(t)),l&&a&&a({action:T.om.INDENTATION_MARKS_TRANSFORMED,actionSubject:T.Wt.EDITOR,eventType:T.Ze.OPERATIONAL}),({transformedAdf:t,isTransformed:l}=P(t)),l&&a&&a({action:T.om.INVALID_MEDIA_CONTENT_TRANSFORMED,actionSubject:T.Wt.EDITOR,eventType:T.Ze.OPERATIONAL});const u=(0,k.gh)(e,t||c,a);let m=W(u,n,i);const v=C.NB.fromJSON(e,m);try{v.check()}catch(h){throw a&&a({action:T.om.INVALID_PROSEMIRROR_DOCUMENT,actionSubject:T.Wt.EDITOR,eventType:T.Ze.OPERATIONAL}),h}return a&&(0,I.cn)(v,e,a),v}catch(p){if(a&&a({action:T.om.DOCUMENT_PROCESSING_ERROR,actionSubject:T.Wt.EDITOR,eventType:T.Ze.OPERATIONAL}),console.error(`Error processing document:\n${p instanceof Error?p.message:String(p)}\n\n`,JSON.stringify(c)),(l=p)instanceof RangeError&&(l.message.match(/^Invalid collection of marks for node/)||l.message.match(/^Invalid content for node/)))throw p;return}}const W=(e,t,n)=>n&&t?function(e,t){const n=new Map;let r=!1;const s=(0,o.f)(e,{mention:e=>{if(e.attrs&&e.attrs.text){r=!0;const t=e.attrs.text,i=t.startsWith("@")?t.slice(1):t;n.set(e.attrs.id,i)}return(0,i.Z)((0,i.Z)({},e),{},{attrs:(0,i.Z)((0,i.Z)({},e.attrs),{},{text:""})})}});if(r&&t){const e=(r,i)=>{i&&i.then((r=>{(0,D.bj)(r)&&(n.forEach(((e,t)=>{r.cacheMentionName(t,e)})),n.clear(),t.unsubscribe("mentionProvider",e))}))};t.subscribe("mentionProvider",e)}return s}(e,t):e;function L(e){if(e.isInline)return(t=e).isText?!!t.textContent.trim():"hardBreak"!==t.type.name;if(e.isBlock&&(e.isLeaf||e.isAtom))return!0;if(!e.childCount)return!1;var t;for(let n=0;n<e.childCount;n++){const t=e.child(n);if(!["paragraph","text","hardBreak"].includes(t.type.name)||L(t))return!0}return!1}const B=e=>e.selection.$to.parent.type===e.schema.nodes.paragraph&&e.selection.$to.pos===e.doc.resolve(e.selection.$to.pos).end();function U(e){return function({tr:e,doc:t}){const n=[],r=$(e);if(!r)return n;const i=Math.min(t.nodeSize-2,r.from),o=Math.min(t.nodeSize-2,r.to);return t.nodesBetween(i,o,((e,t)=>{n.push({node:e,pos:t})})),n}({tr:e,doc:e.doc})}},898933:(e,t,n)=>{n.d(t,{B0:()=>v,Jt:()=>b,L7:()=>h,Ui:()=>m,Ws:()=>d,bG:()=>a,bj:()=>l,dL:()=>u,hT:()=>p,o:()=>g,uM:()=>x,v1:()=>c,vJ:()=>f,w7:()=>y});var r=n(443998),i=n(930487),o=n(986487),s=n(481838);function a(e){return!!e&&"paragraph"===e.type.name&&!e.childCount}const d=e=>e&&e.hasOwnProperty("slice");function c(e,t){let n=!1;return d(e)?(e.slice.content.descendants((e=>(t.has(e.type)&&(n=!0),!n))),n):n}const l=e=>{if(!(e instanceof i.Pu||e instanceof i.FC))return null;return e.slice},p=e=>e instanceof r.Bs,h=e=>(0,s.oq)(e,"td")||(0,s.oq)(e,"th"),u=e=>{const{content:t}=e;return!!t.lastChild&&"mediaGroup"===t.lastChild.type.name},m=(e,t)=>{const{state:n,dispatch:i}=e;if(!isFinite(t))return;i(n.tr.setSelection(r.qv.create(n.doc,t)))};function v(e,t,n){const{state:i,dispatch:o}=e;o(i.tr.setSelection(r.Bs.create(i.doc,t,n)))}function f(e){return null!=e}const y=(e,t)=>"number"==typeof e&&(e>=0&&e<=t.doc.resolve(0).end()),g=e=>(0,o.bw)(e.schema.nodes.layoutSection)(e.selection);function x(e,t,n,r){const i=[];return e.nodesBetween(t,n,((e,t,n)=>{r(e,t,n)&&i.push({node:e,pos:t})})),i}const b=(e,t)=>{const{selection:n,schema:r}=e;let{tr:i}=e;const o=t.filter(Boolean);if(0===o.length)return;let s=!1;const a=e=>o.indexOf(e.type)>-1;return e.doc.nodesBetween(n.from,n.to,((t,n)=>{if(t.type===r.nodes.paragraph&&t.marks.some(a)){s=!0;const r=e.doc.resolve(n),o=t.marks.filter(w(a));i=i.setNodeMarkup(r.pos,void 0,t.attrs,o)}})),s?i:void 0},w=e=>t=>!e(t)},306665:(e,t,n)=>{n.d(t,{Rz:()=>d,qH:()=>l,vy:()=>c});var r=n(431676),i=n(679997);let o=0;const s=100,a=7;function d(e){var t,n;const r=e.state.analyticsPlugin$;const i=r&&r.performanceTracking&&r.performanceTracking.nodeViewTracking||{},o=null!==(t=i.samplingRate)&&void 0!==t?t:s,d=null!==(n=i.slowThreshold)&&void 0!==n?n:a;return{trackingEnabled:!!i.enabled,samplingRate:o,slowThreshold:d}}function c({nodeTypeName:e}){(0,i.MZ)(`🦉${e}::ReactNodeView`)}function l({nodeTypeName:e,dispatchAnalyticsEvent:t,samplingRate:n,slowThreshold:s}){(0,i.H0)(`🦉${e}::ReactNodeView`,(i=>{++o%n==0&&i>s&&t({action:r.om.REACT_NODEVIEW_RENDERED,actionSubject:r.Wt.EDITOR,eventType:r.Ze.OPERATIONAL,attributes:{node:e,duration:i}})}))}},152475:(e,t,n)=>{n.d(t,{$:()=>r,V:()=>i});const r="​",i="‍"},131819:(e,t,n)=>{n.d(t,{f:()=>h});var r=n(615919),i=n(199009),o=n(840506),s=n(329687),a=n.n(s),d=n(431676),c=n(244625),l=n(679997),p=n(667266);class h extends o.Component{constructor(e,t){super(e,t),(0,i.Z)(this,"listeners",{}),(0,i.Z)(this,"debounce",null),(0,i.Z)(this,"notAppliedState",{}),(0,i.Z)(this,"isSubscribed",!1),(0,i.Z)(this,"callsCount",0),(0,i.Z)(this,"context",void 0),(0,i.Z)(this,"state",void 0),(0,i.Z)(this,"handlePluginStateChange",((e,t,n,r)=>i=>{(this.state[e]!==i||r)&&this.updateState({stateSubset:{[e]:i},pluginName:t,performanceOptions:n})})),(0,i.Z)(this,"updateState",(({stateSubset:e,pluginName:t,performanceOptions:n})=>{this.notAppliedState=(0,r.Z)((0,r.Z)({},this.notAppliedState),e),this.debounce&&window.clearTimeout(this.debounce);const i=!1!==this.props.debounce?e=>window.setTimeout(e,0):e=>e();this.debounce=i((()=>{const e=`🦉${t}::WithPluginState`;n.trackingEnabled&&(0,l.MZ)(e),this.setState(this.notAppliedState,(()=>{n.trackingEnabled&&(0,l.H0)(e,(e=>{++this.callsCount%n.samplingRate==0&&e>n.slowThreshold&&this.dispatchAnalyticsEvent({action:d.om.WITH_PLUGIN_STATE_CALLED,actionSubject:d.Wt.EDITOR,eventType:d.Ze.OPERATIONAL,attributes:{plugin:t,duration:e}})}))})),this.debounce=null,this.notAppliedState={}}))})),(0,i.Z)(this,"dispatchAnalyticsEvent",(e=>{const t=this.getEventDispatcher();if(t){(0,c.h)(t)(p.DQ,{payload:e})}})),(0,i.Z)(this,"onContextUpdate",(()=>{this.subscribe(this.props)})),this.state=this.getPluginsStates(this.props.plugins,this.getEditorView(e,t))}getEditorView(e,t){const n=e||this.props,r=t||this.context;return n.editorView||r&&r.editorActions&&r.editorActions._privateGetEditorView()||r&&r.editorSharedConfig&&r.editorSharedConfig.editorView}getEventDispatcher(e){return(e||this.props).eventDispatcher||this.context&&this.context.editorActions&&this.context.editorActions._privateGetEventDispatcher()||this.context&&this.context.editorSharedConfig&&this.context.editorSharedConfig.eventDispatcher}getPluginsStates(e,t){if(!t||!e)return{};return Object.keys(e).reduce(((n,r)=>{const i=e[r];return i?(n[r]=i.getState(t.state),n):n}),{})}subscribe(e){var t,n;const r=e.plugins,i=this.getEventDispatcher(e),o=this.getEditorView(e);if(!i||!o||this.isSubscribed)return;const s=o.state.analyticsPlugin$;const a=s&&s.performanceTracking&&s.performanceTracking.uiTracking||{},d=!0===a.enabled,c=null!==(t=a.samplingRate)&&void 0!==t?t:100,l=null!==(n=a.slowThreshold)&&void 0!==n?n:4;this.isSubscribed=!0;const p=this.getPluginsStates(r,o);this.setState(p),Object.keys(r).forEach((e=>{const t=r[e];if(!t)return;const n=t.key,o=p[e],s=o&&o.subscribe,a=this.handlePluginStateChange(e,n,{samplingRate:c,slowThreshold:l,trackingEnabled:d},s);s?o.subscribe(a):i.on(t.key,a),this.listeners[t.key]={handler:a,pluginKey:t}}))}unsubscribe(){const e=this.getEventDispatcher(),t=this.getEditorView();e&&t&&this.isSubscribed&&(Object.keys(this.listeners).forEach((n=>{const r=this.listeners[n].pluginKey.getState(t.state);r&&r.unsubscribe?r.unsubscribe(this.listeners[n].handler):e.off(n,this.listeners[n].handler)})),this.listeners=[])}subscribeToContextUpdates(e){e&&e.editorActions&&e.editorActions._privateSubscribe(this.onContextUpdate)}unsubscribeFromContextUpdates(e){e&&e.editorActions&&e.editorActions._privateUnsubscribe(this.onContextUpdate)}componentDidMount(){this.subscribe(this.props),this.subscribeToContextUpdates(this.context)}UNSAFE_componentWillReceiveProps(e){this.isSubscribed||this.subscribe(e)}componentWillUnmount(){this.debounce&&window.clearTimeout(this.debounce),this.unsubscribeFromContextUpdates(this.context),this.unsubscribe()}render(){const{render:e}=this.props;return e(this.state)}}h.displayName="WithPluginState",(0,i.Z)(h,"displayName","WithPluginState"),(0,i.Z)(h,"contextTypes",{editorActions:a().object,editorSharedConfig:a().object})}}]);
//# sourceMappingURL=3421.BipwlEQOQo.js.map